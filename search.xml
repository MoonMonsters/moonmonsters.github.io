<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>[è½¬]Vue -- Vueé¡¹ç›®å¯åŠ¨ä»£ç æ‰§è¡Œæµç¨‹åˆ†æ</title>
    <url>/2021/05/29/%E8%BD%AC-vue-Vue%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h3 id="è½¬è½½"><a href="#è½¬è½½" class="headerlink" title="è½¬è½½"></a>è½¬è½½</h3><p><a href="https://blog.csdn.net/IT__learning/article/details/114294180" target="_blank" rel="noopener">Vueæ–‡ä»¶åŠ è½½æ‰§è¡Œæµç¨‹</a></p>
<h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ä¸€èˆ¬ä¸€ä¸ªåˆæ­¥çš„Vueé¡¹ç›®åˆ›å»ºå¥½ä¹‹åéƒ½ä¼šæœ‰è¿™ä¸‰ä¸ªæ–‡ä»¶ï¼š<code>index.html</code> ã€<code>main.js</code> å’Œ<code>App.js</code>ã€‚</p>
<h3 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h3><p>Vueæ˜¯å•é¡µé¢å½¢å¼å¼€å‘ï¼Œindex.htmlæ–‡ä»¶åœ¨å…¶ä¸­èµ·ç€ç‰¹åˆ«é‡è¦çš„ä½œç”¨ã€‚æ‰€æœ‰ç»„ä»¶ï¼ˆåç¼€åä¸º.vueéƒ½è¢«è§†ä¸ºç»„ä»¶ï¼‰éƒ½ä¼šé€šè¿‡æ­¤æ–‡ä»¶è¿›è¡Œæ¸²æŸ“åŠ è½½ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>y<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- built files will be auto injected --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨bodyä½“ä¸­åªæœ‰ä¸€ä¸ªdivæ ‡ç­¾ï¼Œå…¶idä¸ºapp,è¿™ä¸ªidå°†ä¼šè¿æ¥åˆ°src/main.jså†…å®¹</p>
<h3 id="main-js"><a href="#main-js" class="headerlink" title="main.js"></a>main.js</h3><p>ç›¸å½“äºä¸€ä¸ªC/Javaä¸­çš„å…¥å£å‡½æ•°ï¼Œæ§åˆ¶ç€åˆæ¬¡å¯åŠ¨Vueé¡¹ç›®è¦åŠ è½½çš„ç»„ä»¶ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'./router'</span></span><br><span class="line"><span class="keyword">import</span> lhj <span class="keyword">from</span> <span class="string">'./components/lhj'</span></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">"axios"</span>;</span><br><span class="line"><span class="keyword">import</span> VueAxios <span class="keyword">from</span> <span class="string">"vue-axios"</span>;</span><br><span class="line">Vue.use(VueAxios,axios)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* eslint-disable no-new */</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  router,</span><br><span class="line">  components: &#123; App &#125;,</span><br><span class="line">  template: <span class="string">'&lt;App/&gt;'</span>,</span><br><span class="line">  watch:&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>åœ¨main.jsä¸­ï¼Œæ–°å»ºäº†ä¸€ä¸ªvueå®ä¾‹ï¼Œå¹¶ä½¿ç”¨elï¼š#appé“¾æ¥åˆ°index.htmlä¸­çš„appï¼Œå¹¶ä½¿ç”¨templateå¼•å…¥ç»„ä»¶å’Œè·¯ç”±ç›¸å…³çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡main.jsæˆ‘ä»¬å…³è”åˆ°App.vueç»„ä»¶ã€‚</p>
<p>ï¼ˆ1ï¼‰import A from â€˜Bâ€™ <br/><br>è¿™ç±»è¯­å¥ç›¸å½“äºå¼•å…¥Bï¼ˆè¿™ä¸€èˆ¬æ˜¯è·¯å¾„ï¼‰ç„¶åç»™å®ƒèµ·ä¸ªåå­—å«åšAï¼›<br/><br>ï¼ˆ2ï¼‰Vue.useï¼ˆCï¼‰<br/><br>è¿™ä¸ªæ„æ€æ˜¯å…¨å±€æ–¹æ³•å®šä¹‰Cã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®šä¹‰ä»¥åä½ å¯ä»¥åœ¨è¿™ä¸ªVueé¡¹ç›®çš„ä»»æ„åœ°æ–¹ä½¿ç”¨è¯¥ç»„ä»¶ã€‚<br/><br>ï¼ˆ3ï¼‰el: â€˜#appâ€™<br/><br>è¿™ä¸ªå’Œindex.htmlä¸­çš„ç›¸æŒ‚é’©ã€‚<br/></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- built files will be auto injected --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ¨¡æ¿å°†ä¼šæ›¿æ¢æŒ‚è½½çš„å…ƒç´ ï¼ŒæŒ‚è½½å…ƒç´ çš„å†…å®¹éƒ½å°†è¢«å¿½ç•¥ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´:template: â€˜&lt; App/&gt;â€™ è¡¨ç¤ºç”¨&lt; app&gt;&lt; /app&gt;æ›¿æ¢index.htmlé‡Œé¢çš„&lt; div id=â€œappâ€&gt;ï¼Œç„¶åindex.htmlæ–‡ä»¶è¢«åˆæ­¥è§£æä¸ºè¿™ç§å½¢å¼</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"myapp"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">app</span>&gt;</span><span class="tag">&lt;/<span class="name">app</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ï¼ˆ4ï¼‰watch ï¼š ç”¨æ¥ç›‘å¬è·¯ç”±çš„å˜åŒ–ï¼Œå¯ä»¥ç”¨æ¥å®šä¹‰é¡µé¢åˆ‡æ¢æ—¶è¿‡æ¸¡æ•ˆæœã€‚</p>
<h3 id="App-vue"><a href="#App-vue" class="headerlink" title="App.vue"></a>App.vue</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">    &lt;img src&#x3D;&quot;.&#x2F;assets&#x2F;logo.png&quot;&gt;</span><br><span class="line">    &lt;router-view&#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#39;App&#39;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;style&gt;</span><br><span class="line">#app &#123;</span><br><span class="line">  font-family: &#39;Avenir&#39;, Helvetica, Arial, sans-serif;</span><br><span class="line">  -webkit-font-smoothing: antialiased;</span><br><span class="line">  -moz-osx-font-smoothing: grayscale;</span><br><span class="line">  text-align: center;</span><br><span class="line">  color: #2c3e50;</span><br><span class="line">  margin-top: 60px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<p>æ ‡å‡†çš„App.vueæ¨¡æ¿çš„å½¢å¼ï¼ŒåŒ…å«äº†<code>&lt;template&gt;&lt;/template&gt;</code>ã€<code>&lt;script&gt;&lt;/script&gt;</code>ã€<code>&lt;style&gt;&lt;/style&gt;</code>ä¸‰éƒ¨åˆ†ã€‚<br>ï¼ˆ1ï¼‰exportä¸­çš„nameå±æ€§ï¼Œç›¸å½“äºç»™è¿™ä¸ªç»„ä»¶å®šä¹‰ä¸€ä¸ªåå­—ï¼Œä¾¿äºè¯†åˆ«å’Œä½¿ç”¨ã€‚<br/><br>ï¼ˆ2ï¼‰&lt; template&gt;æ ‡ç­¾ä¸‹ï¼Œé™¤äº†&lt; img&gt;æ ‡ç­¾å¤–ï¼Œè¿˜æœ‰&lt; router-view&gt;æ ‡ç­¾ï¼Œ&lt; router-view&gt;æ ‡ç­¾å°†ä¼šæŠŠè·¯ç”±ç›¸å…³å†…å®¹æ¸²æŸ“åœ¨è¿™ä¸ªåœ°æ–¹ã€‚è·¯ç”±çš„å†…å®¹å®šä¹‰åœ¨src/router/index.jsæ–‡ä»¶ä¸­ã€‚<br/></p>
<h3 id="src-router-index-js"><a href="#src-router-index-js" class="headerlink" title="src/router/index.js"></a>src/router/index.js</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> HelloWorld <span class="keyword">from</span> <span class="string">'@/components/HelloWorld'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Router)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/'</span>,</span><br><span class="line">      name: <span class="string">'HelloWorld'</span>,</span><br><span class="line">      component: HelloWorld</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>åœ¨index.jsçš„ä»£ç ä¸­ï¼Œå»ºç«‹äº†è·¯ç”±ç›¸å…³çš„å†…å®¹ï¼Œä¹Ÿå°±ä¼šæ¸²æŸ“åˆ°app.vueä¸‹é¢çš„&lt; router-view&gt;ä¸­ã€‚<br/><br>ï¼ˆ1ï¼‰å¼•å…¥ç»„ä»¶çš„ä»£ç <br/><br>å¼•å…¥çš„æ—¶å€™æ³¨æ„å¥½æ ¼å¼ã€è·¯å¾„å°±è¡Œã€‚<br/><br>ï¼ˆ2ï¼‰routeså®šä¹‰<br/><br>â— pathï¼šé¡µé¢é—´è·¯ç”±è·³è½¬çš„è·¯å¾„ï¼›<br/><br>â— nameï¼šè¯¥è·¯ç”±çš„åç§°ï¼›<br/><br>â— componentï¼šç»„ä»¶åï¼Œè¦å’Œä½ å¼•å…¥ç»„ä»¶æ—¶å®šä¹‰çš„åå­—ä¿æŒä¸€è‡´ã€‚<br/></p>
<h3 id="VueåŠ è½½æ—¶æ–‡ä»¶çš„æ‰§è¡Œé¡ºåº"><a href="#VueåŠ è½½æ—¶æ–‡ä»¶çš„æ‰§è¡Œé¡ºåº" class="headerlink" title="VueåŠ è½½æ—¶æ–‡ä»¶çš„æ‰§è¡Œé¡ºåº"></a>VueåŠ è½½æ—¶æ–‡ä»¶çš„æ‰§è¡Œé¡ºåº</h3><p>1ã€æ‰§è¡Œindex.htmlæ–‡ä»¶ <br/><br>2ã€æ‰§è¡Œmain.jsæ–‡ä»¶ <br/><br>3ã€main.jsæŒ‚è½½äº†app.vueæ–‡ä»¶ï¼Œç”¨app.vueçš„templeteæ›¿æ¢index.htmlä¸­çš„<br/><br>4ã€main.jsä¸­æ³¨å…¥äº†è·¯ç”±æ–‡ä»¶ï¼Œå°†å¯¹åº”çš„ç»„ä»¶æ¸²æŸ“åˆ°router-viewä¸­<br/> 5ã€router-viewä¸­åŠ è½½Layoutæ–‡ä»¶<br/><br>6ã€Layout åŠ è½½Navbar, Sidebar, AppMain</p>
<h3 id="Vueå†…éƒ¨é¡µé¢çš„æ‰§è¡Œé¡ºåº"><a href="#Vueå†…éƒ¨é¡µé¢çš„æ‰§è¡Œé¡ºåº" class="headerlink" title="Vueå†…éƒ¨é¡µé¢çš„æ‰§è¡Œé¡ºåº"></a>Vueå†…éƒ¨é¡µé¢çš„æ‰§è¡Œé¡ºåº</h3><p>Vue æ¨èåœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨ template æ¥åˆ›å»ºä½ çš„ HTMLã€‚ä½†æ˜¯æ¨¡æ¿æ¯•ç«Ÿæ˜¯æ¨¡æ¿ï¼Œä¸æ˜¯çœŸå®çš„domèŠ‚ç‚¹ã€‚ä»æ¨¡æ¿åˆ°çœŸå®domèŠ‚ç‚¹è¿˜éœ€è¦ç»è¿‡ä¸€äº›æ­¥éª¤ï¼š<br/></p>
<p>1ã€æŠŠæ¨¡æ¿ç¼–è¯‘ä¸ºrenderå‡½æ•° <br/><br>2ã€å®ä¾‹è¿›è¡ŒæŒ‚è½½,æ ¹æ®æ ¹èŠ‚ç‚¹renderå‡½æ•°çš„è°ƒç”¨ï¼Œé€’å½’çš„ç”Ÿæˆè™šæ‹Ÿdom<br/><br>3ã€å¯¹æ¯”è™šæ‹Ÿdomï¼Œæ¸²æŸ“åˆ°çœŸå®dom<br/><br>4ã€ç»„ä»¶å†…éƒ¨dataå‘ç”Ÿå˜åŒ–ï¼Œç»„ä»¶å’Œå­ç»„ä»¶å¼•ç”¨dataä½œä¸ºpropsé‡æ–°è°ƒç”¨renderå‡½æ•°ï¼Œç”Ÿæˆè™šæ‹Ÿdom, è¿”å›åˆ°æ­¥éª¤3</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]Vue -- axiosæ‹¦æˆªå™¨</title>
    <url>/2021/05/29/%E8%BD%AC-vue-axios%E6%8B%A6%E6%88%AA%E5%99%A8/</url>
    <content><![CDATA[<h3 id="è½¬è½½"><a href="#è½¬è½½" class="headerlink" title="è½¬è½½"></a>è½¬è½½</h3><p><a href="https://hupeip.github.io/2018/10/08/axios%E6%8B%A6%E6%88%AA%E5%99%A8/" target="_blank" rel="noopener">axiosæ‹¦æˆªå™¨</a></p>
<h3 id="axiosæ‹¦æˆªå™¨ç®€å•ä»‹ç»"><a href="#axiosæ‹¦æˆªå™¨ç®€å•ä»‹ç»" class="headerlink" title="axiosæ‹¦æˆªå™¨ç®€å•ä»‹ç»"></a>axiosæ‹¦æˆªå™¨ç®€å•ä»‹ç»</h3><p>é¡µé¢å‘é€httpè¯·æ±‚ï¼Œå¾ˆå¤šæƒ…å†µæˆ‘ä»¬è¦å¯¹è¯·æ±‚å’Œå…¶å“åº”è¿›è¡Œç‰¹å®šçš„å¤„ç†ï¼›å¦‚æœè¯·æ±‚æ•°éå¸¸å¤šï¼Œå•ç‹¬å¯¹æ¯ä¸€ä¸ªè¯·æ±‚è¿›è¡Œå¤„ç†ä¼šå˜å¾—éå¸¸éº»çƒ¦ï¼Œç¨‹åºçš„ä¼˜é›…æ€§ä¹Ÿä¼šå¤§æ‰“æŠ˜æ‰£ã€‚å¥½åœ¨å¼ºå¤§çš„axiosä¸ºå¼€å‘è€…æä¾›äº†è¿™æ ·ä¸€ä¸ªAPIï¼šæ‹¦æˆªå™¨ã€‚æ‹¦æˆªå™¨åˆ†ä¸º è¯·æ±‚ï¼ˆrequestï¼‰æ‹¦æˆªå™¨å’Œ å“åº”ï¼ˆresponseï¼‰æ‹¦æˆªå™¨ã€‚</p>
<h4 id="è¯·æ±‚æ‹¦æˆªå™¨"><a href="#è¯·æ±‚æ‹¦æˆªå™¨" class="headerlink" title="è¯·æ±‚æ‹¦æˆªå™¨"></a>è¯·æ±‚æ‹¦æˆªå™¨</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">axios.interceptors.request.use(function (config) &#123;</span><br><span class="line">    // åœ¨å‘èµ·è¯·æ±‚è¯·åšä¸€äº›ä¸šåŠ¡å¤„ç†</span><br><span class="line">    return config;</span><br><span class="line">  &#125;, function (error) &#123;</span><br><span class="line">    // å¯¹è¯·æ±‚å¤±è´¥åšå¤„ç†</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="å“åº”æ‹¦æˆªå™¨"><a href="#å“åº”æ‹¦æˆªå™¨" class="headerlink" title="å“åº”æ‹¦æˆªå™¨"></a>å“åº”æ‹¦æˆªå™¨</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">axios.interceptors.response.use(function (response) &#123;</span><br><span class="line">    // å¯¹å“åº”æ•°æ®åšå¤„ç†</span><br><span class="line">    return response;</span><br><span class="line">  &#125;, function (error) &#123;</span><br><span class="line">    // å¯¹å“åº”é”™è¯¯åšå¤„ç†</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="vueæ·»åŠ axiosæ‹¦æˆªå™¨"><a href="#vueæ·»åŠ axiosæ‹¦æˆªå™¨" class="headerlink" title="vueæ·»åŠ axiosæ‹¦æˆªå™¨"></a>vueæ·»åŠ axiosæ‹¦æˆªå™¨</h3><h4 id="å®‰è£…-axios"><a href="#å®‰è£…-axios" class="headerlink" title="å®‰è£… axios"></a>å®‰è£… axios</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install axios â€“save-dev</span><br></pre></td></tr></table></figure>

<h4 id="æ–°å»ºæ–‡ä»¶-axios-js"><a href="#æ–°å»ºæ–‡ä»¶-axios-js" class="headerlink" title="æ–°å»ºæ–‡ä»¶ axios.js"></a>æ–°å»ºæ–‡ä»¶ axios.js</h4><p>å¼€å§‹ç»Ÿä¸€å°è£…axiosï¼Œ é¦–å…ˆå¼•å…¥axiosã€qsä¾èµ–</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">"axios"</span>;</span><br><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">"qs"</span>;</span><br></pre></td></tr></table></figure>
<p>ç„¶ååˆ›å»ºä¸€ä¸ªaxioså®ä¾‹ï¼Œè¿™ä¸ªprocess.env.BASE_URLåœ¨config/dev.evn.jsã€prod.evn.jsé‡Œé¢è¿›è¡Œé…ç½®ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/****** åˆ›å»ºaxioså®ä¾‹ ******/</span></span><br><span class="line"><span class="keyword">const</span> service = axios.create(&#123;</span><br><span class="line">    baseURL: process.env.BASE_URL,  <span class="comment">// apiçš„base_url</span></span><br><span class="line">    timeout: <span class="number">5000</span>  <span class="comment">// è¯·æ±‚è¶…æ—¶æ—¶é—´</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="ä½¿ç”¨requestæ‹¦æˆªå™¨å¯¹axiosè¯·æ±‚é…ç½®åšç»Ÿä¸€å¤„ç†"><a href="#ä½¿ç”¨requestæ‹¦æˆªå™¨å¯¹axiosè¯·æ±‚é…ç½®åšç»Ÿä¸€å¤„ç†" class="headerlink" title="ä½¿ç”¨requestæ‹¦æˆªå™¨å¯¹axiosè¯·æ±‚é…ç½®åšç»Ÿä¸€å¤„ç†"></a>ä½¿ç”¨requestæ‹¦æˆªå™¨å¯¹axiosè¯·æ±‚é…ç½®åšç»Ÿä¸€å¤„ç†</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">service.interceptors.request.use(<span class="function"><span class="params">config</span> =&gt;</span> &#123;    </span><br><span class="line">    app.$vux.loading.show(&#123;        </span><br><span class="line">        text: <span class="string">'æ•°æ®åŠ è½½ä¸­â€¦â€¦'</span>    </span><br><span class="line">    &#125;);     </span><br><span class="line">    config.method === <span class="string">'post'</span>        </span><br><span class="line">        ? config.data = qs.stringify(&#123;...config.data&#125;)        </span><br><span class="line">        : config.params = &#123;...config.params&#125;;    </span><br><span class="line">    config.headers[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded'</span>;     </span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">    &#125;, error =&gt; &#123;  <span class="comment">//è¯·æ±‚é”™è¯¯å¤„ç†   </span></span><br><span class="line">        app.$vux.toast.show(&#123;        </span><br><span class="line">            type: <span class="string">'warn'</span>,        </span><br><span class="line">            text: error   </span><br><span class="line">        &#125;);    </span><br><span class="line">        <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="å¯¹responseåšç»Ÿä¸€å¤„ç†"><a href="#å¯¹responseåšç»Ÿä¸€å¤„ç†" class="headerlink" title="å¯¹responseåšç»Ÿä¸€å¤„ç†"></a>å¯¹responseåšç»Ÿä¸€å¤„ç†</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">service.interceptors.response.use(    </span><br><span class="line">    response =&gt; &#123;  <span class="comment">//æˆåŠŸè¯·æ±‚åˆ°æ•°æ®        </span></span><br><span class="line">        app.$vux.loading.hide();        </span><br><span class="line">        <span class="comment">//è¿™é‡Œæ ¹æ®åç«¯æä¾›çš„æ•°æ®è¿›è¡Œå¯¹åº”çš„å¤„ç†        </span></span><br><span class="line">        <span class="keyword">if</span> (response.data.result === <span class="string">'TRUE'</span>) &#123;            </span><br><span class="line">            <span class="keyword">return</span> response.data;        </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;            </span><br><span class="line">            app.$vux.toast.show(&#123;  </span><br><span class="line">                <span class="comment">//å¸¸è§„é”™è¯¯å¤„ç†                </span></span><br><span class="line">                type: <span class="string">'warn'</span>,                </span><br><span class="line">                text: response.data.data.msg            </span><br><span class="line">            &#125;);        </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;,    </span><br><span class="line">    error =&gt; &#123;  <span class="comment">//å“åº”é”™è¯¯å¤„ç†console.log('error');        </span></span><br><span class="line">        <span class="built_in">console</span>.log(error);        </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(error));         </span><br><span class="line">        <span class="keyword">let</span> text = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(error)).response.status === <span class="number">404</span>            </span><br><span class="line">            ? <span class="string">'404'</span>            </span><br><span class="line">            : <span class="string">'ç½‘ç»œå¼‚å¸¸ï¼Œè¯·é‡è¯•'</span>;        </span><br><span class="line">        app.$vux.toast.show(&#123;            </span><br><span class="line">            type: <span class="string">'warn'</span>,            </span><br><span class="line">            text: text        </span><br><span class="line">        &#125;);         </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)   </span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="å°†axioså®ä¾‹æš´éœ²å‡ºå»"><a href="#å°†axioså®ä¾‹æš´éœ²å‡ºå»" class="headerlink" title="å°†axioså®ä¾‹æš´éœ²å‡ºå»"></a>å°†axioså®ä¾‹æš´éœ²å‡ºå»</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€ä¸ªç®€å•çš„æ‹¦æˆªå™¨å°±å®Œæˆäº†</p>
<h4 id="åœ¨main-jsä¸­è¿›è¡Œå¼•ç”¨ï¼Œå¹¶é…ç½®ä¸€ä¸ªåˆ«åï¼ˆ-ajaxï¼‰æ¥è¿›è¡Œè°ƒç”¨"><a href="#åœ¨main-jsä¸­è¿›è¡Œå¼•ç”¨ï¼Œå¹¶é…ç½®ä¸€ä¸ªåˆ«åï¼ˆ-ajaxï¼‰æ¥è¿›è¡Œè°ƒç”¨" class="headerlink" title="åœ¨main.jsä¸­è¿›è¡Œå¼•ç”¨ï¼Œå¹¶é…ç½®ä¸€ä¸ªåˆ«åï¼ˆ$ajaxï¼‰æ¥è¿›è¡Œè°ƒç”¨"></a>åœ¨main.jsä¸­è¿›è¡Œå¼•ç”¨ï¼Œå¹¶é…ç½®ä¸€ä¸ªåˆ«åï¼ˆ$ajaxï¼‰æ¥è¿›è¡Œè°ƒç”¨</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'../axios.js'</span>    <span class="comment">//axios.jsçš„è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">Vue.prototype.$ajax = axios</span><br></pre></td></tr></table></figure>

<h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><h4 id="åº”ç”¨ï¼šä¸€ä¸ªç®€å•çš„ç™»å½•æ¥å£"><a href="#åº”ç”¨ï¼šä¸€ä¸ªç®€å•çš„ç™»å½•æ¥å£" class="headerlink" title="åº”ç”¨ï¼šä¸€ä¸ªç®€å•çš„ç™»å½•æ¥å£"></a>åº”ç”¨ï¼šä¸€ä¸ªç®€å•çš„ç™»å½•æ¥å£</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.$ajax(&#123;</span><br><span class="line">ã€€ã€€method: <span class="string">'post'</span>,</span><br><span class="line">ã€€ã€€url: <span class="string">'/login'</span>,</span><br><span class="line">ã€€ã€€data: &#123;</span><br><span class="line">ã€€ã€€ã€€ã€€<span class="string">'userName'</span>: <span class="string">'haha'</span>,</span><br><span class="line">ã€€ã€€ã€€ã€€<span class="string">'password'</span>: <span class="string">'123456'</span></span><br><span class="line">ã€€ã€€&#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">ã€€ã€€<span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="è·¯ç”±æ‹¦æˆª"><a href="#è·¯ç”±æ‹¦æˆª" class="headerlink" title="è·¯ç”±æ‹¦æˆª"></a>è·¯ç”±æ‹¦æˆª</h4><p>åœ¨å®šä¹‰è·¯ç”±çš„æ—¶å€™å°±éœ€è¦å¤šæ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰å­—æ®µrequireAuthï¼Œç”¨äºåˆ¤æ–­è¯¥è·¯ç”±çš„è®¿é—®æ˜¯å¦éœ€è¦ç™»å½•ã€‚å¦‚æœç”¨æˆ·å·²ç»ç™»å½•ï¼Œåˆ™é¡ºåˆ©è¿›å…¥è·¯ç”±ï¼Œå¦åˆ™å°±è¿›å…¥ç™»å½•é¡µé¢ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">'/'</span>,</span><br><span class="line">        name: <span class="string">'/'</span>,</span><br><span class="line">        component: Index</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">'/repository'</span>,</span><br><span class="line">        name: <span class="string">'repository'</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">            requireAuth: <span class="literal">true</span>,  <span class="comment">// æ·»åŠ è¯¥å­—æ®µï¼Œè¡¨ç¤ºè¿›å…¥è¿™ä¸ªè·¯ç”±æ˜¯éœ€è¦ç™»å½•çš„</span></span><br><span class="line">        &#125;,</span><br><span class="line">        component: Repository</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">'/login'</span>,</span><br><span class="line">        name: <span class="string">'login'</span>,</span><br><span class="line">        component: Login</span><br><span class="line">    &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰å®Œè·¯ç”±åï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯åˆ©ç”¨vue-routeræä¾›çš„é’©å­å‡½æ•°beforeEach()å¯¹è·¯ç”±è¿›è¡Œåˆ¤æ–­ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (to.meta.requireAuth) &#123;  <span class="comment">// åˆ¤æ–­è¯¥è·¯ç”±æ˜¯å¦éœ€è¦ç™»å½•æƒé™</span></span><br><span class="line">        <span class="keyword">if</span> (token) &#123;  <span class="comment">// åˆ¤æ–­å½“å‰çš„tokenæ˜¯å¦å­˜åœ¨</span></span><br><span class="line">            next();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            next(&#123;</span><br><span class="line">                path: <span class="string">'/login'</span>,</span><br><span class="line">                query: &#123;<span class="attr">redirect</span>: to.fullPath&#125;  <span class="comment">// å°†è·³è½¬çš„è·¯ç”±pathä½œä¸ºå‚æ•°ï¼Œç™»å½•æˆåŠŸåè·³è½¬åˆ°è¯¥è·¯ç”±</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>to.metaä¸­æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®ï¼Œå…¶ä¸­å°±åŒ…æ‹¬æˆ‘ä»¬åˆšåˆšå®šä¹‰çš„requireAuthå­—æ®µ<br>é€šè¿‡è¿™ä¸ªå­—æ®µæ¥åˆ¤æ–­è¯¥è·¯ç”±æ˜¯å¦éœ€è¦ç™»å½•æƒé™<br>éœ€è¦çš„è¯ï¼ŒåŒæ—¶å½“å‰åº”ç”¨ä¸å­˜åœ¨tokenï¼Œåˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œè¿›è¡Œç™»å½•ã€‚ç™»å½•æˆåŠŸåè·³è½¬åˆ°ç›®æ ‡è·¯ç”±ã€‚</p>
<p>è¿™ç§æ–¹å¼åªæ˜¯ç®€å•çš„å‰ç«¯è·¯ç”±æ§åˆ¶ï¼Œå¹¶ä¸èƒ½é˜»æ­¢ç”¨æˆ·è®¿é—®ï¼Œå‡è®¾æœ‰ä¸€ç§æƒ…å†µï¼šå½“å‰tokenå¤±æ•ˆäº†ï¼Œä½†æ˜¯tokenä¾ç„¶ä¿å­˜åœ¨æœ¬åœ°ã€‚è¿™æ—¶å€™ä½ å»è®¿é—®éœ€è¦ç™»å½•æƒé™çš„è·¯ç”±æ—¶ï¼Œå®é™…ä¸Šåº”è¯¥è®©ç”¨æˆ·é‡æ–°ç™»å½•ã€‚è¿™æ—¶å€™å°±éœ€è¦ç»“åˆ http æ‹¦æˆªå™¨ + åç«¯æ¥å£è¿”å›çš„http çŠ¶æ€ç æ¥åˆ¤æ–­ã€‚</p>
<h3 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h3><p>è¦æƒ³ç»Ÿä¸€å¤„ç†æ‰€æœ‰httpè¯·æ±‚å’Œå“åº”ï¼Œå°±å¾—ç”¨ä¸Š axios çš„æ‹¦æˆªå™¨ã€‚é€šè¿‡é…ç½®http response inteceptorï¼Œå½“åç«¯æ¥å£è¿”å›401 Unauthorizedï¼ˆæœªæˆæƒï¼‰ï¼Œè®©ç”¨æˆ·é‡æ–°ç™»å½•ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// http request æ‹¦æˆªå™¨</span></span><br><span class="line">axios.interceptors.request.use(</span><br><span class="line">    config =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (stoken) &#123;  <span class="comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨tokenï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œåˆ™æ¯ä¸ªhttp headeréƒ½åŠ ä¸Štoken</span></span><br><span class="line">            config.headers.Authorization = <span class="string">`token <span class="subst">$&#123;store.state.token&#125;</span>`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;,</span><br><span class="line">    err =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// http response æ‹¦æˆªå™¨</span></span><br><span class="line">axios.interceptors.response.use(</span><br><span class="line">    response =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;,</span><br><span class="line">    error =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (error.response) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (error.response.status) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">401</span>:</span><br><span class="line">                    <span class="comment">// è¿”å› 401 æ¸…é™¤tokenä¿¡æ¯å¹¶è·³è½¬åˆ°ç™»å½•é¡µé¢</span></span><br><span class="line">                    </span><br><span class="line">                    router.replace(&#123;</span><br><span class="line">                        path: <span class="string">'login'</span>,</span><br><span class="line">                        query: &#123;<span class="attr">redirect</span>: router.currentRoute.fullPath&#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error.response.data)   <span class="comment">// è¿”å›æ¥å£è¿”å›çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
  </entry>
  <entry>
    <title>Vue -- axiosè¯·æ±‚æºå¸¦cookie</title>
    <url>/2021/05/29/vue-axios%E8%AF%B7%E6%B1%82%E6%90%BA%E5%B8%A6cookie/</url>
    <content><![CDATA[<h3 id="ä¿®æ”¹vue-config-jsæ–‡ä»¶"><a href="#ä¿®æ”¹vue-config-jsæ–‡ä»¶" class="headerlink" title="ä¿®æ”¹vue.config.jsæ–‡ä»¶"></a>ä¿®æ”¹vue.config.jsæ–‡ä»¶</h3><p>åœ¨è¯¥æ–‡ä»¶ä¸­, æ·»åŠ <code>disableHostCheck: true</code>, ä¸éœ€è¦hostæ£€æŸ¥</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: port,</span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    overlay: &#123;</span><br><span class="line">      warnings: <span class="literal">false</span>,</span><br><span class="line">      errors: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    proxy: <span class="string">'http://localhost:5000'</span>,</span><br><span class="line">    disableHostCheck: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å°è£…axiosæ—¶-åŠ ä¸ŠwithCredentials"><a href="#å°è£…axiosæ—¶-åŠ ä¸ŠwithCredentials" class="headerlink" title="å°è£…axiosæ—¶, åŠ ä¸ŠwithCredentials"></a>å°è£…axiosæ—¶, åŠ ä¸ŠwithCredentials</h3><p>åœ¨å°è£…axiosæ—¶, åŠ ä¸Š<code>withCredentials: true</code><br/><br>è·¨æºè¯·æ±‚ä¸æä¾›å‡­æ®(cookieã€HTTPè®¤è¯åŠå®¢æˆ·ç«¯SSLè¯æ˜ç­‰)ã€‚é€šè¿‡å°†withCredentialså±æ€§è®¾ç½®ä¸ºtrueï¼Œå¯ä»¥æŒ‡å®šæŸä¸ªè¯·æ±‚åº”è¯¥å‘é€å‡­æ®ã€‚<br/><br>é»˜è®¤å€¼ä¸ºfalseã€‚<br/><br>trueï¼šåœ¨è·¨åŸŸè¯·æ±‚æ—¶ï¼Œä¼šæºå¸¦ç”¨æˆ·å‡­è¯<br/><br>falseï¼šåœ¨è·¨åŸŸè¯·æ±‚æ—¶ï¼Œä¸ä¼šæºå¸¦ç”¨æˆ·å‡­è¯ï¼›è¿”å›çš„ response é‡Œä¹Ÿä¼šå¿½ç•¥ cookie<br/></p>
<h3 id="åç«¯è¿”å›çš„æ•°æ®ä¸­-ä¿®æ”¹è¯·æ±‚å¤´"><a href="#åç«¯è¿”å›çš„æ•°æ®ä¸­-ä¿®æ”¹è¯·æ±‚å¤´" class="headerlink" title="åç«¯è¿”å›çš„æ•°æ®ä¸­, ä¿®æ”¹è¯·æ±‚å¤´"></a>åç«¯è¿”å›çš„æ•°æ®ä¸­, ä¿®æ”¹è¯·æ±‚å¤´</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_cors_response</span><span class="params">(response, status=<span class="number">200</span>)</span>:</span></span><br><span class="line">    resp = make_response(response, status)</span><br><span class="line">    resp.headers[<span class="string">'Access-Control-Allow-Credentials'</span>] = <span class="string">'true'</span></span><br><span class="line">    resp.headers[<span class="string">'Access-Control-Allow-Origin'</span>] = <span class="string">'http://key-ui.oa.zego.im:9528'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resp</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯:</p>
<ol>
<li>ä¼ å…¥çš„æ˜¯<code>true</code>å­—ç¬¦ä¸², ä¸æ˜¯<code>True</code>å¸ƒå°”ç±»å‹</li>
<li>originä¸èƒ½æ˜¯<code>*</code>, å¿…é¡»æ˜¯å®Œæ•´çš„åŸŸå</li>
<li>å¯ä»¥ä¿®æ”¹hostsæ–‡ä»¶, æ¥å°†<code>127.0.0.1</code>æŒ‡å‘æµ‹è¯•çš„åŸŸå</li>
<li>æ­£å¼ç¯å¢ƒä¸­, è¿™éƒ¨åˆ†æ“ä½œå°†ç”±nginxå®Œæˆ, ä¸åœ¨ä»£ç ä¸­å†™æ­»</li>
</ol>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]ç½‘ç»œ --- äº’è”ç½‘ç½‘ç»œåè®®</title>
    <url>/2021/05/29/%E8%BD%AC-%E4%BA%92%E8%81%94%E7%BD%91%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/</url>
    <content><![CDATA[<h3 id="äº’è”ç½‘åè®®å…¥é—¨ï¼ˆä¸€ï¼‰"><a href="#äº’è”ç½‘åè®®å…¥é—¨ï¼ˆä¸€ï¼‰" class="headerlink" title="äº’è”ç½‘åè®®å…¥é—¨ï¼ˆä¸€ï¼‰"></a><a href="http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html" target="_blank" rel="noopener">äº’è”ç½‘åè®®å…¥é—¨ï¼ˆä¸€ï¼‰</a></h3><h3 id="äº’è”ç½‘åè®®å…¥é—¨ï¼ˆäºŒï¼‰"><a href="#äº’è”ç½‘åè®®å…¥é—¨ï¼ˆäºŒï¼‰" class="headerlink" title="äº’è”ç½‘åè®®å…¥é—¨ï¼ˆäºŒï¼‰"></a><a href="http://www.ruanyifeng.com/blog/2012/06/internet_protocol_suite_part_ii.html" target="_blank" rel="noopener">äº’è”ç½‘åè®®å…¥é—¨ï¼ˆäºŒï¼‰</a></h3>]]></content>
      <categories>
        <category>ç½‘ç»œ</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]ç½‘ç»œ --- æ¢ç©¶ï¼ä¸€ä¸ªæ•°æ®åŒ…åœ¨ç½‘ç»œä¸­çš„å¿ƒè·¯å†ç¨‹</title>
    <url>/2021/05/29/%E8%BD%AC-%E6%8E%A2%E7%A9%B6%EF%BC%81%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%8C%85%E5%9C%A8%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%9A%84%E5%BF%83%E8%B7%AF%E5%8E%86%E7%A8%8B/</url>
    <content><![CDATA[<h3 id="è½¬è½½"><a href="#è½¬è½½" class="headerlink" title="è½¬è½½"></a>è½¬è½½</h3><p><a href="https://mp.weixin.qq.com/s?__biz=MzUxODAzNDg4NQ==&mid=2247483989&idx=1&sn=7e2ed852770743d3955ef9d5561fcef3&scene=21#wechat_redirect" target="_blank" rel="noopener">æ¢ç©¶ï¼ä¸€ä¸ªæ•°æ®åŒ…åœ¨ç½‘ç»œä¸­çš„å¿ƒè·¯å†ç¨‹</a></p>
<h3 id="å†…å®¹"><a href="#å†…å®¹" class="headerlink" title="å†…å®¹"></a>å†…å®¹</h3><p><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210529135026.png" alt=""></p>
]]></content>
      <categories>
        <category>ç½‘ç»œ</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]ç½‘ç»œ --- pingå’Œæ•°æ®åŒ…å‘é€æµç¨‹</title>
    <url>/2021/05/29/%E8%BD%AC-ping%E5%92%8C%E6%95%B0%E6%8D%AE%E5%8C%85%E5%8F%91%E9%80%81%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<h3 id="è½¬è½½"><a href="#è½¬è½½" class="headerlink" title="è½¬è½½"></a>è½¬è½½</h3><p><a href="https://www.cnblogs.com/iwehdio/p/14231935.html" target="_blank" rel="noopener">pingå’Œæ•°æ®åŒ…å‘é€æµç¨‹</a></p>
<h3 id="å†…å®¹"><a href="#å†…å®¹" class="headerlink" title="å†…å®¹"></a>å†…å®¹</h3><p><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210529122853.png" alt="pingå’Œæ•°æ®åŒ…å‘é€æµç¨‹"></p>
]]></content>
      <categories>
        <category>ç½‘ç»œ</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]ç½‘ç»œ --- å¬è¯´ä½  ping ç”¨çš„å¾ˆ 6 ï¼Ÿç»™æˆ‘å›¾è§£ä¸€ä¸‹ ping çš„å·¥ä½œåŸç†ï¼</title>
    <url>/2021/05/29/%E8%BD%AC-%E5%90%AC%E8%AF%B4%E4%BD%A0-ping-%E7%94%A8%E7%9A%84%E5%BE%88-6-%EF%BC%9F%E7%BB%99%E6%88%91%E5%9B%BE%E8%A7%A3%E4%B8%80%E4%B8%8B-ping-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%EF%BC%81/</url>
    <content><![CDATA[<h3 id="è½¬è½½"><a href="#è½¬è½½" class="headerlink" title="è½¬è½½"></a>è½¬è½½</h3><p><a href="https://mp.weixin.qq.com/s?__biz=MzUxODAzNDg4NQ==&mid=2247483999&idx=1&sn=63825d7e7a94c0e03f8f250bbae3e88e&scene=21#wechat_redirect" target="_blank" rel="noopener">å¬è¯´ä½  ping ç”¨çš„å¾ˆ 6 ï¼Ÿç»™æˆ‘å›¾è§£ä¸€ä¸‹ ping çš„å·¥ä½œåŸç†ï¼</a></p>
<h3 id="å†…å®¹"><a href="#å†…å®¹" class="headerlink" title="å†…å®¹"></a>å†…å®¹</h3><p><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210529131237.png" alt=""></p>
<hr/>

<p><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210529131339.png" alt=""></p>
]]></content>
      <categories>
        <category>ç½‘ç»œ</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]ç½‘ç»œ ---ã€ç§‘æ™®ã€‘IPåœ°å€è¯¦è§£, è®¡ç®—æ–¹å¼</title>
    <url>/2021/05/29/%E8%BD%AC-%E3%80%90%E7%A7%91%E6%99%AE%E3%80%91IP%E5%9C%B0%E5%9D%80%E8%AF%A6%E8%A7%A3-%E8%AE%A1%E7%AE%97%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<h3 id="è½¬è½½"><a href="#è½¬è½½" class="headerlink" title="è½¬è½½"></a>è½¬è½½</h3><p><a href="https://zhuanlan.zhihu.com/p/26098552" target="_blank" rel="noopener">ã€ç§‘æ™®ã€‘IPåœ°å€è¯¦è§£-ä½ ,æ˜¯è°ï¼Ÿ(äºŒï¼‰-è¶…æœ‰è¶£å­¦ç½‘ç»œ</a></p>
<h3 id="å†…å®¹"><a href="#å†…å®¹" class="headerlink" title="å†…å®¹"></a>å†…å®¹</h3><p><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210529120402.png" alt="ã€ç§‘æ™®ã€‘IPåœ°å€è¯¦è§£-ä½ ,æ˜¯è°ï¼Ÿ(äºŒï¼‰-è¶…æœ‰è¶£å­¦ç½‘ç»œ"></p>
]]></content>
      <categories>
        <category>ç½‘ç»œ</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]ç½‘ç»œ --- å­ç½‘æ©ç </title>
    <url>/2021/05/29/%E8%BD%AC-%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81/</url>
    <content><![CDATA[<p><a href="http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html" target="_blank" rel="noopener">è½¬è½½</a></p>
<p>è§„å®šç½‘ç»œåœ°å€çš„åè®®ï¼Œå«åšIPåè®®ã€‚å®ƒæ‰€å®šä¹‰çš„åœ°å€ï¼Œå°±è¢«ç§°ä¸ºIPåœ°å€ã€‚</p>
<p>ç›®å‰ï¼Œå¹¿æ³›é‡‡ç”¨çš„æ˜¯IPåè®®ç¬¬å››ç‰ˆï¼Œç®€ç§°IPv4ã€‚è¿™ä¸ªç‰ˆæœ¬è§„å®šï¼Œç½‘ç»œåœ°å€ç”±32ä¸ªäºŒè¿›åˆ¶ä½ç»„æˆã€‚</p>
<p>ä¹ æƒ¯ä¸Šï¼Œæˆ‘ä»¬ç”¨åˆ†æˆå››æ®µçš„åè¿›åˆ¶æ•°è¡¨ç¤ºIPåœ°å€ï¼Œä»0.0.0.0ä¸€ç›´åˆ°255.255.255.255ã€‚</p>
<p>äº’è”ç½‘ä¸Šçš„æ¯ä¸€å°è®¡ç®—æœºï¼Œéƒ½ä¼šåˆ†é…åˆ°ä¸€ä¸ªIPåœ°å€ã€‚è¿™ä¸ªåœ°å€åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œå‰ä¸€éƒ¨åˆ†ä»£è¡¨ç½‘ç»œï¼Œåä¸€éƒ¨åˆ†ä»£è¡¨ä¸»æœºã€‚æ¯”å¦‚ï¼ŒIPåœ°å€172.16.254.1ï¼Œè¿™æ˜¯ä¸€ä¸ª32ä½çš„åœ°å€ï¼Œå‡å®šå®ƒçš„ç½‘ç»œéƒ¨åˆ†æ˜¯å‰24ä½ï¼ˆ172.16.254ï¼‰ï¼Œé‚£ä¹ˆä¸»æœºéƒ¨åˆ†å°±æ˜¯å8ä½ï¼ˆæœ€åçš„é‚£ä¸ª1ï¼‰ã€‚å¤„äºåŒä¸€ä¸ªå­ç½‘ç»œçš„ç”µè„‘ï¼Œå®ƒä»¬IPåœ°å€çš„ç½‘ç»œéƒ¨åˆ†å¿…å®šæ˜¯ç›¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´172.16.254.2åº”è¯¥ä¸172.16.254.1å¤„åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚</p>
<p>ä½†æ˜¯ï¼Œé—®é¢˜åœ¨äºå•å•ä»IPåœ°å€ï¼Œæˆ‘ä»¬æ— æ³•åˆ¤æ–­ç½‘ç»œéƒ¨åˆ†ã€‚è¿˜æ˜¯ä»¥172.16.254.1ä¸ºä¾‹ï¼Œå®ƒçš„ç½‘ç»œéƒ¨åˆ†ï¼Œåˆ°åº•æ˜¯å‰24ä½ï¼Œè¿˜æ˜¯å‰16ä½ï¼Œç”šè‡³å‰28ä½ï¼Œä»IPåœ°å€ä¸Šæ˜¯çœ‹ä¸å‡ºæ¥çš„ã€‚</p>
<p>é‚£ä¹ˆï¼Œæ€æ ·æ‰èƒ½ä»IPåœ°å€ï¼Œåˆ¤æ–­ä¸¤å°è®¡ç®—æœºæ˜¯å¦å±äºåŒä¸€ä¸ªå­ç½‘ç»œå‘¢ï¼Ÿè¿™å°±è¦ç”¨åˆ°å¦ä¸€ä¸ªå‚æ•°â€å­ç½‘æ©ç â€ï¼ˆsubnet maskï¼‰ã€‚</p>
<p>æ‰€è°“â€å­ç½‘æ©ç â€ï¼Œå°±æ˜¯è¡¨ç¤ºå­ç½‘ç»œç‰¹å¾çš„ä¸€ä¸ªå‚æ•°ã€‚å®ƒåœ¨å½¢å¼ä¸Šç­‰åŒäºIPåœ°å€ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª32ä½äºŒè¿›åˆ¶æ•°å­—ï¼Œå®ƒçš„ç½‘ç»œéƒ¨åˆ†å…¨éƒ¨ä¸º1ï¼Œä¸»æœºéƒ¨åˆ†å…¨éƒ¨ä¸º0ã€‚æ¯”å¦‚ï¼ŒIPåœ°å€172.16.254.1ï¼Œå¦‚æœå·²çŸ¥ç½‘ç»œéƒ¨åˆ†æ˜¯å‰24ä½ï¼Œä¸»æœºéƒ¨åˆ†æ˜¯å8ä½ï¼Œé‚£ä¹ˆå­ç½‘ç»œæ©ç å°±æ˜¯11111111.11111111.11111111.00000000ï¼Œå†™æˆåè¿›åˆ¶å°±æ˜¯255.255.255.0ã€‚</p>
<p>çŸ¥é“â€å­ç½‘æ©ç â€ï¼Œæˆ‘ä»¬å°±èƒ½åˆ¤æ–­ï¼Œä»»æ„ä¸¤ä¸ªIPåœ°å€æ˜¯å¦å¤„åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚æ–¹æ³•æ˜¯å°†ä¸¤ä¸ªIPåœ°å€ä¸å­ç½‘æ©ç åˆ†åˆ«è¿›è¡ŒANDè¿ç®—ï¼ˆä¸¤ä¸ªæ•°ä½éƒ½ä¸º1ï¼Œè¿ç®—ç»“æœä¸º1ï¼Œå¦åˆ™ä¸º0ï¼‰ï¼Œç„¶åæ¯”è¾ƒç»“æœæ˜¯å¦ç›¸åŒï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°±è¡¨æ˜å®ƒä»¬åœ¨åŒä¸€ä¸ªå­ç½‘ç»œä¸­ï¼Œå¦åˆ™å°±ä¸æ˜¯ã€‚</p>
<p>æ¯”å¦‚ï¼Œå·²çŸ¥IPåœ°å€172.16.254.1å’Œ172.16.254.233çš„å­ç½‘æ©ç éƒ½æ˜¯255.255.255.0ï¼Œè¯·é—®å®ƒä»¬æ˜¯å¦åœ¨åŒä¸€ä¸ªå­ç½‘ç»œï¼Ÿä¸¤è€…ä¸å­ç½‘æ©ç åˆ†åˆ«è¿›è¡ŒANDè¿ç®—ï¼Œç»“æœéƒ½æ˜¯172.16.254.0ï¼Œå› æ­¤å®ƒä»¬åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼ŒIPåè®®çš„ä½œç”¨ä¸»è¦æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ä¸ºæ¯ä¸€å°è®¡ç®—æœºåˆ†é…IPåœ°å€ï¼Œå¦ä¸€ä¸ªæ˜¯ç¡®å®šå“ªäº›åœ°å€åœ¨åŒä¸€ä¸ªå­ç½‘ç»œã€‚</p>
]]></content>
      <categories>
        <category>ç½‘ç»œ</category>
      </categories>
  </entry>
  <entry>
    <title>Bug --- vue add axiosæŠ¥é”™</title>
    <url>/2021/05/02/bug-vue-add-axios%E6%8A%A5%E9%94%99/</url>
    <content><![CDATA[<h3 id="æŠ¥é”™"><a href="#æŠ¥é”™" class="headerlink" title="æŠ¥é”™"></a>æŠ¥é”™</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ğŸš€  Invoking generator for vue-cli-plugin-axios...</span><br><span class="line">â ‹  Running completion hooks...error: &#39;options&#39; is defined but never used (no-unused-vars) at src&#x2F;plugins&#x2F;axios.js:42:32:</span><br><span class="line">  40 | );</span><br><span class="line">  41 |</span><br><span class="line">&gt; 42 | Plugin.install &#x3D; function(Vue, options) &#123;</span><br><span class="line">     |                                ^</span><br><span class="line">  43 |   Vue.axios &#x3D; _axios;</span><br><span class="line">  44 |   window.axios &#x3D; _axios;</span><br><span class="line">  45 |   Object.defineProperties(Vue.prototype, &#123;</span><br></pre></td></tr></table></figure>

<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>åŸå› :è¯¥é¡¹ç›®å®‰è£…äº†<code>eslint</code>è§„èŒƒï¼Œ<code>ESLint</code> æ˜¯åœ¨ ECMAScript/JavaScript ä»£ç ä¸­è¯†åˆ«å’ŒæŠ¥å‘Šæ¨¡å¼åŒ¹é…çš„å·¥å…·ï¼Œå®ƒçš„ç›®æ ‡æ˜¯ä¿è¯ä»£ç çš„ä¸€è‡´æ€§å’Œé¿å…é”™è¯¯ã€‚ä½†æœ‰æ—¶ä¹Ÿä¼šç”±äºè¿‡äºä¸¥è°¨,å¯¼è‡´é”™è¯¯æé†’<br>è§£å†³æ–¹æ¡ˆ:<br>åœ¨package.jsonæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"rules": &#123;</span><br><span class="line">    "generator-star-spacing": "off",</span><br><span class="line">    "no-tabs":"off",</span><br><span class="line">    "no-unused-vars":"off",</span><br><span class="line">    "no-console":"off",</span><br><span class="line">    "no-irregular-whitespace":"off",</span><br><span class="line">    "no-debugger": "off"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Bug</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Leetcode --- 144. äºŒå‰æ ‘çš„å‰åºéå†</title>
    <url>/2021/04/18/leetcode-144-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%89%8D%E5%BA%8F%E9%81%8D%E5%8E%86/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/binary-tree-preorder-traversal/" target="_blank" rel="noopener">äºŒå‰æ ‘çš„å‰åºéå†</a></p>
<p>ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œè¿”å›å®ƒèŠ‚ç‚¹å€¼çš„ å‰åº éå†ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210418165503.png" alt=""></p>
<blockquote>
<p>è¾“å…¥ï¼šroot = [1,null,2,3]<br/><br>è¾“å‡ºï¼š[1,2,3]</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Definition for a binary tree node.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val=<span class="number">0</span>, left=None, right=None)</span>:</span></span><br><span class="line">        self.val = val</span><br><span class="line">        self.left = left</span><br><span class="line">        self.right = right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">preorderTraversal</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        rv = list()</span><br><span class="line">        self._pre2(root, rv)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> rv</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_pre</span><span class="params">(self, root, rv)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        é€’å½’åšæ³•</span></span><br><span class="line"><span class="string">        leetcodeè¿è¡Œæ—¶é—´:40ms, å†…å­˜æ¶ˆè€—:14.9mb</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> root:</span><br><span class="line">            rv.append(root.val)</span><br><span class="line">            self._pre(root.left, rv)</span><br><span class="line">            self._pre(root.right, rv)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_pre2</span><span class="params">(self, root, rv: list)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        éé€’å½’åšæ³•</span></span><br><span class="line"><span class="string">        è¿è¡Œæ—¶é—´:36ms, å†…å­˜æ¶ˆè€—: 14.9mb</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        stack = []</span><br><span class="line">        n = root</span><br><span class="line">        <span class="keyword">while</span> n <span class="keyword">or</span> stack:</span><br><span class="line">            <span class="keyword">while</span> n:</span><br><span class="line">                rv.append(n.val)</span><br><span class="line">                stack.append(n)</span><br><span class="line">                n = n.left</span><br><span class="line">            <span class="keyword">if</span> stack:</span><br><span class="line">                t = stack.pop()</span><br><span class="line">                n = t.right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = TreeNode(<span class="number">1</span>)</span><br><span class="line">t2 = TreeNode(<span class="number">2</span>)</span><br><span class="line">t3 = TreeNode(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">t1.right = t2</span><br><span class="line">t2.left = t3</span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">print(s.preorderTraversal(t1))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 2. ä¸¤æ•°ç›¸åŠ </title>
    <url>/2021/04/18/leetcode-2-%E4%B8%A4%E6%95%B0%E7%9B%B8%E5%8A%A0/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/add-two-numbers/" target="_blank" rel="noopener">ä¸¤æ•°ç›¸åŠ </a></p>
<p>ç»™ä½ ä¸¤ä¸ª éç©º çš„é“¾è¡¨ï¼Œè¡¨ç¤ºä¸¤ä¸ªéè´Ÿçš„æ•´æ•°ã€‚å®ƒä»¬æ¯ä½æ•°å­—éƒ½æ˜¯æŒ‰ç…§ é€†åº çš„æ–¹å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ <code>ä¸€ä½</code> æ•°å­—ã€‚<br>è¯·ä½ å°†ä¸¤ä¸ªæ•°ç›¸åŠ ï¼Œå¹¶ä»¥ç›¸åŒå½¢å¼è¿”å›ä¸€ä¸ªè¡¨ç¤ºå’Œçš„é“¾è¡¨ã€‚<br>ä½ å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°éƒ½ä¸ä¼šä»¥ 0 å¼€å¤´ã€‚</p>
<p><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210418140849.png" alt=""></p>
<blockquote>
<p>è¾“å…¥ï¼šl1 = [2,4,3], l2 = [5,6,4] <br/><br>è¾“å‡ºï¼š[7,0,8]    <br/><br>è§£é‡Šï¼š342 + 465 = 807.</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Definition for singly-linked list.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val=<span class="number">0</span>, next=None)</span>:</span></span><br><span class="line">        self.val = val</span><br><span class="line">        self.next = next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addTwoNumbers</span><span class="params">(self, l1: ListNode, l2: ListNode)</span> -&gt; ListNode:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> l1:</span><br><span class="line">            <span class="keyword">return</span> l2</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> l2:</span><br><span class="line">            <span class="keyword">return</span> l1</span><br><span class="line"></span><br><span class="line">        head = <span class="literal">None</span></span><br><span class="line">        tail = <span class="literal">None</span></span><br><span class="line">        tmp = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> l1 <span class="keyword">and</span> l2:</span><br><span class="line">            val = l1.val + l2.val + tmp</span><br><span class="line">            tmp = val // <span class="number">10</span></span><br><span class="line">            l1 = l1.next</span><br><span class="line">            l2 = l2.next</span><br><span class="line"></span><br><span class="line">            n = ListNode(val % <span class="number">10</span>)</span><br><span class="line">            <span class="keyword">if</span> head <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                head = n</span><br><span class="line">                tail = n</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                tail.next = n</span><br><span class="line">                tail = n</span><br><span class="line"></span><br><span class="line">        m = l1 <span class="keyword">if</span> l1 <span class="keyword">else</span> l2</span><br><span class="line">        <span class="keyword">while</span> m:</span><br><span class="line">            val = m.val + tmp</span><br><span class="line">            n = ListNode(val % <span class="number">10</span>)</span><br><span class="line">            tail.next = n</span><br><span class="line">            tail = n</span><br><span class="line">            tmp = val // <span class="number">10</span></span><br><span class="line">            m = m.next</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> tmp &gt; <span class="number">0</span>:</span><br><span class="line">            n = ListNode(tmp)</span><br><span class="line">            tail.next = n</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> head</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># l1_2 = ListNode(2)</span></span><br><span class="line"><span class="comment"># l1_4 = ListNode(4)</span></span><br><span class="line"><span class="comment"># l1_3 = ListNode(3)</span></span><br><span class="line"><span class="comment"># l1_2.next = l1_4</span></span><br><span class="line"><span class="comment"># l1_4.next = l1_3</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># l2_5 = ListNode(5)</span></span><br><span class="line"><span class="comment"># l2_6 = ListNode(6)</span></span><br><span class="line"><span class="comment"># l2_4 = ListNode(4)</span></span><br><span class="line"><span class="comment"># l2_5.next = l2_6</span></span><br><span class="line"><span class="comment"># l2_6.next = l2_4</span></span><br><span class="line"></span><br><span class="line">l1_1 = ListNode(<span class="number">9</span>)</span><br><span class="line">l1_2 = ListNode(<span class="number">9</span>)</span><br><span class="line">l1_3 = ListNode(<span class="number">1</span>)</span><br><span class="line">l1_1.next = l1_2</span><br><span class="line">l1_2.next = l1_3</span><br><span class="line"></span><br><span class="line">l2_1 = ListNode(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">cur = s.addTwoNumbers(l1_1, l2_1)</span><br><span class="line"><span class="keyword">while</span> cur:</span><br><span class="line">    print(<span class="string">"cur: %s"</span> % cur.val)</span><br><span class="line">    cur = cur.next</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]ç½‘ç»œ --- TCPå’ŒUDPæ˜¯å¦å¯ä»¥ç»‘å®šåŒä¸€ç«¯å£è¿›è¡Œé€šä¿¡</title>
    <url>/2021/04/12/%E8%BD%AC-TCP%E5%92%8CUDP%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E7%BB%91%E5%AE%9A%E5%90%8C%E4%B8%80%E7%AB%AF%E5%8F%A3%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1/</url>
    <content><![CDATA[<h3 id="è½¬è½½"><a href="#è½¬è½½" class="headerlink" title="è½¬è½½"></a>è½¬è½½</h3><p><a href="https://blog.csdn.net/m0_37564426/article/details/89294852" target="_blank" rel="noopener">TCPå’ŒUDPæ˜¯å¦å¯ä»¥ç»‘å®šåŒä¸€ç«¯å£è¿›è¡Œé€šä¿¡</a></p>
<h3 id="å†…å®¹"><a href="#å†…å®¹" class="headerlink" title="å†…å®¹"></a>å†…å®¹</h3><p>TCPã€UDPå¯ä»¥ç»‘å®šåŒä¸€ç«¯å£æ¥è¿›è¡Œé€šä¿¡ï¼š </p>
<p>ç½‘ç»œä¸­å¯ä»¥è¢«å‘½åå’Œå¯»å€çš„é€šä¿¡ç«¯å£ï¼Œæ˜¯æ“ä½œç³»ç»Ÿå¯åˆ†é…çš„ä¸€ç§èµ„æºã€‚ </p>
<p>æŒ‰ç…§OSIä¸ƒå±‚åè®®çš„æè¿°ï¼Œä¼ è¾“å±‚ä¸ç½‘ç»œå±‚åœ¨åŠŸèƒ½ä¸Šçš„æœ€å¤§åŒºåˆ«æ˜¯ä¼ è¾“å±‚æä¾›è¿›ç¨‹é€šä¿¡èƒ½åŠ›ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè®²ï¼Œç½‘ç»œé€šä¿¡çš„æœ€ç»ˆåœ°å€å°±ä¸ä»…ä»…æ˜¯ä¸»æœºåœ°å€äº†ï¼Œè¿˜åŒ…æ‹¬å¯ä»¥æè¿°è¿›ç¨‹çš„æŸç§æ ‡è¯†ç¬¦ã€‚ä¸ºæ­¤ï¼ŒTCP/IPåè®®æå‡ºäº†åè®®ç«¯å£ï¼ˆprotocol   portï¼Œç®€ç§°ç«¯å£ï¼‰çš„æ¦‚å¿µï¼Œç”¨äºæ ‡è¯†é€šä¿¡çš„è¿›ç¨‹ã€‚ </p>
<p>ç«¯å£æ˜¯ä¸€ç§æŠ½è±¡çš„è½¯ä»¶ç»“æ„ï¼ˆåŒ…æ‹¬ä¸€äº›æ•°æ®ç»“æ„å’ŒI/Oç¼“å†²åŒºï¼‰ã€‚åº”ç”¨ç¨‹åºï¼ˆå³è¿›ç¨‹ï¼‰é€šè¿‡ç³»ç»Ÿè°ƒç”¨ä¸æŸç«¯å£å»ºç«‹è¿æ¥ï¼ˆbindingï¼‰åï¼Œä¼ è¾“å±‚ä¼ ç»™è¯¥ç«¯å£çš„æ•°æ®éƒ½è¢«ç›¸åº”è¿›ç¨‹æ‰€æ¥æ”¶ï¼Œç›¸åº”è¿›ç¨‹å‘ç»™ä¼ è¾“å±‚çš„æ•°æ®éƒ½é€šè¿‡è¯¥ç«¯å£è¾“å‡ºã€‚åœ¨TCP/IPåè®®çš„å®ç°ä¸­ï¼Œç«¯å£æ“ä½œç±»ä¼¼äºä¸€èˆ¬çš„I/Oæ“ä½œï¼Œè¿›ç¨‹è·å–ä¸€ä¸ªç«¯å£ï¼Œç›¸å½“äºè·å–æœ¬åœ°å”¯ä¸€çš„I/Oæ–‡ä»¶ï¼Œå¯ä»¥ç”¨ä¸€èˆ¬çš„è¯»å†™åŸè¯­è®¿é—®ä¹‹ã€‚ </p>
<p>ç±»ä¼¼äºæ–‡ä»¶æè¿°ç¬¦ï¼Œæ¯ä¸ªç«¯å£éƒ½æ‹¥æœ‰ä¸€ä¸ªå«ç«¯å£å·ï¼ˆport   numberï¼‰çš„æ•´æ•°å‹æ ‡è¯†ç¬¦ï¼Œç”¨äºåŒºåˆ«ä¸åŒç«¯å£ã€‚ç”±äºTCP/IPä¼ è¾“å±‚çš„ä¸¤ä¸ªåè®®TCPå’ŒUDPæ˜¯å®Œå…¨ç‹¬ç«‹çš„ä¸¤ä¸ªè½¯ä»¶æ¨¡å—ï¼Œå› æ­¤å„è‡ªçš„ç«¯å£å·ä¹Ÿç›¸äº’ç‹¬ç«‹ï¼Œå¦‚TCPæœ‰ä¸€ä¸ª255å·ç«¯å£ï¼ŒUDPä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ª255å·ç«¯å£ï¼ŒäºŒè€…å¹¶ä¸å†²çªã€‚ </p>
<p>ç«¯å£å·çš„åˆ†é…æ˜¯ä¸€ä¸ªé‡è¦é—®é¢˜ã€‚æœ‰ä¸¤ç§åŸºæœ¬åˆ†é…æ–¹å¼ï¼šç¬¬ä¸€ç§å«å…¨å±€åˆ†é…ï¼Œè¿™æ˜¯ä¸€ç§é›†ä¸­æ§åˆ¶æ–¹å¼ï¼Œç”±ä¸€ä¸ªå…¬è®¤çš„ä¸­å¤®æœºæ„æ ¹æ®ç”¨æˆ·éœ€è¦è¿›è¡Œç»Ÿä¸€åˆ†é…ï¼Œå¹¶å°†ç»“æœå…¬å¸ƒäºä¼—ã€‚ç¬¬äºŒç§æ˜¯æœ¬åœ°åˆ†é…ï¼Œåˆç§°åŠ¨æ€è¿æ¥ï¼Œå³è¿›ç¨‹éœ€è¦è®¿é—®ä¼ è¾“å±‚æœåŠ¡æ—¶ï¼Œå‘æœ¬åœ°æ“ä½œç³»ç»Ÿæå‡ºç”³è¯·ï¼Œæ“ä½œç³»ç»Ÿè¿”å›ä¸€ä¸ªæœ¬åœ°å”¯ä¸€çš„ç«¯å£å·ï¼Œè¿›ç¨‹å†é€šè¿‡åˆé€‚çš„ç³»ç»Ÿè°ƒç”¨å°†è‡ªå·±ä¸è¯¥ç«¯å£å·è”ç³»èµ·æ¥ï¼ˆç»‘æ‰ï¼‰ã€‚TCP/IPç«¯å£å·çš„åˆ†é…ä¸­ç»¼åˆäº†ä¸Šè¿°ä¸¤ç§æ–¹å¼ã€‚TCP/IPå°†ç«¯å£å·åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå°‘é‡çš„ä½œä¸ºä¿ç•™ç«¯å£ï¼Œä»¥å…¨å±€æ–¹å¼åˆ†é…ç»™æœåŠ¡è¿›ç¨‹ã€‚å› æ­¤ï¼Œæ¯ä¸€ä¸ªæ ‡å‡†æœåŠ¡å™¨éƒ½æ‹¥æœ‰ä¸€ä¸ªå…¨å±€å…¬è®¤çš„ç«¯å£ï¼ˆå³å‘¨çŸ¥å£ï¼Œwell-known   portï¼‰ï¼Œå³ä½¿åœ¨ä¸åŒæœºå™¨ä¸Šï¼Œå…¶ç«¯å£å·ä¹Ÿç›¸åŒã€‚å‰©ä½™çš„ä¸ºè‡ªç”±ç«¯å£ï¼Œä»¥æœ¬åœ°æ–¹å¼è¿›è¡Œåˆ†é…ã€‚TCPå’ŒUDPå‡è§„å®šï¼Œå°äº256çš„ç«¯å£å·æ‰èƒ½ä½œä¿ç•™ç«¯å£ã€‚</p>
<p>Â· å†è®¨è®ºä¸€ä¸‹ï¼Œä¸€ä¸ªæœåŠ¡å™¨ç›‘æ§ä¸€ä¸ªç«¯å£ï¼Œæ¯”å¦‚80ç«¯å£ï¼Œå®ƒä¸ºä»€ä¹ˆå¯ä»¥å»ºç«‹ä¸Šæˆåƒä¸Šä¸‡çš„è¿æ¥ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œ ä¸€ä¸ªTCPè¿æ¥éœ€è¦ç”±å››å…ƒç»„æ¥å½¢æˆï¼Œå³(src_ip,src_port,dst_ip,dst_port)ã€‚å½“ä¸€ä¸ªè¿æ¥è¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯è°ƒç”¨acceptå‡½æ•°ï¼Œæ–°ç”Ÿæˆä¸€ä¸ªsocketï¼Œè¿™ä¸ªsocketæ‰€å ç”¨çš„æœ¬åœ°ç«¯å£ä¾ç„¶æ˜¯80ç«¯å£ã€‚ç”±å››å…ƒç»„å°±å¾ˆå®¹æ˜“åˆ†æåˆ°äº†ï¼ŒåŒä¸€ä¸ª(src_ip,src_port)ï¼Œå®ƒæ‰€å¯¹åº”çš„(dst_ip,dst_port)å¯ä»¥æ— ç©·å˜åŒ–ï¼Œè¿™æ ·å°±å¯ä»¥å»ºç«‹å¾ˆå¤šä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚äº†ã€‚</p>
]]></content>
      <categories>
        <category>ç½‘ç»œ</category>
      </categories>
  </entry>
  <entry>
    <title>æ•°æ®ç»“æ„ --- ä½¿ç”¨æ•°ç»„ä¿å­˜å±‚åºéå†äºŒå‰æ ‘å¹¶åç»­éå†è¾“å‡º</title>
    <url>/2021/04/10/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E4%BD%BF%E7%94%A8%E6%95%B0%E7%BB%84%E4%BF%9D%E5%AD%98%E5%B1%82%E5%BA%8F%E9%81%8D%E5%8E%86%E4%BA%8C%E5%8F%89%E6%A0%91%E5%B9%B6%E5%90%8E%E7%BB%AD%E9%81%8D%E5%8E%86%E8%BE%93%E5%87%BA/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>å°†ä¸€é¢—äºŒå‰æ ‘å±‚åºéå†, å­˜å…¥åˆ°æ•°ç»„ä¸­, å¹¶ååºéå†è¾“å‡ºæ•°æ®</p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€’å½’å†™æ³•</span></span><br><span class="line"><span class="comment"># class Solution(object):</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     def traverse(self, nums):</span></span><br><span class="line"><span class="comment">#         rv = list()</span></span><br><span class="line"><span class="comment">#         index = 0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#         self._post(nums, index, rv)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#         return rv</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     def _post(self, nums: list, index: int, rv: list):</span></span><br><span class="line"><span class="comment">#         if index &lt; len(nums) and nums[index] is not None:</span></span><br><span class="line"><span class="comment">#             self._post(nums, index * 2 + 1, rv)</span></span><br><span class="line"><span class="comment">#             self._post(nums, index * 2 + 2, rv)</span></span><br><span class="line"><span class="comment">#             rv.append(nums[index])</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># éé€’å½’å†™æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">traverse</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">        q = [<span class="number">0</span>]</span><br><span class="line">        rv = list()</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="comment"># ç”¨æ¥åˆ¤æ–­è¯¥ç´¢å¼•æ˜¯å¦å·²éå†è¿‡</span></span><br><span class="line">        done = set()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> q:</span><br><span class="line">            <span class="keyword">while</span> index * <span class="number">2</span> + <span class="number">1</span> &lt; len(nums) <span class="keyword">and</span> index <span class="keyword">not</span> <span class="keyword">in</span> done:</span><br><span class="line">                index = index * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">                q.append(index)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># ä¸èƒ½popæ‰, åç»­éå†, çˆ¶èŠ‚ç‚¹éœ€è¦æœ€åè®¿é—®</span></span><br><span class="line">            index = q[<span class="number">-1</span>]</span><br><span class="line">            <span class="comment"># è®¿é—®æ¡ä»¶</span></span><br><span class="line">            <span class="comment"># 1. æ²¡æœ‰è®¿é—®è¿‡</span></span><br><span class="line">            <span class="comment"># 2. æ²¡æœ‰å³å­èŠ‚ç‚¹</span></span><br><span class="line">            <span class="comment"># 3. å·¦å³å­èŠ‚ç‚¹éƒ½å·²ç»è®¿é—®è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> index <span class="keyword">not</span> <span class="keyword">in</span> done \</span><br><span class="line">                    <span class="keyword">and</span> (index * <span class="number">2</span> + <span class="number">2</span> &gt;= len(nums) <span class="keyword">or</span> nums[index * <span class="number">2</span> + <span class="number">2</span>] <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line">                         <span class="keyword">or</span> (index * <span class="number">2</span> + <span class="number">1</span> <span class="keyword">in</span> done <span class="keyword">and</span> index * <span class="number">2</span> + <span class="number">2</span> <span class="keyword">in</span> done)):</span><br><span class="line">                <span class="comment"># è®¿é—®</span></span><br><span class="line">                rv.append(nums[index])</span><br><span class="line">                <span class="comment"># èŠ‚ç‚¹å·²è®¿é—®äº†</span></span><br><span class="line">                done.add(index)</span><br><span class="line">                <span class="comment"># ä»æ ˆä¸­popå¤„ç†</span></span><br><span class="line">                q.pop()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># å¦‚æœæ— æ³•è®¿é—®, é‚£å°±æŠŠå³å­èŠ‚ç‚¹åŠ å…¥åˆ°æ ˆä¸­, éå†å³å­æ ‘</span></span><br><span class="line">                index = index * <span class="number">2</span> + <span class="number">2</span></span><br><span class="line">                q.append(index)</span><br><span class="line">        <span class="keyword">return</span> rv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tree = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</span><br><span class="line">s = Solution()</span><br><span class="line">print(s.traverse(tree))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]Linux --- å¸¸ç”¨æŒ‡ä»¤ä»‹ç»</title>
    <url>/2021/04/08/%E8%BD%AC-Linux-%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<h3 id="è½¬è½½"><a href="#è½¬è½½" class="headerlink" title="è½¬è½½"></a>è½¬è½½</h3><p><a href="https://thinkwon.blog.csdn.net/article/details/104588679" target="_blank" rel="noopener">Linuxé¢è¯•é¢˜ï¼ˆ2020æœ€æ–°ç‰ˆï¼‰</a></p>
<h3 id="æ–‡ä»¶ç®¡ç†å‘½ä»¤"><a href="#æ–‡ä»¶ç®¡ç†å‘½ä»¤" class="headerlink" title="æ–‡ä»¶ç®¡ç†å‘½ä»¤"></a>æ–‡ä»¶ç®¡ç†å‘½ä»¤</h3><h4 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h4><h5 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>cat å‘½ä»¤ç”¨äºè¿æ¥æ–‡ä»¶å¹¶æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ä¸Šã€‚<br>cat ä¸»è¦æœ‰ä¸‰å¤§åŠŸèƒ½ï¼š</p>
<h6 id="ä¸€æ¬¡æ˜¾ç¤ºæ•´ä¸ªæ–‡ä»¶"><a href="#ä¸€æ¬¡æ˜¾ç¤ºæ•´ä¸ªæ–‡ä»¶" class="headerlink" title="ä¸€æ¬¡æ˜¾ç¤ºæ•´ä¸ªæ–‡ä»¶"></a>ä¸€æ¬¡æ˜¾ç¤ºæ•´ä¸ªæ–‡ä»¶</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat filename</span><br></pre></td></tr></table></figure>
<h6 id="ä»é”®ç›˜åˆ›å»ºä¸€ä¸ªæ–‡ä»¶"><a href="#ä»é”®ç›˜åˆ›å»ºä¸€ä¸ªæ–‡ä»¶" class="headerlink" title="ä»é”®ç›˜åˆ›å»ºä¸€ä¸ªæ–‡ä»¶"></a>ä»é”®ç›˜åˆ›å»ºä¸€ä¸ªæ–‡ä»¶<br/></h6><p>åªèƒ½åˆ›å»ºæ–°æ–‡ä»¶ï¼Œä¸èƒ½ç¼–è¾‘å·²æœ‰æ–‡ä»¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &gt; filename</span><br></pre></td></tr></table></figure>
<h6 id="å°†å‡ ä¸ªæ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶"><a href="#å°†å‡ ä¸ªæ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶" class="headerlink" title="å°†å‡ ä¸ªæ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶ "></a>å°†å‡ ä¸ªæ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶ <br/></h6><p>-b å¯¹éç©ºè¾“å‡ºè¡Œå· <br/><br>-n è¾“å‡ºæ‰€æœ‰è¡Œå·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat file1 file2 &gt; file</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><h6 id="æŠŠ-log2012-log-çš„æ–‡ä»¶å†…å®¹åŠ ä¸Šè¡Œå·åè¾“å…¥-log2013-log-è¿™ä¸ªæ–‡ä»¶é‡Œ"><a href="#æŠŠ-log2012-log-çš„æ–‡ä»¶å†…å®¹åŠ ä¸Šè¡Œå·åè¾“å…¥-log2013-log-è¿™ä¸ªæ–‡ä»¶é‡Œ" class="headerlink" title="æŠŠ log2012.log çš„æ–‡ä»¶å†…å®¹åŠ ä¸Šè¡Œå·åè¾“å…¥ log2013.log è¿™ä¸ªæ–‡ä»¶é‡Œ"></a>æŠŠ log2012.log çš„æ–‡ä»¶å†…å®¹åŠ ä¸Šè¡Œå·åè¾“å…¥ log2013.log è¿™ä¸ªæ–‡ä»¶é‡Œ</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat -n log2012.log log2013.log</span><br></pre></td></tr></table></figure>
<h6 id="æŠŠ-log2012-log-å’Œ-log2013-log-çš„æ–‡ä»¶å†…å®¹åŠ ä¸Šè¡Œå·ï¼ˆç©ºç™½è¡Œä¸åŠ ï¼‰ä¹‹åå°†å†…å®¹é™„åŠ åˆ°-log-log-é‡Œ"><a href="#æŠŠ-log2012-log-å’Œ-log2013-log-çš„æ–‡ä»¶å†…å®¹åŠ ä¸Šè¡Œå·ï¼ˆç©ºç™½è¡Œä¸åŠ ï¼‰ä¹‹åå°†å†…å®¹é™„åŠ åˆ°-log-log-é‡Œ" class="headerlink" title="æŠŠ log2012.log å’Œ log2013.log çš„æ–‡ä»¶å†…å®¹åŠ ä¸Šè¡Œå·ï¼ˆç©ºç™½è¡Œä¸åŠ ï¼‰ä¹‹åå°†å†…å®¹é™„åŠ åˆ° log.log é‡Œ"></a>æŠŠ log2012.log å’Œ log2013.log çš„æ–‡ä»¶å†…å®¹åŠ ä¸Šè¡Œå·ï¼ˆç©ºç™½è¡Œä¸åŠ ï¼‰ä¹‹åå°†å†…å®¹é™„åŠ åˆ° log.log é‡Œ</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat -b log2012.log log2013.log log.log</span><br></pre></td></tr></table></figure>
<h6 id="ä½¿ç”¨-here-doc-ç”Ÿæˆæ–°æ–‡ä»¶"><a href="#ä½¿ç”¨-here-doc-ç”Ÿæˆæ–°æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨ here doc ç”Ÿæˆæ–°æ–‡ä»¶"></a>ä½¿ç”¨ here doc ç”Ÿæˆæ–°æ–‡ä»¶</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &gt;log.txt &lt;&lt;EOF</span><br><span class="line">&gt;Hello</span><br><span class="line">&gt;World</span><br><span class="line">&gt;PWD&#x3D;$(pwd)</span><br><span class="line">&gt;EOF</span><br><span class="line">ls -l log.txt</span><br><span class="line">cat log.txt</span><br><span class="line">Hello</span><br><span class="line">World</span><br><span class="line">PWD&#x3D;&#x2F;opt&#x2F;soft&#x2F;test</span><br></pre></td></tr></table></figure>
<h6 id="åå‘åˆ—ç¤º"><a href="#åå‘åˆ—ç¤º" class="headerlink" title="åå‘åˆ—ç¤º"></a>åå‘åˆ—ç¤º</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tac log.txt</span><br><span class="line">PWD&#x3D;&#x2F;opt&#x2F;soft&#x2F;test</span><br><span class="line">World</span><br><span class="line">Hello</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h4 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a>chmod</h4><h5 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>Linux/Unix çš„æ–‡ä»¶è°ƒç”¨æƒé™åˆ†ä¸ºä¸‰çº§ : æ–‡ä»¶æ‹¥æœ‰è€…ã€ç¾¤ç»„ã€å…¶ä»–ã€‚åˆ©ç”¨ chmod å¯ä»¥æ§åˆ¶æ–‡ä»¶å¦‚ä½•è¢«ä»–äººæ‰€è°ƒç”¨ã€‚</p>
<p>ç”¨äºæ”¹å˜ linux ç³»ç»Ÿæ–‡ä»¶æˆ–ç›®å½•çš„è®¿é—®æƒé™ã€‚ç”¨å®ƒæ§åˆ¶æ–‡ä»¶æˆ–ç›®å½•çš„è®¿é—®æƒé™ã€‚è¯¥å‘½ä»¤æœ‰ä¸¤ç§ç”¨æ³•ã€‚ä¸€ç§æ˜¯åŒ…å«å­—æ¯å’Œæ“ä½œç¬¦è¡¨è¾¾å¼çš„æ–‡å­—è®¾å®šæ³•ï¼›å¦ä¸€ç§æ˜¯åŒ…å«æ•°å­—çš„æ•°å­—è®¾å®šæ³•ã€‚</p>
<p>æ¯ä¸€æ–‡ä»¶æˆ–ç›®å½•çš„è®¿é—®æƒé™éƒ½æœ‰ä¸‰ç»„ï¼Œæ¯ç»„ç”¨ä¸‰ä½è¡¨ç¤ºï¼Œåˆ†åˆ«ä¸ºæ–‡ä»¶å±ä¸»çš„è¯»ã€å†™å’Œæ‰§è¡Œæƒé™ï¼›ä¸å±ä¸»åŒç»„çš„ç”¨æˆ·çš„è¯»ã€å†™å’Œæ‰§è¡Œæƒé™ï¼›ç³»ç»Ÿä¸­å…¶ä»–ç”¨æˆ·çš„è¯»ã€å†™å’Œæ‰§è¡Œæƒé™ã€‚å¯ä½¿ç”¨ ls -l test.txt æŸ¥æ‰¾ã€‚</p>
<p>ä»¥æ–‡ä»¶ log2012.log ä¸ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-rw-r--r-- 1 root root 296K 11-13 06:03 log2012.log</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€åˆ—å…±æœ‰ 10 ä¸ªä½ç½®ï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦æŒ‡å®šäº†æ–‡ä»¶ç±»å‹ã€‚åœ¨é€šå¸¸æ„ä¹‰ä¸Šï¼Œä¸€ä¸ªç›®å½•ä¹Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶ã€‚å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯æ¨ªçº¿ï¼Œè¡¨ç¤ºæ˜¯ä¸€ä¸ªéç›®å½•çš„æ–‡ä»¶ã€‚å¦‚æœæ˜¯ dï¼Œè¡¨ç¤ºæ˜¯ä¸€ä¸ªç›®å½•ã€‚ä»ç¬¬äºŒä¸ªå­—ç¬¦å¼€å§‹åˆ°ç¬¬åä¸ª 9 ä¸ªå­—ç¬¦ï¼Œ3 ä¸ªå­—ç¬¦ä¸€ç»„ï¼Œåˆ†åˆ«è¡¨ç¤ºäº† 3 ç»„ç”¨æˆ·å¯¹æ–‡ä»¶æˆ–è€…ç›®å½•çš„æƒé™ã€‚æƒé™å­—ç¬¦ç”¨æ¨ªçº¿ä»£è¡¨ç©ºè®¸å¯ï¼Œr ä»£è¡¨åªè¯»ï¼Œw ä»£è¡¨å†™ï¼Œx ä»£è¡¨å¯æ‰§è¡Œã€‚</p>
<h6 id="å¸¸ç”¨å‚æ•°"><a href="#å¸¸ç”¨å‚æ•°" class="headerlink" title="å¸¸ç”¨å‚æ•°"></a>å¸¸ç”¨å‚æ•°</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-c å½“å‘ç”Ÿæ”¹å˜æ—¶ï¼ŒæŠ¥å‘Šå¤„ç†ä¿¡æ¯</span><br><span class="line">-R å¤„ç†æŒ‡å®šç›®å½•ä»¥åŠå…¶å­ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶</span><br></pre></td></tr></table></figure>
<h6 id="æƒé™èŒƒå›´"><a href="#æƒé™èŒƒå›´" class="headerlink" title="æƒé™èŒƒå›´"></a>æƒé™èŒƒå›´</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">u ï¼šç›®å½•æˆ–è€…æ–‡ä»¶çš„å½“å‰çš„ç”¨æˆ·</span><br><span class="line">g ï¼šç›®å½•æˆ–è€…æ–‡ä»¶çš„å½“å‰çš„ç¾¤ç»„</span><br><span class="line">o ï¼šé™¤äº†ç›®å½•æˆ–è€…æ–‡ä»¶çš„å½“å‰ç”¨æˆ·æˆ–ç¾¤ç»„ä¹‹å¤–çš„ç”¨æˆ·æˆ–è€…ç¾¤ç»„</span><br><span class="line">a ï¼šæ‰€æœ‰çš„ç”¨æˆ·åŠç¾¤ç»„</span><br></pre></td></tr></table></figure>
<h6 id="æƒé™ä»£å·"><a href="#æƒé™ä»£å·" class="headerlink" title="æƒé™ä»£å·"></a>æƒé™ä»£å·</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">r ï¼šè¯»æƒé™ï¼Œç”¨æ•°å­—4è¡¨ç¤º</span><br><span class="line">w ï¼šå†™æƒé™ï¼Œç”¨æ•°å­—2è¡¨ç¤º</span><br><span class="line">x ï¼šæ‰§è¡Œæƒé™ï¼Œç”¨æ•°å­—1è¡¨ç¤º</span><br><span class="line">- ï¼šåˆ é™¤æƒé™ï¼Œç”¨æ•°å­—0è¡¨ç¤º</span><br><span class="line">s ï¼šç‰¹æ®Šæƒé™</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹-1"><a href="#å®ä¾‹-1" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><h6 id="å¢åŠ æ–‡ä»¶-t-log-æ‰€æœ‰ç”¨æˆ·å¯æ‰§è¡Œæƒé™"><a href="#å¢åŠ æ–‡ä»¶-t-log-æ‰€æœ‰ç”¨æˆ·å¯æ‰§è¡Œæƒé™" class="headerlink" title="å¢åŠ æ–‡ä»¶ t.log æ‰€æœ‰ç”¨æˆ·å¯æ‰§è¡Œæƒé™"></a>å¢åŠ æ–‡ä»¶ t.log æ‰€æœ‰ç”¨æˆ·å¯æ‰§è¡Œæƒé™</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chmod a+x t.log</span><br></pre></td></tr></table></figure>
<h6 id="æ’¤é”€åŸæ¥æ‰€æœ‰çš„æƒé™ï¼Œç„¶åä½¿æ‹¥æœ‰è€…å…·æœ‰å¯è¯»æƒé™-å¹¶è¾“å‡ºå¤„ç†ä¿¡æ¯"><a href="#æ’¤é”€åŸæ¥æ‰€æœ‰çš„æƒé™ï¼Œç„¶åä½¿æ‹¥æœ‰è€…å…·æœ‰å¯è¯»æƒé™-å¹¶è¾“å‡ºå¤„ç†ä¿¡æ¯" class="headerlink" title="æ’¤é”€åŸæ¥æ‰€æœ‰çš„æƒé™ï¼Œç„¶åä½¿æ‹¥æœ‰è€…å…·æœ‰å¯è¯»æƒé™,å¹¶è¾“å‡ºå¤„ç†ä¿¡æ¯"></a>æ’¤é”€åŸæ¥æ‰€æœ‰çš„æƒé™ï¼Œç„¶åä½¿æ‹¥æœ‰è€…å…·æœ‰å¯è¯»æƒé™,å¹¶è¾“å‡ºå¤„ç†ä¿¡æ¯</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chmod u&#x3D;r t.log -c</span><br></pre></td></tr></table></figure>
<h6 id="ç»™-file-çš„å±ä¸»åˆ†é…è¯»ã€å†™ã€æ‰§è¡Œ-7-çš„æƒé™ï¼Œç»™fileçš„æ‰€åœ¨ç»„åˆ†é…è¯»ã€æ‰§è¡Œ-5-çš„æƒé™ï¼Œç»™å…¶ä»–ç”¨æˆ·åˆ†é…æ‰§è¡Œ-1-çš„æƒé™"><a href="#ç»™-file-çš„å±ä¸»åˆ†é…è¯»ã€å†™ã€æ‰§è¡Œ-7-çš„æƒé™ï¼Œç»™fileçš„æ‰€åœ¨ç»„åˆ†é…è¯»ã€æ‰§è¡Œ-5-çš„æƒé™ï¼Œç»™å…¶ä»–ç”¨æˆ·åˆ†é…æ‰§è¡Œ-1-çš„æƒé™" class="headerlink" title="ç»™ file çš„å±ä¸»åˆ†é…è¯»ã€å†™ã€æ‰§è¡Œ(7)çš„æƒé™ï¼Œç»™fileçš„æ‰€åœ¨ç»„åˆ†é…è¯»ã€æ‰§è¡Œ(5)çš„æƒé™ï¼Œç»™å…¶ä»–ç”¨æˆ·åˆ†é…æ‰§è¡Œ(1)çš„æƒé™"></a>ç»™ file çš„å±ä¸»åˆ†é…è¯»ã€å†™ã€æ‰§è¡Œ(7)çš„æƒé™ï¼Œç»™fileçš„æ‰€åœ¨ç»„åˆ†é…è¯»ã€æ‰§è¡Œ(5)çš„æƒé™ï¼Œç»™å…¶ä»–ç”¨æˆ·åˆ†é…æ‰§è¡Œ(1)çš„æƒé™</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chmod 751 t.log -cï¼ˆæˆ–è€…ï¼šchmod u&#x3D;rwx,g&#x3D;rx,o&#x3D;x t.log -c)</span><br></pre></td></tr></table></figure>
<h6 id="å°†-test-ç›®å½•åŠå…¶å­ç›®å½•æ‰€æœ‰æ–‡ä»¶æ·»åŠ å¯è¯»æƒé™"><a href="#å°†-test-ç›®å½•åŠå…¶å­ç›®å½•æ‰€æœ‰æ–‡ä»¶æ·»åŠ å¯è¯»æƒé™" class="headerlink" title="å°† test ç›®å½•åŠå…¶å­ç›®å½•æ‰€æœ‰æ–‡ä»¶æ·»åŠ å¯è¯»æƒé™"></a>å°† test ç›®å½•åŠå…¶å­ç›®å½•æ‰€æœ‰æ–‡ä»¶æ·»åŠ å¯è¯»æƒé™</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chmod u+r,g+r,o+r -R text&#x2F; -c</span><br></pre></td></tr></table></figure>

<h4 id="chown"><a href="#chown" class="headerlink" title="chown"></a>chown</h4><h5 id="ä»‹ç»-2"><a href="#ä»‹ç»-2" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>chown å°†æŒ‡å®šæ–‡ä»¶çš„æ‹¥æœ‰è€…æ”¹ä¸ºæŒ‡å®šçš„ç”¨æˆ·æˆ–ç»„ï¼Œç”¨æˆ·å¯ä»¥æ˜¯ç”¨æˆ·åæˆ–è€…ç”¨æˆ· IDï¼›ç»„å¯ä»¥æ˜¯ç»„åæˆ–è€…ç»„ IDï¼›æ–‡ä»¶æ˜¯ä»¥ç©ºæ ¼åˆ†å¼€çš„è¦æ”¹å˜æƒé™çš„æ–‡ä»¶åˆ—è¡¨ï¼Œæ”¯æŒé€šé…ç¬¦ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-c æ˜¾ç¤ºæ›´æ”¹çš„éƒ¨åˆ†çš„ä¿¡æ¯</span><br><span class="line">-R å¤„ç†æŒ‡å®šç›®å½•åŠå­ç›®å½•</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹-2"><a href="#å®ä¾‹-2" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><h6 id="æ”¹å˜æ‹¥æœ‰è€…å’Œç¾¤ç»„-å¹¶æ˜¾ç¤ºæ”¹å˜ä¿¡æ¯"><a href="#æ”¹å˜æ‹¥æœ‰è€…å’Œç¾¤ç»„-å¹¶æ˜¾ç¤ºæ”¹å˜ä¿¡æ¯" class="headerlink" title="æ”¹å˜æ‹¥æœ‰è€…å’Œç¾¤ç»„ å¹¶æ˜¾ç¤ºæ”¹å˜ä¿¡æ¯"></a>æ”¹å˜æ‹¥æœ‰è€…å’Œç¾¤ç»„ å¹¶æ˜¾ç¤ºæ”¹å˜ä¿¡æ¯</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chown -c mail:mail log2012.log</span><br></pre></td></tr></table></figure>
<h6 id="æ”¹å˜æ–‡ä»¶ç¾¤ç»„"><a href="#æ”¹å˜æ–‡ä»¶ç¾¤ç»„" class="headerlink" title="æ”¹å˜æ–‡ä»¶ç¾¤ç»„"></a>æ”¹å˜æ–‡ä»¶ç¾¤ç»„</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chown -c :mail t.log</span><br></pre></td></tr></table></figure>
<h6 id="æ”¹å˜æ–‡ä»¶å¤¹åŠå­æ–‡ä»¶ç›®å½•å±ä¸»åŠå±ç»„ä¸º-mail"><a href="#æ”¹å˜æ–‡ä»¶å¤¹åŠå­æ–‡ä»¶ç›®å½•å±ä¸»åŠå±ç»„ä¸º-mail" class="headerlink" title="æ”¹å˜æ–‡ä»¶å¤¹åŠå­æ–‡ä»¶ç›®å½•å±ä¸»åŠå±ç»„ä¸º mail"></a>æ”¹å˜æ–‡ä»¶å¤¹åŠå­æ–‡ä»¶ç›®å½•å±ä¸»åŠå±ç»„ä¸º mail</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chown -cR mail: test&#x2F;</span><br></pre></td></tr></table></figure>

<h4 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h4><h5 id="ä»‹ç»-3"><a href="#ä»‹ç»-3" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>å°†æºæ–‡ä»¶å¤åˆ¶è‡³ç›®æ ‡æ–‡ä»¶ï¼Œæˆ–å°†å¤šä¸ªæºæ–‡ä»¶å¤åˆ¶è‡³ç›®æ ‡ç›®å½•ã€‚</p>
<p>æ³¨æ„ï¼šå‘½ä»¤è¡Œå¤åˆ¶ï¼Œå¦‚æœç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ä¼šæç¤ºæ˜¯å¦è¦†ç›–ï¼Œè€Œåœ¨ shell è„šæœ¬ä¸­ï¼Œå¦‚æœä¸åŠ  -i å‚æ•°ï¼Œåˆ™ä¸ä¼šæç¤ºï¼Œè€Œæ˜¯ç›´æ¥è¦†ç›–ï¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-i æç¤º</span><br><span class="line">-r å¤åˆ¶ç›®å½•åŠç›®å½•å†…æ‰€æœ‰é¡¹ç›®</span><br><span class="line">-a å¤åˆ¶çš„æ–‡ä»¶ä¸åŸæ–‡ä»¶æ—¶é—´ä¸€æ ·</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹-3"><a href="#å®ä¾‹-3" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><h6 id="å¤åˆ¶-a-txt-åˆ°-test-ç›®å½•ä¸‹ï¼Œä¿æŒåŸæ–‡ä»¶æ—¶é—´ï¼Œå¦‚æœåŸæ–‡ä»¶å­˜åœ¨æç¤ºæ˜¯å¦è¦†ç›–ã€‚"><a href="#å¤åˆ¶-a-txt-åˆ°-test-ç›®å½•ä¸‹ï¼Œä¿æŒåŸæ–‡ä»¶æ—¶é—´ï¼Œå¦‚æœåŸæ–‡ä»¶å­˜åœ¨æç¤ºæ˜¯å¦è¦†ç›–ã€‚" class="headerlink" title="å¤åˆ¶ a.txt åˆ° test ç›®å½•ä¸‹ï¼Œä¿æŒåŸæ–‡ä»¶æ—¶é—´ï¼Œå¦‚æœåŸæ–‡ä»¶å­˜åœ¨æç¤ºæ˜¯å¦è¦†ç›–ã€‚"></a>å¤åˆ¶ a.txt åˆ° test ç›®å½•ä¸‹ï¼Œä¿æŒåŸæ–‡ä»¶æ—¶é—´ï¼Œå¦‚æœåŸæ–‡ä»¶å­˜åœ¨æç¤ºæ˜¯å¦è¦†ç›–ã€‚</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp -ai a.txt test</span><br></pre></td></tr></table></figure>
<h6 id="ä¸º-a-txt-å»ºè®®ä¸€ä¸ªé“¾æ¥ï¼ˆå¿«æ·æ–¹å¼ï¼‰"><a href="#ä¸º-a-txt-å»ºè®®ä¸€ä¸ªé“¾æ¥ï¼ˆå¿«æ·æ–¹å¼ï¼‰" class="headerlink" title="ä¸º a.txt å»ºè®®ä¸€ä¸ªé“¾æ¥ï¼ˆå¿«æ·æ–¹å¼ï¼‰"></a>ä¸º a.txt å»ºè®®ä¸€ä¸ªé“¾æ¥ï¼ˆå¿«æ·æ–¹å¼ï¼‰</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp -s a.txt link_a.txt</span><br></pre></td></tr></table></figure>

<h4 id="find"><a href="#find" class="headerlink" title="find"></a>find</h4><h5 id="ä»‹ç»-4"><a href="#ä»‹ç»-4" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>ç”¨äºåœ¨æ–‡ä»¶æ ‘ä¸­æŸ¥æ‰¾æ–‡ä»¶ï¼Œå¹¶ä½œå‡ºç›¸åº”çš„å¤„ç†ã€‚</p>
<h6 id="å‘½ä»¤æ ¼å¼"><a href="#å‘½ä»¤æ ¼å¼" class="headerlink" title="å‘½ä»¤æ ¼å¼"></a>å‘½ä»¤æ ¼å¼</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find pathname -options [-print -exec -ok ...]</span><br></pre></td></tr></table></figure>

<h6 id="å‘½ä»¤å‚æ•°"><a href="#å‘½ä»¤å‚æ•°" class="headerlink" title="å‘½ä»¤å‚æ•°"></a>å‘½ä»¤å‚æ•°</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pathname: findå‘½ä»¤æ‰€æŸ¥æ‰¾çš„ç›®å½•è·¯å¾„ã€‚ä¾‹å¦‚ç”¨.æ¥è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œç”¨&#x2F;æ¥è¡¨ç¤ºç³»ç»Ÿæ ¹ç›®å½•ã€‚</span><br><span class="line">-printï¼š findå‘½ä»¤å°†åŒ¹é…çš„æ–‡ä»¶è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚</span><br><span class="line">-execï¼š findå‘½ä»¤å¯¹åŒ¹é…çš„æ–‡ä»¶æ‰§è¡Œè¯¥å‚æ•°æ‰€ç»™å‡ºçš„shellå‘½ä»¤ã€‚ç›¸åº”å‘½ä»¤çš„å½¢å¼ä¸º&#39;command&#39; &#123;  &#125; \;ï¼Œæ³¨æ„&#123;   &#125;å’Œ\ï¼›ä¹‹é—´çš„ç©ºæ ¼ã€‚</span><br><span class="line">-okï¼š å’Œ-execçš„ä½œç”¨ç›¸åŒï¼Œåªä¸è¿‡ä»¥ä¸€ç§æ›´ä¸ºå®‰å…¨çš„æ¨¡å¼æ¥æ‰§è¡Œè¯¥å‚æ•°æ‰€ç»™å‡ºçš„shellå‘½ä»¤ï¼Œåœ¨æ‰§è¡Œæ¯ä¸€ä¸ªå‘½ä»¤ä¹‹å‰ï¼Œéƒ½ä¼šç»™å‡ºæç¤ºï¼Œè®©ç”¨æˆ·æ¥ç¡®å®šæ˜¯å¦æ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure>
<h6 id="å‘½ä»¤é€‰é¡¹"><a href="#å‘½ä»¤é€‰é¡¹" class="headerlink" title="å‘½ä»¤é€‰é¡¹"></a>å‘½ä»¤é€‰é¡¹</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-name æŒ‰ç…§æ–‡ä»¶åæŸ¥æ‰¾æ–‡ä»¶</span><br><span class="line">-perm æŒ‰æ–‡ä»¶æƒé™æŸ¥æ‰¾æ–‡ä»¶</span><br><span class="line">-user æŒ‰æ–‡ä»¶å±ä¸»æŸ¥æ‰¾æ–‡ä»¶</span><br><span class="line">-group  æŒ‰ç…§æ–‡ä»¶æ‰€å±çš„ç»„æ¥æŸ¥æ‰¾æ–‡ä»¶ã€‚</span><br><span class="line">-type  æŸ¥æ‰¾æŸä¸€ç±»å‹çš„æ–‡ä»¶ï¼Œè¯¸å¦‚ï¼š</span><br><span class="line">     b - å—è®¾å¤‡æ–‡ä»¶</span><br><span class="line">     d - ç›®å½•</span><br><span class="line">     c - å­—ç¬¦è®¾å¤‡æ–‡ä»¶</span><br><span class="line">     l - ç¬¦å·é“¾æ¥æ–‡ä»¶</span><br><span class="line">     p - ç®¡é“æ–‡ä»¶</span><br><span class="line">     f - æ™®é€šæ–‡ä»¶</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹-4"><a href="#å®ä¾‹-4" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><h6 id="æŸ¥æ‰¾-48-å°æ—¶å†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶"><a href="#æŸ¥æ‰¾-48-å°æ—¶å†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶" class="headerlink" title="æŸ¥æ‰¾ 48 å°æ—¶å†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶"></a>æŸ¥æ‰¾ 48 å°æ—¶å†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find -atime -2</span><br></pre></td></tr></table></figure>
<h6 id="åœ¨å½“å‰ç›®å½•æŸ¥æ‰¾-ä»¥-log-ç»“å°¾çš„æ–‡ä»¶ã€‚-ä»£è¡¨å½“å‰ç›®å½•"><a href="#åœ¨å½“å‰ç›®å½•æŸ¥æ‰¾-ä»¥-log-ç»“å°¾çš„æ–‡ä»¶ã€‚-ä»£è¡¨å½“å‰ç›®å½•" class="headerlink" title="åœ¨å½“å‰ç›®å½•æŸ¥æ‰¾ ä»¥ .log ç»“å°¾çš„æ–‡ä»¶ã€‚ . ä»£è¡¨å½“å‰ç›®å½•"></a>åœ¨å½“å‰ç›®å½•æŸ¥æ‰¾ ä»¥ .log ç»“å°¾çš„æ–‡ä»¶ã€‚ . ä»£è¡¨å½“å‰ç›®å½•</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find .&#x2F; -name &#39;*.log&#39;</span><br></pre></td></tr></table></figure>
<h6 id="æŸ¥æ‰¾-opt-ç›®å½•ä¸‹-æƒé™ä¸º-777-çš„æ–‡ä»¶"><a href="#æŸ¥æ‰¾-opt-ç›®å½•ä¸‹-æƒé™ä¸º-777-çš„æ–‡ä»¶" class="headerlink" title="æŸ¥æ‰¾ /opt ç›®å½•ä¸‹ æƒé™ä¸º 777 çš„æ–‡ä»¶"></a>æŸ¥æ‰¾ /opt ç›®å½•ä¸‹ æƒé™ä¸º 777 çš„æ–‡ä»¶</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find &#x2F;opt -perm 777</span><br></pre></td></tr></table></figure>
<h6 id="æŸ¥æ‰¾å¤§äº-1K-çš„æ–‡ä»¶"><a href="#æŸ¥æ‰¾å¤§äº-1K-çš„æ–‡ä»¶" class="headerlink" title="æŸ¥æ‰¾å¤§äº 1K çš„æ–‡ä»¶"></a>æŸ¥æ‰¾å¤§äº 1K çš„æ–‡ä»¶</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find -size +1000c</span><br></pre></td></tr></table></figure>
<h6 id="æŸ¥æ‰¾ç­‰äº-1000-å­—ç¬¦çš„æ–‡ä»¶"><a href="#æŸ¥æ‰¾ç­‰äº-1000-å­—ç¬¦çš„æ–‡ä»¶" class="headerlink" title="æŸ¥æ‰¾ç­‰äº 1000 å­—ç¬¦çš„æ–‡ä»¶"></a>æŸ¥æ‰¾ç­‰äº 1000 å­—ç¬¦çš„æ–‡ä»¶</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find -size 1000c</span><br></pre></td></tr></table></figure>

<h4 id="head"><a href="#head" class="headerlink" title="head"></a>head</h4><h5 id="ä»‹ç»-5"><a href="#ä»‹ç»-5" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>head ç”¨æ¥æ˜¾ç¤ºæ¡£æ¡ˆçš„å¼€å¤´è‡³æ ‡å‡†è¾“å‡ºä¸­ï¼Œé»˜è®¤ head å‘½ä»¤æ‰“å°å…¶ç›¸åº”æ–‡ä»¶çš„å¼€å¤´ 10 è¡Œã€‚</p>
<h6 id="å¸¸ç”¨å‚æ•°-1"><a href="#å¸¸ç”¨å‚æ•°-1" class="headerlink" title="å¸¸ç”¨å‚æ•°"></a>å¸¸ç”¨å‚æ•°</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-n&lt;è¡Œæ•°&gt; æ˜¾ç¤ºçš„è¡Œæ•°ï¼ˆè¡Œæ•°ä¸ºè´Ÿæ•°è¡¨ç¤ºä»æœ€åå‘å‰æ•°ï¼‰</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹-5"><a href="#å®ä¾‹-5" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><h6 id="æ˜¾ç¤º-1-log-æ–‡ä»¶ä¸­å‰-20-è¡Œ"><a href="#æ˜¾ç¤º-1-log-æ–‡ä»¶ä¸­å‰-20-è¡Œ" class="headerlink" title="æ˜¾ç¤º 1.log æ–‡ä»¶ä¸­å‰ 20 è¡Œ"></a>æ˜¾ç¤º 1.log æ–‡ä»¶ä¸­å‰ 20 è¡Œ</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">head 1.log -n 20</span><br></pre></td></tr></table></figure>
<h6 id="æ˜¾ç¤º-1-log-æ–‡ä»¶å‰-20-å­—èŠ‚"><a href="#æ˜¾ç¤º-1-log-æ–‡ä»¶å‰-20-å­—èŠ‚" class="headerlink" title="æ˜¾ç¤º 1.log æ–‡ä»¶å‰ 20 å­—èŠ‚"></a>æ˜¾ç¤º 1.log æ–‡ä»¶å‰ 20 å­—èŠ‚</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">head -c 20 log2014.log</span><br></pre></td></tr></table></figure>
<h6 id="æ˜¾ç¤º-t-logæœ€å-10-è¡Œ"><a href="#æ˜¾ç¤º-t-logæœ€å-10-è¡Œ" class="headerlink" title="æ˜¾ç¤º t.logæœ€å 10 è¡Œ"></a>æ˜¾ç¤º t.logæœ€å 10 è¡Œ</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">head -n -10 t.log</span><br></pre></td></tr></table></figure>

<h4 id="less"><a href="#less" class="headerlink" title="less"></a>less</h4><h5 id="ä»‹ç»-6"><a href="#ä»‹ç»-6" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>less ä¸ more ç±»ä¼¼ï¼Œä½†ä½¿ç”¨ less å¯ä»¥éšæ„æµè§ˆæ–‡ä»¶ï¼Œè€Œ more ä»…èƒ½å‘å‰ç§»åŠ¨ï¼Œå´ä¸èƒ½å‘åç§»åŠ¨ï¼Œè€Œä¸” less åœ¨æŸ¥çœ‹ä¹‹å‰ä¸ä¼šåŠ è½½æ•´ä¸ªæ–‡ä»¶ã€‚</p>
<h6 id="å¸¸ç”¨å‘½ä»¤å‚æ•°"><a href="#å¸¸ç”¨å‘½ä»¤å‚æ•°" class="headerlink" title="å¸¸ç”¨å‘½ä»¤å‚æ•°"></a>å¸¸ç”¨å‘½ä»¤å‚æ•°</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-i  å¿½ç•¥æœç´¢æ—¶çš„å¤§å°å†™</span><br><span class="line">-N  æ˜¾ç¤ºæ¯è¡Œçš„è¡Œå·</span><br><span class="line">-o  &lt;æ–‡ä»¶å&gt; å°†less è¾“å‡ºçš„å†…å®¹åœ¨æŒ‡å®šæ–‡ä»¶ä¸­ä¿å­˜èµ·æ¥</span><br><span class="line">-s  æ˜¾ç¤ºè¿ç»­ç©ºè¡Œä¸ºä¸€è¡Œ</span><br><span class="line">&#x2F;å­—ç¬¦ä¸²ï¼šå‘ä¸‹æœç´¢â€œå­—ç¬¦ä¸²â€çš„åŠŸèƒ½</span><br><span class="line">?å­—ç¬¦ä¸²ï¼šå‘ä¸Šæœç´¢â€œå­—ç¬¦ä¸²â€çš„åŠŸèƒ½</span><br><span class="line">nï¼šé‡å¤å‰ä¸€ä¸ªæœç´¢ï¼ˆä¸ &#x2F; æˆ– ? æœ‰å…³ï¼‰</span><br><span class="line">Nï¼šåå‘é‡å¤å‰ä¸€ä¸ªæœç´¢ï¼ˆä¸ &#x2F; æˆ– ? æœ‰å…³ï¼‰</span><br><span class="line">-x &lt;æ•°å­—&gt; å°†â€œtabâ€é”®æ˜¾ç¤ºä¸ºè§„å®šçš„æ•°å­—ç©ºæ ¼</span><br><span class="line">b  å‘åç¿»ä¸€é¡µ</span><br><span class="line">d  å‘åç¿»åŠé¡µ</span><br><span class="line">h  æ˜¾ç¤ºå¸®åŠ©ç•Œé¢</span><br><span class="line">Q  é€€å‡ºless å‘½ä»¤</span><br><span class="line">u  å‘å‰æ»šåŠ¨åŠé¡µ</span><br><span class="line">y  å‘å‰æ»šåŠ¨ä¸€è¡Œ</span><br><span class="line">ç©ºæ ¼é”® æ»šåŠ¨ä¸€è¡Œ</span><br><span class="line">å›è½¦é”® æ»šåŠ¨ä¸€é¡µ</span><br><span class="line">[pagedown]ï¼š å‘ä¸‹ç¿»åŠ¨ä¸€é¡µ</span><br><span class="line">[pageup]ï¼š   å‘ä¸Šç¿»åŠ¨ä¸€é¡µ</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹-6"><a href="#å®ä¾‹-6" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><h6 id="ps-æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯å¹¶é€šè¿‡-less-åˆ†é¡µæ˜¾ç¤º"><a href="#ps-æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯å¹¶é€šè¿‡-less-åˆ†é¡µæ˜¾ç¤º" class="headerlink" title="ps æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯å¹¶é€šè¿‡ less åˆ†é¡µæ˜¾ç¤º"></a>ps æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯å¹¶é€šè¿‡ less åˆ†é¡µæ˜¾ç¤º</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -aux | less -N</span><br></pre></td></tr></table></figure>
<h6 id="æŸ¥çœ‹å¤šä¸ªæ–‡ä»¶"><a href="#æŸ¥çœ‹å¤šä¸ªæ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹å¤šä¸ªæ–‡ä»¶"></a>æŸ¥çœ‹å¤šä¸ªæ–‡ä»¶</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">less 1.log 2.log</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ä½¿ç”¨ n æŸ¥çœ‹ä¸‹ä¸€ä¸ªï¼Œä½¿ç”¨ p æŸ¥çœ‹å‰ä¸€ä¸ªã€‚</p>
<h4 id="ln"><a href="#ln" class="headerlink" title="ln"></a>ln</h4><h5 id="ä»‹ç»-7"><a href="#ä»‹ç»-7" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>åŠŸèƒ½æ˜¯ä¸ºæ–‡ä»¶åœ¨å¦å¤–ä¸€ä¸ªä½ç½®å»ºç«‹ä¸€ä¸ªåŒæ­¥çš„é“¾æ¥ï¼Œå½“åœ¨ä¸åŒç›®å½•éœ€è¦è¯¥é—®é¢˜æ—¶ï¼Œå°±ä¸éœ€è¦ä¸ºæ¯ä¸€ä¸ªç›®å½•åˆ›å»ºåŒæ ·çš„æ–‡ä»¶ï¼Œé€šè¿‡ ln åˆ›å»ºçš„é“¾æ¥ï¼ˆlinkï¼‰å‡å°‘ç£ç›˜å ç”¨é‡ã€‚<br>é“¾æ¥åˆ†ç±»ï¼šè½¯ä»¶é“¾æ¥åŠç¡¬é“¾æ¥</p>
<h6 id="è½¯é“¾æ¥"><a href="#è½¯é“¾æ¥" class="headerlink" title="è½¯é“¾æ¥"></a>è½¯é“¾æ¥</h6><pre><code>- è½¯é“¾æ¥ï¼Œä»¥è·¯å¾„çš„å½¢å¼å­˜åœ¨ã€‚ç±»ä¼¼äºWindowsæ“ä½œç³»ç»Ÿä¸­çš„å¿«æ·æ–¹å¼
- è½¯é“¾æ¥å¯ä»¥ è·¨æ–‡ä»¶ç³»ç»Ÿ ï¼Œç¡¬é“¾æ¥ä¸å¯ä»¥
- è½¯é“¾æ¥å¯ä»¥å¯¹ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶åè¿›è¡Œé“¾æ¥
- è½¯é“¾æ¥å¯ä»¥å¯¹ç›®å½•è¿›è¡Œé“¾æ¥</code></pre><h6 id="ç¡¬é“¾æ¥"><a href="#ç¡¬é“¾æ¥" class="headerlink" title="ç¡¬é“¾æ¥:"></a>ç¡¬é“¾æ¥:</h6><pre><code>- ç¡¬é“¾æ¥ï¼Œä»¥æ–‡ä»¶å‰¯æœ¬çš„å½¢å¼å­˜åœ¨ã€‚ä½†ä¸å ç”¨å®é™…ç©ºé—´ã€‚
- ä¸å…è®¸ç»™ç›®å½•åˆ›å»ºç¡¬é“¾æ¥
- ç¡¬é“¾æ¥åªæœ‰åœ¨åŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­æ‰èƒ½åˆ›å»º</code></pre><h6 id="éœ€è¦æ³¨æ„ï¼š"><a href="#éœ€è¦æ³¨æ„ï¼š" class="headerlink" title="éœ€è¦æ³¨æ„ï¼š"></a>éœ€è¦æ³¨æ„ï¼š</h6><pre><code>- lnå‘½ä»¤ä¼šä¿æŒæ¯ä¸€å¤„é“¾æ¥æ–‡ä»¶çš„åŒæ­¥æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸è®ºä½ æ”¹åŠ¨äº†å“ªä¸€å¤„ï¼Œå…¶å®ƒçš„æ–‡ä»¶éƒ½ä¼šå‘ç”Ÿç›¸åŒçš„å˜åŒ–ï¼›
- lnçš„é“¾æ¥åˆåˆ†è½¯é“¾æ¥å’Œç¡¬é“¾æ¥ä¸¤ç§ï¼Œè½¯é“¾æ¥å°±æ˜¯ln â€“s æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶ï¼Œå®ƒåªä¼šåœ¨ä½ é€‰å®šçš„ä½ç½®ä¸Šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶çš„é•œåƒï¼Œä¸ä¼šå ç”¨ç£ç›˜ç©ºé—´ï¼Œç¡¬é“¾æ¥ ln æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶ï¼Œæ²¡æœ‰å‚æ•°-sï¼Œ å®ƒä¼šåœ¨ä½ é€‰å®šçš„ä½ç½®ä¸Šç”Ÿæˆä¸€ä¸ªå’Œæºæ–‡ä»¶å¤§å°ç›¸åŒçš„æ–‡ä»¶ï¼Œæ— è®ºæ˜¯è½¯é“¾æ¥è¿˜æ˜¯ç¡¬é“¾æ¥ï¼Œæ–‡ä»¶éƒ½ä¿æŒåŒæ­¥å˜åŒ–ã€‚
- lnæŒ‡ä»¤ç”¨åœ¨é“¾æ¥æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¦‚åŒæ—¶æŒ‡å®šä¸¤ä¸ªä»¥ä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œä¸”æœ€åçš„ç›®çš„åœ°æ˜¯ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç›®å½•ï¼Œåˆ™ä¼šæŠŠå‰é¢æŒ‡å®šçš„æ‰€æœ‰æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°è¯¥ç›®å½•ä¸­ã€‚è‹¥åŒæ—¶æŒ‡å®šå¤šä¸ªæ–‡ä»¶æˆ–ç›®å½•ï¼Œä¸”æœ€åçš„ç›®çš„åœ°å¹¶éæ˜¯ä¸€ä¸ªå·²å­˜åœ¨çš„ç›®å½•ï¼Œåˆ™ä¼šå‡ºç°é”™è¯¯ä¿¡æ¯ã€‚</code></pre><h6 id="å¸¸ç”¨å‚æ•°-2"><a href="#å¸¸ç”¨å‚æ•°-2" class="headerlink" title="å¸¸ç”¨å‚æ•°"></a>å¸¸ç”¨å‚æ•°</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-b åˆ é™¤ï¼Œè¦†ç›–ä»¥å‰å»ºç«‹çš„é“¾æ¥</span><br><span class="line">-s è½¯é“¾æ¥ï¼ˆç¬¦å·é“¾æ¥ï¼‰</span><br><span class="line">-v æ˜¾ç¤ºè¯¦ç»†å¤„ç†è¿‡ç¨‹</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹-7"><a href="#å®ä¾‹-7" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><h6 id="ç»™æ–‡ä»¶åˆ›å»ºè½¯é“¾æ¥ï¼Œå¹¶æ˜¾ç¤ºæ“ä½œä¿¡æ¯"><a href="#ç»™æ–‡ä»¶åˆ›å»ºè½¯é“¾æ¥ï¼Œå¹¶æ˜¾ç¤ºæ“ä½œä¿¡æ¯" class="headerlink" title="ç»™æ–‡ä»¶åˆ›å»ºè½¯é“¾æ¥ï¼Œå¹¶æ˜¾ç¤ºæ“ä½œä¿¡æ¯"></a>ç»™æ–‡ä»¶åˆ›å»ºè½¯é“¾æ¥ï¼Œå¹¶æ˜¾ç¤ºæ“ä½œä¿¡æ¯</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ln -sv source.log link.log</span><br></pre></td></tr></table></figure>
<h6 id="ç»™æ–‡ä»¶åˆ›å»ºç¡¬é“¾æ¥ï¼Œå¹¶æ˜¾ç¤ºæ“ä½œä¿¡æ¯"><a href="#ç»™æ–‡ä»¶åˆ›å»ºç¡¬é“¾æ¥ï¼Œå¹¶æ˜¾ç¤ºæ“ä½œä¿¡æ¯" class="headerlink" title="ç»™æ–‡ä»¶åˆ›å»ºç¡¬é“¾æ¥ï¼Œå¹¶æ˜¾ç¤ºæ“ä½œä¿¡æ¯"></a>ç»™æ–‡ä»¶åˆ›å»ºç¡¬é“¾æ¥ï¼Œå¹¶æ˜¾ç¤ºæ“ä½œä¿¡æ¯</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ln -v source.log link1.log</span><br></pre></td></tr></table></figure>
<h6 id="ç»™ç›®å½•åˆ›å»ºè½¯é“¾æ¥"><a href="#ç»™ç›®å½•åˆ›å»ºè½¯é“¾æ¥" class="headerlink" title="ç»™ç›®å½•åˆ›å»ºè½¯é“¾æ¥"></a>ç»™ç›®å½•åˆ›å»ºè½¯é“¾æ¥</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ln -sv &#x2F;opt&#x2F;soft&#x2F;test&#x2F;test3 &#x2F;opt&#x2F;soft&#x2F;test&#x2F;test5</span><br></pre></td></tr></table></figure>

<h4 id="locate"><a href="#locate" class="headerlink" title="locate"></a>locate</h4><h5 id="ä»‹ç»-8"><a href="#ä»‹ç»-8" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>locate é€šè¿‡æœå¯»ç³»ç»Ÿå†…å»ºæ–‡æ¡£æ•°æ®åº“è¾¾åˆ°å¿«é€Ÿæ‰¾åˆ°æ¡£æ¡ˆï¼Œæ•°æ®åº“ç”± updatedb ç¨‹åºæ¥æ›´æ–°ï¼Œupdatedb æ˜¯ç”± cron daemon å‘¨æœŸæ€§è°ƒç”¨çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ locate å‘½ä»¤åœ¨æœå¯»æ•°æ®åº“æ—¶æ¯”ç”±æ•´ä¸ªç”±ç¡¬ç›˜èµ„æ–™æ¥æœå¯»èµ„æ–™æ¥å¾—å¿«ï¼Œä½†è¾ƒå·®åŠ²çš„æ˜¯ locate æ‰€æ‰¾åˆ°çš„æ¡£æ¡ˆè‹¥æ˜¯æœ€è¿‘æ‰å»ºç«‹æˆ– åˆšæ›´åçš„ï¼Œå¯èƒ½ä¼šæ‰¾ä¸åˆ°ï¼Œåœ¨å†…å®šå€¼ä¸­ï¼Œupdatedb æ¯å¤©ä¼šè·‘ä¸€æ¬¡ï¼Œå¯ä»¥ç”±ä¿®æ”¹ crontab æ¥æ›´æ–°è®¾å®šå€¼ (etc/crontab)ã€‚</p>
<p>locate ä¸ find å‘½ä»¤ç›¸ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ *ã€? ç­‰è¿›è¡Œæ­£åˆ™åŒ¹é…æŸ¥æ‰¾</p>
<h6 id="å¸¸ç”¨å‚æ•°-3"><a href="#å¸¸ç”¨å‚æ•°-3" class="headerlink" title="å¸¸ç”¨å‚æ•°"></a>å¸¸ç”¨å‚æ•°</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-l numï¼ˆè¦æ˜¾ç¤ºçš„è¡Œæ•°ï¼‰</span><br><span class="line">-f   å°†ç‰¹å®šçš„æ¡£æ¡ˆç³»ç»Ÿæ’é™¤åœ¨å¤–ï¼Œå¦‚å°†procæ’é™¤åœ¨å¤–</span><br><span class="line">-r   ä½¿ç”¨æ­£åˆ™è¿ç®—å¼åšä¸ºå¯»æ‰¾æ¡ä»¶</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹-8"><a href="#å®ä¾‹-8" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><h6 id="æŸ¥æ‰¾å’Œ-pwd-ç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶-æ–‡ä»¶åä¸­åŒ…å«-pwdï¼‰"><a href="#æŸ¥æ‰¾å’Œ-pwd-ç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶-æ–‡ä»¶åä¸­åŒ…å«-pwdï¼‰" class="headerlink" title="æŸ¥æ‰¾å’Œ pwd ç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶(æ–‡ä»¶åä¸­åŒ…å« pwdï¼‰"></a>æŸ¥æ‰¾å’Œ pwd ç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶(æ–‡ä»¶åä¸­åŒ…å« pwdï¼‰</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">locate pwd</span><br></pre></td></tr></table></figure>
<h6 id="æœç´¢-etc-ç›®å½•ä¸‹æ‰€æœ‰ä»¥-sh-å¼€å¤´çš„æ–‡ä»¶"><a href="#æœç´¢-etc-ç›®å½•ä¸‹æ‰€æœ‰ä»¥-sh-å¼€å¤´çš„æ–‡ä»¶" class="headerlink" title="æœç´¢ etc ç›®å½•ä¸‹æ‰€æœ‰ä»¥ sh å¼€å¤´çš„æ–‡ä»¶"></a>æœç´¢ etc ç›®å½•ä¸‹æ‰€æœ‰ä»¥ sh å¼€å¤´çš„æ–‡ä»¶</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">locate &#x2F;etc&#x2F;sh</span><br></pre></td></tr></table></figure>
<h6 id="æŸ¥æ‰¾-var-ç›®å½•ä¸‹ï¼Œä»¥-reason-ç»“å°¾çš„æ–‡ä»¶"><a href="#æŸ¥æ‰¾-var-ç›®å½•ä¸‹ï¼Œä»¥-reason-ç»“å°¾çš„æ–‡ä»¶" class="headerlink" title="æŸ¥æ‰¾ /var ç›®å½•ä¸‹ï¼Œä»¥ reason ç»“å°¾çš„æ–‡ä»¶"></a>æŸ¥æ‰¾ /var ç›®å½•ä¸‹ï¼Œä»¥ reason ç»“å°¾çš„æ–‡ä»¶</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">locate -r &#39;^&#x2F;var.*reason$&#39;ï¼ˆå…¶ä¸­.è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œ*è¡¨ç¤ºä»»åŠ¡å¤šä¸ªï¼›.*è¡¨ç¤ºä»»æ„å¤šä¸ªå­—ç¬¦ï¼‰</span><br></pre></td></tr></table></figure>

<h4 id="whereis"><a href="#whereis" class="headerlink" title="whereis"></a>whereis</h4><h5 id="ä»‹ç»-9"><a href="#ä»‹ç»-9" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>whereis å‘½ä»¤åªèƒ½ç”¨äºç¨‹åºåçš„æœç´¢ï¼Œè€Œä¸”åªæœç´¢äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå‚æ•°-bï¼‰ã€manè¯´æ˜æ–‡ä»¶ï¼ˆå‚æ•°-mï¼‰å’Œæºä»£ç æ–‡ä»¶ï¼ˆå‚æ•°-sï¼‰ã€‚å¦‚æœçœç•¥å‚æ•°ï¼Œåˆ™è¿”å›æ‰€æœ‰ä¿¡æ¯ã€‚whereis åŠ locate éƒ½æ˜¯åŸºäºç³»ç»Ÿå†…å»ºçš„æ•°æ®åº“è¿›è¡Œæœç´¢ï¼Œå› æ­¤æ•ˆç‡å¾ˆé«˜ï¼Œè€Œfindåˆ™æ˜¯éå†ç¡¬ç›˜æŸ¥æ‰¾æ–‡ä»¶ã€‚</p>
<h6 id="å¸¸ç”¨å‚æ•°-4"><a href="#å¸¸ç”¨å‚æ•°-4" class="headerlink" title="å¸¸ç”¨å‚æ•°"></a>å¸¸ç”¨å‚æ•°</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-b   å®šä½å¯æ‰§è¡Œæ–‡ä»¶ã€‚</span><br><span class="line">-m   å®šä½å¸®åŠ©æ–‡ä»¶ã€‚</span><br><span class="line">-s   å®šä½æºä»£ç æ–‡ä»¶ã€‚</span><br><span class="line">-u   æœç´¢é»˜è®¤è·¯å¾„ä¸‹é™¤å¯æ‰§è¡Œæ–‡ä»¶ã€æºä»£ç æ–‡ä»¶ã€å¸®åŠ©æ–‡ä»¶ä»¥å¤–çš„å…¶å®ƒæ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹-9"><a href="#å®ä¾‹-9" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><h6 id="æŸ¥æ‰¾-locate-ç¨‹åºç›¸å…³æ–‡ä»¶"><a href="#æŸ¥æ‰¾-locate-ç¨‹åºç›¸å…³æ–‡ä»¶" class="headerlink" title="æŸ¥æ‰¾ locate ç¨‹åºç›¸å…³æ–‡ä»¶"></a>æŸ¥æ‰¾ locate ç¨‹åºç›¸å…³æ–‡ä»¶</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">whereis locate</span><br></pre></td></tr></table></figure>
<h6 id="æŸ¥æ‰¾-locate-çš„æºç æ–‡ä»¶"><a href="#æŸ¥æ‰¾-locate-çš„æºç æ–‡ä»¶" class="headerlink" title="æŸ¥æ‰¾ locate çš„æºç æ–‡ä»¶"></a>æŸ¥æ‰¾ locate çš„æºç æ–‡ä»¶</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">whereis -s locate</span><br></pre></td></tr></table></figure>
<h6 id="æŸ¥æ‰¾-lcoate-çš„å¸®åŠ©æ–‡ä»¶"><a href="#æŸ¥æ‰¾-lcoate-çš„å¸®åŠ©æ–‡ä»¶" class="headerlink" title="æŸ¥æ‰¾ lcoate çš„å¸®åŠ©æ–‡ä»¶"></a>æŸ¥æ‰¾ lcoate çš„å¸®åŠ©æ–‡ä»¶</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">whereis -m locate</span><br></pre></td></tr></table></figure>

<h4 id="which"><a href="#which" class="headerlink" title="which"></a>which</h4><h5 id="ä»‹ç»-10"><a href="#ä»‹ç»-10" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>åœ¨ linux è¦æŸ¥æ‰¾æŸä¸ªæ–‡ä»¶ï¼Œä½†ä¸çŸ¥é“æ”¾åœ¨å“ªé‡Œäº†ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä¸€äº›å‘½ä»¤æ¥æœç´¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">which     æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ã€‚</span><br><span class="line">whereis æŸ¥çœ‹æ–‡ä»¶çš„ä½ç½®ã€‚</span><br><span class="line">locate  é…åˆæ•°æ®åº“æŸ¥çœ‹æ–‡ä»¶ä½ç½®ã€‚</span><br><span class="line">find        å®é™…æœå¯»ç¡¬ç›˜æŸ¥è¯¢æ–‡ä»¶åç§°ã€‚</span><br></pre></td></tr></table></figure>
<p>which æ˜¯åœ¨ PATH å°±æ˜¯æŒ‡å®šçš„è·¯å¾„ä¸­ï¼Œæœç´¢æŸä¸ªç³»ç»Ÿå‘½ä»¤çš„ä½ç½®ï¼Œå¹¶è¿”å›ç¬¬ä¸€ä¸ªæœç´¢ç»“æœã€‚ä½¿ç”¨ which å‘½ä»¤ï¼Œå°±å¯ä»¥çœ‹åˆ°æŸä¸ªç³»ç»Ÿå‘½ä»¤æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠæ‰§è¡Œçš„åˆ°åº•æ˜¯å“ªä¸€ä¸ªä½ç½®çš„å‘½ä»¤ã€‚</p>
<h6 id="å¸¸ç”¨å‚æ•°-5"><a href="#å¸¸ç”¨å‚æ•°-5" class="headerlink" title="å¸¸ç”¨å‚æ•°"></a>å¸¸ç”¨å‚æ•°</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-n ã€€æŒ‡å®šæ–‡ä»¶åé•¿åº¦ï¼ŒæŒ‡å®šçš„é•¿åº¦å¿…é¡»å¤§äºæˆ–ç­‰äºæ‰€æœ‰æ–‡ä»¶ä¸­æœ€é•¿çš„æ–‡ä»¶åã€‚</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹-10"><a href="#å®ä¾‹-10" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><h6 id="æŸ¥çœ‹-ls-å‘½ä»¤æ˜¯å¦å­˜åœ¨ï¼Œæ‰§è¡Œå“ªä¸ª"><a href="#æŸ¥çœ‹-ls-å‘½ä»¤æ˜¯å¦å­˜åœ¨ï¼Œæ‰§è¡Œå“ªä¸ª" class="headerlink" title="æŸ¥çœ‹ ls å‘½ä»¤æ˜¯å¦å­˜åœ¨ï¼Œæ‰§è¡Œå“ªä¸ª"></a>æŸ¥çœ‹ ls å‘½ä»¤æ˜¯å¦å­˜åœ¨ï¼Œæ‰§è¡Œå“ªä¸ª</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">which ls</span><br></pre></td></tr></table></figure>
<h6 id="æŸ¥çœ‹-which"><a href="#æŸ¥çœ‹-which" class="headerlink" title="æŸ¥çœ‹ which"></a>æŸ¥çœ‹ which</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">which which</span><br></pre></td></tr></table></figure>
<h6 id="æŸ¥çœ‹-cd"><a href="#æŸ¥çœ‹-cd" class="headerlink" title="æŸ¥çœ‹ cd"></a>æŸ¥çœ‹ cd</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">which cdï¼ˆæ˜¾ç¤ºä¸å­˜åœ¨ï¼Œå› ä¸º cd æ˜¯å†…å»ºå‘½ä»¤ï¼Œè€Œ which æŸ¥æ‰¾æ˜¾ç¤ºæ˜¯ PATH ä¸­çš„å‘½ä»¤ï¼‰</span><br></pre></td></tr></table></figure>
<h6 id="æŸ¥çœ‹å½“å‰-PATH-é…ç½®ï¼š"><a href="#æŸ¥çœ‹å½“å‰-PATH-é…ç½®ï¼š" class="headerlink" title="æŸ¥çœ‹å½“å‰ PATH é…ç½®ï¼š"></a>æŸ¥çœ‹å½“å‰ PATH é…ç½®ï¼š</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo $PATH</span><br></pre></td></tr></table></figure>
<p>æˆ–ä½¿ç”¨ env æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå˜é‡åŠå¯¹åº”å€¼</p>
<h3 id="æ–‡æ¡£ç¼–è¾‘å‘½ä»¤"><a href="#æ–‡æ¡£ç¼–è¾‘å‘½ä»¤" class="headerlink" title="æ–‡æ¡£ç¼–è¾‘å‘½ä»¤"></a>æ–‡æ¡£ç¼–è¾‘å‘½ä»¤</h3><h4 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h4><h5 id="ä»‹ç»-11"><a href="#ä»‹ç»-11" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>å¼ºå¤§çš„æ–‡æœ¬æœç´¢å‘½ä»¤ï¼Œgrep(Global Regular Expression Print) å…¨å±€æ­£åˆ™è¡¨è¾¾å¼æœç´¢ã€‚</p>
<p>grep çš„å·¥ä½œæ–¹å¼æ˜¯è¿™æ ·çš„ï¼Œå®ƒåœ¨ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ä¸­æœç´¢å­—ç¬¦ä¸²æ¨¡æ¿ã€‚å¦‚æœæ¨¡æ¿åŒ…æ‹¬ç©ºæ ¼ï¼Œåˆ™å¿…é¡»è¢«å¼•ç”¨ï¼Œæ¨¡æ¿åçš„æ‰€æœ‰å­—ç¬¦ä¸²è¢«çœ‹ä½œæ–‡ä»¶åã€‚æœç´¢çš„ç»“æœè¢«é€åˆ°æ ‡å‡†è¾“å‡ºï¼Œä¸å½±å“åŸæ–‡ä»¶å†…å®¹ã€‚</p>
<h6 id="å‘½ä»¤æ ¼å¼-1"><a href="#å‘½ä»¤æ ¼å¼-1" class="headerlink" title="å‘½ä»¤æ ¼å¼"></a>å‘½ä»¤æ ¼å¼</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grep [option] pattern file|dir</span><br></pre></td></tr></table></figure>
<h6 id="å¸¸ç”¨å‚æ•°-6"><a href="#å¸¸ç”¨å‚æ•°-6" class="headerlink" title="å¸¸ç”¨å‚æ•°"></a>å¸¸ç”¨å‚æ•°</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-A n --after-contextæ˜¾ç¤ºåŒ¹é…å­—ç¬¦ånè¡Œ</span><br><span class="line">-B n --before-contextæ˜¾ç¤ºåŒ¹é…å­—ç¬¦å‰nè¡Œ</span><br><span class="line">-C n --context æ˜¾ç¤ºåŒ¹é…å­—ç¬¦å‰ånè¡Œ</span><br><span class="line">-c --count è®¡ç®—ç¬¦åˆæ ·å¼çš„åˆ—æ•°</span><br><span class="line">-i å¿½ç•¥å¤§å°å†™</span><br><span class="line">-l åªåˆ—å‡ºæ–‡ä»¶å†…å®¹ç¬¦åˆæŒ‡å®šçš„æ ·å¼çš„æ–‡ä»¶åç§°</span><br><span class="line">-f ä»æ–‡ä»¶ä¸­è¯»å–å…³é”®è¯</span><br><span class="line">-n æ˜¾ç¤ºåŒ¹é…å†…å®¹çš„æ‰€åœ¨æ–‡ä»¶ä¸­è¡Œæ•°</span><br><span class="line">-R é€’å½’æŸ¥æ‰¾æ–‡ä»¶å¤¹</span><br></pre></td></tr></table></figure>
<h6 id="grep-çš„è§„åˆ™è¡¨è¾¾å¼"><a href="#grep-çš„è§„åˆ™è¡¨è¾¾å¼" class="headerlink" title="grep çš„è§„åˆ™è¡¨è¾¾å¼"></a>grep çš„è§„åˆ™è¡¨è¾¾å¼</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^  #é”šå®šè¡Œçš„å¼€å§‹ å¦‚ï¼š&#39;^grep&#39;åŒ¹é…æ‰€æœ‰ä»¥grepå¼€å¤´çš„è¡Œã€‚ </span><br><span class="line">$  #é”šå®šè¡Œçš„ç»“æŸ å¦‚ï¼š&#39;grep$&#39;åŒ¹é…æ‰€æœ‰ä»¥grepç»“å°¾çš„è¡Œã€‚ </span><br><span class="line">.  #åŒ¹é…ä¸€ä¸ªéæ¢è¡Œç¬¦çš„å­—ç¬¦ å¦‚ï¼š&#39;gr.p&#39;åŒ¹é…gråæ¥ä¸€ä¸ªä»»æ„å­—ç¬¦ï¼Œç„¶åæ˜¯pã€‚  </span><br><span class="line">*  #åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå…ˆå‰å­—ç¬¦ å¦‚ï¼š&#39;*grep&#39;åŒ¹é…æ‰€æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼åç´§è·Ÿgrepçš„è¡Œã€‚</span><br><span class="line">.*   #ä¸€èµ·ç”¨ä»£è¡¨ä»»æ„å­—ç¬¦ã€‚  </span><br><span class="line">[]   #åŒ¹é…ä¸€ä¸ªæŒ‡å®šèŒƒå›´å†…çš„å­—ç¬¦ï¼Œå¦‚&#39;[Gg]rep&#39;åŒ¹é…Grepå’Œgrepã€‚ </span><br><span class="line">[^]  #åŒ¹é…ä¸€ä¸ªä¸åœ¨æŒ‡å®šèŒƒå›´å†…çš„å­—ç¬¦ï¼Œå¦‚ï¼š&#39;[^A-FH-Z]rep&#39;åŒ¹é…ä¸åŒ…å«A-Rå’ŒT-Zçš„ä¸€ä¸ªå­—æ¯å¼€å¤´ï¼Œç´§è·Ÿrepçš„è¡Œã€‚  </span><br><span class="line">\(..\)  #æ ‡è®°åŒ¹é…å­—ç¬¦ï¼Œå¦‚&#39;\(love\)&#39;ï¼Œloveè¢«æ ‡è®°ä¸º1ã€‚   </span><br><span class="line">\&lt;      #é”šå®šå•è¯çš„å¼€å§‹ï¼Œå¦‚:&#39;\&lt;grep&#39;åŒ¹é…åŒ…å«ä»¥grepå¼€å¤´çš„å•è¯çš„è¡Œã€‚</span><br><span class="line">\&gt;      #é”šå®šå•è¯çš„ç»“æŸï¼Œå¦‚&#39;grep\&gt;&#39;åŒ¹é…åŒ…å«ä»¥grepç»“å°¾çš„å•è¯çš„è¡Œã€‚</span><br><span class="line">x\&#123;m\&#125;  #é‡å¤å­—ç¬¦xï¼Œmæ¬¡ï¼Œå¦‚ï¼š&#39;0\&#123;5\&#125;&#39;åŒ¹é…åŒ…å«5ä¸ªoçš„è¡Œã€‚ </span><br><span class="line">x\&#123;m,\&#125;  #é‡å¤å­—ç¬¦x,è‡³å°‘mæ¬¡ï¼Œå¦‚ï¼š&#39;o\&#123;5,\&#125;&#39;åŒ¹é…è‡³å°‘æœ‰5ä¸ªoçš„è¡Œã€‚  </span><br><span class="line">x\&#123;m,n\&#125;  #é‡å¤å­—ç¬¦xï¼Œè‡³å°‘mæ¬¡ï¼Œä¸å¤šäºnæ¬¡ï¼Œå¦‚ï¼š&#39;o\&#123;5,10\&#125;&#39;åŒ¹é…5--10ä¸ªoçš„è¡Œã€‚  </span><br><span class="line">\w    #åŒ¹é…æ–‡å­—å’Œæ•°å­—å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯[A-Za-z0-9]ï¼Œå¦‚ï¼š&#39;G\w*p&#39;åŒ¹é…ä»¥Gåè·Ÿé›¶ä¸ªæˆ–å¤šä¸ªæ–‡å­—æˆ–æ•°å­—å­—ç¬¦ï¼Œç„¶åæ˜¯pã€‚  </span><br><span class="line">\W    #\wçš„åç½®å½¢å¼ï¼ŒåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªéå•è¯å­—ç¬¦ï¼Œå¦‚ç‚¹å·å¥å·ç­‰ã€‚  </span><br><span class="line">\b    #å•è¯é”å®šç¬¦ï¼Œå¦‚: &#39;\bgrep\b&#39;åªåŒ¹é…grepã€‚</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹-11"><a href="#å®ä¾‹-11" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><h6 id="æŸ¥æ‰¾æŒ‡å®šè¿›ç¨‹"><a href="#æŸ¥æ‰¾æŒ‡å®šè¿›ç¨‹" class="headerlink" title="æŸ¥æ‰¾æŒ‡å®šè¿›ç¨‹"></a>æŸ¥æ‰¾æŒ‡å®šè¿›ç¨‹</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -ef | grep svn</span><br></pre></td></tr></table></figure>
<h6 id="æŸ¥æ‰¾æŒ‡å®šè¿›ç¨‹ä¸ªæ•°"><a href="#æŸ¥æ‰¾æŒ‡å®šè¿›ç¨‹ä¸ªæ•°" class="headerlink" title="æŸ¥æ‰¾æŒ‡å®šè¿›ç¨‹ä¸ªæ•°"></a>æŸ¥æ‰¾æŒ‡å®šè¿›ç¨‹ä¸ªæ•°</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -ef | grep svn -c</span><br></pre></td></tr></table></figure>
<h6 id="ä»æ–‡ä»¶ä¸­è¯»å–å…³é”®è¯"><a href="#ä»æ–‡ä»¶ä¸­è¯»å–å…³é”®è¯" class="headerlink" title="ä»æ–‡ä»¶ä¸­è¯»å–å…³é”®è¯"></a>ä»æ–‡ä»¶ä¸­è¯»å–å…³é”®è¯</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat test1.txt | grep -f key.log</span><br></pre></td></tr></table></figure>
<h6 id="ä»æ–‡ä»¶å¤¹ä¸­é€’å½’æŸ¥æ‰¾ä»¥grepå¼€å¤´çš„è¡Œï¼Œå¹¶åªåˆ—å‡ºæ–‡ä»¶"><a href="#ä»æ–‡ä»¶å¤¹ä¸­é€’å½’æŸ¥æ‰¾ä»¥grepå¼€å¤´çš„è¡Œï¼Œå¹¶åªåˆ—å‡ºæ–‡ä»¶" class="headerlink" title="ä»æ–‡ä»¶å¤¹ä¸­é€’å½’æŸ¥æ‰¾ä»¥grepå¼€å¤´çš„è¡Œï¼Œå¹¶åªåˆ—å‡ºæ–‡ä»¶"></a>ä»æ–‡ä»¶å¤¹ä¸­é€’å½’æŸ¥æ‰¾ä»¥grepå¼€å¤´çš„è¡Œï¼Œå¹¶åªåˆ—å‡ºæ–‡ä»¶</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grep -lR &#39;^grep&#39; &#x2F;tmp</span><br></pre></td></tr></table></figure>
<h6 id="æŸ¥æ‰¾éxå¼€å…³çš„è¡Œå†…å®¹"><a href="#æŸ¥æ‰¾éxå¼€å…³çš„è¡Œå†…å®¹" class="headerlink" title="æŸ¥æ‰¾éxå¼€å…³çš„è¡Œå†…å®¹"></a>æŸ¥æ‰¾éxå¼€å…³çš„è¡Œå†…å®¹</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grep &#39;^[^x]&#39; test.txt</span><br></pre></td></tr></table></figure>
<h6 id="æ˜¾ç¤ºåŒ…å«-ed-æˆ–è€…-at-å­—ç¬¦çš„å†…å®¹è¡Œ"><a href="#æ˜¾ç¤ºåŒ…å«-ed-æˆ–è€…-at-å­—ç¬¦çš„å†…å®¹è¡Œ" class="headerlink" title="æ˜¾ç¤ºåŒ…å« ed æˆ–è€… at å­—ç¬¦çš„å†…å®¹è¡Œ"></a>æ˜¾ç¤ºåŒ…å« ed æˆ–è€… at å­—ç¬¦çš„å†…å®¹è¡Œ</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grep -E &#39;ed|at&#39; test.txt</span><br></pre></td></tr></table></figure>

<h4 id="wc"><a href="#wc" class="headerlink" title="wc"></a>wc</h4><h5 id="ä»‹ç»-12"><a href="#ä»‹ç»-12" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>wc(word count)åŠŸèƒ½ä¸ºç»Ÿè®¡æŒ‡å®šçš„æ–‡ä»¶ä¸­å­—èŠ‚æ•°ã€å­—æ•°ã€è¡Œæ•°ï¼Œå¹¶å°†ç»Ÿè®¡ç»“æœè¾“å‡º</p>
<h6 id="å‘½ä»¤æ ¼å¼-2"><a href="#å‘½ä»¤æ ¼å¼-2" class="headerlink" title="å‘½ä»¤æ ¼å¼"></a>å‘½ä»¤æ ¼å¼</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wc [option] file..</span><br></pre></td></tr></table></figure>
<h6 id="å‘½ä»¤å‚æ•°-1"><a href="#å‘½ä»¤å‚æ•°-1" class="headerlink" title="å‘½ä»¤å‚æ•°"></a>å‘½ä»¤å‚æ•°</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-c ç»Ÿè®¡å­—èŠ‚æ•°</span><br><span class="line">-l ç»Ÿè®¡è¡Œæ•°</span><br><span class="line">-m ç»Ÿè®¡å­—ç¬¦æ•°</span><br><span class="line">-w ç»Ÿè®¡è¯æ•°ï¼Œä¸€ä¸ªå­—è¢«å®šä¹‰ä¸ºç”±ç©ºç™½ã€è·³æ ¼æˆ–æ¢è¡Œå­—ç¬¦åˆ†éš”çš„å­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹-12"><a href="#å®ä¾‹-12" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><h6 id="æŸ¥æ‰¾æ–‡ä»¶çš„-è¡Œæ•°-å•è¯æ•°-å­—èŠ‚æ•°-æ–‡ä»¶å"><a href="#æŸ¥æ‰¾æ–‡ä»¶çš„-è¡Œæ•°-å•è¯æ•°-å­—èŠ‚æ•°-æ–‡ä»¶å" class="headerlink" title="æŸ¥æ‰¾æ–‡ä»¶çš„ è¡Œæ•° å•è¯æ•° å­—èŠ‚æ•° æ–‡ä»¶å"></a>æŸ¥æ‰¾æ–‡ä»¶çš„ è¡Œæ•° å•è¯æ•° å­—èŠ‚æ•° æ–‡ä»¶å</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wc text.txt</span><br></pre></td></tr></table></figure>
<h6 id="ç»Ÿè®¡è¾“å‡ºç»“æœçš„è¡Œæ•°"><a href="#ç»Ÿè®¡è¾“å‡ºç»“æœçš„è¡Œæ•°" class="headerlink" title="ç»Ÿè®¡è¾“å‡ºç»“æœçš„è¡Œæ•°"></a>ç»Ÿè®¡è¾“å‡ºç»“æœçš„è¡Œæ•°</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat test.txt | wc -l</span><br></pre></td></tr></table></figure>


<h3 id="ç½‘ç»œé€šè®¯å‘½ä»¤"><a href="#ç½‘ç»œé€šè®¯å‘½ä»¤" class="headerlink" title="ç½‘ç»œé€šè®¯å‘½ä»¤"></a>ç½‘ç»œé€šè®¯å‘½ä»¤</h3><h4 id="ifconfig"><a href="#ifconfig" class="headerlink" title="ifconfig"></a>ifconfig</h4><ul>
<li>ifconfig ç”¨äºæŸ¥çœ‹å’Œé…ç½® Linux ç³»ç»Ÿçš„ç½‘ç»œæ¥å£ã€‚<br/></li>
<li>æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£åŠå…¶çŠ¶æ€ï¼š<code>ifconfig -a</code> ã€‚</li>
<li>ä½¿ç”¨ up å’Œ down å‘½ä»¤å¯åŠ¨æˆ–åœæ­¢æŸä¸ªæ¥å£ï¼š<code>ifconfig eth0 up</code> å’Œ <code>ifconfig eth0 down</code> ã€‚</li>
</ul>
<h4 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h4><p>iptables ï¼Œæ˜¯ä¸€ä¸ªé…ç½® Linux å†…æ ¸é˜²ç«å¢™çš„å‘½ä»¤è¡Œå·¥å…·ã€‚åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå¯¹äºæˆ‘ä»¬å¼€å‘æ¥è¯´ï¼Œä¸»è¦æŒæ¡å¦‚ä½•å¼€æ”¾ç«¯å£å³å¯ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li><p>æŠŠæ¥æº IP ä¸º 192.168.1.101 è®¿é—®æœ¬æœº 80 ç«¯å£çš„åŒ…ç›´æ¥æ‹’ç»ï¼šiptables -I INPUT -s 192.168.1.101 -p tcp â€“dport 80 -j REJECT ã€‚</p>
</li>
<li><p>å¼€å¯ 80 ç«¯å£ï¼Œå› ä¸ºwebå¯¹å¤–éƒ½æ˜¯è¿™ä¸ªç«¯å£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 80 -j ACCEP</span><br></pre></td></tr></table></figure></li>
<li><p>å¦å¤–ï¼Œè¦æ³¨æ„ä½¿ç”¨ iptables save å‘½ä»¤ï¼Œè¿›è¡Œä¿å­˜ã€‚å¦åˆ™ï¼ŒæœåŠ¡å™¨é‡å¯åï¼Œé…ç½®çš„è§„åˆ™å°†ä¸¢å¤±ã€‚</p>
</li>
</ul>
<h4 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h4><h5 id="ä»‹ç»-13"><a href="#ä»‹ç»-13" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>Linux netstatå‘½ä»¤ç”¨äºæ˜¾ç¤ºç½‘ç»œçŠ¶æ€ã€‚<br>åˆ©ç”¨netstatæŒ‡ä»¤å¯è®©ä½ å¾—çŸ¥æ•´ä¸ªLinuxç³»ç»Ÿçš„ç½‘ç»œæƒ…å†µã€‚</p>
<h6 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">netstat [-acCeFghilMnNoprstuvVwx][-A&lt;ç½‘ç»œç±»å‹&gt;][--ip]</span><br></pre></td></tr></table></figure>
<h6 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-aæˆ–â€“all æ˜¾ç¤ºæ‰€æœ‰è¿çº¿ä¸­çš„Socketã€‚</span><br><span class="line">-A&lt;ç½‘ç»œç±»å‹&gt;æˆ–â€“&lt;ç½‘ç»œç±»å‹&gt; åˆ—å‡ºè¯¥ç½‘ç»œç±»å‹è¿çº¿ä¸­çš„ç›¸å…³åœ°å€ã€‚</span><br><span class="line">-cæˆ–â€“continuous æŒç»­åˆ—å‡ºç½‘ç»œçŠ¶æ€ã€‚</span><br><span class="line">-Cæˆ–â€“cache æ˜¾ç¤ºè·¯ç”±å™¨é…ç½®çš„å¿«å–ä¿¡æ¯ã€‚</span><br><span class="line">-eæˆ–â€“extend æ˜¾ç¤ºç½‘ç»œå…¶ä»–ç›¸å…³ä¿¡æ¯ã€‚</span><br><span class="line">-Fæˆ–â€“fib æ˜¾ç¤ºFIBã€‚</span><br><span class="line">-gæˆ–â€“groups æ˜¾ç¤ºå¤šé‡å¹¿æ’­åŠŸèƒ½ç¾¤ç»„ç»„å‘˜åå•ã€‚</span><br><span class="line">-hæˆ–â€“help åœ¨çº¿å¸®åŠ©ã€‚</span><br><span class="line">-iæˆ–â€“interfaces æ˜¾ç¤ºç½‘ç»œç•Œé¢ä¿¡æ¯è¡¨å•ã€‚</span><br><span class="line">-læˆ–â€“listening æ˜¾ç¤ºç›‘æ§ä¸­çš„æœåŠ¡å™¨çš„Socketã€‚</span><br><span class="line">-Mæˆ–â€“masquerade æ˜¾ç¤ºä¼ªè£…çš„ç½‘ç»œè¿çº¿ã€‚</span><br><span class="line">-næˆ–â€“numeric ç›´æ¥ä½¿ç”¨IPåœ°å€ï¼Œè€Œä¸é€šè¿‡åŸŸåæœåŠ¡å™¨ã€‚</span><br><span class="line">-Næˆ–â€“netlinkæˆ–â€“symbolic æ˜¾ç¤ºç½‘ç»œç¡¬ä»¶å¤–å›´è®¾å¤‡çš„ç¬¦å·è¿æ¥åç§°ã€‚</span><br><span class="line">-oæˆ–â€“timers æ˜¾ç¤ºè®¡æ—¶å™¨ã€‚</span><br><span class="line">-pæˆ–â€“programs æ˜¾ç¤ºæ­£åœ¨ä½¿ç”¨Socketçš„ç¨‹åºè¯†åˆ«ç å’Œç¨‹åºåç§°ã€‚</span><br><span class="line">-ræˆ–â€“route æ˜¾ç¤ºRouting Tableã€‚</span><br><span class="line">-sæˆ–â€“statistice æ˜¾ç¤ºç½‘ç»œå·¥ä½œä¿¡æ¯ç»Ÿè®¡è¡¨ã€‚</span><br><span class="line">-tæˆ–â€“tcp æ˜¾ç¤ºTCPä¼ è¾“åè®®çš„è¿çº¿çŠ¶å†µã€‚</span><br><span class="line">-uæˆ–â€“udp æ˜¾ç¤ºUDPä¼ è¾“åè®®çš„è¿çº¿çŠ¶å†µã€‚</span><br><span class="line">-væˆ–â€“verbose æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ã€‚</span><br><span class="line">-Væˆ–â€“version æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚</span><br><span class="line">-wæˆ–â€“raw æ˜¾ç¤ºRAWä¼ è¾“åè®®çš„è¿çº¿çŠ¶å†µã€‚</span><br><span class="line">-xæˆ–â€“unix æ­¤å‚æ•°çš„æ•ˆæœå’ŒæŒ‡å®š&quot;-A unix&quot;å‚æ•°ç›¸åŒã€‚</span><br><span class="line">â€“ipæˆ–â€“inet æ­¤å‚æ•°çš„æ•ˆæœå’ŒæŒ‡å®š&quot;-A inet&quot;å‚æ•°ç›¸åŒã€‚</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹-13"><a href="#å®ä¾‹-13" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><h6 id="å¦‚ä½•æŸ¥çœ‹ç³»ç»Ÿéƒ½å¼€å¯äº†å“ªäº›ç«¯å£ï¼Ÿ"><a href="#å¦‚ä½•æŸ¥çœ‹ç³»ç»Ÿéƒ½å¼€å¯äº†å“ªäº›ç«¯å£ï¼Ÿ" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹ç³»ç»Ÿéƒ½å¼€å¯äº†å“ªäº›ç«¯å£ï¼Ÿ"></a>å¦‚ä½•æŸ¥çœ‹ç³»ç»Ÿéƒ½å¼€å¯äº†å“ªäº›ç«¯å£ï¼Ÿ</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">netstat -lnp</span><br></pre></td></tr></table></figure>
<h6 id="å¦‚ä½•æŸ¥çœ‹ç½‘ç»œè¿æ¥çŠ¶å†µï¼Ÿ"><a href="#å¦‚ä½•æŸ¥çœ‹ç½‘ç»œè¿æ¥çŠ¶å†µï¼Ÿ" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹ç½‘ç»œè¿æ¥çŠ¶å†µï¼Ÿ"></a>å¦‚ä½•æŸ¥çœ‹ç½‘ç»œè¿æ¥çŠ¶å†µï¼Ÿ</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">netstat -an</span><br></pre></td></tr></table></figure>
<h6 id="å¦‚ä½•ç»Ÿè®¡ç³»ç»Ÿå½“å‰è¿›ç¨‹è¿æ¥æ•°ï¼Ÿ"><a href="#å¦‚ä½•ç»Ÿè®¡ç³»ç»Ÿå½“å‰è¿›ç¨‹è¿æ¥æ•°ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç»Ÿè®¡ç³»ç»Ÿå½“å‰è¿›ç¨‹è¿æ¥æ•°ï¼Ÿ"></a>å¦‚ä½•ç»Ÿè®¡ç³»ç»Ÿå½“å‰è¿›ç¨‹è¿æ¥æ•°ï¼Ÿ</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥å‘½ä»¤ netstat -an | grep ESTABLISHED | wc -l ã€‚</span><br><span class="line">è¾“å‡ºç»“æœ 177 ã€‚ä¸€å…±æœ‰ 177 è¿æ¥æ•°ã€‚</span><br></pre></td></tr></table></figure>
<h6 id="ç”¨-netstat-å‘½ä»¤é…åˆå…¶ä»–å‘½ä»¤ï¼ŒæŒ‰ç…§æº-IP-ç»Ÿè®¡æ‰€æœ‰åˆ°-80-ç«¯å£çš„-ESTABLISHED-çŠ¶æ€é“¾æ¥çš„ä¸ªæ•°ï¼Ÿ"><a href="#ç”¨-netstat-å‘½ä»¤é…åˆå…¶ä»–å‘½ä»¤ï¼ŒæŒ‰ç…§æº-IP-ç»Ÿè®¡æ‰€æœ‰åˆ°-80-ç«¯å£çš„-ESTABLISHED-çŠ¶æ€é“¾æ¥çš„ä¸ªæ•°ï¼Ÿ" class="headerlink" title="ç”¨ netstat å‘½ä»¤é…åˆå…¶ä»–å‘½ä»¤ï¼ŒæŒ‰ç…§æº IP ç»Ÿè®¡æ‰€æœ‰åˆ° 80 ç«¯å£çš„ ESTABLISHED çŠ¶æ€é“¾æ¥çš„ä¸ªæ•°ï¼Ÿ"></a>ç”¨ netstat å‘½ä»¤é…åˆå…¶ä»–å‘½ä»¤ï¼ŒæŒ‰ç…§æº IP ç»Ÿè®¡æ‰€æœ‰åˆ° 80 ç«¯å£çš„ ESTABLISHED çŠ¶æ€é“¾æ¥çš„ä¸ªæ•°ï¼Ÿ</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">netstat -an|grep ESTABLISHED</span><br></pre></td></tr></table></figure>

<h4 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h4><p>Linux pingå‘½ä»¤ç”¨äºæ£€æµ‹ä¸»æœºã€‚</p>
<p>æ‰§è¡ŒpingæŒ‡ä»¤ä¼šä½¿ç”¨ICMPä¼ è¾“åè®®ï¼Œå‘å‡ºè¦æ±‚å›åº”çš„ä¿¡æ¯ï¼Œè‹¥è¿œç«¯ä¸»æœºçš„ç½‘ç»œåŠŸèƒ½æ²¡æœ‰é—®é¢˜ï¼Œå°±ä¼šå›åº”è¯¥ä¿¡æ¯ï¼Œå› è€Œå¾—çŸ¥è¯¥ä¸»æœºè¿ä½œæ­£å¸¸ã€‚</p>
<p>æŒ‡å®šæ¥æ”¶åŒ…çš„æ¬¡æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ping -c 2 www.baidu.com</span><br></pre></td></tr></table></figure>

<h4 id="telnet"><a href="#telnet" class="headerlink" title="telnet"></a>telnet</h4><p>Linux telnetå‘½ä»¤ç”¨äºè¿œç«¯ç™»å…¥ã€‚<br>æ‰§è¡ŒtelnetæŒ‡ä»¤å¼€å¯ç»ˆç«¯æœºé˜¶æ®µä½œä¸šï¼Œå¹¶ç™»å…¥è¿œç«¯ä¸»æœºã€‚</p>
<h6 id="è¯­æ³•-1"><a href="#è¯­æ³•-1" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">telnet [-8acdEfFKLrx][-b&lt;ä¸»æœºåˆ«å&gt;][-e&lt;è„±ç¦»å­—ç¬¦&gt;][-k&lt;åŸŸå&gt;][-l&lt;ç”¨æˆ·åç§°&gt;][-n&lt;è®°å½•æ–‡ä»¶&gt;][-S&lt;æœåŠ¡ç±»å‹&gt;][-X&lt;è®¤è¯å½¢æ€&gt;][ä¸»æœºåç§°æˆ–IPåœ°å€&lt;é€šä¿¡ç«¯å£&gt;]</span><br></pre></td></tr></table></figure>
<h6 id="å‚æ•°è¯´æ˜-1"><a href="#å‚æ•°è¯´æ˜-1" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-8 å…è®¸ä½¿ç”¨8ä½å­—ç¬¦èµ„æ–™ï¼ŒåŒ…æ‹¬è¾“å…¥ä¸è¾“å‡ºã€‚</span><br><span class="line">-a å°è¯•è‡ªåŠ¨ç™»å…¥è¿œç«¯ç³»ç»Ÿã€‚</span><br><span class="line">-b&lt;ä¸»æœºåˆ«å&gt; ä½¿ç”¨åˆ«åæŒ‡å®šè¿œç«¯ä¸»æœºåç§°ã€‚</span><br><span class="line">-c ä¸è¯»å–ç”¨æˆ·ä¸“å±ç›®å½•é‡Œçš„.telnetrcæ–‡ä»¶ã€‚</span><br><span class="line">-d å¯åŠ¨æ’é”™æ¨¡å¼ã€‚</span><br><span class="line">-e&lt;è„±ç¦»å­—ç¬¦&gt; è®¾ç½®è„±ç¦»å­—ç¬¦ã€‚</span><br><span class="line">-E æ»¤é™¤è„±ç¦»å­—ç¬¦ã€‚</span><br><span class="line">-f æ­¤å‚æ•°çš„æ•ˆæœå’ŒæŒ‡å®š&quot;-F&quot;å‚æ•°ç›¸åŒã€‚</span><br><span class="line">-F ä½¿ç”¨Kerberos V5è®¤è¯æ—¶ï¼ŒåŠ ä¸Šæ­¤å‚æ•°å¯æŠŠæœ¬åœ°ä¸»æœºçš„è®¤è¯æ•°æ®ä¸Šä¼ åˆ°è¿œç«¯ä¸»æœºã€‚</span><br><span class="line">-k&lt;åŸŸå&gt; ä½¿ç”¨Kerberosè®¤è¯æ—¶ï¼ŒåŠ ä¸Šæ­¤å‚æ•°è®©è¿œç«¯ä¸»æœºé‡‡ç”¨æŒ‡å®šçš„é¢†åŸŸåï¼Œè€Œéè¯¥ä¸»æœºçš„åŸŸåã€‚</span><br><span class="line">-K ä¸è‡ªåŠ¨ç™»å…¥è¿œç«¯ä¸»æœºã€‚</span><br><span class="line">-l&lt;ç”¨æˆ·åç§°&gt; æŒ‡å®šè¦ç™»å…¥è¿œç«¯ä¸»æœºçš„ç”¨æˆ·åç§°ã€‚</span><br><span class="line">-L å…è®¸è¾“å‡º8ä½å­—ç¬¦èµ„æ–™ã€‚</span><br><span class="line">-n&lt;è®°å½•æ–‡ä»¶&gt; æŒ‡å®šæ–‡ä»¶è®°å½•ç›¸å…³ä¿¡æ¯ã€‚</span><br><span class="line">-r ä½¿ç”¨ç±»ä¼¼rloginæŒ‡ä»¤çš„ç”¨æˆ·ç•Œé¢ã€‚</span><br><span class="line">-S&lt;æœåŠ¡ç±»å‹&gt; è®¾ç½®telnetè¿çº¿æ‰€éœ€çš„IP TOSä¿¡æ¯ã€‚</span><br><span class="line">-x å‡è®¾ä¸»æœºæœ‰æ”¯æŒæ•°æ®åŠ å¯†çš„åŠŸèƒ½ï¼Œå°±ä½¿ç”¨å®ƒã€‚</span><br><span class="line">-X&lt;è®¤è¯å½¢æ€&gt; å…³é—­æŒ‡å®šçš„è®¤è¯å½¢æ€ã€‚</span><br></pre></td></tr></table></figure>
<h6 id="ç™»å½•è¿œç¨‹ä¸»æœº"><a href="#ç™»å½•è¿œç¨‹ä¸»æœº" class="headerlink" title="ç™»å½•è¿œç¨‹ä¸»æœº"></a>ç™»å½•è¿œç¨‹ä¸»æœº</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ç™»å½•IPä¸º 192.168.0.5 çš„è¿œç¨‹ä¸»æœº</span><br><span class="line">telnet 192.168.0.5</span><br></pre></td></tr></table></figure>


<h3 id="ç³»ç»Ÿç®¡ç†å‘½ä»¤"><a href="#ç³»ç»Ÿç®¡ç†å‘½ä»¤" class="headerlink" title="ç³»ç»Ÿç®¡ç†å‘½ä»¤"></a>ç³»ç»Ÿç®¡ç†å‘½ä»¤</h3><h4 id="kill"><a href="#kill" class="headerlink" title="kill"></a>kill</h4><p>å‘é€æŒ‡å®šçš„ä¿¡å·åˆ°ç›¸åº”è¿›ç¨‹ã€‚ä¸æŒ‡å®šå‹å·å°†å‘é€SIGTERMï¼ˆ15ï¼‰ç»ˆæ­¢æŒ‡å®šè¿›ç¨‹ã€‚å¦‚æœä»»æ— æ³•ç»ˆæ­¢è¯¥ç¨‹åºå¯ç”¨â€-KILLâ€ å‚æ•°ï¼Œå…¶å‘é€çš„ä¿¡å·ä¸ºSIGKILL(9) ï¼Œå°†å¼ºåˆ¶ç»“æŸè¿›ç¨‹ï¼Œä½¿ç”¨pså‘½ä»¤æˆ–è€…jobs å‘½ä»¤å¯ä»¥æŸ¥çœ‹è¿›ç¨‹å·ã€‚rootç”¨æˆ·å°†å½±å“ç”¨æˆ·çš„è¿›ç¨‹ï¼Œérootç”¨æˆ·åªèƒ½å½±å“è‡ªå·±çš„è¿›ç¨‹ã€‚</p>
<h6 id="å¸¸ç”¨å‚æ•°-7"><a href="#å¸¸ç”¨å‚æ•°-7" class="headerlink" title="å¸¸ç”¨å‚æ•°"></a>å¸¸ç”¨å‚æ•°</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-l  ä¿¡å·ï¼Œè‹¥æœä¸åŠ ä¿¡å·çš„ç¼–å·å‚æ•°ï¼Œåˆ™ä½¿ç”¨â€œ-lâ€å‚æ•°ä¼šåˆ—å‡ºå…¨éƒ¨çš„ä¿¡å·åç§°</span><br><span class="line">-a  å½“å¤„ç†å½“å‰è¿›ç¨‹æ—¶ï¼Œä¸é™åˆ¶å‘½ä»¤åå’Œè¿›ç¨‹å·çš„å¯¹åº”å…³ç³»</span><br><span class="line">-p  æŒ‡å®škill å‘½ä»¤åªæ‰“å°ç›¸å…³è¿›ç¨‹çš„è¿›ç¨‹å·ï¼Œè€Œä¸å‘é€ä»»ä½•ä¿¡å·</span><br><span class="line">-s  æŒ‡å®šå‘é€ä¿¡å·</span><br><span class="line">-u  æŒ‡å®šç”¨æˆ·</span><br></pre></td></tr></table></figure>
<h6 id="å…ˆä½¿ç”¨psæŸ¥æ‰¾è¿›ç¨‹pro1ï¼Œç„¶åç”¨killæ€æ‰"><a href="#å…ˆä½¿ç”¨psæŸ¥æ‰¾è¿›ç¨‹pro1ï¼Œç„¶åç”¨killæ€æ‰" class="headerlink" title="å…ˆä½¿ç”¨psæŸ¥æ‰¾è¿›ç¨‹pro1ï¼Œç„¶åç”¨killæ€æ‰"></a>å…ˆä½¿ç”¨psæŸ¥æ‰¾è¿›ç¨‹pro1ï¼Œç„¶åç”¨killæ€æ‰</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kill -9 $(ps -ef | grep pro1)</span><br></pre></td></tr></table></figure>

<h4 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h4><h5 id="ä»‹ç»-14"><a href="#ä»‹ç»-14" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>ps(process status)ï¼Œç”¨æ¥æŸ¥çœ‹å½“å‰è¿è¡Œçš„è¿›ç¨‹çŠ¶æ€ï¼Œä¸€æ¬¡æ€§æŸ¥çœ‹ï¼Œå¦‚æœéœ€è¦åŠ¨æ€è¿ç»­ç»“æœä½¿ç”¨ top</p>
<p>linuxä¸Šè¿›ç¨‹æœ‰5ç§çŠ¶æ€:</p>
<ul>
<li>è¿è¡Œ(æ­£åœ¨è¿è¡Œæˆ–åœ¨è¿è¡Œé˜Ÿåˆ—ä¸­ç­‰å¾…)</li>
<li>ä¸­æ–­(ä¼‘çœ ä¸­, å—é˜», åœ¨ç­‰å¾…æŸä¸ªæ¡ä»¶çš„å½¢æˆæˆ–æ¥å—åˆ°ä¿¡å·)</li>
<li>ä¸å¯ä¸­æ–­(æ”¶åˆ°ä¿¡å·ä¸å”¤é†’å’Œä¸å¯è¿è¡Œ, è¿›ç¨‹å¿…é¡»ç­‰å¾…ç›´åˆ°æœ‰ä¸­æ–­å‘ç”Ÿ)</li>
<li>åƒµæ­»(è¿›ç¨‹å·²ç»ˆæ­¢, ä½†è¿›ç¨‹æè¿°ç¬¦å­˜åœ¨, ç›´åˆ°çˆ¶è¿›ç¨‹è°ƒç”¨wait4()ç³»ç»Ÿè°ƒç”¨åé‡Šæ”¾)</li>
<li>åœæ­¢(è¿›ç¨‹æ”¶åˆ°SIGSTOP, SIGSTP, SIGTIN, SIGTOUä¿¡å·ååœæ­¢è¿è¡Œ)<h6 id="ps-å·¥å…·æ ‡è¯†è¿›ç¨‹çš„5ç§çŠ¶æ€ç "><a href="#ps-å·¥å…·æ ‡è¯†è¿›ç¨‹çš„5ç§çŠ¶æ€ç " class="headerlink" title="ps å·¥å…·æ ‡è¯†è¿›ç¨‹çš„5ç§çŠ¶æ€ç "></a>ps å·¥å…·æ ‡è¯†è¿›ç¨‹çš„5ç§çŠ¶æ€ç </h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">D ä¸å¯ä¸­æ–­ uninterruptible sleep (usually IO)</span><br><span class="line">R è¿è¡Œ runnable (on run queue)</span><br><span class="line">S ä¸­æ–­ sleeping</span><br><span class="line">T åœæ­¢ traced or stopped</span><br><span class="line">Z åƒµæ­» a defunct (â€zombieâ€) process</span><br></pre></td></tr></table></figure>
<h6 id="å‘½ä»¤å‚æ•°-2"><a href="#å‘½ä»¤å‚æ•°-2" class="headerlink" title="å‘½ä»¤å‚æ•°"></a>å‘½ä»¤å‚æ•°</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-A æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹</span><br><span class="line">a æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹</span><br><span class="line">-a æ˜¾ç¤ºåŒä¸€ç»ˆç«¯ä¸‹æ‰€æœ‰è¿›ç¨‹</span><br><span class="line">c æ˜¾ç¤ºè¿›ç¨‹çœŸå®åç§°</span><br><span class="line">e æ˜¾ç¤ºç¯å¢ƒå˜é‡</span><br><span class="line">f æ˜¾ç¤ºè¿›ç¨‹é—´çš„å…³ç³»</span><br><span class="line">r æ˜¾ç¤ºå½“å‰ç»ˆç«¯è¿è¡Œçš„è¿›ç¨‹</span><br><span class="line">-aux æ˜¾ç¤ºæ‰€æœ‰åŒ…å«å…¶å®ƒä½¿ç”¨çš„è¿›ç¨‹</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹-14"><a href="#å®ä¾‹-14" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><h6 id="æ˜¾ç¤ºå½“å‰æ‰€æœ‰è¿›ç¨‹ç¯å¢ƒå˜é‡åŠè¿›ç¨‹é—´å…³ç³»"><a href="#æ˜¾ç¤ºå½“å‰æ‰€æœ‰è¿›ç¨‹ç¯å¢ƒå˜é‡åŠè¿›ç¨‹é—´å…³ç³»" class="headerlink" title="æ˜¾ç¤ºå½“å‰æ‰€æœ‰è¿›ç¨‹ç¯å¢ƒå˜é‡åŠè¿›ç¨‹é—´å…³ç³»"></a>æ˜¾ç¤ºå½“å‰æ‰€æœ‰è¿›ç¨‹ç¯å¢ƒå˜é‡åŠè¿›ç¨‹é—´å…³ç³»</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -ef</span><br></pre></td></tr></table></figure>
<h6 id="æ˜¾ç¤ºå½“å‰æ‰€æœ‰è¿›ç¨‹"><a href="#æ˜¾ç¤ºå½“å‰æ‰€æœ‰è¿›ç¨‹" class="headerlink" title="æ˜¾ç¤ºå½“å‰æ‰€æœ‰è¿›ç¨‹"></a>æ˜¾ç¤ºå½“å‰æ‰€æœ‰è¿›ç¨‹</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -A</span><br></pre></td></tr></table></figure>
<h6 id="ä¸grepè”ç”¨æŸ¥æ‰¾æŸè¿›ç¨‹"><a href="#ä¸grepè”ç”¨æŸ¥æ‰¾æŸè¿›ç¨‹" class="headerlink" title="ä¸grepè”ç”¨æŸ¥æ‰¾æŸè¿›ç¨‹"></a>ä¸grepè”ç”¨æŸ¥æ‰¾æŸè¿›ç¨‹</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -aux | grep apache</span><br></pre></td></tr></table></figure>
<h6 id="æ‰¾å‡ºä¸-cron-ä¸-syslog-è¿™ä¸¤ä¸ªæœåŠ¡æœ‰å…³çš„-PID-å·ç "><a href="#æ‰¾å‡ºä¸-cron-ä¸-syslog-è¿™ä¸¤ä¸ªæœåŠ¡æœ‰å…³çš„-PID-å·ç " class="headerlink" title="æ‰¾å‡ºä¸ cron ä¸ syslog è¿™ä¸¤ä¸ªæœåŠ¡æœ‰å…³çš„ PID å·ç "></a>æ‰¾å‡ºä¸ cron ä¸ syslog è¿™ä¸¤ä¸ªæœåŠ¡æœ‰å…³çš„ PID å·ç </h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps aux | grep &#39;(cron|syslog)&#39;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="top"><a href="#top" class="headerlink" title="top"></a>top</h4><h5 id="ä»‹ç»-15"><a href="#ä»‹ç»-15" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p>æ˜¾ç¤ºå½“å‰ç³»ç»Ÿæ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿›ç¨‹ IDã€å†…å­˜å ç”¨ç‡ã€CPU å ç”¨ç‡ç­‰</p>
<h6 id="å¸¸ç”¨å‚æ•°-8"><a href="#å¸¸ç”¨å‚æ•°-8" class="headerlink" title="å¸¸ç”¨å‚æ•°"></a>å¸¸ç”¨å‚æ•°</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-c æ˜¾ç¤ºå®Œæ•´çš„è¿›ç¨‹å‘½ä»¤</span><br><span class="line">-s ä¿å¯†æ¨¡å¼</span><br><span class="line">-p &lt;è¿›ç¨‹å·&gt; æŒ‡å®šè¿›ç¨‹æ˜¾ç¤º</span><br><span class="line">-n &lt;æ¬¡æ•°&gt;å¾ªç¯æ˜¾ç¤ºæ¬¡æ•°</span><br></pre></td></tr></table></figure>
<h5 id="å®ä¾‹-15"><a href="#å®ä¾‹-15" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">top - 14:06:23 up 70 days, 16:44,  2 users,  load average: 1.25, 1.32, 1.35</span><br><span class="line">Tasks: 206 total,   1 running, 205 sleeping,   0 stopped,   0 zombie</span><br><span class="line">Cpu(s):  5.9%us,  3.4%sy,  0.0%ni, 90.4%id,  0.0%wa,  0.0%hi,  0.2%si,  0.0%st</span><br><span class="line">Mem:  32949016k total, 14411180k used, 18537836k free,   169884k buffers</span><br><span class="line">Swap: 32764556k total,        0k used, 32764556k free,  3612636k cached</span><br><span class="line">PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND  </span><br><span class="line">28894 root      22   0 1501m 405m  10m S 52.2  1.3   2534:16 java</span><br></pre></td></tr></table></figure>
<p>å‰äº”è¡Œæ˜¯å½“å‰ç³»ç»Ÿæƒ…å†µæ•´ä½“çš„ç»Ÿè®¡ä¿¡æ¯åŒºã€‚</p>
<p><code>ç¬¬ä¸€è¡Œ</code>ï¼Œä»»åŠ¡é˜Ÿåˆ—ä¿¡æ¯ï¼ŒåŒ uptime å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼Œå…·ä½“å‚æ•°è¯´æ˜æƒ…å†µå¦‚ä¸‹ï¼š</p>
<p>14:06:23 â€” å½“å‰ç³»ç»Ÿæ—¶é—´</p>
<p>up 70 days, 16:44 â€” ç³»ç»Ÿå·²ç»è¿è¡Œäº†70å¤©16å°æ—¶44åˆ†é’Ÿï¼ˆåœ¨è¿™æœŸé—´ç³»ç»Ÿæ²¡æœ‰é‡å¯è¿‡çš„å†ï¼ï¼‰</p>
<p>2 users â€” å½“å‰æœ‰2ä¸ªç”¨æˆ·ç™»å½•ç³»ç»Ÿ</p>
<p>load average: 1.15, 1.42, 1.44 â€” load averageåé¢çš„ä¸‰ä¸ªæ•°åˆ†åˆ«æ˜¯1åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿçš„è´Ÿè½½æƒ…å†µã€‚</p>
<p>load averageæ•°æ®æ˜¯æ¯éš”5ç§’é’Ÿæ£€æŸ¥ä¸€æ¬¡æ´»è·ƒçš„è¿›ç¨‹æ•°ï¼Œç„¶åæŒ‰ç‰¹å®šç®—æ³•è®¡ç®—å‡ºçš„æ•°å€¼ã€‚å¦‚æœè¿™ä¸ªæ•°é™¤ä»¥é€»è¾‘CPUçš„æ•°é‡ï¼Œç»“æœé«˜äº5çš„æ—¶å€™å°±è¡¨æ˜ç³»ç»Ÿåœ¨è¶…è´Ÿè·è¿è½¬äº†ã€‚</p>
<p><code>ç¬¬äºŒè¡Œ</code>ï¼ŒTasks â€” ä»»åŠ¡ï¼ˆè¿›ç¨‹ï¼‰ï¼Œå…·ä½“ä¿¡æ¯è¯´æ˜å¦‚ä¸‹ï¼š</p>
<p>ç³»ç»Ÿç°åœ¨å…±æœ‰206ä¸ªè¿›ç¨‹ï¼Œå…¶ä¸­å¤„äºè¿è¡Œä¸­çš„æœ‰1ä¸ªï¼Œ205ä¸ªåœ¨ä¼‘çœ ï¼ˆsleepï¼‰ï¼ŒstopedçŠ¶æ€çš„æœ‰0ä¸ªï¼ŒzombieçŠ¶æ€ï¼ˆåƒµå°¸ï¼‰çš„æœ‰0ä¸ªã€‚</p>
<p><code>ç¬¬ä¸‰è¡Œ</code>ï¼ŒcpuçŠ¶æ€ä¿¡æ¯ï¼Œå…·ä½“å±æ€§è¯´æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">5.9%us â€” ç”¨æˆ·ç©ºé—´å ç”¨CPUçš„ç™¾åˆ†æ¯”ã€‚</span><br><span class="line">3.4% sy â€” å†…æ ¸ç©ºé—´å ç”¨CPUçš„ç™¾åˆ†æ¯”ã€‚</span><br><span class="line">0.0% ni â€” æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹å ç”¨CPUçš„ç™¾åˆ†æ¯”</span><br><span class="line">90.4% id â€” ç©ºé—²CPUç™¾åˆ†æ¯”</span><br><span class="line">0.0% wa â€” IOç­‰å¾…å ç”¨CPUçš„ç™¾åˆ†æ¯”</span><br><span class="line">0.0% hi â€” ç¡¬ä¸­æ–­ï¼ˆHardware IRQï¼‰å ç”¨CPUçš„ç™¾åˆ†æ¯”</span><br><span class="line">0.2% si â€” è½¯ä¸­æ–­ï¼ˆSoftware Interruptsï¼‰å ç”¨CPUçš„ç™¾åˆ†æ¯”</span><br></pre></td></tr></table></figure>
<p>å¤‡æ³¨ï¼šåœ¨è¿™é‡ŒCPUçš„ä½¿ç”¨æ¯”ç‡å’Œwindowsæ¦‚å¿µä¸åŒï¼Œéœ€è¦ç†è§£linuxç³»ç»Ÿç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„ç›¸å…³çŸ¥è¯†ï¼<br><code>ç¬¬å››è¡Œ</code>ï¼Œå†…å­˜çŠ¶æ€ï¼Œå…·ä½“ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">32949016k total â€” ç‰©ç†å†…å­˜æ€»é‡ï¼ˆ32GBï¼‰</span><br><span class="line">14411180k used â€” ä½¿ç”¨ä¸­çš„å†…å­˜æ€»é‡ï¼ˆ14GBï¼‰</span><br><span class="line">18537836k free â€” ç©ºé—²å†…å­˜æ€»é‡ï¼ˆ18GBï¼‰</span><br><span class="line">169884k buffers â€” ç¼“å­˜çš„å†…å­˜é‡ ï¼ˆ169Mï¼‰</span><br></pre></td></tr></table></figure>
<p><code>ç¬¬äº”è¡Œ</code>ï¼Œswapäº¤æ¢åˆ†åŒºä¿¡æ¯ï¼Œå…·ä½“ä¿¡æ¯è¯´æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">32764556k total â€” äº¤æ¢åŒºæ€»é‡ï¼ˆ32GBï¼‰</span><br><span class="line">0k used â€” ä½¿ç”¨çš„äº¤æ¢åŒºæ€»é‡ï¼ˆ0Kï¼‰</span><br><span class="line">32764556k free â€” ç©ºé—²äº¤æ¢åŒºæ€»é‡ï¼ˆ32GBï¼‰</span><br><span class="line">3612636k cached â€” ç¼“å†²çš„äº¤æ¢åŒºæ€»é‡ï¼ˆ3.6GBï¼‰</span><br></pre></td></tr></table></figure>
<p><code>ç¬¬å…­è¡Œ</code>ï¼Œç©ºè¡Œã€‚</p>
<p><code>ç¬¬ä¸ƒè¡Œ</code>ä»¥ä¸‹ï¼šå„è¿›ç¨‹ï¼ˆä»»åŠ¡ï¼‰çš„çŠ¶æ€ç›‘æ§ï¼Œé¡¹ç›®åˆ—ä¿¡æ¯è¯´æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PID â€” è¿›ç¨‹id</span><br><span class="line">USER â€” è¿›ç¨‹æ‰€æœ‰è€…</span><br><span class="line">PR â€” è¿›ç¨‹ä¼˜å…ˆçº§</span><br><span class="line">NI â€” niceå€¼ã€‚è´Ÿå€¼è¡¨ç¤ºé«˜ä¼˜å…ˆçº§ï¼Œæ­£å€¼è¡¨ç¤ºä½ä¼˜å…ˆçº§</span><br><span class="line">VIRT â€” è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜æ€»é‡ï¼Œå•ä½kbã€‚VIRT&#x3D;SWAP+RES</span><br><span class="line">RES â€” è¿›ç¨‹ä½¿ç”¨çš„ã€æœªè¢«æ¢å‡ºçš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbã€‚RES&#x3D;CODE+DATA</span><br><span class="line">SHR â€” å…±äº«å†…å­˜å¤§å°ï¼Œå•ä½kb</span><br><span class="line">S â€” è¿›ç¨‹çŠ¶æ€ã€‚D&#x3D;ä¸å¯ä¸­æ–­çš„ç¡çœ çŠ¶æ€ R&#x3D;è¿è¡Œ S&#x3D;ç¡çœ  T&#x3D;è·Ÿè¸ª&#x2F;åœæ­¢ Z&#x3D;åƒµå°¸è¿›ç¨‹</span><br><span class="line">%CPU â€” ä¸Šæ¬¡æ›´æ–°åˆ°ç°åœ¨çš„CPUæ—¶é—´å ç”¨ç™¾åˆ†æ¯”</span><br><span class="line">%MEM â€” è¿›ç¨‹ä½¿ç”¨çš„ç‰©ç†å†…å­˜ç™¾åˆ†æ¯”</span><br><span class="line">TIME+ â€” è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´æ€»è®¡ï¼Œå•ä½1&#x2F;100ç§’</span><br><span class="line">COMMAND â€” è¿›ç¨‹åç§°ï¼ˆå‘½ä»¤å&#x2F;å‘½ä»¤è¡Œï¼‰</span><br></pre></td></tr></table></figure>
<h6 id="topäº¤äº’å‘½ä»¤"><a href="#topäº¤äº’å‘½ä»¤" class="headerlink" title="topäº¤äº’å‘½ä»¤"></a>topäº¤äº’å‘½ä»¤</h6><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">h æ˜¾ç¤ºtopäº¤äº’å‘½ä»¤å¸®åŠ©ä¿¡æ¯</span><br><span class="line">c åˆ‡æ¢æ˜¾ç¤ºå‘½ä»¤åç§°å’Œå®Œæ•´å‘½ä»¤è¡Œ</span><br><span class="line">m ä»¥å†…å­˜ä½¿ç”¨ç‡æ’åº</span><br><span class="line">P æ ¹æ®CPUä½¿ç”¨ç™¾åˆ†æ¯”å¤§å°è¿›è¡Œæ’åº</span><br><span class="line">T æ ¹æ®æ—¶é—´&#x2F;ç´¯è®¡æ—¶é—´è¿›è¡Œæ’åº</span><br><span class="line">W å°†å½“å‰è®¾ç½®å†™å…¥~&#x2F;.toprcæ–‡ä»¶ä¸­</span><br><span class="line">oæˆ–è€…O æ”¹å˜æ˜¾ç¤ºé¡¹ç›®çš„é¡ºåº</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 199. äºŒå‰æ ‘çš„å³è§†å›¾</title>
    <url>/2021/04/05/leetcode-199-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%8F%B3%E8%A7%86%E5%9B%BE/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/binary-tree-right-side-view" target="_blank" rel="noopener">äºŒå‰æ ‘çš„å³è§†å›¾</a></p>
<p>ç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œæƒ³è±¡è‡ªå·±ç«™åœ¨å®ƒçš„å³ä¾§ï¼ŒæŒ‰ç…§ä»é¡¶éƒ¨åˆ°åº•éƒ¨çš„é¡ºåºï¼Œè¿”å›ä»å³ä¾§æ‰€èƒ½çœ‹åˆ°çš„èŠ‚ç‚¹å€¼ã€‚</p>
<p>ç¤ºä¾‹</p>
<blockquote>
<p>è¾“å…¥: [1,2,3,null,5,null,4] <br/><br>è¾“å‡º: [1, 3, 4] <br/><br>è§£é‡Š:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">   1            &lt;---</span><br><span class="line"> &#x2F;   \</span><br><span class="line">2     3         &lt;---</span><br><span class="line"> \     \</span><br><span class="line">  5     4       &lt;---</span><br></pre></td></tr></table></figure>


<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val=<span class="number">0</span>, left=None, right=None)</span>:</span></span><br><span class="line">        self.val = val</span><br><span class="line">        self.left = left</span><br><span class="line">        self.right = right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€’å½’éå†</span></span><br><span class="line"><span class="comment"># class Solution:</span></span><br><span class="line"><span class="comment">#     def rightSideView(self, root: TreeNode) -&gt; list:</span></span><br><span class="line"><span class="comment">#         if not root:</span></span><br><span class="line"><span class="comment">#             return []</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#         rv = dict()</span></span><br><span class="line"><span class="comment">#         index = -1</span></span><br><span class="line"><span class="comment">#         self._traverse(root, rv, index)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#         keys = sorted(rv.keys())</span></span><br><span class="line"><span class="comment">#         result = [rv[k] for k in keys]</span></span><br><span class="line"><span class="comment">#         return result</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     def _traverse(self, node: TreeNode, rv: dict, index: int):</span></span><br><span class="line"><span class="comment">#         """</span></span><br><span class="line"><span class="comment">#         å‰åº, ä¸­åº, ååºéå†çš†å¯, ä¸å½±å“ç»“æœ</span></span><br><span class="line"><span class="comment">#         åªéœ€è¦ä¿è¯å³å­æ ‘æ¯”å·¦å­æ ‘åéå†å³å¯</span></span><br><span class="line"><span class="comment">#         """</span></span><br><span class="line"><span class="comment">#         index += 1</span></span><br><span class="line"><span class="comment">#         if node:</span></span><br><span class="line"><span class="comment">#             # æ¯ä¸€å±‚ä¿å­˜æ›´é å³çš„ç»“æœ</span></span><br><span class="line"><span class="comment">#             rv[index] = node.val</span></span><br><span class="line"><span class="comment">#             self._traverse(node.left, rv, index + 1)</span></span><br><span class="line"><span class="comment">#             self._traverse(node.right, rv, index + 1)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å±‚åºéå†</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rightSideView</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        rv = list()</span><br><span class="line">        queue = [root]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> queue:</span><br><span class="line">            tmp = queue[:]</span><br><span class="line">            queue.clear()</span><br><span class="line">            <span class="keyword">for</span> index, t <span class="keyword">in</span> enumerate(tmp):</span><br><span class="line">                <span class="keyword">if</span> t.left:</span><br><span class="line">                    queue.append(t.left)</span><br><span class="line">                <span class="keyword">if</span> t.right:</span><br><span class="line">                    queue.append(t.right)</span><br><span class="line">                <span class="comment"># ä¿å­˜æ¯ä¸€å±‚çš„æœ€åä¸€ä¸ªæ•°æ®</span></span><br><span class="line">                <span class="keyword">if</span> index == len(tmp) - <span class="number">1</span>:</span><br><span class="line">                    rv.append(t.val)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> rv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n1 = TreeNode(<span class="number">1</span>)</span><br><span class="line">n2 = TreeNode(<span class="number">2</span>)</span><br><span class="line">n3 = TreeNode(<span class="number">3</span>)</span><br><span class="line">n4 = TreeNode(<span class="number">4</span>)</span><br><span class="line">n5 = TreeNode(<span class="number">5</span>)</span><br><span class="line">n1.left = n2</span><br><span class="line">n1.right = n3</span><br><span class="line">n2.right = n5</span><br><span class="line"><span class="comment"># n3.right = n4</span></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">print(s.rightSideView(n1))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 94. äºŒå‰æ ‘çš„ä¸­åºéå†</title>
    <url>/2021/04/05/leetcode-94-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E4%B8%AD%E5%BA%8F%E9%81%8D%E5%8E%86/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="">äºŒå‰æ ‘çš„ä¸­åºéå†</a></p>
<p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œè¿”å›å®ƒçš„ ä¸­åº éå†ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210405222801.png" alt=""></p>
<blockquote>
<p>è¾“å…¥ï¼šroot = [1,null,2,3]<br/><br>è¾“å‡ºï¼š[1,3,2]</p>
</blockquote>
<h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Definition for a binary tree node.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val=<span class="number">0</span>, left=None, right=None)</span>:</span></span><br><span class="line">        self.val = val</span><br><span class="line">        self.left = left</span><br><span class="line">        self.right = right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€’å½’å†™æ³•</span></span><br><span class="line"><span class="comment"># class Solution:</span></span><br><span class="line"><span class="comment">#     def inorderTraversal(self, root: TreeNode) -&gt; list:</span></span><br><span class="line"><span class="comment">#         if not root:</span></span><br><span class="line"><span class="comment">#             return []</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#         rv = list()</span></span><br><span class="line"><span class="comment">#         self._inorder(root, rv)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#         return rv</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     def _inorder(self, node, rv):</span></span><br><span class="line"><span class="comment">#         if node:</span></span><br><span class="line"><span class="comment">#             self._inorder(node.left, rv)</span></span><br><span class="line"><span class="comment">#             rv.append(node.val)</span></span><br><span class="line"><span class="comment">#             self._inorder(node.right, rv)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éé€’å½’</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inorderTraversal</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        rv = list()</span><br><span class="line">        stack = list()</span><br><span class="line">        node = root</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> node <span class="keyword">or</span> stack:</span><br><span class="line">            <span class="comment"># å¦‚æœnodeå€¼å­˜åœ¨, åˆ™å…¥æ ˆ</span></span><br><span class="line">            <span class="keyword">if</span> node:</span><br><span class="line">                stack.append(node)</span><br><span class="line">                <span class="comment"># å·¦å­æ ‘éå†</span></span><br><span class="line">                node = node.left</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># ä¿å­˜æ ˆé¡¶çš„å€¼</span></span><br><span class="line">                node = stack.pop(<span class="number">-1</span>)</span><br><span class="line">                rv.append(node.val)</span><br><span class="line">                <span class="comment"># éå†å³å­æ ‘</span></span><br><span class="line">                node = node.right</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> rv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n1 = TreeNode(<span class="number">1</span>)</span><br><span class="line">n2 = TreeNode(<span class="number">2</span>)</span><br><span class="line">n3 = TreeNode(<span class="number">3</span>)</span><br><span class="line">n1.right = n2</span><br><span class="line">n2.left = n3</span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">print(s.inorderTraversal(n1))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 912. æ’åºæ•°ç»„</title>
    <url>/2021/03/27/leetcode-912-%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/sort-an-array/" target="_blank" rel="noopener">æ’åºæ•°ç»„</a></p>
<p>ç¤ºä¾‹</p>
<blockquote>
<p>è¾“å…¥ï¼šnums = [5,2,3,1] <br/><br>è¾“å‡ºï¼š[1,2,3,5]</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sortArray</span><span class="params">(self, nums: list)</span> -&gt; list:</span></span><br><span class="line">        ns = nums[:]</span><br><span class="line">        <span class="keyword">return</span> self._quick_sort(nums, <span class="number">0</span>, len(ns) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_quick_sort</span><span class="params">(self, nums, left, right)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> left &gt;= right:</span><br><span class="line">            <span class="keyword">return</span> nums</span><br><span class="line"></span><br><span class="line">        base_index = self._sort(left, right, nums)</span><br><span class="line">        self._quick_sort(nums, left, base_index - <span class="number">1</span>)</span><br><span class="line">        self._quick_sort(nums, base_index + <span class="number">1</span>, right)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_sort</span><span class="params">(self, left, right, nums)</span>:</span></span><br><span class="line"></span><br><span class="line">        temp = left</span><br><span class="line">        base = nums[left]</span><br><span class="line">        <span class="keyword">while</span> left != right:</span><br><span class="line">            <span class="keyword">while</span> left &lt; right <span class="keyword">and</span> nums[right] &gt;= base:</span><br><span class="line">                right -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> left &lt; right <span class="keyword">and</span> nums[left] &lt;= base:</span><br><span class="line">                left += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> left &lt; right:</span><br><span class="line">                nums[left], nums[right] = nums[right], nums[left]</span><br><span class="line"></span><br><span class="line">        nums[temp] = nums[left]</span><br><span class="line">        nums[left] = base</span><br><span class="line">        <span class="keyword">return</span> left</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">num = [<span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">s = Solution()</span><br><span class="line">print(s.sortArray(num))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 704. äºŒåˆ†æŸ¥æ‰¾</title>
    <url>/2021/03/27/leetcode-704-%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/binary-search" target="_blank" rel="noopener">äºŒåˆ†æŸ¥æ‰¾</a></p>
<p>ç»™å®šä¸€ä¸ª n ä¸ªå…ƒç´ æœ‰åºçš„ï¼ˆå‡åºï¼‰æ•´å‹æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ target  ï¼Œå†™ä¸€ä¸ªå‡½æ•°æœç´¢ nums ä¸­çš„ targetï¼Œå¦‚æœç›®æ ‡å€¼å­˜åœ¨è¿”å›ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å› -1ã€‚</p>
<p>ç¤ºä¾‹</p>
<blockquote>
<p>è¾“å…¥: nums = [-1,0,3,5,9,12], target = 9 <br/><br>è¾“å‡º: 4 <br/><br>è§£é‡Š: 9 å‡ºç°åœ¨ nums ä¸­å¹¶ä¸”ä¸‹æ ‡ä¸º 4 <br/></p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self, nums: list, target: int)</span> -&gt; int:</span></span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = len(nums) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> left &lt;= right:</span><br><span class="line">            mid = (left + right) // <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> nums[mid] == target:</span><br><span class="line">                <span class="keyword">return</span> mid</span><br><span class="line">            <span class="keyword">elif</span> nums[mid] &lt; target:</span><br><span class="line">                left = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right = mid - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">nums = [<span class="number">-1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">12</span>]</span><br><span class="line">target = <span class="number">2</span></span><br><span class="line">print(s.search(nums, target))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 415. å­—ç¬¦ä¸²ç›¸åŠ </title>
    <url>/2021/03/27/leetcode-415-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%8A%A0/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/add-strings/" target="_blank" rel="noopener">å­—ç¬¦ä¸²ç›¸åŠ </a></p>
<p>ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„éè´Ÿæ•´æ•° num1 å’Œnum2 ï¼Œè®¡ç®—å®ƒä»¬çš„å’Œã€‚</p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addStrings</span><span class="params">(self, num1: str, num2: str)</span> -&gt; str:</span></span><br><span class="line">        num1 = num1[::<span class="number">-1</span>]</span><br><span class="line">        num2 = num2[::<span class="number">-1</span>]</span><br><span class="line">        length = min(len(num1), len(num2))</span><br><span class="line">        result = <span class="string">""</span></span><br><span class="line">        tmp = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> range(length):</span><br><span class="line">            r = int(num1[index]) + int(num2[index]) + tmp</span><br><span class="line">            result += str(r % <span class="number">10</span>)</span><br><span class="line">            tmp = r // <span class="number">10</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> length == len(num1):</span><br><span class="line">            num = num2</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            num = num1</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> range(length, len(num)):</span><br><span class="line">            r = int(num[index]) + tmp</span><br><span class="line">            result += str(r % <span class="number">10</span>)</span><br><span class="line">            tmp = r // <span class="number">10</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> tmp != <span class="number">0</span>:</span><br><span class="line">            result += str(tmp)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result[::<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n1 = <span class="string">"123458888"</span></span><br><span class="line">n2 = <span class="string">"2232342358233289"</span></span><br><span class="line">s = Solution()</span><br><span class="line">print(s.addStrings(n1, n2))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 268. ä¸¢å¤±çš„æ•°å­—</title>
    <url>/2021/03/27/leetcode-268-%E4%B8%A2%E5%A4%B1%E7%9A%84%E6%95%B0%E5%AD%97/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/missing-number" target="_blank" rel="noopener">ä¸¢å¤±çš„æ•°å­—</a></p>
<p>ç»™å®šä¸€ä¸ªåŒ…å« [0, n] ä¸­ n ä¸ªæ•°çš„æ•°ç»„ nums ï¼Œæ‰¾å‡º [0, n] è¿™ä¸ªèŒƒå›´å†…æ²¡æœ‰å‡ºç°åœ¨æ•°ç»„ä¸­çš„é‚£ä¸ªæ•°ã€‚</p>
<p>ç¤ºä¾‹ </p>
<blockquote>
<p>è¾“å…¥ï¼šnums = [3,0,1] <br/><br>è¾“å‡ºï¼š2 <br/><br>è§£é‡Šï¼šn = 3ï¼Œå› ä¸ºæœ‰ 3 ä¸ªæ•°å­—ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ•°å­—éƒ½åœ¨èŒƒå›´ [0,3] å†…ã€‚2 æ˜¯ä¸¢å¤±çš„æ•°å­—ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‡ºç°åœ¨ nums ä¸­ã€‚<br/></p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">missingNumber</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type nums: List[int]</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        n = len(nums)</span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">            n = n + <span class="number">1</span></span><br><span class="line">        <span class="comment"># è®¡ç®—è¯¥æ•°å­—å¦‚æœå­˜åœ¨çš„æ€»å’Œ</span></span><br><span class="line">        total = (<span class="number">1</span> + n) * (n // <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> n != len(nums):</span><br><span class="line">            total -= n</span><br><span class="line">        <span class="comment"># å®Œæ•´æ•°ç»„çš„æ€»å’Œ - å½“å‰æ€»å’Œ</span></span><br><span class="line">        <span class="keyword">return</span> total - sum(nums)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">nums = [<span class="number">0</span>]</span><br><span class="line">print(s.missingNumber(nums))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</title>
    <url>/2021/03/27/leetcode-236-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree" target="_blank" rel="noopener">äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</a></p>
<p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p>
<p>ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªèŠ‚ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªèŠ‚ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€</p>
<p>ç¤ºä¾‹<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210327145858.png" alt=""></p>
<blockquote>
<p>è¾“å…¥ï¼šroot = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 1 <br/><br>è¾“å‡ºï¼š3 <br/><br>è§£é‡Šï¼šèŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 1 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 3 ã€‚<br/></p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Definition for a binary tree node.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.left = <span class="literal">None</span></span><br><span class="line">        self.right = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lowestCommonAncestor</span><span class="params">(self, root: TreeNode, p: TreeNode, q: TreeNode)</span> -&gt; TreeNode:</span></span><br><span class="line"></span><br><span class="line">        node_dict = self._traverse(root)</span><br><span class="line">        <span class="comment"># éœ€è¦åŠ å…¥è‡ªèº«èŠ‚ç‚¹</span></span><br><span class="line">        qSet = &#123;q&#125;</span><br><span class="line">        pSet = &#123;p&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment"># è‹¥æœ‰é‡åˆèŠ‚ç‚¹, åˆ™é‡åˆçš„èŠ‚ç‚¹å°±æ˜¯è¿”å›å€¼</span></span><br><span class="line">            result = qSet &amp; pSet</span><br><span class="line">            <span class="keyword">if</span> len(result) &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> result.pop()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># è·å–çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">            qParent = node_dict.get(q.val)</span><br><span class="line">            pParent = node_dict.get(p.val)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å°†çˆ¶èŠ‚ç‚¹åŠ å…¥åˆ°æœç´¢è·¯å¾„ä¸­</span></span><br><span class="line">            <span class="keyword">if</span> qParent:</span><br><span class="line">                qSet.add(qParent)</span><br><span class="line">                q = qParent</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> pParent:</span><br><span class="line">                pSet.add(pParent)</span><br><span class="line">                p = pParent</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_traverse</span><span class="params">(self, root: TreeNode)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ„å»ºå­—å…¸, &#123;å­èŠ‚ç‚¹val: çˆ¶èŠ‚ç‚¹&#125;çš„å½¢å¼, å› ä¸ºé¢˜ç›®ä¸­æåˆ°valä¸ä¼šé‡å¤</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        q: list = [root]</span><br><span class="line">        node_dict = &#123;&#125;</span><br><span class="line">        <span class="keyword">while</span> q:</span><br><span class="line">            node = q.pop(<span class="number">0</span>)</span><br><span class="line">            left = node.left</span><br><span class="line">            right = node.right</span><br><span class="line">            <span class="keyword">if</span> left:</span><br><span class="line">                q.append(left)</span><br><span class="line">                node_dict[left.val] = node</span><br><span class="line">            <span class="keyword">if</span> right:</span><br><span class="line">                q.append(right)</span><br><span class="line">                node_dict[right.val] = node</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> node_dict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n3 = TreeNode(<span class="number">3</span>)</span><br><span class="line">n5 = TreeNode(<span class="number">5</span>)</span><br><span class="line">n1 = TreeNode(<span class="number">1</span>)</span><br><span class="line">n6 = TreeNode(<span class="number">6</span>)</span><br><span class="line">n0 = TreeNode(<span class="number">0</span>)</span><br><span class="line">n7 = TreeNode(<span class="number">7</span>)</span><br><span class="line">n2 = TreeNode(<span class="number">2</span>)</span><br><span class="line">n8 = TreeNode(<span class="number">8</span>)</span><br><span class="line">n4 = TreeNode(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">n3.left = n5</span><br><span class="line">n3.right = n1</span><br><span class="line">n5.left = n6</span><br><span class="line">n5.right = n2</span><br><span class="line">n1.left = n0</span><br><span class="line">n1.right = n8</span><br><span class="line">n2.left = n7</span><br><span class="line">n2.right = n4</span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">node = s.lowestCommonAncestor(n3, n5, n4)</span><br><span class="line">print(node.val)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 232. ç”¨æ ˆå®ç°é˜Ÿåˆ—</title>
    <url>/2021/03/27/leetcode-232-%E7%94%A8%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/implement-queue-using-stacks" target="_blank" rel="noopener">ç”¨æ ˆå®ç°é˜Ÿåˆ—</a></p>
<p>è¯·ä½ ä»…ä½¿ç”¨ä¸¤ä¸ªæ ˆå®ç°å…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—ã€‚é˜Ÿåˆ—åº”å½“æ”¯æŒä¸€èˆ¬é˜Ÿåˆ—æ”¯æŒçš„æ‰€æœ‰æ“ä½œï¼ˆpushã€popã€peekã€emptyï¼‰ï¼š</p>
<p>å®ç° MyQueue ç±»ï¼š</p>
<ul>
<li>void push(int x) å°†å…ƒç´  x æ¨åˆ°é˜Ÿåˆ—çš„æœ«å°¾</li>
<li>int pop() ä»é˜Ÿåˆ—çš„å¼€å¤´ç§»é™¤å¹¶è¿”å›å…ƒç´ </li>
<li>int peek() è¿”å›é˜Ÿåˆ—å¼€å¤´çš„å…ƒç´ </li>
<li>boolean empty() å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false</li>
</ul>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyQueue</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Initialize your data structure here.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self._in = list()</span><br><span class="line">        self._out = list()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, x: int)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Push element x to the back of queue.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        self._in.append(x)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_transfer</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> self._in:</span><br><span class="line">            x = self._in.pop()</span><br><span class="line">            self._out.append(x)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Removes the element from in front of queue and returns that element.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._out:</span><br><span class="line">            self._transfer()</span><br><span class="line">        <span class="keyword">return</span> self._out.pop()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">peek</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Get the front element.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._out:</span><br><span class="line">            self._transfer()</span><br><span class="line">        <span class="keyword">return</span> self._out[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">empty</span><span class="params">(self)</span> -&gt; bool:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Returns whether the queue is empty.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> len(self._in) == <span class="number">0</span> <span class="keyword">and</span> len(self._out) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Your MyQueue object will be instantiated and called as such:</span></span><br><span class="line">obj = MyQueue()</span><br><span class="line">print(obj.empty())</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 206. åè½¬é“¾è¡¨</title>
    <url>/2021/03/27/leetcode-206-%E5%8F%8D%E8%BD%AC%E9%93%BE%E8%A1%A8/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/reverse-linked-list/" target="_blank" rel="noopener">åè½¬é“¾è¡¨</a></p>
<p>åè½¬ä¸€ä¸ªå•é“¾è¡¨ã€‚</p>
<p>ç¤ºä¾‹:</p>
<blockquote>
<p>è¾“å…¥: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL <br/><br>è¾“å‡º: 5-&gt;4-&gt;3-&gt;2-&gt;1-&gt;NULL</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Definition for singly-linked list.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val=<span class="number">0</span>, next=None)</span>:</span></span><br><span class="line">        self.val = val</span><br><span class="line">        self.next = next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverseList</span><span class="params">(self, head: ListNode)</span> -&gt; ListNode:</span></span><br><span class="line">        cur = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> head:</span><br><span class="line">            cur = ListNode(head.val, cur)</span><br><span class="line">            head = head.next</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cur</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">traverse</span><span class="params">(head)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> head:</span><br><span class="line">        print(head.val)</span><br><span class="line">        head = head.next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n1 = ListNode(<span class="number">1</span>)</span><br><span class="line">n2 = ListNode(<span class="number">2</span>)</span><br><span class="line">n3 = ListNode(<span class="number">3</span>)</span><br><span class="line">n4 = ListNode(<span class="number">4</span>)</span><br><span class="line">n5 = ListNode(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">n1.next = n2</span><br><span class="line">n2.next = n3</span><br><span class="line">n3.next = n4</span><br><span class="line">n4.next = n5</span><br><span class="line">traverse(n1)</span><br><span class="line">print(<span class="string">'-'</span> * <span class="number">80</span>)</span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">n = s.reverseList(n1)</span><br><span class="line">traverse(n)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 169. å¤šæ•°å…ƒç´ </title>
    <url>/2021/03/27/leetcode-169-%E5%A4%9A%E6%95%B0%E5%85%83%E7%B4%A0/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/majority-element" target="_blank" rel="noopener">å¤šæ•°å…ƒç´ </a></p>
<p>ç»™å®šä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ï¼Œæ‰¾åˆ°å…¶ä¸­çš„å¤šæ•°å…ƒç´ ã€‚å¤šæ•°å…ƒç´ æ˜¯æŒ‡åœ¨æ•°ç»„ä¸­å‡ºç°æ¬¡æ•° å¤§äº âŒŠ n/2 âŒ‹ çš„å…ƒç´ ã€‚</p>
<p>ä½ å¯ä»¥å‡è®¾æ•°ç»„æ˜¯éç©ºçš„ï¼Œå¹¶ä¸”ç»™å®šçš„æ•°ç»„æ€»æ˜¯å­˜åœ¨å¤šæ•°å…ƒç´ ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼š[3,2,3]<br>è¾“å‡ºï¼š3</p>
</blockquote>
<p>ç¤ºä¾‹ 2ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼š[2,2,1,1,1,2,2]<br>è¾“å‡ºï¼š2</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">majorityElement</span><span class="params">(self, nums: list)</span> -&gt; int:</span></span><br><span class="line">        nDict = dict()</span><br><span class="line">        half = len(nums) / <span class="number">2</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> nums:</span><br><span class="line">            d = nDict.get(n, <span class="number">0</span>)</span><br><span class="line">            d += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> d &gt;= half:</span><br><span class="line">                <span class="keyword">return</span> n</span><br><span class="line">            nDict[n] = d</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nums = [<span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">s = Solution()</span><br><span class="line">print(s.majorityElement(nums))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 160. ç›¸äº¤é“¾è¡¨</title>
    <url>/2021/03/27/leetcode-160-%E7%9B%B8%E4%BA%A4%E9%93%BE%E8%A1%A8/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/intersection-of-two-linked-lists" target="_blank" rel="noopener">ç›¸äº¤é“¾è¡¨</a></p>
<p>ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œæ‰¾åˆ°ä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ã€‚</p>
<p>å¦‚ä¸‹é¢çš„ä¸¤ä¸ªé“¾è¡¨ï¼š<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210327144950.png" alt=""><br>åœ¨èŠ‚ç‚¹ c1 å¼€å§‹ç›¸äº¤ã€‚</p>
<p>ç¤ºä¾‹<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210327145018.png" alt=""></p>
<blockquote>
<p>è¾“å…¥ï¼šintersectVal = 8, listA = [4,1,8,4,5], listB = [5,0,1,8,4,5], skipA = 2, skipB = 3 <br/><br>è¾“å‡ºï¼šReference of the node with value = 8 <br/><br>è¾“å…¥è§£é‡Šï¼šç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 8 ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªé“¾è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º 0ï¼‰ã€‚ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [4,1,8,4,5]ï¼Œé“¾è¡¨ B ä¸º [5,0,1,8,4,5]ã€‚åœ¨ A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3 ä¸ªèŠ‚ç‚¹ã€‚<br/></p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Definition for singly-linked list.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getIntersectionNode</span><span class="params">(self, headA: ListNode, headB: ListNode)</span> -&gt; ListNode:</span></span><br><span class="line">        la = <span class="number">0</span></span><br><span class="line">        na = headA</span><br><span class="line">        <span class="keyword">while</span> na:</span><br><span class="line">            la += <span class="number">1</span></span><br><span class="line">            na = na.next</span><br><span class="line"></span><br><span class="line">        lb = <span class="number">0</span></span><br><span class="line">        nb = headB</span><br><span class="line">        <span class="keyword">while</span> nb:</span><br><span class="line">            lb += <span class="number">1</span></span><br><span class="line">            nb = nb.next</span><br><span class="line"></span><br><span class="line">        length = abs(la - lb)</span><br><span class="line">        <span class="keyword">if</span> la &gt; lb:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">                headA = headA.next</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">                headB = headB.next</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> headB <span class="keyword">and</span> headA:</span><br><span class="line">            <span class="keyword">if</span> headB == headA:</span><br><span class="line">                <span class="keyword">return</span> headA</span><br><span class="line">            headA = headA.next</span><br><span class="line">            headB = headB.next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">listA = [<span class="number">4</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">listB = [<span class="number">5</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">tailA = <span class="literal">None</span></span><br><span class="line">headA = <span class="literal">None</span></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> listA[::<span class="number">-1</span>]:</span><br><span class="line">    n = ListNode(a)</span><br><span class="line">    n.next = tailA</span><br><span class="line">    tailA = n</span><br><span class="line">    headA = n</span><br><span class="line"></span><br><span class="line">tailB = <span class="literal">None</span></span><br><span class="line">headB = <span class="literal">None</span></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> listB[::<span class="number">-1</span>]:</span><br><span class="line">    n = ListNode(a)</span><br><span class="line">    n.next = tailB</span><br><span class="line">    tailB = n</span><br><span class="line">    headB = n</span><br><span class="line"></span><br><span class="line"><span class="comment"># while headA:</span></span><br><span class="line"><span class="comment">#     print(headA.val)</span></span><br><span class="line"><span class="comment">#     headA = headA.next</span></span><br><span class="line"><span class="comment"># print('-' * 80)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># while headB:</span></span><br><span class="line"><span class="comment">#     print(headB.val)</span></span><br><span class="line"><span class="comment">#     headB = headB.next</span></span><br><span class="line"><span class="comment"># print('=' * 80)</span></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">node = s.getIntersectionNode(headA, headB)</span><br><span class="line">print(node.val)</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 146. LRU ç¼“å­˜æœºåˆ¶</title>
    <url>/2021/03/27/leetcode-146-LRU-%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/lru-cache" target="_blank" rel="noopener">LRU ç¼“å­˜æœºåˆ¶</a></p>
<p>è¿ç”¨ä½ æ‰€æŒæ¡çš„æ•°æ®ç»“æ„ï¼Œè®¾è®¡å’Œå®ç°ä¸€ä¸ª  LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜æœºåˆ¶ ã€‚<br>å®ç° LRUCache ç±»ï¼š</p>
<p>LRUCache(int capacity) ä»¥æ­£æ•´æ•°ä½œä¸ºå®¹é‡ capacity åˆå§‹åŒ– LRU ç¼“å­˜<br>int get(int key) å¦‚æœå…³é”®å­— key å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å› -1 ã€‚<br>void put(int key, int value) å¦‚æœå…³é”®å­—å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼ï¼›å¦‚æœå…³é”®å­—ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥è¯¥ç»„ã€Œå…³é”®å­—-å€¼ã€ã€‚å½“ç¼“å­˜å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå®ƒåº”è¯¥åœ¨å†™å…¥æ–°æ•°æ®ä¹‹å‰åˆ é™¤æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®å€¼ï¼Œä»è€Œä¸ºæ–°çš„æ•°æ®å€¼ç•™å‡ºç©ºé—´ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<blockquote>
<p>è¾“å…¥<br>[â€œLRUCacheâ€, â€œputâ€, â€œputâ€, â€œgetâ€, â€œputâ€, â€œgetâ€, â€œputâ€, â€œgetâ€, â€œgetâ€, â€œgetâ€] <br/><br>[[2], [1, 1], [2, 2], [1], [3, 3], [2], [4, 4], [1], [3], [4]] <br/><br>è¾“å‡º <br/><br>[null, null, null, 1, null, -1, null, -1, 3, 4] <br/><br>è§£é‡Š <br/><br>LRUCache lRUCache = new LRUCache(2);<br/><br>lRUCache.put(1, 1); // ç¼“å­˜æ˜¯ {1=1}<br/><br>lRUCache.put(2, 2); // ç¼“å­˜æ˜¯ {1=1, 2=2}<br/><br>lRUCache.get(1);    // è¿”å› 1<br/><br>lRUCache.put(3, 3); // è¯¥æ“ä½œä¼šä½¿å¾—å…³é”®å­— 2 ä½œåºŸï¼Œç¼“å­˜æ˜¯ {1=1, 3=3}<br/><br>lRUCache.get(2);    // è¿”å› -1 (æœªæ‰¾åˆ°)<br/><br>lRUCache.put(4, 4); // è¯¥æ“ä½œä¼šä½¿å¾—å…³é”®å­— 1 ä½œåºŸï¼Œç¼“å­˜æ˜¯ {4=4, 3=3}<br/><br>lRUCache.get(1);    // è¿”å› -1 (æœªæ‰¾åˆ°)<br/><br>lRUCache.get(3);    // è¿”å› 3<br/><br>lRUCache.get(4);    // è¿”å› 4<br/></p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, capacity: int)</span>:</span></span><br><span class="line">        self._order = OrderedDict()</span><br><span class="line">        self._capacity = capacity</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> self._order.keys():</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">        v = self._order.pop(key)</span><br><span class="line">        self._order[key] = v</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, key: int, value: int)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> self._order.keys() <span class="keyword">and</span> len(self._order.keys()) &gt;= self._capacity:</span><br><span class="line">            self._order.popitem(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self._order.keys():</span><br><span class="line">            self._order.pop(key)</span><br><span class="line">        self._order[key] = value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = LRUCache(<span class="number">2</span>)</span><br><span class="line">s.put(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">s.put(<span class="number">2</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 141. ç¯å½¢é“¾è¡¨</title>
    <url>/2021/03/27/leetcode-141-%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/linked-list-cycle" target="_blank" rel="noopener">ç¯å½¢é“¾è¡¨</a></p>
<p>ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚</p>
<p>å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª next æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœ pos æ˜¯ -1ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚æ³¨æ„ï¼špos ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚</p>
<p>å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯ï¼Œåˆ™è¿”å› true ã€‚ å¦åˆ™ï¼Œè¿”å› false ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210327144340.png" alt=""></p>
<blockquote>
<p>è¾“å…¥ï¼šhead = [3,2,0,-4], pos = 1 <br/><br>è¾“å‡ºï¼štrue <br/><br>è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚ <br/></p>
</blockquote>
<p>ç¤ºä¾‹ 2ï¼š<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210327144416.png" alt=""></p>
<blockquote>
<p>è¾“å…¥ï¼šhead = [1,2], pos = 0 <br/><br>è¾“å‡ºï¼štrue <br/><br>è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚<br/></p>
</blockquote>
<p>ç¤ºä¾‹ 3ï¼š<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210327144447.png" alt=""></p>
<blockquote>
<p>è¾“å…¥ï¼šhead = [1], pos = -1 <br/><br>è¾“å‡ºï¼šfalse <br/><br>è§£é‡Šï¼šé“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚ <br/></p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Definition for singly-linked list.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hasCycle</span><span class="params">(self, head: ListNode)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> head:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> head.next <span class="keyword">or</span> <span class="keyword">not</span> head.next.next:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        p = head</span><br><span class="line">        q = head.next.next</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> p == q:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">            p = p.next</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> q.next <span class="keyword">or</span> <span class="keyword">not</span> q.next.next:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            q = q.next.next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n3 = ListNode(<span class="number">3</span>)</span><br><span class="line">n2 = ListNode(<span class="number">2</span>)</span><br><span class="line">n0 = ListNode(<span class="number">0</span>)</span><br><span class="line">n4 = ListNode(<span class="number">4</span>)</span><br><span class="line">n3.next = n2</span><br><span class="line">n2.next = n0</span><br><span class="line">n0.next = n4</span><br><span class="line">n4.next = n2</span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">print(s.hasCycle(n3))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 136. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—</title>
    <url>/2021/03/27/leetcode-136-%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%95%B0%E5%AD%97/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/single-number" target="_blank" rel="noopener">åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—</a></p>
<p>ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚</p>
<p>è¯´æ˜ï¼š</p>
<p>ä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´æ¥å®ç°å—ï¼Ÿ</p>
<p>ç¤ºä¾‹ 1:</p>
<blockquote>
<p>è¾“å…¥: [2,2,1] <br/><br>è¾“å‡º: 1</p>
</blockquote>
<p>ç¤ºä¾‹ 2:</p>
<blockquote>
<p>è¾“å…¥: [4,1,2,1,2] <br/><br>è¾“å‡º: 4</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">singleNumber</span><span class="params">(self, nums: list)</span> -&gt; int:</span></span><br><span class="line">        t = nums[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> nums[<span class="number">1</span>:]:</span><br><span class="line">            t ^= n</span><br><span class="line">        <span class="keyword">return</span> t</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">ns = [<span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">print(s.singleNumber(ns))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</title>
    <url>/2021/03/27/leetcode-121-%E4%B9%B0%E5%8D%96%E8%82%A1%E7%A5%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E6%97%B6%E6%9C%BA/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock" target="_blank" rel="noopener">ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</a></p>
<p>ç»™å®šä¸€ä¸ªæ•°ç»„ prices ï¼Œå®ƒçš„ç¬¬ i ä¸ªå…ƒç´  prices[i] è¡¨ç¤ºä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚</p>
<p>ä½ åªèƒ½é€‰æ‹© æŸä¸€å¤© ä¹°å…¥è¿™åªè‚¡ç¥¨ï¼Œå¹¶é€‰æ‹©åœ¨ æœªæ¥çš„æŸä¸€ä¸ªä¸åŒçš„æ—¥å­ å–å‡ºè¯¥è‚¡ç¥¨ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚</p>
<p>è¿”å›ä½ å¯ä»¥ä»è¿™ç¬”äº¤æ˜“ä¸­è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚å¦‚æœä½ ä¸èƒ½è·å–ä»»ä½•åˆ©æ¶¦ï¼Œè¿”å› 0 ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼š[7,1,5,3,6,4] <br/><br>è¾“å‡ºï¼š5 <br/><br>è§£é‡Šï¼šåœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡ºï¼Œæœ€å¤§åˆ©æ¶¦ = 6-1 = 5 ã€‚æ³¨æ„åˆ©æ¶¦ä¸èƒ½æ˜¯ 7-1 = 6, å› ä¸ºå–å‡ºä»·æ ¼éœ€è¦å¤§äºä¹°å…¥ä»·æ ¼ï¼›åŒæ—¶ï¼Œä½ ä¸èƒ½åœ¨ä¹°å…¥å‰å–å‡ºè‚¡ç¥¨ã€‚<br/></p>
</blockquote>
<p>ç¤ºä¾‹ 2ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šprices = [7,6,4,3,1] <br/><br>è¾“å‡ºï¼š0 <br/><br>è§£é‡Šï¼šåœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0ã€‚<br/></p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span><span class="params">(self, prices)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> prices:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        minNum = prices[<span class="number">0</span>]</span><br><span class="line">        value = <span class="number">0</span></span><br><span class="line">        <span class="comment"># éå†åˆ—è¡¨, ä¿å­˜æœ€å°å€¼åˆ°minNumä¸­</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> prices[<span class="number">1</span>:]:</span><br><span class="line">            tmp = n - minNum</span><br><span class="line">            <span class="comment"># åˆ¤æ–­å½“å‰å€¼ä¸æœ€å°å€¼çš„å·®å€¼</span></span><br><span class="line">            <span class="keyword">if</span> tmp &gt; value:</span><br><span class="line">                value = tmp</span><br><span class="line">            <span class="keyword">if</span> n &lt; minNum:</span><br><span class="line">                minNum = n</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nums = [<span class="number">7</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">4</span>]</span><br><span class="line">s = Solution()</span><br><span class="line">print(s.maxProfit(nums))</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 103. äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚åºéå†</title>
    <url>/2021/03/27/leetcode-103-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%94%AF%E9%BD%BF%E5%BD%A2%E5%B1%82%E5%BA%8F%E9%81%8D%E5%8E%86/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/binary-tree-zigzag-level-order-traversal" target="_blank" rel="noopener">äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚åºéå†</a></p>
<p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„é”¯é½¿å½¢å±‚åºéå†ã€‚ï¼ˆå³å…ˆä»å·¦å¾€å³ï¼Œå†ä»å³å¾€å·¦è¿›è¡Œä¸‹ä¸€å±‚éå†ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå±‚ä¸å±‚ä¹‹é—´äº¤æ›¿è¿›è¡Œï¼‰ã€‚</p>
<p>ä¾‹å¦‚ï¼š<br>ç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7],</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  3</span><br><span class="line"> &#x2F; \</span><br><span class="line">9  20</span><br><span class="line">  &#x2F;  \</span><br><span class="line"> 15   7</span><br></pre></td></tr></table></figure>
<p>è¿”å›é”¯é½¿å½¢å±‚åºéå†å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  [3],</span><br><span class="line">  [20,9],</span><br><span class="line">  [15,7]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Definition for a binary tree node.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val=<span class="number">0</span>, left=None, right=None)</span>:</span></span><br><span class="line">        self.val = val</span><br><span class="line">        self.left = left</span><br><span class="line">        self.right = right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">zigzagLevelOrder</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆ¤æ–­å±‚åºæ˜¯å¦å®Œæˆ</span></span><br><span class="line">        queue = [[root]]</span><br><span class="line">        <span class="comment"># è¿”å›ç»“æœ</span></span><br><span class="line">        result = list()</span><br><span class="line">        <span class="comment"># ç”¨æ¥åˆ¤æ–­å¥‡å¶æ€§</span></span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> queue:</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">            <span class="comment"># ä¸´æ—¶å­˜å‚¨æ¯ä¸€å±‚çš„èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">            tmp_val = list()</span><br><span class="line">            <span class="comment"># ä¸´æ—¶å­˜å‚¨æ¯ä¸€å±‚èŠ‚ç‚¹, ä»å·¦å¾€å³</span></span><br><span class="line">            tmp_node = list()</span><br><span class="line">            nodes = queue.pop(<span class="number">0</span>)</span><br><span class="line">            <span class="comment"># ä»å·¦å¾€å³éå†æ¯ä¸€ä¸ªèŠ‚ç‚¹, ä¿å­˜èŠ‚ç‚¹ä»¥åŠèŠ‚ç‚¹æ•°æ®</span></span><br><span class="line">            <span class="keyword">for</span> node <span class="keyword">in</span> nodes:</span><br><span class="line">                tmp_val.append(node.val)</span><br><span class="line">                <span class="keyword">if</span> node.left:</span><br><span class="line">                    tmp_node.append(node.left)</span><br><span class="line">                <span class="keyword">if</span> node.right:</span><br><span class="line">                    tmp_node.append(node.right)</span><br><span class="line">            <span class="comment"># å¦‚æœæ˜¯å¶æ•°å±‚, é‚£ä¹ˆé€†åºè¾“å‡º</span></span><br><span class="line">            <span class="keyword">if</span> index % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">                tmp_val = tmp_val[::<span class="number">-1</span>]</span><br><span class="line">            <span class="comment"># ä¸èƒ½å­˜å‚¨ç©ºåˆ—è¡¨, è¿™ä¸ªæ˜¯å¾ªç¯é€€å‡ºæ¡ä»¶</span></span><br><span class="line">            <span class="keyword">if</span> tmp_node:</span><br><span class="line">                queue.append(tmp_node)</span><br><span class="line">            result.append(tmp_val)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n3 = TreeNode(<span class="number">3</span>)</span><br><span class="line">n9 = TreeNode(<span class="number">9</span>)</span><br><span class="line">n20 = TreeNode(<span class="number">20</span>)</span><br><span class="line">n15 = TreeNode(<span class="number">15</span>)</span><br><span class="line">n7 = TreeNode(<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">n3.left = n9</span><br><span class="line">n3.right = n20</span><br><span class="line">n20.left = n15</span><br><span class="line">n20.right = n7</span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">print(s.zigzagLevelOrder(n3))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 102. äºŒå‰æ ‘çš„å±‚åºéå†</title>
    <url>/2021/03/27/leetcode-102-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%B1%82%E5%BA%8F%E9%81%8D%E5%8E%86/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/binary-tree-level-order-traversal" target="_blank" rel="noopener">äºŒå‰æ ‘çš„å±‚åºéå†</a></p>
<p>ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘ï¼Œè¯·ä½ è¿”å›å…¶æŒ‰ å±‚åºéå† å¾—åˆ°çš„èŠ‚ç‚¹å€¼ã€‚ ï¼ˆå³é€å±‚åœ°ï¼Œä»å·¦åˆ°å³è®¿é—®æ‰€æœ‰èŠ‚ç‚¹ï¼‰ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<blockquote>
<p>äºŒå‰æ ‘ï¼š[3,9,20,null,null,15,7],</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">3</span><br><span class="line">  &#x2F; \</span><br><span class="line"> 9  20</span><br><span class="line">   &#x2F;  \</span><br><span class="line">  15   7</span><br></pre></td></tr></table></figure>
<p>è¿”å›å…¶å±‚åºéå†ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  [3],</span><br><span class="line">  [9,20],</span><br><span class="line">  [15,7]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>


<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val=<span class="number">0</span>, left=None, right=None)</span>:</span></span><br><span class="line">        self.val = val</span><br><span class="line">        self.left = left</span><br><span class="line">        self.right = right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">levelOrder</span><span class="params">(self, root: TreeNode)</span> -&gt; list:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆ¤æ–­å±‚åºæ˜¯å¦å®Œæˆ</span></span><br><span class="line">        queue = [[root]]</span><br><span class="line">        <span class="comment"># è¿”å›ç»“æœ</span></span><br><span class="line">        result = list()</span><br><span class="line">        <span class="keyword">while</span> queue:</span><br><span class="line">            <span class="comment"># ä¸´æ—¶å­˜å‚¨æ¯ä¸€å±‚çš„èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">            tmp_val = list()</span><br><span class="line">            <span class="comment"># ä¸´æ—¶å­˜å‚¨æ¯ä¸€å±‚èŠ‚ç‚¹, ä»å·¦å¾€å³</span></span><br><span class="line">            tmp_node = list()</span><br><span class="line">            nodes = queue.pop(<span class="number">0</span>)</span><br><span class="line">            <span class="comment"># ä»å·¦å¾€å³éå†æ¯ä¸€ä¸ªèŠ‚ç‚¹, ä¿å­˜èŠ‚ç‚¹ä»¥åŠèŠ‚ç‚¹æ•°æ®</span></span><br><span class="line">            <span class="keyword">for</span> node <span class="keyword">in</span> nodes:</span><br><span class="line">                tmp_val.append(node.val)</span><br><span class="line">                <span class="keyword">if</span> node.left:</span><br><span class="line">                    tmp_node.append(node.left)</span><br><span class="line">                <span class="keyword">if</span> node.right:</span><br><span class="line">                    tmp_node.append(node.right)</span><br><span class="line">            <span class="comment"># ä¸èƒ½å­˜å‚¨ç©ºåˆ—è¡¨, è¿™ä¸ªæ˜¯å¾ªç¯é€€å‡ºæ¡ä»¶</span></span><br><span class="line">            <span class="keyword">if</span> tmp_node:</span><br><span class="line">                queue.append(tmp_node)</span><br><span class="line">            result.append(tmp_val)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n3 = TreeNode(<span class="number">3</span>)</span><br><span class="line">n9 = TreeNode(<span class="number">9</span>)</span><br><span class="line">n20 = TreeNode(<span class="number">20</span>)</span><br><span class="line">n15 = TreeNode(<span class="number">15</span>)</span><br><span class="line">n7 = TreeNode(<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">n3.left = n9</span><br><span class="line">n3.right = n20</span><br><span class="line">n20.left = n15</span><br><span class="line">n20.right = n7</span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">print(s.levelOrder(n3))</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</title>
    <url>/2021/03/27/leetcode-88-%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/merge-sorted-array" target="_blank" rel="noopener">åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</a></p>
<p>ç»™ä½ ä¸¤ä¸ªæœ‰åºæ•´æ•°æ•°ç»„ nums1 å’Œ nums2ï¼Œè¯·ä½ å°† nums2 åˆå¹¶åˆ° nums1 ä¸­ï¼Œä½¿ nums1 æˆä¸ºä¸€ä¸ªæœ‰åºæ•°ç»„ã€‚</p>
<p>åˆå§‹åŒ– nums1 å’Œ nums2 çš„å…ƒç´ æ•°é‡åˆ†åˆ«ä¸º m å’Œ n ã€‚ä½ å¯ä»¥å‡è®¾ nums1 çš„ç©ºé—´å¤§å°ç­‰äº m + nï¼Œè¿™æ ·å®ƒå°±æœ‰è¶³å¤Ÿçš„ç©ºé—´ä¿å­˜æ¥è‡ª nums2 çš„å…ƒç´ ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š<br>è¾“å…¥ï¼šnums1 = [1,2,3,0,0,0], m = 3, nums2 = [2,5,6], n = 3 <br/><br>è¾“å‡ºï¼š[1,2,2,3,5,6]</p>
<p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šnums1 = [1], m = 1, nums2 = [], n = 0 <br/><br>è¾“å‡ºï¼š[1]</p>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(self, nums1: list, m: int, nums2: list, n: int)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Do not return anything, modify nums1 in-place instead.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        tmp = nums1[:m]</span><br><span class="line">        nums1.clear()</span><br><span class="line">        nums1.extend(tmp)</span><br><span class="line">        nums2 = nums2[:n]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> nums1:</span><br><span class="line">            nums1.extend(nums2)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> nums2:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> n2 <span class="keyword">in</span> nums2:</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                <span class="keyword">if</span> n2 &lt;= nums1[index]:</span><br><span class="line">                    nums1.insert(index, n2)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">elif</span> n2 &gt; nums1[index] <span class="keyword">and</span> (index == len(nums1) - <span class="number">1</span> <span class="keyword">or</span> n2 &lt; nums1[index + <span class="number">1</span>]):</span><br><span class="line">                    nums1.insert(index + <span class="number">1</span>, n2)</span><br><span class="line">                    index += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> index == len(nums1):</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nums1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">m = <span class="number">3</span></span><br><span class="line">nums2 = [<span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">n = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">s.merge(nums1, m, nums2, n)</span><br><span class="line">print(nums1)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 77. ç»„åˆ</title>
    <url>/2021/03/27/leetcode-77-%E7%BB%84%E5%90%88/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/combinations" target="_blank" rel="noopener">ç»„åˆ</a></p>
<p>ç»™å®šä¸¤ä¸ªæ•´æ•° n å’Œ kï¼Œè¿”å› 1 â€¦ n ä¸­æ‰€æœ‰å¯èƒ½çš„ k ä¸ªæ•°çš„ç»„åˆã€‚</p>
<p>ç¤ºä¾‹:</p>
<blockquote>
<p>è¾“å…¥: n = 4, k = 2<br>è¾“å‡º:<br>[<br>  [2,4],<br>  [3,4],<br>  [2,3],<br>  [1,2],<br>  [1,3],<br>  [1,4],<br>]</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">combine</span><span class="params">(self, n: int, k: int)</span>:</span></span><br><span class="line">        <span class="keyword">import</span> itertools</span><br><span class="line">        nums = range(<span class="number">1</span>, n + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> list(itertools.combinations(nums, k))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">print(s.combine(<span class="number">4</span>, <span class="number">2</span>))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 71. ç®€åŒ–è·¯å¾„</title>
    <url>/2021/03/27/leetcode-71-%E7%AE%80%E5%8C%96%E8%B7%AF%E5%BE%84/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/simplify-path" target="_blank" rel="noopener">ç®€åŒ–è·¯å¾„</a></p>
<p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² path ï¼Œè¡¨ç¤ºæŒ‡å‘æŸä¸€æ–‡ä»¶æˆ–ç›®å½•çš„ Unix é£æ ¼ ç»å¯¹è·¯å¾„ ï¼ˆä»¥ â€˜/â€˜ å¼€å¤´ï¼‰ï¼Œè¯·ä½ å°†å…¶è½¬åŒ–ä¸ºæ›´åŠ ç®€æ´çš„è§„èŒƒè·¯å¾„ã€‚</p>
<p>åœ¨ Unix é£æ ¼çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªç‚¹ï¼ˆ.ï¼‰è¡¨ç¤ºå½“å‰ç›®å½•æœ¬èº«ï¼›æ­¤å¤–ï¼Œä¸¤ä¸ªç‚¹ ï¼ˆ..ï¼‰ è¡¨ç¤ºå°†ç›®å½•åˆ‡æ¢åˆ°ä¸Šä¸€çº§ï¼ˆæŒ‡å‘çˆ¶ç›®å½•ï¼‰ï¼›ä¸¤è€…éƒ½å¯ä»¥æ˜¯å¤æ‚ç›¸å¯¹è·¯å¾„çš„ç»„æˆéƒ¨åˆ†ã€‚ä»»æ„å¤šä¸ªè¿ç»­çš„æ–œæ ï¼ˆå³ï¼Œâ€™//â€˜ï¼‰éƒ½è¢«è§†ä¸ºå•ä¸ªæ–œæ  â€˜/â€˜ ã€‚ å¯¹äºæ­¤é—®é¢˜ï¼Œä»»ä½•å…¶ä»–æ ¼å¼çš„ç‚¹ï¼ˆä¾‹å¦‚ï¼Œâ€™â€¦â€™ï¼‰å‡è¢«è§†ä¸ºæ–‡ä»¶/ç›®å½•åç§°ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œè¿”å›çš„ è§„èŒƒè·¯å¾„ å¿…é¡»éµå¾ªä¸‹è¿°æ ¼å¼ï¼š</p>
<p>å§‹ç»ˆä»¥æ–œæ  â€˜/â€˜ å¼€å¤´ã€‚<br>ä¸¤ä¸ªç›®å½•åä¹‹é—´å¿…é¡»åªæœ‰ä¸€ä¸ªæ–œæ  â€˜/â€˜ ã€‚<br>æœ€åä¸€ä¸ªç›®å½•åï¼ˆå¦‚æœå­˜åœ¨ï¼‰ä¸èƒ½ ä»¥ â€˜/â€˜ ç»“å°¾ã€‚<br>æ­¤å¤–ï¼Œè·¯å¾„ä»…åŒ…å«ä»æ ¹ç›®å½•åˆ°ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ä¸Šçš„ç›®å½•ï¼ˆå³ï¼Œä¸å« â€˜.â€™ æˆ– â€˜..â€™ï¼‰ã€‚<br>è¿”å›ç®€åŒ–åå¾—åˆ°çš„ è§„èŒƒè·¯å¾„ ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼špath = â€œ/home/â€œ<br>è¾“å‡ºï¼šâ€/homeâ€<br>è§£é‡Šï¼šæ³¨æ„ï¼Œæœ€åä¸€ä¸ªç›®å½•ååé¢æ²¡æœ‰æ–œæ ã€‚ </p>
</blockquote>
<p>ç¤ºä¾‹ 2ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼špath = â€œ/../â€œ<br>è¾“å‡ºï¼šâ€/â€œ<br>è§£é‡Šï¼šä»æ ¹ç›®å½•å‘ä¸Šä¸€çº§æ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºæ ¹ç›®å½•æ˜¯ä½ å¯ä»¥åˆ°è¾¾çš„æœ€é«˜çº§ã€‚</p>
</blockquote>
<p>ç¤ºä¾‹ 3ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼špath = â€œ/home//foo/â€œ<br>è¾“å‡ºï¼šâ€/home/fooâ€<br>è§£é‡Šï¼šåœ¨è§„èŒƒè·¯å¾„ä¸­ï¼Œå¤šä¸ªè¿ç»­æ–œæ éœ€è¦ç”¨ä¸€ä¸ªæ–œæ æ›¿æ¢ã€‚</p>
</blockquote>
<p>ç¤ºä¾‹ 4ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼špath = â€œ/a/./b/../../c/â€œ<br>è¾“å‡ºï¼šâ€/câ€</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">simplifyPath</span><span class="params">(self, path: str)</span> -&gt; str:</span></span><br><span class="line">        stack = list()</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> path.split(<span class="string">"/"</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> p:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> p == <span class="string">"."</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> p == <span class="string">".."</span>:</span><br><span class="line">                <span class="keyword">if</span> stack:</span><br><span class="line">                    stack.pop(<span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                stack.append(p)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> stack:</span><br><span class="line">            result = <span class="string">"/"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result = <span class="string">"/"</span>.join(stack)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> result.startswith(<span class="string">"/"</span>):</span><br><span class="line">            result = <span class="string">"/"</span> + result</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">path = <span class="string">"/../"</span></span><br><span class="line">print(s.simplifyPath(path))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 61. æ—‹è½¬é“¾è¡¨</title>
    <url>/2021/03/27/leetcode-61-%E6%97%8B%E8%BD%AC%E9%93%BE%E8%A1%A8/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/rotate-list/" target="_blank" rel="noopener">æ—‹è½¬é“¾è¡¨</a></p>
<p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œæ—‹è½¬é“¾è¡¨ï¼Œå°†é“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹å‘å³ç§»åŠ¨ k ä¸ªä½ç½®ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210327141215.png" alt=""></p>
<blockquote>
<p>è¾“å…¥ï¼šhead = [1,2,3,4,5], k = 2 <br/><br>è¾“å‡ºï¼š[4,5,1,2,3]</p>
</blockquote>
<p>ç¤ºä¾‹ 2ï¼š<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210327141255.png" alt=""></p>
<blockquote>
<p>è¾“å…¥ï¼šhead = [0,1,2], k = 4 <br/><br>è¾“å‡ºï¼š[2,0,1]</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val=<span class="number">0</span>, next=None)</span>:</span></span><br><span class="line">        self.val = val</span><br><span class="line">        self.next = next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rotateRight</span><span class="params">(self, head: ListNode, k: int)</span> -&gt; ListNode:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> head <span class="keyword">or</span> <span class="keyword">not</span> head.next <span class="keyword">or</span> k == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> head</span><br><span class="line"></span><br><span class="line">        length = <span class="number">0</span></span><br><span class="line">        tail = head</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> tail:</span><br><span class="line">            length += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> tail.next:</span><br><span class="line">                tail = tail.next</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        target = k % length</span><br><span class="line">        <span class="keyword">if</span> target == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> head</span><br><span class="line"></span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="comment"># æ„å»ºå¾ªç¯é“¾è¡¨</span></span><br><span class="line">        tail.next = head</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> index &lt; length - target:</span><br><span class="line">            tail = tail.next</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ–°çš„å°¾èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹, ä½œä¸ºå¤´ç»“ç‚¹</span></span><br><span class="line">        new_head = tail.next</span><br><span class="line">        tail.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> new_head</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">links</span><span class="params">(nums)</span>:</span></span><br><span class="line">    head = <span class="literal">None</span></span><br><span class="line">    cur = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> nums:</span><br><span class="line">        <span class="keyword">if</span> head <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            head = ListNode(n)</span><br><span class="line">            cur = head</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            node = ListNode(n)</span><br><span class="line">            cur.next = node</span><br><span class="line">            cur = node</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> head</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">traverse</span><span class="params">(head)</span>:</span></span><br><span class="line">    cur = head</span><br><span class="line">    <span class="keyword">while</span> cur:</span><br><span class="line">        print(cur.val, end=<span class="string">" "</span>)</span><br><span class="line">        cur = cur.next</span><br><span class="line">    print(<span class="string">"\n"</span> + <span class="string">"-"</span> * <span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">    head = links(nums)</span><br><span class="line">    traverse(head)</span><br><span class="line">    s = Solution()</span><br><span class="line">    new_head = s.rotateRight(head, <span class="number">2</span>)</span><br><span class="line">    traverse(new_head)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 58. æœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦</title>
    <url>/2021/03/27/leetcode-58-%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E5%8D%95%E8%AF%8D%E7%9A%84%E9%95%BF%E5%BA%A6/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/length-of-last-word" target="_blank" rel="noopener">æœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦</a></p>
<p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œç”±è‹¥å¹²å•è¯ç»„æˆï¼Œå•è¯ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚è¿”å›å­—ç¬¦ä¸²ä¸­æœ€åä¸€ä¸ªå•è¯çš„é•¿åº¦ã€‚å¦‚æœä¸å­˜åœ¨æœ€åä¸€ä¸ªå•è¯ï¼Œè¯·è¿”å› 0 ã€‚</p>
<p>å•è¯ æ˜¯æŒ‡ä»…ç”±å­—æ¯ç»„æˆã€ä¸åŒ…å«ä»»ä½•ç©ºæ ¼å­—ç¬¦çš„æœ€å¤§å­å­—ç¬¦ä¸²ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šs = â€œHello Worldâ€<br>è¾“å‡ºï¼š5</p>
</blockquote>
<p>ç¤ºä¾‹ 2ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šs = â€œ â€œ<br>è¾“å‡ºï¼š0</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lengthOfLastWord</span><span class="params">(self, s: str)</span> -&gt; int:</span></span><br><span class="line">        string = <span class="string">""</span></span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> s[::<span class="number">-1</span>]:</span><br><span class="line">            <span class="keyword">if</span> x == <span class="string">" "</span> <span class="keyword">and</span> flag:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> x == <span class="string">" "</span> <span class="keyword">and</span> <span class="keyword">not</span> flag:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            flag = <span class="literal">True</span></span><br><span class="line">            string = x + string</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> len(string)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 53. æœ€å¤§å­åºå’Œ</title>
    <url>/2021/03/27/leetcode-53-%E6%9C%80%E5%A4%A7%E5%AD%90%E5%BA%8F%E5%92%8C/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/maximum-subarray" target="_blank" rel="noopener">æœ€å¤§å­åºå’Œ</a></p>
<p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šnums = [-2,1,-3,4,-1,2,1,-5,4]<br>è¾“å‡ºï¼š6<br>è§£é‡Šï¼šè¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6 ã€‚</p>
</blockquote>
<blockquote>
<p>ç¤ºä¾‹ 2ï¼š<br>è¾“å…¥ï¼šnums = [1]<br>è¾“å‡ºï¼š1</p>
</blockquote>
<blockquote>
<p>ç¤ºä¾‹ 3ï¼š<br>è¾“å…¥ï¼šnums = [0]<br>è¾“å‡ºï¼š0</p>
</blockquote>
<blockquote>
<p>ç¤ºä¾‹ 4ï¼š<br>è¾“å…¥ï¼šnums = [-1]<br>è¾“å‡ºï¼š-1</p>
</blockquote>
<p>ç¤ºä¾‹ 5ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šnums = [-100000]<br>è¾“å‡ºï¼š-100000</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxSubArray</span><span class="params">(self, nums: list)</span> -&gt; int:</span></span><br><span class="line"></span><br><span class="line">        total = nums[<span class="number">0</span>]</span><br><span class="line">        temp = nums[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> nums[<span class="number">1</span>:]:</span><br><span class="line">            <span class="keyword">if</span> temp &lt; <span class="number">0</span>:</span><br><span class="line">                temp = <span class="number">0</span></span><br><span class="line">            temp += n</span><br><span class="line">            <span class="keyword">if</span> temp &gt; total:</span><br><span class="line">                total = temp</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> total</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nums = [<span class="number">-2</span>, <span class="number">1</span>, <span class="number">-3</span>, <span class="number">4</span>, <span class="number">-1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">-5</span>, <span class="number">4</span>]</span><br><span class="line">s = Solution()</span><br><span class="line">print(s.maxSubArray(nums))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 38. å¤–è§‚æ•°åˆ—</title>
    <url>/2021/03/27/leetcode-38-%E5%A4%96%E8%A7%82%E6%95%B0%E5%88%97/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/count-and-say" target="_blank" rel="noopener">å¤–è§‚æ•°åˆ—</a></p>
<p>ç»™å®šä¸€ä¸ªæ­£æ•´æ•° n ï¼Œè¾“å‡ºå¤–è§‚æ•°åˆ—çš„ç¬¬ n é¡¹ã€‚</p>
<p>ã€Œå¤–è§‚æ•°åˆ—ã€æ˜¯ä¸€ä¸ªæ•´æ•°åºåˆ—ï¼Œä»æ•°å­— 1 å¼€å§‹ï¼Œåºåˆ—ä¸­çš„æ¯ä¸€é¡¹éƒ½æ˜¯å¯¹å‰ä¸€é¡¹çš„æè¿°ã€‚</p>
<p>ä½ å¯ä»¥å°†å…¶è§†ä½œæ˜¯ç”±é€’å½’å…¬å¼å®šä¹‰çš„æ•°å­—å­—ç¬¦ä¸²åºåˆ—ï¼š</p>
<p>countAndSay(1) = â€œ1â€<br>countAndSay(n) æ˜¯å¯¹ countAndSay(n-1) çš„æè¿°ï¼Œç„¶åè½¬æ¢æˆå¦ä¸€ä¸ªæ•°å­—å­—ç¬¦ä¸²ã€‚</p>
<p>å‰äº”é¡¹å¦‚ä¸‹<br/></p>
<blockquote>
<ol>
<li>1</li>
<li>11</li>
<li>21</li>
<li>1211</li>
<li>111221<br>ç¬¬ä¸€é¡¹æ˜¯æ•°å­— 1<br>æè¿°å‰ä¸€é¡¹ï¼Œè¿™ä¸ªæ•°æ˜¯ 1 å³ â€œ ä¸€ ä¸ª 1 â€ï¼Œè®°ä½œ â€œ11â€<br>æè¿°å‰ä¸€é¡¹ï¼Œè¿™ä¸ªæ•°æ˜¯ 11 å³ â€œ äºŒ ä¸ª 1 â€ ï¼Œè®°ä½œ â€œ21â€<br>æè¿°å‰ä¸€é¡¹ï¼Œè¿™ä¸ªæ•°æ˜¯ 21 å³ â€œ ä¸€ ä¸ª 2 + ä¸€ ä¸ª 1 â€ ï¼Œè®°ä½œ â€œ1211â€<br>æè¿°å‰ä¸€é¡¹ï¼Œè¿™ä¸ªæ•°æ˜¯ 1211 å³ â€œ ä¸€ ä¸ª 1 + ä¸€ ä¸ª 2 + äºŒ ä¸ª 1 â€ ï¼Œè®°ä½œ â€œ111221â€</li>
</ol>
</blockquote>
<p>è¦ æè¿° ä¸€ä¸ªæ•°å­—å­—ç¬¦ä¸²ï¼Œé¦–å…ˆè¦å°†å­—ç¬¦ä¸²åˆ†å‰²ä¸º æœ€å° æ•°é‡çš„ç»„ï¼Œæ¯ä¸ªç»„éƒ½ç”±è¿ç»­çš„æœ€å¤š ç›¸åŒå­—ç¬¦ ç»„æˆã€‚ç„¶åå¯¹äºæ¯ä¸ªç»„ï¼Œå…ˆæè¿°å­—ç¬¦çš„æ•°é‡ï¼Œç„¶åæè¿°å­—ç¬¦ï¼Œå½¢æˆä¸€ä¸ªæè¿°ç»„ã€‚è¦å°†æè¿°è½¬æ¢ä¸ºæ•°å­—å­—ç¬¦ä¸²ï¼Œå…ˆå°†æ¯ç»„ä¸­çš„å­—ç¬¦æ•°é‡ç”¨æ•°å­—æ›¿æ¢ï¼Œå†å°†æ‰€æœ‰æè¿°ç»„è¿æ¥èµ·æ¥ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ•°å­—å­—ç¬¦ä¸² â€œ3322251â€ çš„æè¿°å¦‚ä¸‹å›¾ï¼š<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210327140225.png" alt=""></p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šn = 1<br>è¾“å‡ºï¼šâ€1â€<br>è§£é‡Šï¼šè¿™æ˜¯ä¸€ä¸ªåŸºæœ¬æ ·ä¾‹ã€‚</p>
</blockquote>
<p>ç¤ºä¾‹ 2ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šn = 4<br>è¾“å‡ºï¼šâ€1211â€<br>è§£é‡Šï¼š<br>countAndSay(1) = â€œ1â€<br>countAndSay(2) = è¯» â€œ1â€ = ä¸€ ä¸ª 1 = â€œ11â€<br>countAndSay(3) = è¯» â€œ11â€ = äºŒ ä¸ª 1 = â€œ21â€<br>countAndSay(4) = è¯» â€œ21â€ = ä¸€ ä¸ª 2 + ä¸€ ä¸ª 1 = â€œ12â€ + â€œ11â€ = â€œ1211â€</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">countAndSay</span><span class="params">(self, n: int)</span> -&gt; str:</span></span><br><span class="line">        string = <span class="string">"1"</span></span><br><span class="line">        index = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> index &lt; n:</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            rv = <span class="string">""</span></span><br><span class="line">            <span class="keyword">while</span> string:</span><br><span class="line">                start = string[<span class="number">0</span>]</span><br><span class="line">                tmp = string.lstrip(start)</span><br><span class="line">                count = len(string) - len(tmp)</span><br><span class="line">                string = tmp</span><br><span class="line">                rv += <span class="string">"%s%s"</span> % (count, start)</span><br><span class="line">            string = rv</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">n = <span class="number">4</span></span><br><span class="line">print(s.countAndSay(n))</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 35. æœç´¢æ’å…¥ä½ç½®</title>
    <url>/2021/03/27/leetcode-35-%E6%90%9C%E7%B4%A2%E6%8F%92%E5%85%A5%E4%BD%8D%E7%BD%AE/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/search-insert-position" target="_blank" rel="noopener">æœç´¢æ’å…¥ä½ç½®</a></p>
<p>ç»™å®šä¸€ä¸ªæ’åºæ•°ç»„å’Œä¸€ä¸ªç›®æ ‡å€¼ï¼Œåœ¨æ•°ç»„ä¸­æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œå¹¶è¿”å›å…¶ç´¢å¼•ã€‚å¦‚æœç›®æ ‡å€¼ä¸å­˜åœ¨äºæ•°ç»„ä¸­ï¼Œè¿”å›å®ƒå°†ä¼šè¢«æŒ‰é¡ºåºæ’å…¥çš„ä½ç½®ã€‚</p>
<p>ä½ å¯ä»¥å‡è®¾æ•°ç»„ä¸­æ— é‡å¤å…ƒç´ ã€‚</p>
<p>ç¤ºä¾‹ 1:</p>
<blockquote>
<p>è¾“å…¥: [1,3,5,6], 5 <br/><br>è¾“å‡º: 2</p>
</blockquote>
<p>ç¤ºä¾‹ 2:</p>
<blockquote>
<p>è¾“å…¥: [1,3,5,6], 2 <br/><br>è¾“å‡º: 1</p>
</blockquote>
<p>ç¤ºä¾‹ 3:</p>
<blockquote>
<p>è¾“å…¥: [1,3,5,6], 7 <br/><br>è¾“å‡º: 4</p>
</blockquote>
<p>ç¤ºä¾‹ 4:</p>
<blockquote>
<p>è¾“å…¥: [1,3,5,6], 0 <br/><br>è¾“å‡º: 0</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">searchInsert</span><span class="params">(self, nums: list, target: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">for</span> index, value <span class="keyword">in</span> enumerate(nums):</span><br><span class="line">            <span class="keyword">if</span> target &lt;= value:</span><br><span class="line">                <span class="keyword">return</span> index</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> len(nums)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">ns = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">print(s.searchInsert(ns, <span class="number">5</span>))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</title>
    <url>/2021/03/27/leetcode-21-%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E9%93%BE%E8%A1%A8/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="">åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</a></p>
<p>å°†ä¸¤ä¸ªå‡åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„ å‡åº é“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚ </p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<blockquote>
<p><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210327125926.png" alt=""><br>è¾“å…¥ï¼šl1 = [1,2,4], l2 = [1,3,4] <br/><br>è¾“å‡ºï¼š[1,1,2,3,4,4]</p>
</blockquote>
<p>ç¤ºä¾‹ 2ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šl1 = [], l2 = []<br>è¾“å‡ºï¼š[]</p>
</blockquote>
<p>ç¤ºä¾‹ 3ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šl1 = [], l2 = [0]<br>è¾“å‡ºï¼š[0]</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Definition for singly-linked list.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val=<span class="number">0</span>, next=None)</span>:</span></span><br><span class="line">        self.val = val</span><br><span class="line">        self.next = next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mergeTwoLists</span><span class="params">(self, l1: ListNode, l2: ListNode)</span> -&gt; ListNode:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> l1 <span class="keyword">and</span> <span class="keyword">not</span> l2:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">elif</span> l1 <span class="keyword">and</span> <span class="keyword">not</span> l2:</span><br><span class="line">            <span class="keyword">return</span> l1</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> l1 <span class="keyword">and</span> l2:</span><br><span class="line">            <span class="keyword">return</span> l2</span><br><span class="line"></span><br><span class="line">        cur = <span class="literal">None</span></span><br><span class="line">        head = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> l1 <span class="keyword">and</span> l2:</span><br><span class="line">            <span class="keyword">if</span> l1.val &lt;= l2.val:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> head:</span><br><span class="line">                    head = l1</span><br><span class="line">                    cur = head</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    cur.next = l1</span><br><span class="line">                    cur = cur.next</span><br><span class="line">                l1 = l1.next</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> head:</span><br><span class="line">                    head = l2</span><br><span class="line">                    cur = head</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    cur.next = l2</span><br><span class="line">                    cur = cur.next</span><br><span class="line">                l2 = l2.next</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> l1:</span><br><span class="line">            cur.next = l1</span><br><span class="line">        <span class="keyword">if</span> l2:</span><br><span class="line">            cur.next = l2</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> head</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">l1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>]</span><br><span class="line">l2 = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">la1 = ListNode(<span class="number">1</span>)</span><br><span class="line">la2 = ListNode(<span class="number">2</span>)</span><br><span class="line">la3 = ListNode(<span class="number">4</span>)</span><br><span class="line">la1.next = la2</span><br><span class="line">la2.next = la3</span><br><span class="line"></span><br><span class="line">lb1 = ListNode(<span class="number">1</span>)</span><br><span class="line">lb2 = ListNode(<span class="number">3</span>)</span><br><span class="line">lb3 = ListNode(<span class="number">4</span>)</span><br><span class="line">lb1.next = lb2</span><br><span class="line">lb2.next = lb3</span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">node = s.mergeTwoLists(la1, lb1)</span><br><span class="line"><span class="keyword">while</span> node:</span><br><span class="line">    print(node.val)</span><br><span class="line">    node = node.next</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 20.æœ‰æ•ˆçš„æ‹¬å·</title>
    <url>/2021/03/27/leetcode-20-%E6%9C%89%E6%95%88%E7%9A%84%E6%8B%AC%E5%8F%B7/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/valid-parentheses" target="_blank" rel="noopener">æœ‰æ•ˆçš„æ‹¬å·</a></p>
<p>ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ â€˜(â€˜ï¼Œâ€™)â€™ï¼Œâ€™{â€˜ï¼Œâ€™}â€™ï¼Œâ€™[â€˜ï¼Œâ€™]â€™ çš„å­—ç¬¦ä¸² s ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚</p>
<p>æœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š</p>
<p>å·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚<br>å·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šs = â€œ()â€<br>è¾“å‡ºï¼štrue</p>
</blockquote>
<p>ç¤ºä¾‹ 2ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šs = â€œ()[]{}â€<br>è¾“å‡ºï¼štrue</p>
</blockquote>
<p>ç¤ºä¾‹ 3ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šs = â€œ(]â€<br>è¾“å‡ºï¼šfalse</p>
</blockquote>
<p>ç¤ºä¾‹ 4ï¼š<br>è¾“å…¥ï¼šs = â€œ([)]â€<br>è¾“å‡ºï¼šfalse</p>
<p>ç¤ºä¾‹ 5ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šs = â€œ{[]}â€<br>è¾“å‡ºï¼štrue</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isValid</span><span class="params">(self, s: str)</span> -&gt; bool:</span></span><br><span class="line"></span><br><span class="line">        left_dict = &#123;</span><br><span class="line">            <span class="string">"("</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">"["</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="string">"&#123;"</span>: <span class="number">3</span></span><br><span class="line">        &#125;</span><br><span class="line">        right_dict = &#123;</span><br><span class="line">            <span class="string">")"</span>: <span class="number">-1</span>,</span><br><span class="line">            <span class="string">"]"</span>: <span class="number">-2</span>,</span><br><span class="line">            <span class="string">"&#125;"</span>: <span class="number">-3</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stack = list()</span><br><span class="line">        <span class="keyword">for</span> ss <span class="keyword">in</span> s:</span><br><span class="line">            <span class="keyword">if</span> ss <span class="keyword">in</span> left_dict.keys():</span><br><span class="line">                stack.append(ss)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> stack:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">                ch = stack.pop(<span class="number">-1</span>)</span><br><span class="line">                <span class="keyword">if</span> left_dict.get(ch, <span class="number">99</span>) + right_dict.get(ss, <span class="number">99</span>) == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> stack:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = <span class="string">"()[]&#123;&#125;"</span></span><br><span class="line">so = Solution()</span><br><span class="line">print(so.isValid(s))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]ç½‘ç»œæ–‡ç« é›†åˆ</title>
    <url>/2021/03/26/%E8%BD%AC-%E7%BD%91%E7%BB%9C%E6%96%87%E7%AB%A0%E9%9B%86%E5%90%88/</url>
    <content><![CDATA[<p><a href="https://mp.weixin.qq.com/s/jiPMUk6zUdOY6eKxAjNDbQ" target="_blank" rel="noopener">ä½å¹¶å‘ç¼–ç¨‹ - å¦‚æœè®©ä½ æ¥è®¾è®¡ç½‘ç»œ</a></p>
<p><a href="https://mp.weixin.qq.com/s/Uf42QEL6WUSHOwJ403FwOA" target="_blank" rel="noopener">ä½å¹¶å‘ç¼–ç¨‹ - å›¾è§£ | ä½ ç®¡è¿™ç ´ç©æ„å„¿å«TCPï¼Ÿ</a></p>
]]></content>
  </entry>
  <entry>
    <title>Leetcode --- 17.ç”µè¯å·ç çš„å­—æ¯ç»„åˆ</title>
    <url>/2021/03/26/leetcode-17.%E7%94%B5%E8%AF%9D%E5%8F%B7%E7%A0%81%E7%9A%84%E5%AD%97%E6%AF%8D%E7%BB%84%E5%90%88/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/letter-combinations-of-a-phone-number/" target="_blank" rel="noopener">ç”µè¯å·ç çš„å­—æ¯ç»„åˆ</a></p>
<p>ç»™å®šä¸€ä¸ªä»…åŒ…å«æ•°å­— 2-9 çš„å­—ç¬¦ä¸²ï¼Œè¿”å›æ‰€æœ‰å®ƒèƒ½è¡¨ç¤ºçš„å­—æ¯ç»„åˆã€‚ç­”æ¡ˆå¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›ã€‚</p>
<p>ç»™å‡ºæ•°å­—åˆ°å­—æ¯çš„æ˜ å°„å¦‚ä¸‹ï¼ˆä¸ç”µè¯æŒ‰é”®ç›¸åŒï¼‰ã€‚æ³¨æ„ 1 ä¸å¯¹åº”ä»»ä½•å­—æ¯ã€‚<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210326005238.png" alt=""></p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šdigits = â€œ23â€ <br/><br>è¾“å‡ºï¼š[â€œadâ€,â€aeâ€,â€afâ€,â€bdâ€,â€beâ€,â€bfâ€,â€cdâ€,â€ceâ€,â€cfâ€] <br/></p>
</blockquote>
<p>ç¤ºä¾‹ 2ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šdigits = â€œâ€ <br/><br>è¾“å‡ºï¼š[]</p>
</blockquote>
<p>ç¤ºä¾‹ 3ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šdigits = â€œ2â€ <br/><br>è¾“å‡ºï¼š[â€œaâ€,â€bâ€,â€câ€]</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">letterCombinations</span><span class="params">(self, digits: str)</span>:</span></span><br><span class="line">        number = &#123;</span><br><span class="line">            <span class="string">"2"</span>: [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>],</span><br><span class="line">            <span class="string">"3"</span>: [<span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"f"</span>],</span><br><span class="line">            <span class="string">"4"</span>: [<span class="string">"g"</span>, <span class="string">"h"</span>, <span class="string">"i"</span>],</span><br><span class="line">            <span class="string">"5"</span>: [<span class="string">"j"</span>, <span class="string">"k"</span>, <span class="string">"l"</span>],</span><br><span class="line">            <span class="string">"6"</span>: [<span class="string">"m"</span>, <span class="string">"n"</span>, <span class="string">"o"</span>],</span><br><span class="line">            <span class="string">"7"</span>: [<span class="string">"p"</span>, <span class="string">"q"</span>, <span class="string">"r"</span>, <span class="string">"s"</span>],</span><br><span class="line">            <span class="string">"8"</span>: [<span class="string">"t"</span>, <span class="string">"u"</span>, <span class="string">"v"</span>],</span><br><span class="line">            <span class="string">"9"</span>: [<span class="string">"w"</span>, <span class="string">"x"</span>, <span class="string">"y"</span>, <span class="string">"z"</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> digits <span class="keyword">or</span> digits == <span class="string">"1"</span>:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        ret = [<span class="string">""</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> digits:</span><br><span class="line">            ret = [r + n <span class="keyword">for</span> r <span class="keyword">in</span> ret <span class="keyword">for</span> n <span class="keyword">in</span> number[i]]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">d = <span class="string">"23"</span></span><br><span class="line">print(s.letterCombinations(d))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 15.ä¸‰æ•°ä¹‹å’Œ</title>
    <url>/2021/03/26/leetcode-15.%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/3sum/" target="_blank" rel="noopener">ä¸‰æ•°ä¹‹å’Œ</a></p>
<p>ç»™ä½ ä¸€ä¸ªåŒ…å« n ä¸ªæ•´æ•°çš„æ•°ç»„ numsï¼Œåˆ¤æ–­ nums ä¸­æ˜¯å¦å­˜åœ¨ä¸‰ä¸ªå…ƒç´  aï¼Œbï¼Œc ï¼Œä½¿å¾— a + b + c = 0 ï¼Ÿè¯·ä½ æ‰¾å‡ºæ‰€æœ‰å’Œä¸º 0 ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p>
<p>æ³¨æ„ï¼šç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p>
<p>ç¤ºä¾‹ 1</p>
<blockquote>
<p>è¾“å…¥ï¼šnums = [-1,0,1,2,-1,-4] <br/><br>è¾“å‡ºï¼š[[-1,-1,2],[-1,0,1]] <br/></p>
</blockquote>
<p>ç¤ºä¾‹ 2</p>
<blockquote>
<p>è¾“å…¥ï¼šnums = [] <br/><br>è¾“å‡ºï¼š[] <br/></p>
</blockquote>
<p>ç¤ºä¾‹ 3</p>
<blockquote>
<p>è¾“å…¥ï¼šnums = [0] <br/><br>è¾“å‡ºï¼š[] <br/></p>
</blockquote>
<h3 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">threeSum</span><span class="params">(self, nums: list)</span> -&gt; list:</span></span><br><span class="line">        result = set()</span><br><span class="line">        nums = sorted(nums)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums)):</span><br><span class="line"></span><br><span class="line">            m = nums[i]</span><br><span class="line">            <span class="keyword">if</span> m &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            left = i + <span class="number">1</span></span><br><span class="line">            right = len(nums) - <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> left &lt; right:</span><br><span class="line">                n = nums[left]</span><br><span class="line">                o = nums[right]</span><br><span class="line">                <span class="keyword">if</span> m + n + o == <span class="number">0</span>:</span><br><span class="line">                    result.add(tuple(sorted([m, n, o])))</span><br><span class="line">                    left += <span class="number">1</span></span><br><span class="line">                    right -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">elif</span> m + n + o &gt; <span class="number">0</span>:</span><br><span class="line">                    right -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    left += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [list(r) <span class="keyword">for</span> r <span class="keyword">in</span> result]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">ns = [<span class="number">-1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">-1</span>,<span class="number">-4</span>]</span><br><span class="line">print(s.threeSum(ns))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 3.æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</title>
    <url>/2021/03/26/leetcode-3.%E6%97%A0%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%90%E4%B8%B2/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/" target="_blank" rel="noopener">æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a></p>
<p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸² çš„é•¿åº¦ã€‚</p>
<p>ç¤ºä¾‹ 1</p>
<blockquote>
<p>è¾“å…¥: s = â€œabcabcbbâ€    <br/><br>è¾“å‡º: 3     <br/><br>è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ â€œabcâ€ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚<br/></p>
</blockquote>
<p>ç¤ºä¾‹ 2</p>
<blockquote>
<p>è¾“å…¥: s = â€œbbbbbâ€<br/><br>è¾“å‡º: 1    <br/><br>è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ â€œbâ€ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 1ã€‚    <br/></p>
</blockquote>
<p>ç¤ºä¾‹ 3</p>
<blockquote>
<p>è¾“å…¥: s = â€œpwwkewâ€<br/><br>è¾“å‡º: 3    <br/><br>è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ â€œwkeâ€ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚<br>     è¯·æ³¨æ„ï¼Œä½ çš„ç­”æ¡ˆå¿…é¡»æ˜¯ å­ä¸² çš„é•¿åº¦ï¼Œâ€pwkeâ€ æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œä¸æ˜¯å­ä¸²ã€‚<br/></p>
</blockquote>
<p>ç¤ºä¾‹ 4:</p>
<blockquote>
<p>è¾“å…¥: s = â€œâ€ <br/><br>è¾“å‡º: 0</p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(self, s: str)</span> -&gt; int:</span></span><br><span class="line">        temp = <span class="string">""</span></span><br><span class="line">        length = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> ss <span class="keyword">in</span> s:</span><br><span class="line">            index = temp.find(ss)</span><br><span class="line">            <span class="keyword">if</span> index == <span class="number">-1</span>:</span><br><span class="line">                temp += ss</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                temp = temp[index + <span class="number">1</span>:] + ss</span><br><span class="line">            <span class="keyword">if</span> len(temp) &gt; length:</span><br><span class="line">                length = len(temp)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> length</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">string = <span class="string">"aabaab!bb"</span></span><br><span class="line">s = Solution()</span><br><span class="line">print(s.lengthOfLongestSubstring(string))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- 1.ä¸¤æ•°ä¹‹å’Œ</title>
    <url>/2021/03/26/leetcode-1.%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8C/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/two-sum/" target="_blank" rel="noopener">ä¸¤æ•°ä¹‹å’Œ</a></p>
<p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º å’Œä¸ºç›®æ ‡å€¼ çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚</p>
<p>ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œæ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ åœ¨ç­”æ¡ˆé‡Œä¸èƒ½é‡å¤å‡ºç°ã€‚</p>
<p>ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚</p>
<p>ç¤ºä¾‹1</p>
<blockquote>
<p>è¾“å…¥ï¼šnums = [2,7,11,15], target = 9 <br/><br>è¾“å‡ºï¼š[0,1] <br/><br>è§£é‡Šï¼šå› ä¸º nums[0] + nums[1] == 9 ï¼Œè¿”å› [0, 1] ã€‚<br/></p>
</blockquote>
<p>ç¤ºä¾‹ 2ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šnums = [3,2,4], target = 6 <br/><br>è¾“å‡ºï¼š[1,2]    <br/></p>
</blockquote>
<p>ç¤ºä¾‹ 3ï¼š</p>
<blockquote>
<p>è¾“å…¥ï¼šnums = [3,3], target = 6    <br/><br>è¾“å‡ºï¼š[0,1]    <br/></p>
</blockquote>
<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">twoSum</span><span class="params">(self, nums: list, target: int)</span> -&gt; list:</span></span><br><span class="line">        numDict = dict()</span><br><span class="line">        <span class="keyword">for</span> index, n <span class="keyword">in</span> enumerate(nums):</span><br><span class="line">            numDict.setdefault(n, []).append(index)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> nums:</span><br><span class="line">            tmp = target - n</span><br><span class="line">            values = numDict.get(tmp)</span><br><span class="line">            <span class="keyword">if</span> values:</span><br><span class="line">                <span class="keyword">if</span> tmp == n:</span><br><span class="line">                    <span class="keyword">if</span> len(values) &gt;= <span class="number">2</span>:</span><br><span class="line">                        <span class="keyword">return</span> values[:<span class="number">2</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> [numDict[n][<span class="number">0</span>], numDict[tmp][<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ns = [<span class="number">3</span>, <span class="number">3</span>]</span><br><span class="line">target = <span class="number">6</span></span><br><span class="line">s = Solution()</span><br><span class="line">print(s.twoSum(ns, target))</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Redis --- åˆ†å¸ƒå¼é”å®ç°</title>
    <url>/2021/02/24/redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”"><a href="#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”"></a>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”</h3><p>æˆ‘ä»¬åœ¨å¼€å‘åº”ç”¨çš„æ—¶å€™ï¼Œå¦‚æœéœ€è¦å¯¹æŸä¸€ä¸ªå…±äº«å˜é‡è¿›è¡Œå¤šçº¿ç¨‹åŒæ­¥è®¿é—®çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘ä»¬å­¦åˆ°çš„é”è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”å¯ä»¥å®Œç¾çš„è¿è¡Œï¼Œæ¯«æ— Bugï¼</p>
<p>æ³¨æ„è¿™æ˜¯å•æœºåº”ç”¨ï¼Œåæ¥ä¸šåŠ¡å‘å±•ï¼Œéœ€è¦åšé›†ç¾¤ï¼Œä¸€ä¸ªåº”ç”¨éœ€è¦éƒ¨ç½²åˆ°å‡ å°æœºå™¨ä¸Šç„¶ååšè´Ÿè½½å‡è¡¡ï¼Œå¤§è‡´å¦‚ä¸‹å›¾ï¼š<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210224231757.png" alt=""></p>
<p>ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå˜é‡Aå­˜åœ¨ä¸‰ä¸ªæœåŠ¡å™¨å†…å­˜ä¸­ï¼ˆè¿™ä¸ªå˜é‡Aä¸»è¦ä½“ç°æ˜¯åœ¨ä¸€ä¸ªç±»ä¸­çš„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œæ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„å¯¹è±¡ï¼‰ï¼Œå¦‚æœä¸åŠ ä»»ä½•æ§åˆ¶çš„è¯ï¼Œå˜é‡AåŒæ—¶éƒ½ä¼šåœ¨åˆ†é…ä¸€å—å†…å­˜ï¼Œä¸‰ä¸ªè¯·æ±‚å‘è¿‡æ¥åŒæ—¶å¯¹è¿™ä¸ªå˜é‡æ“ä½œï¼Œæ˜¾ç„¶ç»“æœæ˜¯ä¸å¯¹çš„ï¼å³ä½¿ä¸æ˜¯åŒæ—¶å‘è¿‡æ¥ï¼Œä¸‰ä¸ªè¯·æ±‚åˆ†åˆ«æ“ä½œä¸‰ä¸ªä¸åŒå†…å­˜åŒºåŸŸçš„æ•°æ®ï¼Œå˜é‡Aä¹‹é—´ä¸å­˜åœ¨å…±äº«ï¼Œä¹Ÿä¸å…·æœ‰å¯è§æ€§ï¼Œå¤„ç†çš„ç»“æœä¹Ÿæ˜¯ä¸å¯¹çš„ï¼</p>
<p>å¦‚æœæˆ‘ä»¬ä¸šåŠ¡ä¸­ç¡®å®å­˜åœ¨è¿™ä¸ªåœºæ™¯çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ç§æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼</p>
<p>ä¸ºäº†ä¿è¯ä¸€ä¸ªæ–¹æ³•æˆ–å±æ€§åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹çš„åŒä¸€æ—¶é—´åªèƒ½è¢«åŒä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œåœ¨ä¼ ç»Ÿå•ä½“åº”ç”¨å•æœºéƒ¨ç½²çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¹¶å‘å¤„ç†ç›¸å…³çš„åŠŸèƒ½è¿›è¡Œäº’æ–¥æ§åˆ¶ã€‚ä½†æ˜¯ï¼Œéšç€ä¸šåŠ¡å‘å±•çš„éœ€è¦ï¼ŒåŸå•ä½“å•æœºéƒ¨ç½²çš„ç³»ç»Ÿè¢«æ¼”åŒ–æˆåˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿåï¼Œç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿå¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹å¹¶ä¸”åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šï¼Œè¿™å°†ä½¿åŸå•æœºéƒ¨ç½²æƒ…å†µä¸‹çš„å¹¶å‘æ§åˆ¶é”ç­–ç•¥å¤±æ•ˆï¼Œå•çº¯çš„åº”ç”¨å¹¶ä¸èƒ½æä¾›åˆ†å¸ƒå¼é”çš„èƒ½åŠ›ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å°±éœ€è¦ä¸€ç§è·¨æœºå™¨çš„äº’æ–¥æœºåˆ¶æ¥æ§åˆ¶å…±äº«èµ„æºçš„è®¿é—®ï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”è¦è§£å†³çš„é—®é¢˜ï¼</p>
<p>åˆ†å¸ƒå¼é”åº”è¯¥å…·å¤‡å“ªäº›æ¡ä»¶ï¼š</p>
<blockquote>
</blockquote>
<ul>
<li>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªæ–¹æ³•åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªæœºå™¨çš„ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼›</li>
<li>é«˜å¯ç”¨çš„è·å–é”ä¸é‡Šæ”¾é”ï¼›</li>
<li>é«˜æ€§èƒ½çš„è·å–é”ä¸é‡Šæ”¾é”ï¼›</li>
<li>å…·å¤‡å¯é‡å…¥ç‰¹æ€§ï¼›</li>
<li>å…·å¤‡é”å¤±æ•ˆæœºåˆ¶ï¼Œé˜²æ­¢æ­»é”ï¼›</li>
<li>å…·å¤‡éé˜»å¡é”ç‰¹æ€§ï¼Œå³æ²¡æœ‰è·å–åˆ°é”å°†ç›´æ¥è¿”å›è·å–é”å¤±è´¥</li>
</ul>
<a id="more"></a>

<h3 id="åŸºäºrediså®ç°åˆ†å¸ƒå¼é”"><a href="#åŸºäºrediså®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="åŸºäºrediså®ç°åˆ†å¸ƒå¼é”"></a>åŸºäºrediså®ç°åˆ†å¸ƒå¼é”</h3><h4 id="é€‰ç”¨Rediså®ç°åˆ†å¸ƒå¼é”åŸå› "><a href="#é€‰ç”¨Rediså®ç°åˆ†å¸ƒå¼é”åŸå› " class="headerlink" title="é€‰ç”¨Rediså®ç°åˆ†å¸ƒå¼é”åŸå› "></a>é€‰ç”¨Rediså®ç°åˆ†å¸ƒå¼é”åŸå› </h4><ul>
<li>Redisæœ‰å¾ˆé«˜çš„æ€§èƒ½ï¼›</li>
<li>Rediså‘½ä»¤å¯¹æ­¤æ”¯æŒè¾ƒå¥½ï¼Œå®ç°èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿</li>
</ul>
<h4 id="ä½¿ç”¨å‘½ä»¤ä»‹ç»ï¼š"><a href="#ä½¿ç”¨å‘½ä»¤ä»‹ç»ï¼š" class="headerlink" title="ä½¿ç”¨å‘½ä»¤ä»‹ç»ï¼š"></a>ä½¿ç”¨å‘½ä»¤ä»‹ç»ï¼š</h4><ul>
<li>SETNX</li>
</ul>
<p><code>SETNX key val</code>ï¼šå½“ä¸”ä»…å½“keyä¸å­˜åœ¨æ—¶ï¼Œsetä¸€ä¸ªkeyä¸ºvalçš„å­—ç¬¦ä¸²ï¼Œè¿”å›1ï¼›è‹¥keyå­˜åœ¨ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œè¿”å›0ã€‚</p>
<ul>
<li>expire</li>
</ul>
<p><code>expire key timeout</code>ï¼šä¸ºkeyè®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºsecondï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´é”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œé¿å…æ­»é”ã€‚</p>
<ul>
<li>delete</li>
</ul>
<p><code>delete key</code>ï¼šåˆ é™¤key</p>
<p>åœ¨ä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”çš„æ—¶å€™ï¼Œä¸»è¦å°±ä¼šä½¿ç”¨åˆ°è¿™ä¸‰ä¸ªå‘½ä»¤ã€‚</p>
<h4 id="å®ç°æ€æƒ³ï¼š"><a href="#å®ç°æ€æƒ³ï¼š" class="headerlink" title="å®ç°æ€æƒ³ï¼š"></a>å®ç°æ€æƒ³ï¼š</h4><ul>
<li><p>è·å–é”çš„æ—¶å€™ï¼Œä½¿ç”¨setnxåŠ é”ï¼Œå¹¶ä½¿ç”¨expireå‘½ä»¤ä¸ºé”æ·»åŠ ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´åˆ™è‡ªåŠ¨é‡Šæ”¾é”ï¼Œé”çš„valueå€¼ä¸ºä¸€ä¸ªéšæœºç”Ÿæˆçš„UUIDï¼Œé€šè¿‡æ­¤åœ¨é‡Šæ”¾é”çš„æ—¶å€™è¿›è¡Œåˆ¤æ–­ã€‚</p>
</li>
<li><p>è·å–é”çš„æ—¶å€™è¿˜è®¾ç½®ä¸€ä¸ªè·å–çš„è¶…æ—¶æ—¶é—´ï¼Œè‹¥è¶…è¿‡è¿™ä¸ªæ—¶é—´åˆ™æ”¾å¼ƒè·å–é”ã€‚</p>
</li>
<li><p>é‡Šæ”¾é”çš„æ—¶å€™ï¼Œé€šè¿‡UUIDåˆ¤æ–­æ˜¯ä¸æ˜¯è¯¥é”ï¼Œè‹¥æ˜¯è¯¥é”ï¼Œåˆ™æ‰§è¡Œdeleteè¿›è¡Œé”é‡Šæ”¾ã€‚</p>
</li>
</ul>
<h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisLock</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, client, lock_name, acquire_time=<span class="number">5</span>, time_out=<span class="number">5</span>)</span>:</span></span><br><span class="line">        self._client: redis.Redis = client</span><br><span class="line">        self._lock_name = lock_name</span><br><span class="line">        self._acquire_time = acquire_time</span><br><span class="line">        self._time_out = time_out</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">acquire</span><span class="params">(self)</span>:</span></span><br><span class="line">        identifier = str(uuid.uuid4())</span><br><span class="line">        <span class="comment"># æœ€å¤§è·å–é”çš„æ—¶é—´</span></span><br><span class="line">        end = time.time() + self._acquire_time</span><br><span class="line">        <span class="comment"># è¶…è¿‡è·å–é”çš„æœ€å¤§æ—¶é—´, é‚£ä¹ˆè·å–é”å¤±è´¥</span></span><br><span class="line">        <span class="keyword">while</span> time.time() &lt; end:</span><br><span class="line">            <span class="comment"># åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></span><br><span class="line">            <span class="keyword">if</span> self._client.setnx(self._lock_name, identifier):</span><br><span class="line">                <span class="comment"># è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´, é˜²æ­¢è¿›ç¨‹å´©æºƒå¯¼è‡´å…¶ä»–è¿›ç¨‹æ— æ³•è·å–é”</span></span><br><span class="line">                self._client.expire(self._lock_name, self._time_out)</span><br><span class="line">                <span class="keyword">return</span> identifier</span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> <span class="keyword">not</span> self._client.ttl(self._lock_name):</span><br><span class="line">                self._client.expire(self._lock_name, self._time_out)</span><br><span class="line">            time.sleep(<span class="number">0.001</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">release</span><span class="params">(self, identifier)</span>:</span></span><br><span class="line">        pipe = self._client.pipeline(<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># ç”¨äºç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œ</span></span><br><span class="line">                <span class="comment"># å¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­</span></span><br><span class="line">                pipe.watch(self._lock_name)</span><br><span class="line">                lock_value = self._client.get(self._lock_name)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> lock_value:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># åŸå­å¤„ç†, åˆ é™¤åŠ é”å€¼</span></span><br><span class="line">                <span class="keyword">if</span> lock_value.decode() == identifier:</span><br><span class="line">                    <span class="comment"># ç”¨äºæ ‡è®°ä¸€ä¸ªäº‹åŠ¡å—çš„å¼€å§‹</span></span><br><span class="line">                    pipe.multi()</span><br><span class="line">                    <span class="comment"># åˆ é™¤ç”¨æ¥åŠ é”çš„å€¼</span></span><br><span class="line">                    pipe.delete(self._lock_name)</span><br><span class="line">                    <span class="comment"># äº‹åŠ¡å—å†…çš„å¤šæ¡å‘½ä»¤ä¼šæŒ‰ç…§å…ˆåé¡ºåºè¢«æ”¾è¿›ä¸€ä¸ªé˜Ÿåˆ—å½“ä¸­ï¼Œæœ€åç”± EXEC å‘½ä»¤åŸå­æ€§(atomic)åœ°æ‰§è¡Œã€‚</span></span><br><span class="line">                    pipe.execute()</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">                pipe.unwatch()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> redis.exceptions.WatchError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">count = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(thread_name)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> count</span><br><span class="line"></span><br><span class="line">    client = redis.Redis(host=<span class="string">"localhost"</span>, port=<span class="number">6379</span>, db=<span class="number">10</span>)</span><br><span class="line">    lock = RedisLock(client, <span class="string">"test-redis-lock"</span>)</span><br><span class="line"></span><br><span class="line">    identifier = lock.acquire()</span><br><span class="line">    print(<span class="string">"çº¿ç¨‹:&#123;&#125;è·å–äº†é”"</span>.format(thread_name))</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> count &lt; <span class="number">1</span>:</span><br><span class="line">        print(<span class="string">"çº¿ç¨‹:&#123;&#125;çš„countå€¼å°äº1äº†"</span>.format(thread_name))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    count -= <span class="number">1</span></span><br><span class="line">    print(<span class="string">"çº¿ç¨‹:&#123;&#125;æŠ¢åˆ°äº†ç¥¨, è¿˜å‰©ä¸‹&#123;&#125;å¼ ç¥¨"</span>.format(thread_name, count))</span><br><span class="line">    lock.release(identifier)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    threads = [Thread(target=test, args=(<span class="string">"thread-&#123;&#125;"</span>.format(i),)) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>)]</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">        t.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">        t.join()</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶, è¿™ä¸ªæ˜¯è‡ªå·±æ‰‹åŠ¨å®ç°çš„.<br>å¾€ä¸Šä¹Ÿå·²ç»æœ‰å¾ˆå¥½ç”¨çš„ä¸‰æ–¹åº“å¯ä»¥ç›´æ¥ä½¿ç”¨äº†.<br><a href="https://pypi.org/project/python-redis-lock/" target="_blank" rel="noopener">python-redis-lock 3.7.0
</a></p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://zhuanlan.zhihu.com/p/112016634" target="_blank" rel="noopener">Python ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”</a><br><a href="https://www.cnblogs.com/chengege/p/11074055.html" target="_blank" rel="noopener">Redisåˆ†å¸ƒå¼é”çš„pythonå®ç°</a><br><a href="https://www.cnblogs.com/angelyan/p/11523846.html" target="_blank" rel="noopener">pythonåŸºäºrediså®ç°åˆ†å¸ƒå¼é”</a></p>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
  </entry>
  <entry>
    <title>ä¸‰æ–¹åº“æ¨è</title>
    <url>/2021/02/24/%E4%B8%89%E6%96%B9%E5%BA%93%E6%8E%A8%E8%8D%90/</url>
    <content><![CDATA[<h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p><a href="https://pypi.org/project/python-redis-lock/" target="_blank" rel="noopener">python-redis-lock 3.7.0, redisåˆ†å¸ƒå¼é”</a></p>
]]></content>
  </entry>
  <entry>
    <title>[è½¬]Linux --- åˆ©ç”¨ Linux æŒ‡ä»¤åˆ†æ Web æ—¥å¿—</title>
    <url>/2021/02/24/%E8%BD%AC-%E5%88%A9%E7%94%A8-Linux-%E6%8C%87%E4%BB%A4%E5%88%86%E6%9E%90-Web-%E6%97%A5%E5%BF%97/</url>
    <content><![CDATA[<h3 id="è½¬è½½"><a href="#è½¬è½½" class="headerlink" title="è½¬è½½"></a>è½¬è½½</h3><p><a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=478#/detail/pc?id=4617" target="_blank" rel="noopener">é«˜çº§æŠ€å·§ä¹‹æ—¥å¿—åˆ†æï¼šåˆ©ç”¨ Linux æŒ‡ä»¤åˆ†æ Web æ—¥å¿—</a></p>
<h3 id="ç¬¬ä¸€æ­¥ï¼šèƒ½ä¸èƒ½è¿™æ ·åšï¼Ÿ"><a href="#ç¬¬ä¸€æ­¥ï¼šèƒ½ä¸èƒ½è¿™æ ·åšï¼Ÿ" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šèƒ½ä¸èƒ½è¿™æ ·åšï¼Ÿ"></a>ç¬¬ä¸€æ­¥ï¼šèƒ½ä¸èƒ½è¿™æ ·åšï¼Ÿ</h3><p>å½“æˆ‘ä»¬æƒ³è¦åˆ†æä¸€ä¸ªçº¿ä¸Šæ–‡ä»¶çš„æ—¶å€™ï¼Œé¦–å…ˆè¦æ€è€ƒï¼Œèƒ½ä¸èƒ½è¿™æ ·åšï¼Ÿ è¿™é‡Œä½ å¯ä»¥å…ˆç”¨<code>htop</code>æŒ‡ä»¤çœ‹ä¸€ä¸‹å½“å‰çš„è´Ÿè½½ã€‚å¦‚æœä½ çš„æœºå™¨ä¸Šæ²¡æœ‰<code>htop</code>ï¼Œå¯ä»¥è€ƒè™‘ç”¨<code>yum</code>æˆ–è€…<code>apt</code>å»å®‰è£…ã€‚<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210224220935.png" alt=""></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘çš„æœºå™¨ä¸Š 8 ä¸ª CPU éƒ½æ˜¯ 0 è´Ÿè½½ï¼Œ2Gçš„å†…å­˜ç”¨äº†ä¸€åŠå¤šï¼Œè¿˜æœ‰å¯Œä½™ã€‚ æˆ‘ä»¬ç”¨<code>wget</code>å°†ç›®æ ‡æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼ˆå¦‚æœä½ æ²¡æœ‰ wgetï¼Œå¯ä»¥ç”¨yumæˆ–è€…aptå®‰è£…ï¼‰ã€‚</p>
<blockquote>
<pre><code>wget æŸç½‘å€ï¼ˆè‡ªå·±æ›¿ä»£ï¼‰</code></pre></blockquote>
<p>ç„¶åæˆ‘ä»¬ç”¨lsæŸ¥çœ‹æ–‡ä»¶å¤§å°ã€‚å‘ç°è¿™åªæ˜¯ä¸€ä¸ª 7M çš„æ–‡ä»¶ï¼Œå› æ­¤å¯¹çº¿ä¸Šçš„å½±å“å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚å¦‚æœæ–‡ä»¶å¤ªå¤§ï¼Œå»ºè®®ä½ ç”¨scpæŒ‡ä»¤å°†æ–‡ä»¶æ‹·è´åˆ°é—²ç½®æœåŠ¡å™¨å†åˆ†æã€‚ä¸‹å›¾ä¸­æˆ‘ä½¿ç”¨äº†<code>--block-size</code>è®©<code>ls</code>ä»¥<code>M</code>ä¸ºå•ä½æ˜¾ç¤ºæ–‡ä»¶å¤§å°ã€‚<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210224221141.png" alt=""><br>ç¡®å®šäº†å½“å‰æœºå™¨çš„CPUå’Œå†…å­˜å…è®¸æˆ‘è¿›è¡Œåˆ†æåï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ç¬¬äºŒæ­¥æ“ä½œäº†ã€‚</p>
<h3 id="ç¬¬äºŒæ­¥ï¼šLESS-æ—¥å¿—æ–‡ä»¶"><a href="#ç¬¬äºŒæ­¥ï¼šLESS-æ—¥å¿—æ–‡ä»¶" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šLESS æ—¥å¿—æ–‡ä»¶"></a>ç¬¬äºŒæ­¥ï¼šLESS æ—¥å¿—æ–‡ä»¶</h3><p>åœ¨åˆ†ææ—¥å¿—å‰ï¼Œç»™ä½ æä¸ªé†’ï¼Œè®°å¾—è¦<code>less</code>ä¸€ä¸‹ï¼Œçœ‹çœ‹æ—¥å¿—é‡Œé¢çš„å†…å®¹ã€‚ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œå°½é‡ä½¿ç”¨<code>less</code>è¿™ç§ä¸éœ€è¦è¯»å–å…¨éƒ¨æ–‡ä»¶çš„æŒ‡ä»¤ï¼Œå› ä¸ºåœ¨çº¿ä¸Šæ‰§è¡Œ<code>cat</code>æ˜¯ä¸€ä»¶éå¸¸å±é™©çš„äº‹æƒ…ï¼Œè¿™å¯èƒ½å¯¼è‡´çº¿ä¸ŠæœåŠ¡å™¨èµ„æºä¸è¶³ã€‚<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210224221407.png" alt=""><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬çœ‹åˆ°<code>nginx</code>çš„<code>access_log</code>æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€æ¬¡ç”¨æˆ·çš„è®¿é—®ï¼Œä»å·¦åˆ°å³ä¾æ¬¡æ˜¯ï¼š</p>
<ul>
<li>IP åœ°å€ï¼›</li>
<li>æ—¶é—´ï¼›</li>
<li>HTTP è¯·æ±‚çš„æ–¹æ³•ã€è·¯å¾„å’Œåè®®ç‰ˆæœ¬ã€è¿”å›çš„çŠ¶æ€ç ï¼›</li>
<li>User Agentã€‚</li>
</ul>
<a id="more"></a>

<h3 id="ç¬¬ä¸‰æ­¥ï¼šPV-åˆ†æ"><a href="#ç¬¬ä¸‰æ­¥ï¼šPV-åˆ†æ" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šPV åˆ†æ"></a>ç¬¬ä¸‰æ­¥ï¼šPV åˆ†æ</h3><p><code>PVï¼ˆPage Viewï¼‰</code>ï¼Œç”¨æˆ·æ¯è®¿é—®ä¸€ä¸ªé¡µé¢å°±æ˜¯ä¸€æ¬¡Page Viewã€‚å¯¹äºnginxçš„acess_logæ¥è¯´ï¼Œåˆ†æ PV éå¸¸ç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨<code>wc -l</code>å°±å¯ä»¥çœ‹åˆ°æ•´ä½“çš„<code>PV</code>ã€‚<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210224221531.png" alt=""><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šæˆ‘ä»¬çœ‹åˆ°äº†ä¸€å…±æœ‰ 51462 æ¡ PVã€‚</p>
<h3 id="ç¬¬å››æ­¥ï¼šPV-åˆ†ç»„"><a href="#ç¬¬å››æ­¥ï¼šPV-åˆ†ç»„" class="headerlink" title="ç¬¬å››æ­¥ï¼šPV åˆ†ç»„"></a>ç¬¬å››æ­¥ï¼šPV åˆ†ç»„</h3><p>é€šå¸¸ä¸€ä¸ªæ—¥å¿—ä¸­å¯èƒ½æœ‰å‡ å¤©çš„ PVï¼Œä¸ºäº†å¾—åˆ°æ›´åŠ ç›´è§‚çš„æ•°æ®ï¼Œæœ‰æ—¶å€™éœ€è¦æŒ‰å¤©è¿›è¡Œåˆ†ç»„ã€‚ä¸ºäº†ç®€åŒ–è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ—¥å¿—ä¸­éƒ½æœ‰å“ªäº›å¤©çš„æ—¥å¿—ã€‚</p>
<p>ä½¿ç”¨<code>awk &#39;{print $4}&#39; access.log  | less</code>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœã€‚<code>awk</code>æ˜¯ä¸€ä¸ªå¤„ç†æ–‡æœ¬çš„é¢†åŸŸä¸“æœ‰è¯­è¨€ã€‚è¿™é‡Œå°±ç‰µæ‰¯åˆ°é¢†åŸŸä¸“æœ‰è¯­è¨€è¿™ä¸ªæ¦‚å¿µï¼Œè‹±æ–‡æ˜¯Domain Specific Languageã€‚é¢†åŸŸä¸“æœ‰è¯­è¨€ï¼Œå°±æ˜¯ä¸ºäº†å¤„ç†æŸä¸ªé¢†åŸŸä¸“é—¨è®¾è®¡çš„è¯­è¨€ã€‚æ¯”å¦‚awkæ˜¯ç”¨æ¥åˆ†æå¤„ç†æ–‡æœ¬çš„DSLï¼Œhtmlæ˜¯ä¸“é—¨ç”¨æ¥æè¿°ç½‘é¡µçš„DSLï¼ŒSQLæ˜¯ä¸“é—¨ç”¨æ¥æŸ¥è¯¢æ•°æ®çš„DSLâ€¦â€¦å¤§å®¶è¿˜å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡è®¾è®¡æŸç§é’ˆå¯¹ä¸šåŠ¡çš„DSLã€‚</p>
<p>ä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç”¨<code>$4</code>ä»£è¡¨æ–‡æœ¬çš„ç¬¬ 4 åˆ—ï¼Œä¹Ÿå°±æ˜¯æ—¶é—´æ‰€åœ¨çš„è¿™ä¸€åˆ—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210224221707.png" alt=""><br>æˆ‘ä»¬æƒ³è¦æŒ‰å¤©ç»Ÿè®¡ï¼Œå¯ä»¥åˆ©ç”¨ awkæä¾›çš„å­—ç¬¦ä¸²æˆªå–çš„èƒ½åŠ›ã€‚<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210224221724.png" alt=""><br>ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>awk</code>çš„<code>substr</code>å‡½æ•°ï¼Œæ•°å­—<code>2</code>ä»£è¡¨ä»ç¬¬ 2 ä¸ªå­—ç¬¦å¼€å§‹ï¼Œæ•°å­—11ä»£è¡¨æˆªå– 11 ä¸ªå­—ç¬¦ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åˆ†ç»„ç»Ÿè®¡æ¯å¤©çš„æ—¥å¿—æ¡æ•°äº†ã€‚<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210224221752.png" alt=""></p>
<p>ä¸Šå›¾ä¸­ï¼Œä½¿ç”¨<code>sort</code>è¿›è¡Œæ’åºï¼Œç„¶åä½¿ç”¨<code>uniq -c</code>è¿›è¡Œç»Ÿè®¡ã€‚ä½ å¯ä»¥çœ‹åˆ°ä» 2015 å¹´ 5 æœˆ 17 å·ä¸€ç›´åˆ° 6 æœˆ 4 å·çš„æ—¥å¿—ï¼Œè¿˜å¯ä»¥çœ‹åˆ°æ¯å¤©çš„ PV é‡å¤§æ¦‚æ˜¯åœ¨ 2000~3000 ä¹‹é—´ã€‚</p>
<h3 id="ç¬¬äº”æ­¥ï¼šåˆ†æ-UV"><a href="#ç¬¬äº”æ­¥ï¼šåˆ†æ-UV" class="headerlink" title="ç¬¬äº”æ­¥ï¼šåˆ†æ UV"></a>ç¬¬äº”æ­¥ï¼šåˆ†æ UV</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æ UVã€‚<code>UVï¼ˆUniq Visitorï¼‰</code>ï¼Œä¹Ÿå°±æ˜¯ç»Ÿè®¡è®¿é—®äººæ•°ã€‚é€šå¸¸ç¡®å®šç”¨æˆ·çš„èº«ä»½æ˜¯ä¸€ä¸ªå¤æ‚çš„äº‹æƒ…ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨ <code>IP</code> è®¿é—®æ¥è¿‘ä¼¼ç»Ÿè®¡ UVã€‚<br><a href="https://s0.lgstatic.com/i/image/M00/5C/74/Ciqc1F-BkNeAam2YAACxCjlKsvc488.png" target="_blank" rel="noopener">https://s0.lgstatic.com/i/image/M00/5C/74/Ciqc1F-BkNeAam2YAACxCjlKsvc488.png</a><br><img src="/images/pasted-1.png" alt="upload successful"></p>
<p>ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>awk</code> å»æ‰“å°<code>$1</code>ä¹Ÿå°±æ˜¯ç¬¬ä¸€åˆ—ï¼Œæ¥ç€<code>sort</code>æ’åºï¼Œç„¶åç”¨uniqå»é‡ï¼Œæœ€åç”¨<code>wc -l</code>æŸ¥çœ‹æ¡æ•°ã€‚ è¿™æ ·æˆ‘ä»¬å°±çŸ¥é“æ—¥å¿—æ–‡ä»¶ä¸­ä¸€å…±æœ‰2660ä¸ª IPï¼Œä¹Ÿå°±æ˜¯2660ä¸ª UVã€‚</p>
<h3 id="ç¬¬å…­æ­¥ï¼šåˆ†ç»„åˆ†æ-UV"><a href="#ç¬¬å…­æ­¥ï¼šåˆ†ç»„åˆ†æ-UV" class="headerlink" title="ç¬¬å…­æ­¥ï¼šåˆ†ç»„åˆ†æ UV"></a>ç¬¬å…­æ­¥ï¼šåˆ†ç»„åˆ†æ UV</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•æŒ‰å¤©åˆ†ç»„åˆ†ææ¯å¤©çš„ UV æƒ…å†µã€‚è¿™ä¸ªæƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦è¾ƒå¤šçš„æŒ‡ä»¤ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªå«ä½œsum.shçš„bashè„šæœ¬æ–‡ä»¶ï¼Œå†™å…¥å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/usr/bin/bash</span></span><br><span class="line">awk '&#123;print substr($4, 2, 11) " " $1&#125;' access.log |\</span><br><span class="line">    sort | uniq |\</span><br><span class="line">    awk '&#123;uv[$1]++;next&#125;END&#123;for (ip in uv) print ip, uv[ip]&#125;'</span><br></pre></td></tr></table></figure>
<p>å…·ä½“åˆ†æå¦‚ä¸‹ã€‚</p>
<ul>
<li>æ–‡ä»¶é¦–éƒ¨æˆ‘ä»¬ä½¿ç”¨#!ï¼Œè¡¨ç¤ºæˆ‘ä»¬å°†ä½¿ç”¨åé¢çš„/usr/bin/bashæ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚</li>
<li>ç¬¬ä¸€æ¬¡awkæˆ‘ä»¬å°†ç¬¬ 4 åˆ—çš„æ—¥æœŸå’Œç¬¬ 1 åˆ—çš„ipåœ°å€æ‹¼æ¥åœ¨ä¸€èµ·ã€‚</li>
<li>ä¸‹é¢çš„sortæ˜¯æŠŠæ•´ä¸ªæ–‡ä»¶è¿›è¡Œä¸€æ¬¡å­—å…¸åºæ’åºï¼Œç›¸å½“äºå…ˆæ ¹æ®æ—¥æœŸæ’åºï¼Œå†æ ¹æ® IP æ’åºã€‚</li>
<li>æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨uniqå»é‡ï¼Œæ—¥æœŸ +IP ç›¸åŒçš„è¡Œå°±åªä¿ç•™ä¸€ä¸ªã€‚</li>
<li>æœ€åçš„awkæˆ‘ä»¬å†æ ¹æ®ç¬¬ 1 åˆ—çš„æ—¶é—´å’Œç¬¬ 2 åˆ—çš„ IP è¿›è¡Œç»Ÿè®¡ã€‚</li>
</ul>
<p>ä¸ºäº†ç†è§£æœ€åè¿™ä¸€è¡Œæè¿°ï¼Œæˆ‘ä»¬å…ˆæ¥ç®€å•äº†è§£ä¸‹<code>awk</code>çš„åŸç†ã€‚</p>
<p><code>awk</code>æœ¬èº«æ˜¯é€è¡Œè¿›è¡Œå¤„ç†çš„ã€‚å› æ­¤æˆ‘ä»¬çš„<code>next</code>å…³é”®å­—æ˜¯æé†’<code>awk</code>è·³è½¬åˆ°ä¸‹ä¸€è¡Œè¾“å…¥ã€‚ å¯¹æ¯ä¸€è¡Œè¾“å…¥ï¼Œawkä¼šæ ¹æ®ç¬¬ 1 åˆ—çš„å­—ç¬¦ä¸²ï¼ˆä¹Ÿå°±æ˜¯æ—¥æœŸï¼‰è¿›è¡Œç´¯åŠ ã€‚ä¹‹åçš„<code>END</code>å…³é”®å­—ä»£è¡¨ä¸€ä¸ªè§¦å‘å™¨ï¼Œå°±æ˜¯ END åé¢ç”¨ {} æ‹¬èµ·æ¥çš„è¯­å¥ä¼šåœ¨æ‰€æœ‰è¾“å…¥éƒ½å¤„ç†å®Œä¹‹åæ‰§è¡Œâ€”â€”å½“æ‰€æœ‰è¾“å…¥éƒ½æ‰§è¡Œå®Œï¼Œç»“æœè¢«ç´¯åŠ åˆ°<code>uv</code>ä¸­åï¼Œé€šè¿‡<code>foreach</code>éå†<code>uv</code>ä¸­æ‰€æœ‰çš„<code>key</code>ï¼Œå»æ‰“å°<code>ip</code>å’Œ<code>ipå¯¹åº”çš„æ•°é‡</code>ã€‚</p>
<p>ç¼–å†™å®Œä¸Šé¢çš„è„šæœ¬ä¹‹åï¼Œæˆ‘ä»¬ä¿å­˜é€€å‡ºç¼–è¾‘å™¨ã€‚æ¥ç€æ‰§è¡Œ<code>chmod +x ./sum.sh</code>ï¼Œç»™<code>sum.sh</code>å¢åŠ æ‰§è¡Œæƒé™ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥åƒä¸‹å›¾è¿™æ ·æ‰§è¡Œï¼Œè·å¾—ç»“æœï¼š<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20210224222148.png" alt=""></p>
<p>å¦‚ä¸Šå›¾ï¼ŒIPåœ°å€å·²ç»æŒ‰å¤©è¿›è¡Œç»Ÿè®¡å¥½äº†ã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- åˆå¹¶åŒºé—´</title>
    <url>/2021/02/02/leetcode-%E5%90%88%E5%B9%B6%E5%8C%BA%E9%97%B4/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/merge-intervals/" target="_blank" rel="noopener">åˆå¹¶åŒºé—´</a></p>
<p>ä»¥æ•°ç»„ intervals è¡¨ç¤ºè‹¥å¹²ä¸ªåŒºé—´çš„é›†åˆï¼Œå…¶ä¸­å•ä¸ªåŒºé—´ä¸º intervals[i] = [starti, endi] ã€‚è¯·ä½ åˆå¹¶æ‰€æœ‰é‡å çš„åŒºé—´ï¼Œå¹¶è¿”å›ä¸€ä¸ªä¸é‡å çš„åŒºé—´æ•°ç»„ï¼Œè¯¥æ•°ç»„éœ€æ°å¥½è¦†ç›–è¾“å…¥ä¸­çš„æ‰€æœ‰åŒºé—´ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šintervals &#x3D; [[1,3],[2,6],[8,10],[15,18]]</span><br><span class="line">è¾“å‡ºï¼š[[1,6],[8,10],[15,18]]</span><br><span class="line">è§£é‡Šï¼šåŒºé—´ [1,3] å’Œ [2,6] é‡å , å°†å®ƒä»¬åˆå¹¶ä¸º [1,6].</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šintervals &#x3D; [[1,4],[4,5]]</span><br><span class="line">è¾“å‡ºï¼š[[1,5]]</span><br><span class="line">è§£é‡Šï¼šåŒºé—´ [1,4] å’Œ [4,5] å¯è¢«è§†ä¸ºé‡å åŒºé—´ã€‚</span><br></pre></td></tr></table></figure>

<p>æç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 &lt;&#x3D; intervals.length &lt;&#x3D; 10^4</span><br><span class="line">intervals[i].length &#x3D;&#x3D; 2</span><br><span class="line">0 &lt;&#x3D; starti &lt;&#x3D; endi &lt;&#x3D; 10^4</span><br></pre></td></tr></table></figure>

<h3 id="è§£ç­”"><a href="#è§£ç­”" class="headerlink" title="è§£ç­”"></a>è§£ç­”</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(self, intervals)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type intervals: List[List[int]]</span></span><br><span class="line"><span class="string">        :rtype: List[List[int]]</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        intervals = sorted(intervals, key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>])</span><br><span class="line">        current = intervals[<span class="number">0</span>]</span><br><span class="line">        rv = list()</span><br><span class="line">        <span class="keyword">for</span> inter <span class="keyword">in</span> intervals[<span class="number">1</span>:]:</span><br><span class="line">            <span class="comment"># å¦‚æœæ— æ³•åˆå¹¶çš„è¯, é‚£ä¹ˆå°†å‰ä¸€ä¸ªåŒºé—´æ”¾å…¥åˆ—è¡¨</span></span><br><span class="line">            <span class="comment"># currentç§»åŠ¨åˆ°åä¸€ä¸ªåŒºé—´ä¸Š</span></span><br><span class="line">            <span class="keyword">if</span> current[<span class="number">1</span>] &lt; inter[<span class="number">0</span>]:</span><br><span class="line">                rv.append(current)</span><br><span class="line">                current = inter</span><br><span class="line">            <span class="comment"># å‰ä¸€ä¸ªåŒºé—´çš„è¾ƒå¤§å€¼, åœ¨åä¸€ä¸ªåŒºé—´èŒƒå›´å†…</span></span><br><span class="line">            <span class="comment"># åˆå¹¶ä¸¤ä¸ªåŒºé—´, ä½†æ­¤æ—¶ä¸å°†currentæ”¾å…¥åˆ—è¡¨, éœ€è¦ç»§ç»­åˆå¹¶</span></span><br><span class="line">            <span class="keyword">elif</span> inter[<span class="number">0</span>] &lt;= current[<span class="number">1</span>] &lt;= inter[<span class="number">1</span>]:</span><br><span class="line">                current = [current[<span class="number">0</span>], inter[<span class="number">1</span>]]</span><br><span class="line">            <span class="comment"># å‰ä¸€ä¸ªåŒºé—´åŒ…æ‹¬äº†åä¸€ä¸ªåŒºé—´, ä¸åšå¤„ç†</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        rv.append(current)</span><br><span class="line">        <span class="keyword">return</span> rv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    i = [[<span class="number">1</span>, <span class="number">3</span>], [<span class="number">2</span>, <span class="number">6</span>], [<span class="number">8</span>, <span class="number">10</span>], [<span class="number">15</span>, <span class="number">18</span>]]</span><br><span class="line">    s = Solution()</span><br><span class="line">    print(s.merge(i))</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>æ•°æ®ç»“æ„ --- æœ€å°æ ˆçš„å®ç°</title>
    <url>/2021/01/31/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E6%9C%80%E5%B0%8F%E6%A0%88%E7%9A%84%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<p>é¢˜ç›®:<br>å®ç°ä¸€ä¸ªæ ˆ, è¯¥æ ˆå¸¦æœ‰å‡ºæ ˆ(pop), å…¥æ ˆ(push), å–æœ€å°å…ƒç´ (get_min)ä¸‰ä¸ªæ–¹æ³•, å¹¶ä¸”ä¿è¯ä¸‰ä¸ªæ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1).<br>æ³¨: åªæ˜¯éœ€è¦é€šè¿‡get_minè·å–åˆ°æœ€å°å…ƒç´ , å¹¶ä¸æ˜¯è¯´popå‡ºæ¥çš„è¦æ˜¯æœ€å°å…ƒç´ .</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    æœ€å°æ ˆçš„å®ç°</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># ä¸»æ ˆ, å­˜å‚¨æ‰€æœ‰æ•°æ®</span></span><br><span class="line">        self.stack = list()</span><br><span class="line">        <span class="comment"># è¾…åŠ©æ ˆ, ä¿å­˜æœ€å°å€¼åˆ—è¡¨</span></span><br><span class="line">        self.bak_stack = list()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, element)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å…¥æ ˆ</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> len(self.stack) == <span class="number">0</span>:</span><br><span class="line">            self.stack.append(element)</span><br><span class="line">            self.bak_stack.append(element)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        self.stack.append(element)</span><br><span class="line">        <span class="comment"># æ ˆé¡¶å…ƒç´ </span></span><br><span class="line">        top = self.bak_stack[<span class="number">-1</span>]</span><br><span class="line">        <span class="comment"># å¦‚æœè¾…åŠ©æ ˆçš„æ ˆé¡¶å…ƒç´ å¤§äºå…¥èŒå…ƒç´ , é‚£ä¹ˆå°±è¯´æ˜å…¥æ ˆå…ƒç´ æ˜¯æ–°çš„æœ€å°å€¼</span></span><br><span class="line">        <span class="comment"># æ”¾å…¥è¾…åŠ©æ ˆçš„æ ˆé¡¶</span></span><br><span class="line">        <span class="keyword">if</span> top &gt;= element:</span><br><span class="line">            self.bak_stack.append(element)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len(self.stack) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        top = self.stack.pop(<span class="number">-1</span>)</span><br><span class="line">        <span class="comment"># å¦‚æœå½“å‰ä¸»æ ˆçš„æ ˆé¡¶å…ƒç´ å’Œè¾…åŠ©æ ˆçš„ä¸€è‡´, é‚£ä¹ˆä¹Ÿéœ€è¦å°†è¾…åŠ©æ ˆçš„æ ˆé¡¶popæ‰</span></span><br><span class="line">        <span class="keyword">if</span> top == self.bak_stack[<span class="number">-1</span>]:</span><br><span class="line">            self.bak_stack.pop(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> top</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_min</span><span class="params">(self)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len(self.bak_stack) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è·å–æœ€å°å…ƒç´ æ—¶, ç›´æ¥ä»è¾…åŠ©æ ˆä¸­è·å–</span></span><br><span class="line">        <span class="keyword">return</span> self.bak_stack[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_print</span><span class="params">(_ms: MinStack)</span>:</span></span><br><span class="line">    print(<span class="string">"æŠ›å‡ºæ ˆé¡¶å…ƒç´ : %s, å½“å‰æ•°ç»„: %s, æœ€å°å…ƒç´ : %s"</span> % (_ms.pop(), _ms.stack, _ms.get_min()))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    array = [random.randint(<span class="number">0</span>, <span class="number">100</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">7</span>)]</span><br><span class="line">    array.append(array[<span class="number">3</span>])</span><br><span class="line">    array.append(<span class="number">-1</span>)</span><br><span class="line">    array.append(array[<span class="number">4</span>])</span><br><span class="line">    array.append(<span class="number">-1</span>)</span><br><span class="line">    print(<span class="string">"åˆå§‹åŒ–æ•°ç»„: "</span>, array)</span><br><span class="line">    ms = MinStack()</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> array:</span><br><span class="line">        ms.push(a)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(len(array)):</span><br><span class="line">        _print(ms)</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åˆå§‹åŒ–æ•°ç»„:  [80, 65, 4, 52, 90, 37, 70, 52, -1, 90, -1]</span><br><span class="line">æŠ›å‡ºæ ˆé¡¶å…ƒç´ : -1, å½“å‰æ•°ç»„: [80, 65, 4, 52, 90, 37, 70, 52, -1, 90], æœ€å°å…ƒç´ : -1</span><br><span class="line">æŠ›å‡ºæ ˆé¡¶å…ƒç´ : 90, å½“å‰æ•°ç»„: [80, 65, 4, 52, 90, 37, 70, 52, -1], æœ€å°å…ƒç´ : -1</span><br><span class="line">æŠ›å‡ºæ ˆé¡¶å…ƒç´ : -1, å½“å‰æ•°ç»„: [80, 65, 4, 52, 90, 37, 70, 52], æœ€å°å…ƒç´ : 4</span><br><span class="line">æŠ›å‡ºæ ˆé¡¶å…ƒç´ : 52, å½“å‰æ•°ç»„: [80, 65, 4, 52, 90, 37, 70], æœ€å°å…ƒç´ : 4</span><br><span class="line">æŠ›å‡ºæ ˆé¡¶å…ƒç´ : 70, å½“å‰æ•°ç»„: [80, 65, 4, 52, 90, 37], æœ€å°å…ƒç´ : 4</span><br><span class="line">æŠ›å‡ºæ ˆé¡¶å…ƒç´ : 37, å½“å‰æ•°ç»„: [80, 65, 4, 52, 90], æœ€å°å…ƒç´ : 4</span><br><span class="line">æŠ›å‡ºæ ˆé¡¶å…ƒç´ : 90, å½“å‰æ•°ç»„: [80, 65, 4, 52], æœ€å°å…ƒç´ : 4</span><br><span class="line">æŠ›å‡ºæ ˆé¡¶å…ƒç´ : 52, å½“å‰æ•°ç»„: [80, 65, 4], æœ€å°å…ƒç´ : 4</span><br><span class="line">æŠ›å‡ºæ ˆé¡¶å…ƒç´ : 4, å½“å‰æ•°ç»„: [80, 65], æœ€å°å…ƒç´ : 65</span><br><span class="line">æŠ›å‡ºæ ˆé¡¶å…ƒç´ : 65, å½“å‰æ•°ç»„: [80], æœ€å°å…ƒç´ : 80</span><br><span class="line">æŠ›å‡ºæ ˆé¡¶å…ƒç´ : 80, å½“å‰æ•°ç»„: [], æœ€å°å…ƒç´ : None</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]Django --- QuerySetç‰¹æ€§åŠé«˜çº§ä½¿ç”¨æŠ€å·§ï¼Œå¦‚ä½•å‡å°‘æ•°æ®åº“çš„è®¿é—®</title>
    <url>/2021/01/30/django-QuerySet%E7%89%B9%E6%80%A7%E5%8F%8A%E9%AB%98%E7%BA%A7%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%EF%BC%8C%E5%A6%82%E4%BD%95%E5%87%8F%E5%B0%91%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BF%E9%97%AE/</url>
    <content><![CDATA[<h3 id="è½¬è½½"><a href="#è½¬è½½" class="headerlink" title="è½¬è½½"></a>è½¬è½½</h3><p><a href="https://mp.weixin.qq.com/s/OyJy6Do4_4eA7tMXU0NlZQ" target="_blank" rel="noopener">QuerySetç‰¹æ€§åŠé«˜çº§ä½¿ç”¨æŠ€å·§ï¼Œå¦‚ä½•å‡å°‘æ•°æ®åº“çš„è®¿é—®ï¼ŒèŠ‚çœå†…å­˜ï¼Œæå‡ç½‘ç«™æ€§èƒ½ã€‚</a></p>
<h3 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h3><p>å¯¹äºä¸­å¤§å‹ç½‘ç«™æˆ–Web APPè€Œè¨€ï¼Œæœ€å½±å“ç½‘ç«™æ€§èƒ½çš„å°±æ˜¯æ•°æ®åº“æŸ¥è¯¢éƒ¨åˆ†äº†ã€‚ä¸€æ˜¯å› ä¸ºåå¤ä»æ•°æ®åº“è¯»å†™æ•°æ®å¾ˆæ¶ˆè€—æ—¶é—´å’Œè®¡ç®—èµ„æºï¼ŒäºŒæ˜¯å½“è¿”å›çš„æŸ¥è¯¢æ•°æ®é›†querysetéå¸¸å¤§æ—¶è¿˜ä¼šå æ®å¾ˆå¤šå†…å­˜ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯QuerySet"><a href="#ä»€ä¹ˆæ˜¯QuerySet" class="headerlink" title="ä»€ä¹ˆæ˜¯QuerySet"></a>ä»€ä¹ˆæ˜¯QuerySet</h3><p>QuerySetæ˜¯Djangoæä¾›çš„å¼ºå¤§çš„æ•°æ®åº“æ¥å£(API)ã€‚æ­£æ˜¯å› ä¸ºé€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨filter, exclude, getç­‰æ–¹æ³•è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨åŸå§‹çš„SQLè¯­è¨€ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ã€‚ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥çš„ç»“æœä¸€èˆ¬æ˜¯ä¸€ä¸ªé›†åˆï¼Œè¿™ä¸ªé›†åˆå«å°±åš querysetã€‚</p>
<h3 id="Djangoçš„QuerySetæ˜¯æƒ°æ€§çš„"><a href="#Djangoçš„QuerySetæ˜¯æƒ°æ€§çš„" class="headerlink" title="Djangoçš„QuerySetæ˜¯æƒ°æ€§çš„"></a>Djangoçš„QuerySetæ˜¯æƒ°æ€§çš„</h3><p>Djangoçš„QuerySetæ˜¯æƒ°æ€§çš„ã€‚ä¸‹ä¾‹ä¸­article_listè¯•å›¾ä»æ•°æ®åº“æŸ¥è¯¢ä¸€ä¸ªæ ‡é¢˜å«æœ‰djangoçš„å…¨éƒ¨æ–‡ç« åˆ—è¡¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">article_list = Article.objects.filter(title__contains=<span class="string">"django"</span>)</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯å½“æˆ‘ä»¬å®šä¹‰article_listçš„æ—¶å€™ï¼ŒDjangoçš„æ•°æ®æ¥å£QuerySetå¹¶æ²¡æœ‰å¯¹æ•°æ®åº“è¿›è¡Œä»»ä½•æŸ¥è¯¢ã€‚æ— è®ºä½ åŠ å¤šå°‘è¿‡æ»¤æ¡ä»¶ï¼ŒDjangoéƒ½ä¸ä¼šå¯¹æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ã€‚åªæœ‰å½“ä½ éœ€è¦å¯¹article_liståšè¿›ä¸€æ­¥è¿ç®—æ—¶ï¼ˆæ¯”å¦‚æ‰“å°å‡ºæŸ¥è¯¢ç»“æœï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œç»Ÿè®¡æŸ¥è¯¢ç»“æœé•¿åº¦)ï¼ŒDjangoæ‰ä¼šçœŸæ­£æ‰§è¡Œå¯¹æ•°æ®åº“çš„æŸ¥è¯¢(è§ä¸‹ä¾‹1)ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºquerysetçš„<code>æ‰§è¡Œ(evaluation)</code>ã€‚Djangoè¿™æ ·è®¾è®¡çš„æœ¬æ„æ˜¯å°½é‡å‡å°‘å¯¹æ•°æ®åº“çš„æ— æ•ˆæ“ä½œï¼Œæ¯”å¦‚æŸ¥è¯¢äº†ç»“æœè€Œä¸ç”¨æ˜¯è®¡ç®—èµ„æºçš„å¾ˆå¤§æµªè´¹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># example 1</span></span><br><span class="line"><span class="keyword">for</span> article <span class="keyword">in</span> article_list:</span><br><span class="line">    print(article.title)</span><br></pre></td></tr></table></figure>


<h3 id="Djangoçš„QuerySetè‡ªå¸¦ç¼“å­˜-Cache"><a href="#Djangoçš„QuerySetè‡ªå¸¦ç¼“å­˜-Cache" class="headerlink" title="Djangoçš„QuerySetè‡ªå¸¦ç¼“å­˜(Cache)"></a>Djangoçš„QuerySetè‡ªå¸¦ç¼“å­˜(Cache)</h3><p>åœ¨ä¾‹1ä¸­ï¼Œå½“ä½ éå†queryset(article_list)æ—¶ï¼Œæ‰€æœ‰åŒ¹é…çš„è®°å½•ä¼šä»æ•°æ®åº“è·å–ã€‚è¿™äº›ç»“æœä¼šè½½å…¥å†…å­˜å¹¶ä¿å­˜åœ¨querysetå†…ç½®çš„cacheä¸­ã€‚è¿™æ ·å¦‚æœä½ å†æ¬¡éå†æˆ–è¯»å–è¿™ä¸ªarticle_listæ—¶ï¼ŒDjangoå°±ä¸éœ€è¦é‡å¤æŸ¥è¯¢äº†ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å‡å°‘å¯¹æ•°æ®åº“çš„æŸ¥è¯¢ã€‚</p>
<p>ä¸‹ä¾‹ä¸­ä¾‹2æ¯”ä¾‹3è¦å¥½ï¼Œå› ä¸ºåœ¨ä½ æ‰“å°æ–‡ç« æ ‡é¢˜åï¼ŒDjangoä¸ä»…æ‰§è¡Œäº†æŸ¥è¯¢ï¼Œè¿˜æŠŠæŸ¥è¯¢åˆ°çš„article_listæ”¾åœ¨äº†ç¼“å­˜é‡Œã€‚è¿™ä¸ªarticle_listæ˜¯å¯ä»¥å¤ç”¨çš„ã€‚ä¾‹3å°±ä¸è¡Œäº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Example 2: Good</span></span><br><span class="line">article_list = Article.objects.filter(title__contains=<span class="string">"django"</span>)</span><br><span class="line"><span class="keyword">for</span> article <span class="keyword">in</span> article_list:</span><br><span class="line">    print(article.title)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example 3: Bad</span></span><br><span class="line"><span class="keyword">for</span> article <span class="keyword">in</span> Article.objects.filter(title__contains=<span class="string">"django"</span>):</span><br><span class="line">    print(article.title)</span><br></pre></td></tr></table></figure>


<h3 id="ç”¨ifä¹Ÿä¼šå¯¼è‡´querysetçš„æ‰§è¡Œ"><a href="#ç”¨ifä¹Ÿä¼šå¯¼è‡´querysetçš„æ‰§è¡Œ" class="headerlink" title="ç”¨ifä¹Ÿä¼šå¯¼è‡´querysetçš„æ‰§è¡Œ"></a>ç”¨ifä¹Ÿä¼šå¯¼è‡´querysetçš„æ‰§è¡Œ</h3><p>ä¸çŸ¥é“ä½ æ³¨æ„åˆ°ä¸Šè¿°ä¾‹2ä¸­æœ‰ä¸ªé—®é¢˜æ²¡æœ‰ï¼Ÿä¸‡ä¸€article_listæ˜¯ä¸ªç©ºæ•°æ®é›†å‘¢? è™½ç„¶forâ€¦.inâ€¦ç”¨åˆ°ç©ºé›†åˆä¸Šä¹Ÿä¸ä¼šå‡ºç°raiseä»€ä¹ˆé”™è¯¯ï¼Œä½†ä¸“ä¸šä¼˜ç§€çš„æˆ‘ä»¬æ€ä¹ˆèƒ½å…è®¸è¿™æ ·çš„ä½çº§äº‹æƒ…å‘ç”Ÿå‘¢ï¼Ÿæœ€å¥½çš„åšæ³•å°±æ˜¯åœ¨loopå‰åŠ ä¸ªifåˆ¤æ–­ï¼ˆä¾‹4ï¼‰ã€‚å› ä¸ºdjangoä¼šå¯¹æ‰§è¡Œè¿‡çš„querysetè¿›è¡Œç¼“å­˜(ifä¹Ÿä¼šå¯¼è‡´querysetæ‰§è¡Œ, ç¼“å­˜article_list)ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨éå†article_listæ—¶ä¸ç”¨æ‹…å¿ƒDjangoä¼šå¯¹æ•°æ®åº“è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Example 4: Good</span></span><br><span class="line">article_list = Article.objects.filter(title__contains=<span class="string">"django"</span>)</span><br><span class="line"><span class="keyword">if</span> article_list:</span><br><span class="line">    <span class="keyword">for</span> article <span class="keyword">in</span> article_list:</span><br><span class="line">        print(article.title)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"No records"</span>)</span><br></pre></td></tr></table></figure>
<p>ä½†æœ‰æ—¶æˆ‘ä»¬åªå¸Œæœ›äº†è§£æŸ¥è¯¢çš„ç»“æœæ˜¯å¦å­˜åœ¨ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨æ•´ä¸ªæ•°æ®é›†ï¼Œè¿™æ—¶ifè§¦å‘æ•´ä¸ªquerysetçš„ç¼“å­˜å˜æˆäº†ä¸€ä»¶åäº‹æƒ…ã€‚å“ï¼Œç¨‹åºå‘˜è¦æ‹…å¿ƒçš„äº‹æƒ…ç€ä¸å°‘ã€‚è¿™æ—¶ä½ å¯ä»¥ç”¨exists()æ–¹æ³•ã€‚ä¸ifåˆ¤æ–­ä¸åŒï¼Œexistsåªä¼šæ£€æŸ¥æŸ¥è¯¢ç»“æœæ˜¯å¦å­˜åœ¨ï¼Œè¿”å›Trueæˆ–Falseï¼Œè€Œä¸ä¼šç¼“å­˜article_list(è§ä¾‹5ï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Example 5: Good</span></span><br><span class="line">article_list = Article.objects.filter(title__contains=<span class="string">"django"</span>)</span><br><span class="line"><span class="keyword">if</span> article_list.exists():</span><br><span class="line">    print(<span class="string">"Records found."</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"No records"</span>)</span><br></pre></td></tr></table></figure>
<p><code>æ³¨æ„</code>: åˆ¤æ–­æŸ¥è¯¢ç»“æœæ˜¯å¦å­˜åœ¨åˆ°åº•ç”¨ifè¿˜æ˜¯existså–å†³äºä½ æ˜¯å¦å¸Œæœ›ç¼“å­˜æŸ¥è¯¢æ•°æ®é›†å¤ç”¨ï¼Œå¦‚æœæ˜¯ç”¨ifï¼Œåä¹‹ç”¨existsã€‚</p>
<h3 id="ç»Ÿè®¡æŸ¥è¯¢ç»“æœæ•°é‡ä¼˜é€‰countæ–¹æ³•"><a href="#ç»Ÿè®¡æŸ¥è¯¢ç»“æœæ•°é‡ä¼˜é€‰countæ–¹æ³•" class="headerlink" title="ç»Ÿè®¡æŸ¥è¯¢ç»“æœæ•°é‡ä¼˜é€‰countæ–¹æ³•"></a>ç»Ÿè®¡æŸ¥è¯¢ç»“æœæ•°é‡ä¼˜é€‰countæ–¹æ³•</h3><p><code>len()</code>ä¸<code>count()</code>å‡èƒ½ç»Ÿè®¡æŸ¥è¯¢ç»“æœçš„æ•°é‡ã€‚ä¸€èˆ¬æ¥è¯´countæ›´å¿«ï¼Œå› ä¸ºå®ƒæ˜¯<code>ä»æ•°æ®åº“å±‚é¢ç›´æ¥è·å–æŸ¥è¯¢ç»“æœçš„æ•°é‡</code>ï¼Œè€Œä¸æ˜¯è¿”å›æ•´ä¸ªæ•°æ®é›†ï¼Œè€Œlenä¼šå¯¼è‡´querysetçš„æ‰§è¡Œï¼Œéœ€è¦å°†æ•´ä¸ªquerysetè½½å…¥å†…å­˜åæ‰èƒ½ç»Ÿè®¡å…¶é•¿åº¦ã€‚ä½†äº‹æƒ…ä¹Ÿæ²¡æœ‰ç»å¯¹ï¼Œå¦‚æœ<code>æ•°æ®é›†querysetå·²ç»åœ¨ç¼“å­˜é‡Œäº†ï¼Œä½¿ç”¨lenæ›´å¿«</code>ï¼Œå› ä¸ºå®ƒä¸éœ€è¦è·Ÿæ•°æ®åº“å†æ¬¡æ‰“äº¤é“ã€‚</p>
<p>ä¸‹é¢ä¸‰ä¸ªä¾‹å­ä¸­ï¼Œåªæœ‰ä¾‹7æœ€å·®ï¼Œå°½é‡ä¸è¦ç”¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Example 6: Good</span></span><br><span class="line">count = Article.objects.filter(title__contains=<span class="string">"django"</span>).count()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example 7:Bad</span></span><br><span class="line">count = Article.objects.filter(title__contains=<span class="string">"django"</span>).len()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example 8: Good</span></span><br><span class="line">article_list = Article.objects.filter(title__contains=<span class="string">"django"</span>)</span><br><span class="line"><span class="keyword">if</span> article_list:</span><br><span class="line">    print(<span class="string">"&#123;&#125; records found."</span>.format(article_list.len()))</span><br></pre></td></tr></table></figure>


<h3 id="å½“querysetéå¸¸å¤§æ—¶ï¼Œæ•°æ®è¯·æŒ‰éœ€å»å–"><a href="#å½“querysetéå¸¸å¤§æ—¶ï¼Œæ•°æ®è¯·æŒ‰éœ€å»å–" class="headerlink" title="å½“querysetéå¸¸å¤§æ—¶ï¼Œæ•°æ®è¯·æŒ‰éœ€å»å–"></a>å½“querysetéå¸¸å¤§æ—¶ï¼Œæ•°æ®è¯·æŒ‰éœ€å»å–</h3><p>å½“æŸ¥è¯¢åˆ°çš„querysetçš„éå¸¸å¤§æ—¶ï¼Œä¼šå¤§é‡å ç”¨å†…å­˜(ç¼“å­˜)ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>values</code>å’Œ<code>value_list</code>æ–¹æ³•æŒ‰éœ€æå–æ•°æ®ã€‚æ¯”å¦‚ä¾‹1ä¸­æˆ‘ä»¬åªéœ€è¦æ‰“å°æ–‡ç« æ ‡é¢˜ï¼Œè¿™æ—¶æˆ‘ä»¬å®Œå…¨æ²¡æœ‰å¿…è¦æŠŠæ¯ç¯‡æ–‡ç« å¯¹è±¡çš„å…¨éƒ¨ä¿¡æ¯éƒ½æå–å‡ºæ¥è½½å…¥åˆ°å†…å­˜ä¸­ã€‚æˆ‘ä»¬å¯ä»¥åšå¦‚ä¸‹æ”¹è¿›ï¼ˆä¾‹9ï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Example 9: Good</span></span><br><span class="line">article_list = Article.objects.filter(title__contains=<span class="string">"django"</span>).values(<span class="string">'title'</span>)</span><br><span class="line"><span class="keyword">if</span> article_list:</span><br><span class="line">    print(article.title)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">article_list = Article.objects.filter(title__contains=<span class="string">"django"</span>).values_list(<span class="string">'id'</span>, <span class="string">'title'</span>)</span><br><span class="line"><span class="keyword">if</span> article_list:</span><br><span class="line">    print(article.title)</span><br></pre></td></tr></table></figure>
<p><code>æ³¨æ„</code>: valueså’Œvalues_listè¿”å›çš„æ˜¯å­—å…¸å½¢å¼å­—ç¬¦ä¸²æ•°æ®ï¼Œè€Œä¸æ˜¯å¯¹è±¡é›†åˆã€‚å¦‚æœä¸ç†è§£è¯·ä¸è¦ä¹±ç”¨ã€‚<br>å¦å¤–è¿˜å¯ä»¥ä½¿ç”¨iterator()æ–¹æ³•å¯ä»¥ä¼˜åŒ–ç¨‹åºå¯¹å†…å­˜çš„ä½¿ç”¨ï¼Œå…¶å·¥ä½œåŸç†æ˜¯ä¸å¯¹querysetè¿›è¡Œç¼“å­˜ï¼Œè€Œæ˜¯é‡‡ç”¨è¿­ä»£æ–¹æ³•é€ä¸€è¿”å›æŸ¥è¯¢ç»“æœï¼Œä½†è¿™æœ‰æ—¶ä¼šå¢åŠ æ•°æ®åº“çš„è®¿é—®æ¬¡æ•°ï¼Œæ–°æ‰‹ä¸€èˆ¬ä¹Ÿé©¾é©­ä¸äº†ã€‚</p>
<h3 id="æ›´æ–°æ•°æ®åº“éƒ¨åˆ†å­—æ®µè¯·ç”¨updateæ–¹æ³•"><a href="#æ›´æ–°æ•°æ®åº“éƒ¨åˆ†å­—æ®µè¯·ç”¨updateæ–¹æ³•" class="headerlink" title="æ›´æ–°æ•°æ®åº“éƒ¨åˆ†å­—æ®µè¯·ç”¨updateæ–¹æ³•"></a>æ›´æ–°æ•°æ®åº“éƒ¨åˆ†å­—æ®µè¯·ç”¨updateæ–¹æ³•</h3><p>å¦‚æœéœ€è¦å¯¹æ•°æ®åº“ä¸­çš„æŸæ¡å·²æœ‰æ•°æ®æˆ–æŸäº›å­—æ®µè¿›è¡Œæ›´æ–°ï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯ç”¨updateï¼Œè€Œä¸æ˜¯saveæ–¹æ³•ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥å¯¹æ¯”ä¸‹é¢ä¸¤ä¸ªæ¡ˆä¾‹ã€‚ä¾‹10ä¸­éœ€è¦æŠŠæ•´ä¸ªArticleå¯¹è±¡çš„æ•°æ®(æ ‡é¢˜ï¼Œæ­£æ–‡â€¦..)å…ˆæå–å‡ºæ¥ï¼Œç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå˜æ›´ä¿¡æ¯åå†å†™å…¥æ•°æ®åº“ã€‚è€Œä¾‹11ç›´æ¥å¯¹æ ‡é¢˜åšäº†æ›´æ–°ï¼Œä¸éœ€è¦æŠŠæ•´ä¸ªæ–‡ç« å¯¹è±¡çš„æ•°æ®è½½å…¥å†…å­˜ï¼Œæ˜¾ç„¶æ›´é«˜æ•ˆã€‚å°½ç®¡å•ç¯‡æ–‡ç« å ç”¨å†…å­˜ä¸å¤šï¼Œä½†æ˜¯ä¸‡ä¸€ç”¨æˆ·éå¸¸å¤šå‘¢ï¼Œé‚£ä¹ˆå ç”¨çš„å†…å­˜åŠ èµ·æ¥ä¹Ÿæ˜¯å¾ˆææ€–çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Example 10: Bad</span></span><br><span class="line">article = Article.objects.get(id=<span class="number">10</span>)</span><br><span class="line">Article.title = <span class="string">"Django"</span></span><br><span class="line">article.save()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example 11: Good</span></span><br><span class="line">Article.objects.filter(id=<span class="number">10</span>).update(title=<span class="string">'Django'</span>)</span><br></pre></td></tr></table></figure>
<p>updateæ–¹æ³•è¿˜ä¼šè¿”å›å·²æ›´æ–°æ¡ç›®çš„æ•°é‡ï¼Œè¿™ç‚¹ä¹Ÿéå¸¸æœ‰ç”¨ã€‚å½“ç„¶äº‹æƒ…ä¹Ÿæ²¡æœ‰ç»å¯¹ï¼Œsaveæ–¹æ³•å¯¹äºå•ä¸ªæ¨¡å‹çš„æ›´æ–°è¿˜æ˜¯å¾ˆæœ‰ä¼˜åŠ¿çš„ï¼Œæ¯”å¦‚save(commit=False), article.author = request.userç­‰ç­‰äº‹æƒ…updateéƒ½åšä¸æ¥ã€‚</p>
<h3 id="ä¸“ä¸šåœ°ä½¿ç”¨explainæ–¹æ³•"><a href="#ä¸“ä¸šåœ°ä½¿ç”¨explainæ–¹æ³•" class="headerlink" title="ä¸“ä¸šåœ°ä½¿ç”¨explainæ–¹æ³•"></a>ä¸“ä¸šåœ°ä½¿ç”¨explainæ–¹æ³•</h3><p>Django 2.1ä¸­QuerySetæ–°å¢äº†explainæ–¹æ³•ï¼Œå¯ä»¥ç»Ÿè®¡ä¸€ä¸ªæŸ¥è¯¢æ‰€æ¶ˆè€—çš„æ‰§è¡Œæ—¶é—´ã€‚è¿™å¯ä»¥å¸®åŠ©ç¨‹åºå‘˜æ›´å¥½åœ°ä¼˜åŒ–æŸ¥è¯¢ç»“æœã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(Blog.objects.filter(title=<span class="string">'My Blog'</span>).explain(verbose=<span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># output</span></span><br><span class="line">Seq Scan on public.blog  (cost=<span class="number">0.00</span>.<span class="number">.35</span><span class="number">.50</span> rows=<span class="number">10</span> width=<span class="number">12</span>) (actual time=<span class="number">0.004</span>.<span class="number">.0</span><span class="number">.004</span> rows=<span class="number">10</span> loops=<span class="number">1</span>)</span><br><span class="line">  Output: id, title</span><br><span class="line">  Filter: (blog.title = <span class="string">'My Blog'</span>::bpchar)</span><br><span class="line">Planning time: <span class="number">0.064</span> ms</span><br><span class="line">Execution time: <span class="number">0.058</span> ms</span><br></pre></td></tr></table></figure>


<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>Django QuerySetçš„æƒ°æ€§å’Œç¼“å­˜ç‰¹æ€§å¯¹äºå‡å°‘æ•°æ®åº“çš„è®¿é—®æ¬¡æ•°éå¸¸æœ‰ç”¨ã€‚ä½ éœ€è¦æ ¹æ®ä¸åŒåº”ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„æ–¹æ³•(æ¯”å¦‚exists, count, update, values) æ¥å‡å°‘æ•°æ®åº“çš„è®¿é—®ï¼Œå‡å°‘æŸ¥è¯¢ç»“æœå ç”¨çš„å†…å­˜ç©ºé—´ä»è€Œæå‡ç½‘ç«™çš„æ€§èƒ½ã€‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®ç»“æ„ --- ä¼˜å…ˆé˜Ÿåˆ—</title>
    <url>/2021/01/26/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97/</url>
    <content><![CDATA[<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PriorityQueue</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ä¼˜å…ˆé˜Ÿåˆ—</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.array = list()</span><br><span class="line">        self.size = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enqueue</span><span class="params">(self, element)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å…¥é˜Ÿ</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.array.append(element)</span><br><span class="line">        self.size += <span class="number">1</span></span><br><span class="line">        self.up_adjust()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">up_adjust</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å‘ä¸Šè°ƒæ•´</span></span><br><span class="line"><span class="string">        æ’å…¥å…ƒç´ å, æ”¾åœ¨æœ€æœ«å°¾</span></span><br><span class="line"><span class="string">        éœ€è¦å¾€ä¸Šè°ƒæ•´, å˜æˆæœ€å¤§å †</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># æ’å…¥çš„å…ƒç´ çš„ä½ç½®</span></span><br><span class="line">        child_index = self.size - <span class="number">1</span></span><br><span class="line">        parent_index = (child_index - <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">        <span class="comment"># æ’å…¥çš„å…ƒç´ , ä¸€ç›´å¾€ä¸Šç§»åŠ¨</span></span><br><span class="line">        tmp = self.array[child_index]</span><br><span class="line">        <span class="comment"># ç›´åˆ°ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªæ ¹èŠ‚ç‚¹, æˆ–è€…æ¯”çˆ¶èŠ‚ç‚¹å°</span></span><br><span class="line">        <span class="keyword">while</span> child_index &gt; <span class="number">0</span> <span class="keyword">and</span> tmp &gt; self.array[parent_index]:</span><br><span class="line">            <span class="comment"># tmpå¾€ä¸Šç§»åŠ¨, å°†çˆ¶èŠ‚ç‚¹èµ‹å€¼ç»™å­èŠ‚ç‚¹</span></span><br><span class="line">            self.array[child_index] = self.array[parent_index]</span><br><span class="line">            <span class="comment"># å¾€ä¸Šç§»åŠ¨ä¸€å±‚</span></span><br><span class="line">            child_index = parent_index</span><br><span class="line">            parent_index = (child_index - <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">        <span class="comment"># ç§»åŠ¨åˆ°æœ€ç»ˆä½ç½®</span></span><br><span class="line">        self.array[child_index] = tmp</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dequeue</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        è·å–ä¼˜å…ˆé˜Ÿåˆ—çš„æœ€å¤§ä¼˜å…ˆå€¼</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> self.size &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">"é˜Ÿåˆ—ä¸ºç©º"</span>)</span><br><span class="line">        <span class="comment"># è¿”å›æœ€å¤§ä¼˜å…ˆå€¼</span></span><br><span class="line">        head = self.array[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># å°†æœ€åä¸€ä¸ªèŠ‚ç‚¹ç§»åŠ¨åˆ°æ ¹èŠ‚ç‚¹ä½ç½®</span></span><br><span class="line">        self.array[<span class="number">0</span>] = self.array[self.size - <span class="number">1</span>]</span><br><span class="line">        <span class="comment"># è‡ªé¡¶å‘ä¸‹ç§»åŠ¨</span></span><br><span class="line">        self.down_adjust()</span><br><span class="line">        <span class="keyword">return</span> head</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">down_adjust</span><span class="params">(self)</span>:</span></span><br><span class="line">        parent_index = <span class="number">0</span></span><br><span class="line">        tmp = self.array[parent_index]</span><br><span class="line">        child_index = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> child_index &lt; self.size:</span><br><span class="line">            <span class="comment"># å¦‚æœæœ‰å³å­©å­èŠ‚ç‚¹, å¹¶ä¸”å€¼å¤§äºå·¦å­©å­èŠ‚ç‚¹, é‚£ä¹ˆçˆ¶èŠ‚ç‚¹å¾€å³å­©å­èŠ‚ç‚¹ç§»åŠ¨</span></span><br><span class="line">            <span class="comment"># éœ€è¦æ„å»ºæœ€å¤§å †, æ‰€ä»¥éœ€è¦ä¿è¯çˆ¶èŠ‚ç‚¹è¦å¤§äºå­èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> child_index + <span class="number">1</span> &lt; self.size <span class="keyword">and</span> self.array[child_index + <span class="number">1</span>] &gt; self.array[child_index]:</span><br><span class="line">                child_index += <span class="number">1</span></span><br><span class="line">            <span class="comment"># çˆ¶èŠ‚ç‚¹å¹¶æœ€å¤§å­èŠ‚ç‚¹éƒ½å¤§, é‚£ä¹ˆé€€å‡º</span></span><br><span class="line">            <span class="keyword">if</span> tmp &gt;= self.array[child_index]:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># å°†æœ€å¤§å­èŠ‚ç‚¹ç§»åŠ¨åˆ°çˆ¶èŠ‚ç‚¹ä½ç½®</span></span><br><span class="line">            self.array[parent_index] = self.array[child_index]</span><br><span class="line">            <span class="comment"># ç§»åŠ¨åˆ°å­èŠ‚ç‚¹ä½ç½®</span></span><br><span class="line">            parent_index = child_index</span><br><span class="line">            <span class="comment"># åˆ¤æ–­å·¦å­©å­èŠ‚ç‚¹</span></span><br><span class="line">            child_index = <span class="number">2</span> * child_index + <span class="number">1</span></span><br><span class="line">        self.array[parent_index] = tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    queue = PriorityQueue()</span><br><span class="line">    queue.enqueue(<span class="number">3</span>)</span><br><span class="line">    queue.enqueue(<span class="number">20</span>)</span><br><span class="line">    queue.enqueue(<span class="number">30</span>)</span><br><span class="line">    queue.enqueue(<span class="number">50</span>)</span><br><span class="line">    queue.enqueue(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    print(queue.dequeue())</span><br><span class="line">    print(queue.dequeue())</span><br><span class="line">    print(queue.dequeue())</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
  </entry>
  <entry>
    <title>Django --- LocMemCacheæºç åˆ†æ</title>
    <url>/2021/01/24/django-LocMemCache%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">"Thread-safe in-memory cache backend."</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.core.cache.backends.base <span class="keyword">import</span> DEFAULT_TIMEOUT, BaseCache</span><br><span class="line"><span class="keyword">from</span> django.utils.synch <span class="keyword">import</span> RWLock</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> django.utils.six.moves <span class="keyword">import</span> cPickle <span class="keyword">as</span> pickle</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Global in-memory store of cache data. Keyed by name, to provide</span></span><br><span class="line"><span class="comment"># multiple named local memory caches.</span></span><br><span class="line">_caches = &#123;&#125;</span><br><span class="line">_expire_info = &#123;&#125;</span><br><span class="line">_locks = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dummy</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""A context manager that does nothing special."""</span></span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LocMemCache</span><span class="params">(BaseCache)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, params)</span>:</span></span><br><span class="line">        BaseCache.__init__(self, params)</span><br><span class="line">        <span class="comment"># ä½¿ç”¨å­—å…¸, ä¿å­˜æ•°æ®åˆ°å†…å­˜</span></span><br><span class="line">        <span class="comment"># æŒ‰ç…§_cull_frequencyçœ‹, æ­¤å¤„å¯ä»¥è®¾ç½®æˆOrderDict, å¹¶ä¸”æŒ‰LRUæ–¹å¼, åˆ é™¤è¾ƒå°‘è®¿é—®çš„æ•°æ®</span></span><br><span class="line">        self._cache = _caches.setdefault(name, &#123;&#125;)</span><br><span class="line">        <span class="comment"># å­˜å‚¨keyè¿‡æœŸä¿¡æ¯</span></span><br><span class="line">        self._expire_info = _expire_info.setdefault(name, &#123;&#125;)</span><br><span class="line">        <span class="comment"># ä½¿ç”¨äº†è¯»å†™é”</span></span><br><span class="line">        self._lock = _locks.setdefault(name, RWLock())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, key, value, timeout=DEFAULT_TIMEOUT, version=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ·»åŠ ç¼“å­˜æ•°æ®</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># ç”Ÿæˆkeyå€¼</span></span><br><span class="line">        key = self.make_key(key, version=version)</span><br><span class="line">        <span class="comment"># å¯¹keyå€¼æ ¡éªŒ</span></span><br><span class="line">        self.validate_key(key)</span><br><span class="line">        <span class="comment"># åºåˆ—åŒ–</span></span><br><span class="line">        pickled = pickle.dumps(value, pickle.HIGHEST_PROTOCOL)</span><br><span class="line">        <span class="comment"># è·å–å†™é”</span></span><br><span class="line">        <span class="keyword">with</span> self._lock.writer():</span><br><span class="line">            <span class="comment"># åˆ¤æ–­keyå€¼æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">            <span class="keyword">if</span> self._has_expired(key):</span><br><span class="line">                <span class="comment"># keyæ²¡æœ‰è¿‡æœŸæˆ–è€…ä¸å­˜åœ¨, åˆ™ç¼“å­˜æ•°æ®</span></span><br><span class="line">                self._set(key, pickled, timeout)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key, default=None, version=None, acquire_lock=True)</span>:</span></span><br><span class="line">        key = self.make_key(key, version=version)</span><br><span class="line">        self.validate_key(key)</span><br><span class="line">        pickled = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># è·å–è¯»é”</span></span><br><span class="line">        <span class="keyword">with</span> (self._lock.reader() <span class="keyword">if</span> acquire_lock <span class="keyword">else</span> dummy()):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self._has_expired(key):</span><br><span class="line">                pickled = self._cache[key]</span><br><span class="line">        <span class="comment"># è·å–åˆ°äº†æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> pickled <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># ååºåˆ—åŒ–</span></span><br><span class="line">                <span class="keyword">return</span> pickle.loads(pickled)</span><br><span class="line">            <span class="keyword">except</span> pickle.PickleError:</span><br><span class="line">                <span class="keyword">return</span> default</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> (self._lock.writer() <span class="keyword">if</span> acquire_lock <span class="keyword">else</span> dummy()):</span><br><span class="line">            <span class="comment"># å¦‚æœæ²¡æœ‰æ‹¿åˆ°æ•°æ®, åˆ™ä»ç¼“å­˜å’Œè¿‡æœŸä¿¡æ¯ä¸­, åˆ é™¤æ‰€æœ‰keyå€¼</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">del</span> self._cache[key]</span><br><span class="line">                <span class="keyword">del</span> self._expire_info[key]</span><br><span class="line">            <span class="keyword">except</span> KeyError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">return</span> default</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_set</span><span class="params">(self, key, value, timeout=DEFAULT_TIMEOUT)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å®é™…ä¸Šçš„ç¼“å­˜æ“ä½œ</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># åˆ¤æ–­ç¼“å­˜çš„keyå€¼æ•°é‡, æ˜¯å¦è¶…è¿‡é…ç½®æ•°é‡, é»˜è®¤æ˜¯300</span></span><br><span class="line">        <span class="keyword">if</span> len(self._cache) &gt;= self._max_entries:</span><br><span class="line">            <span class="comment">#</span></span><br><span class="line">            self._cull()</span><br><span class="line">        self._cache[key] = value</span><br><span class="line">        <span class="comment"># ç¼“å­˜è¿‡æœŸæ—¶é—´ä¿¡æ¯</span></span><br><span class="line">        self._expire_info[key] = self.get_backend_timeout(timeout)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set</span><span class="params">(self, key, value, timeout=DEFAULT_TIMEOUT, version=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        ç¼“å­˜æ“ä½œ</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        key = self.make_key(key, version=version)</span><br><span class="line">        self.validate_key(key)</span><br><span class="line">        pickled = pickle.dumps(value, pickle.HIGHEST_PROTOCOL)</span><br><span class="line">        <span class="keyword">with</span> self._lock.writer():</span><br><span class="line">            self._set(key, pickled, timeout)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">incr</span><span class="params">(self, key, delta=<span class="number">1</span>, version=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ•°å€¼å¢åŠ </span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">with</span> self._lock.writer():</span><br><span class="line">            value = self.get(key, version=version, acquire_lock=<span class="literal">False</span>)</span><br><span class="line">            <span class="keyword">if</span> value <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">"Key '%s' not found"</span> % key)</span><br><span class="line">            <span class="comment"># æ²¡æœ‰ç¡®ä¿valueæ˜¯æ•°å­—åˆ¤æ–­?</span></span><br><span class="line">            new_value = value + delta</span><br><span class="line">            key = self.make_key(key, version=version)</span><br><span class="line">            pickled = pickle.dumps(new_value, pickle.HIGHEST_PROTOCOL)</span><br><span class="line">            self._cache[key] = pickled</span><br><span class="line">        <span class="keyword">return</span> new_value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_key</span><span class="params">(self, key, version=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        åˆ¤æ–­keyå€¼æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        key = self.make_key(key, version=version)</span><br><span class="line">        self.validate_key(key)</span><br><span class="line">        <span class="keyword">with</span> self._lock.reader():</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self._has_expired(key):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä¸å­˜åœ¨åˆ™æ¸…ç©ºkeyå€¼ç›¸å…³æ•°æ®</span></span><br><span class="line">        <span class="keyword">with</span> self._lock.writer():</span><br><span class="line">            <span class="comment"># ...è¿˜ä¸å¦‚ç›´æ¥è°ƒç”¨self._delete(key)å‡½æ•°</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">del</span> self._cache[key]</span><br><span class="line">                <span class="keyword">del</span> self._expire_info[key]</span><br><span class="line">            <span class="keyword">except</span> KeyError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_has_expired</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        keyå€¼æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># è·å–è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        exp = self._expire_info.get(key, <span class="number">-1</span>)</span><br><span class="line">        <span class="comment"># å¦‚æœè¿‡æœŸæ—¶é—´ä¸å­˜åœ¨(keyå€¼ä¸å­˜åœ¨çš„æ„æ€), è·å–è¶…è¿‡å½“å‰æ—¶é—´</span></span><br><span class="line">        <span class="keyword">if</span> exp <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> exp &gt; time.time():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_cull</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        åˆ é™¤é¢‘ç‡</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># å¦‚æœè®¾ç½®ä¸º0, åˆ™æ¸…ç©ºæ‰€æœ‰ç¼“å­˜</span></span><br><span class="line">        <span class="comment"># é»˜è®¤æ˜¯3</span></span><br><span class="line">        <span class="keyword">if</span> self._cull_frequency == <span class="number">0</span>:</span><br><span class="line">            self.clear()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># æŒ‰å–æ¨¡æ“ä½œ, æŒ‰ç…§è®¾ç½®çš„é¢‘ç‡åˆ é™¤æ•°æ®</span></span><br><span class="line">            doomed = [k <span class="keyword">for</span> (i, k) <span class="keyword">in</span> enumerate(self._cache) <span class="keyword">if</span> i % self._cull_frequency == <span class="number">0</span>]</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> doomed:</span><br><span class="line">                self._delete(k)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_delete</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">del</span> self._cache[key]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">del</span> self._expire_info[key]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, key, version=None)</span>:</span></span><br><span class="line">        key = self.make_key(key, version=version)</span><br><span class="line">        self.validate_key(key)</span><br><span class="line">        <span class="keyword">with</span> self._lock.writer():</span><br><span class="line">            self._delete(key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clear</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ¸…ç©ºæ‰€æœ‰ç¼“å­˜ä¿¡æ¯</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self._cache.clear()</span><br><span class="line">        self._expire_info.clear()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
      </tags>
  </entry>
  <entry>
    <title>Django --- è¯»å†™é”</title>
    <url>/2021/01/23/django-%E8%AF%BB%E5%86%99%E9%94%81/</url>
    <content><![CDATA[<h3 id="ä»£ç æ¥æº"><a href="#ä»£ç æ¥æº" class="headerlink" title="ä»£ç æ¥æº"></a>ä»£ç æ¥æº</h3><p>django1.11 ç‰ˆæœ¬, å®Œæ•´æºç è·¯å¾„<code>from django.utils.synch import RWLock</code></p>
<p>å®ç°æ–¹æ³•ä¸»è¦æ˜¯<code>RLock+Semaphore</code>ç»“åˆä½¿ç”¨.</p>
<p>åœ¨é˜…è¯»<code>LocMemCache</code>æœ¬åœ°å†…å­˜ç¼“å­˜ä»£ç æ—¶, æ³¨æ„åˆ°è¿™ä¸€éƒ¨åˆ†åŠŸèƒ½, æ·»åŠ è§£é‡Šåä»¥åå¯ä»¥ç”¨.</p>
<p>ä½†åœ¨django3æˆ–è€…æ›´ä¹‹å‰çš„ç‰ˆæœ¬, å·²ç»ä¸å†æ²¡æœ‰åœ¨<code>LocMemCache</code>ä¸­ç”¨<code>RWLock</code>, è€Œæ˜¯ç›´æ¥ä½¿ç”¨pythonè‡ªå¸¦çš„<code>from threading import Lock</code>äº†.</p>
<a id="more"></a>

<h3 id="æºç åŠè§£é‡Š"><a href="#æºç åŠè§£é‡Š" class="headerlink" title="æºç åŠè§£é‡Š"></a>æºç åŠè§£é‡Š</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Synchronization primitives:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    - reader-writer lock (preference to writers)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(Contributed to Django by eugene@lazutkin.com)</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RWLock</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Classic implementation of reader-writer lock with preference to writers.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Readers can access a resource simultaneously.</span></span><br><span class="line"><span class="string">    Writers get an exclusive access.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    API is self-descriptive:</span></span><br><span class="line"><span class="string">        reader_enters()</span></span><br><span class="line"><span class="string">        reader_leaves()</span></span><br><span class="line"><span class="string">        writer_enters()</span></span><br><span class="line"><span class="string">        writer_leaves()</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># å¯é‡å…¥é”</span></span><br><span class="line">        self.mutex = threading.RLock()</span><br><span class="line">        <span class="comment"># è¯»é”ä¿¡å·é‡</span></span><br><span class="line">        self.can_read = threading.Semaphore(<span class="number">0</span>)</span><br><span class="line">        <span class="comment"># å†™é”ä¿¡å·é‡</span></span><br><span class="line">        self.can_write = threading.Semaphore(<span class="number">0</span>)</span><br><span class="line">        <span class="comment"># æ­£åœ¨è¿›è¡Œè¯»æ“ä½œçš„æ•°é‡</span></span><br><span class="line">        self.active_readers = <span class="number">0</span></span><br><span class="line">        <span class="comment"># æ­£åœ¨å†™æ“ä½œçš„æ•°é‡</span></span><br><span class="line">        self.active_writers = <span class="number">0</span></span><br><span class="line">        <span class="comment"># ç­‰å¾…æ“ä½œ</span></span><br><span class="line">        self.waiting_readers = <span class="number">0</span></span><br><span class="line">        self.waiting_writers = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reader_enters</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># åŠ é”</span></span><br><span class="line">        <span class="keyword">with</span> self.mutex:</span><br><span class="line">            <span class="comment"># å¦‚æœæ²¡æœ‰è¿›è¡Œå†™æ“ä½œ</span></span><br><span class="line">            <span class="keyword">if</span> self.active_writers == <span class="number">0</span> <span class="keyword">and</span> self.waiting_writers == <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># é‚£ä¹ˆè¯»æ“ä½œ+1</span></span><br><span class="line">                self.active_readers += <span class="number">1</span></span><br><span class="line">                <span class="comment"># æ¿€æ´»è¯»æ“ä½œ</span></span><br><span class="line">                self.can_read.release()</span><br><span class="line">            <span class="comment"># å¦åˆ™, ç­‰å¾…ä¸­çš„è¯»æ“ä½œ+1</span></span><br><span class="line">            <span class="comment"># ç­‰å¾…å†™æ“ä½œå®Œæˆ</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.waiting_readers += <span class="number">1</span></span><br><span class="line">        <span class="comment"># è·å–è¯»é”</span></span><br><span class="line">        self.can_read.acquire()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reader_leaves</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># é‡Šæ”¾</span></span><br><span class="line">        <span class="keyword">with</span> self.mutex:</span><br><span class="line">            <span class="comment"># è¯»æ“ä½œæ•°-1</span></span><br><span class="line">            self.active_readers -= <span class="number">1</span></span><br><span class="line">            <span class="comment"># æ²¡æœ‰è¯»æ“ä½œ, å¹¶ä¸”æœ‰ç­‰å¾…ä¸­çš„å†™æ“ä½œ</span></span><br><span class="line">            <span class="keyword">if</span> self.active_readers == <span class="number">0</span> <span class="keyword">and</span> self.waiting_writers != <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># é‡Šæ”¾å†™æ“ä½œçš„é”</span></span><br><span class="line">                self.active_writers += <span class="number">1</span></span><br><span class="line">                self.waiting_writers -= <span class="number">1</span></span><br><span class="line">                self.can_write.release()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @contextlib.contextmanager</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reader</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># contextlib.contextmanagerè£…é¥°å™¨çš„ä½œç”¨</span></span><br><span class="line">        <span class="comment"># å½“ä»£ç è¢« with self.reader() ä¿®é¥°æ—¶, å…ˆæ‰§è¡Œyieldä¹‹å‰çš„ä»£ç , å†æ‰§è¡Œä»£ç å—, æœ€åæ‰§è¡Œyieldåçš„ä»£ç </span></span><br><span class="line">        <span class="comment"># ä»¥æ­¤å®Œæˆå…ˆè·å–é”å†é‡Šæ”¾é”çš„æ“ä½œ</span></span><br><span class="line">        <span class="comment"># è·å–é”</span></span><br><span class="line">        self.reader_enters()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">yield</span></span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="comment"># é‡Šæ”¾é”</span></span><br><span class="line">            self.reader_leaves()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">writer_enters</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> self.mutex:</span><br><span class="line">            <span class="comment"># é‡Šæ”¾å†™é”</span></span><br><span class="line">            <span class="keyword">if</span> self.active_writers == <span class="number">0</span> <span class="keyword">and</span> self.waiting_writers == <span class="number">0</span> <span class="keyword">and</span> self.active_readers == <span class="number">0</span>:</span><br><span class="line">                self.active_writers += <span class="number">1</span></span><br><span class="line">                self.can_write.release()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.waiting_writers += <span class="number">1</span></span><br><span class="line">        self.can_write.acquire()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">writer_leaves</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> self.mutex:</span><br><span class="line">            self.active_writers -= <span class="number">1</span></span><br><span class="line">            <span class="comment"># é‡Šæ”¾å†™é”</span></span><br><span class="line">            <span class="keyword">if</span> self.waiting_writers != <span class="number">0</span>:</span><br><span class="line">                self.active_writers += <span class="number">1</span></span><br><span class="line">                self.waiting_writers -= <span class="number">1</span></span><br><span class="line">                self.can_write.release()</span><br><span class="line">            <span class="comment"># é‡Šæ”¾è¯»é”</span></span><br><span class="line">            <span class="keyword">elif</span> self.waiting_readers != <span class="number">0</span>:</span><br><span class="line">                t = self.waiting_readers</span><br><span class="line">                self.waiting_readers = <span class="number">0</span></span><br><span class="line">                self.active_readers += t</span><br><span class="line">                <span class="keyword">while</span> t &gt; <span class="number">0</span>:</span><br><span class="line">                    self.can_read.release()</span><br><span class="line">                    t -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @contextlib.contextmanager</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">writer</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.writer_enters()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">yield</span></span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            self.writer_leaves()</span><br></pre></td></tr></table></figure>



<h3 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lock = RWLock()</span><br><span class="line"><span class="keyword">with</span> lock.reader():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">with</span> lock.writer():</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
      </tags>
  </entry>
  <entry>
    <title>Golang --- è§£æyamlé…ç½®æ–‡ä»¶</title>
    <url>/2020/12/14/golang-%E8%A7%A3%E6%9E%90yaml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h1 id="golang-è§£æyamlé…ç½®æ–‡ä»¶"><a href="#golang-è§£æyamlé…ç½®æ–‡ä»¶" class="headerlink" title="golang - è§£æyamlé…ç½®æ–‡ä»¶"></a>golang - è§£æyamlé…ç½®æ–‡ä»¶</h1><h3 id="å®‰è£…ç¬¬ä¸‰æ–¹åº“"><a href="#å®‰è£…ç¬¬ä¸‰æ–¹åº“" class="headerlink" title="å®‰è£…ç¬¬ä¸‰æ–¹åº“"></a>å®‰è£…ç¬¬ä¸‰æ–¹åº“</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">go</span> get -u <span class="string">"github.com/spf13/viper"</span></span><br></pre></td></tr></table></figure>

<h3 id="æ–‡ä»¶æ•´ä½“ç»“æ„"><a href="#æ–‡ä»¶æ•´ä½“ç»“æ„" class="headerlink" title="æ–‡ä»¶æ•´ä½“ç»“æ„"></a>æ–‡ä»¶æ•´ä½“ç»“æ„</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ configs</span><br><span class="line">â”‚Â Â  â””â”€â”€ stand_alone.yaml</span><br><span class="line">â””â”€â”€ pkg</span><br><span class="line">    â””â”€â”€ settings</span><br><span class="line">        â”œâ”€â”€ section.go</span><br><span class="line">        â””â”€â”€ setting.go</span><br></pre></td></tr></table></figure>

<h3 id="yamlé…ç½®æ–‡ä»¶"><a href="#yamlé…ç½®æ–‡ä»¶" class="headerlink" title="yamlé…ç½®æ–‡ä»¶"></a>yamlé…ç½®æ–‡ä»¶</h3><p>è·¯å¾„: configs/stand_alone.yaml</p>
<p>è¯¦ç»†æ ¼å¼å¯ä»¥å‚è€ƒ:</p>
<p><a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html" target="_blank" rel="noopener">YAML è¯­è¨€æ•™ç¨‹</a></p>
<p><a href="https://en.wikipedia.org/wiki/YAML" target="_blank" rel="noopener">YAML</a></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">Server:</span></span><br><span class="line">  <span class="attr">StorageRoot:</span> <span class="string">"Storage/upload"</span></span><br><span class="line">  <span class="attr">ListenAddress:</span> <span class="string">":8888"</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="å®šä¹‰Settingç»“æ„ä½“"><a href="#å®šä¹‰Settingç»“æ„ä½“" class="headerlink" title="å®šä¹‰Settingç»“æ„ä½“"></a>å®šä¹‰Settingç»“æ„ä½“</h3><p>è·¯å¾„: pkg/settings/setting.go</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> settings</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"github.com/spf13/viper"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Setting <span class="keyword">struct</span> &#123;</span><br><span class="line">    vp *viper.Viper</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSetting</span><span class="params">()</span> <span class="params">(*Setting, error)</span></span> &#123;</span><br><span class="line">    vp := viper.New()</span><br><span class="line">    vp.SetConfigName(<span class="string">"stand_alone.yaml"</span>)</span><br><span class="line">    vp.AddConfigPath(<span class="string">"stand_alone/configs"</span>)</span><br><span class="line">    vp.SetConfigType(<span class="string">"yaml"</span>)</span><br><span class="line"></span><br><span class="line">    err := vp.ReadInConfig()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &amp;Setting&#123;vp&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å®šä¹‰Sectionç»“æ„ä½“"><a href="#å®šä¹‰Sectionç»“æ„ä½“" class="headerlink" title="å®šä¹‰Sectionç»“æ„ä½“"></a>å®šä¹‰Sectionç»“æ„ä½“</h3><p>è·¯å¾„: pkg/settings/section.go</p>
<p>å¦‚æœæœ‰å¤šç»„é…ç½®, é‚£ä¹ˆæŒ‰ç…§æ ¼å¼, åˆ›å»ºå¤šä¸ªstructå˜é‡</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> settings</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> &#123;</span><br><span class="line">    StorageRoot   <span class="keyword">string</span></span><br><span class="line">    ListenAddress <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Setting)</span> <span class="title">ReadSection</span><span class="params">(sType <span class="keyword">string</span>, section <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    err := s.vp.UnmarshalKey(sType, section)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"Storage/stand_alone/pkg/settings"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    setting, err := settings.NewSetting()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Println(<span class="string">"err: "</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> server *settings.Server</span><br><span class="line">    _ = setting.ReadSection(<span class="string">"Server"</span>, &amp;server)</span><br><span class="line">    fmt.Println(server.StorageRoot, server.ListenAddress)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Golang</category>
      </categories>
  </entry>
  <entry>
    <title>Golang --- ä½¿ç”¨ä»¤ç‰Œæ¡¶é™åˆ¶æ¥å£è®¿é—®é¢‘ç‡</title>
    <url>/2020/12/12/golang-%E4%BD%BF%E7%94%A8%E4%BB%A4%E7%89%8C%E6%A1%B6%E9%99%90%E5%88%B6%E6%8E%A5%E5%8F%A3%E8%AE%BF%E9%97%AE%E9%A2%91%E7%8E%87/</url>
    <content><![CDATA[<h3 id="ä¸‰æ–¹åº“"><a href="#ä¸‰æ–¹åº“" class="headerlink" title="ä¸‰æ–¹åº“"></a>ä¸‰æ–¹åº“</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">go</span> get -u github.com/juju/ratelimit@v1<span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>



<h3 id="ä»¤ç‰Œæ¡¶ç»“æ„ä½“"><a href="#ä»¤ç‰Œæ¡¶ç»“æ„ä½“" class="headerlink" title="ä»¤ç‰Œæ¡¶ç»“æ„ä½“"></a>ä»¤ç‰Œæ¡¶ç»“æ„ä½“</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> limiter</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">    <span class="string">"github.com/juju/ratelimit"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¤ç‰Œæ¡¶ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">type</span> Limiter <span class="keyword">struct</span> &#123;</span><br><span class="line">    limiterBuckets <span class="keyword">map</span>[<span class="keyword">string</span>]*ratelimit.Bucket</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¤ç‰ŒBucket</span></span><br><span class="line"><span class="keyword">type</span> LimiterBucketRule <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰é”®å€¼å¯¹åç§°</span></span><br><span class="line">    Key <span class="keyword">string</span></span><br><span class="line">    <span class="comment">// é—´éš”å¤šä¹…æ”¾Nä¸ªä»¤ç‰Œ</span></span><br><span class="line">    FillInterval time.Duration</span><br><span class="line">    <span class="comment">// ä»¤ç‰Œæ¡¶çš„å®¹é‡</span></span><br><span class="line">    Capacity <span class="keyword">int64</span></span><br><span class="line">    <span class="comment">// æ¯æ¬¡åˆ°è¾¾é—´éš”æ—¶é—´åæ‰€æ”¾çš„å…·ä½“ä»¤ç‰Œæ•°é‡</span></span><br><span class="line">    Quantum <span class="keyword">int64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> LimiterIface <span class="keyword">interface</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å¯¹åº”çš„é™æµå™¨çš„é”®å€¼å¯¹åç§°</span></span><br><span class="line">    Key(c *gin.Context) <span class="keyword">string</span></span><br><span class="line">    <span class="comment">// è·å–ä»¤ç‰Œæ¡¶</span></span><br><span class="line">    GetBucket(key <span class="keyword">string</span>) (*ratelimit.Bucket, <span class="keyword">bool</span>)</span><br><span class="line">    <span class="comment">// æ–°å¢ä»¤ç‰Œæ¡¶</span></span><br><span class="line">    AddBuckets(rules ...LimiterBucketRule) LimiterIface</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>


<h3 id="å®ç°ä»¤ç‰Œæ¡¶çš„æ¥å£"><a href="#å®ç°ä»¤ç‰Œæ¡¶çš„æ¥å£" class="headerlink" title="å®ç°ä»¤ç‰Œæ¡¶çš„æ¥å£"></a>å®ç°ä»¤ç‰Œæ¡¶çš„æ¥å£</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> limiter</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">    <span class="string">"github.com/juju/ratelimit"</span></span><br><span class="line">    <span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MethodLimiter <span class="keyword">struct</span> &#123;</span><br><span class="line">    *Limiter</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªä»¤ç‰Œæ¡¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMethodLimiter</span><span class="params">()</span> <span class="title">LimiterIface</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> MethodLimiter&#123;</span><br><span class="line">        Limiter: &amp;Limiter&#123;</span><br><span class="line">            limiterBuckets: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]*ratelimit.Bucket),</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–é”®å€¼å¯¹, ä½¿ç”¨æ ¸å¿ƒè·¯ç”±åškeyå€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l MethodLimiter)</span> <span class="title">Key</span><span class="params">(c *gin.Context)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    uri := c.Request.RequestURI</span><br><span class="line">    index := strings.Index(uri, <span class="string">"?"</span>)</span><br><span class="line">    <span class="keyword">if</span> index == <span class="number">-1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uri</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> uri[:index]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–Bucket</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l MethodLimiter)</span> <span class="title">GetBucket</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="params">(*ratelimit.Bucket, <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">    bucket, ok := l.limiterBuckets[key]</span><br><span class="line">    <span class="keyword">return</span> bucket, ok</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ bucket</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l MethodLimiter)</span> <span class="title">AddBuckets</span><span class="params">(rules ...LimiterBucketRule)</span> <span class="title">LimiterIface</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, rule := <span class="keyword">range</span> rules &#123;</span><br><span class="line">        <span class="keyword">if</span> _, ok := l.limiterBuckets[rule.Key]; !ok &#123;</span><br><span class="line">            l.limiterBuckets[rule.Key] = ratelimit.NewBucketWithQuantum(rule.FillInterval, rule.Capacity, rule.Quantum)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> l</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> middleware</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"GoProgrammingJourney/blog_service/pkg/app"</span></span><br><span class="line">    <span class="string">"GoProgrammingJourney/blog_service/pkg/errcode"</span></span><br><span class="line">    <span class="string">"GoProgrammingJourney/blog_service/pkg/limiter"</span></span><br><span class="line">    <span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RateLimiter</span><span class="params">(l limiter.LimiterIface)</span> <span class="title">gin</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ä»¤ç‰Œçš„keyå€¼</span></span><br><span class="line">        key := l.Key(c)</span><br><span class="line">        <span class="keyword">if</span> bucket, ok := l.GetBucket(key); ok &#123;</span><br><span class="line">            <span class="comment">// ä¼ å…¥1, è¡¨ç¤ºå·²ä½¿ç”¨ä¸€ä¸ªä»¤ç‰Œ</span></span><br><span class="line">            count := bucket.TakeAvailable(<span class="number">1</span>)</span><br><span class="line">            <span class="comment">// å¦‚æœå‰©ä½™å¯ç”¨ä»¤ç‰Œæ•°ä¸º0, åˆ™æŠ›å‡ºå¼‚å¸¸, ç¦æ­¢è®¿é—®</span></span><br><span class="line">            <span class="keyword">if</span> count == <span class="number">0</span> &#123;</span><br><span class="line">                response := app.NewResponse(c)</span><br><span class="line">                response.ToErrorResponse(errcode.TooManyRequests)</span><br><span class="line">                c.Abort()</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        c.Next()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="åŠ å…¥ginçš„ä¸­é—´ä»¶"><a href="#åŠ å…¥ginçš„ä¸­é—´ä»¶" class="headerlink" title="åŠ å…¥ginçš„ä¸­é—´ä»¶"></a>åŠ å…¥ginçš„ä¸­é—´ä»¶</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é™åˆ¶äº†/authçš„è®¿é—®é¢‘ç‡</span></span><br><span class="line"><span class="comment">// é™åˆ¶æ—¶é—´é—´éš”, 1ç§’é’Ÿ</span></span><br><span class="line"><span class="comment">// ä¸€ç§’é’Ÿå†…, æœ€å¤šè¢«è®¿é—®10æ¬¡</span></span><br><span class="line"><span class="comment">// å½“ä¸€ç§’å, é‡æ–°æ”¾å…¥10ä¸ªä»¤ç‰Œåˆ°ä»¤ç‰Œæ¡¶å†…, ä¹Ÿå°±æ˜¯ä¸‹ä¸€ç§’å¯å†æ¬¡è¢«è®¿é—®10æ¬¡</span></span><br><span class="line"><span class="keyword">var</span> methodLimiters = limiter.NewMethodLimiter().AddBuckets(limiter.LimiterBucketRule&#123;</span><br><span class="line">    <span class="comment">// ä»¤ç‰Œæ¡¶é™åˆ¶çš„url</span></span><br><span class="line">    Key: <span class="string">"/auth"</span>,</span><br><span class="line">    <span class="comment">// æ—¶é—´é—´éš”</span></span><br><span class="line">    FillInterval: time.Second * <span class="number">1</span>,</span><br><span class="line">    <span class="comment">// ä»¤ç‰Œæ€»å®¹é‡</span></span><br><span class="line">    Capacity: <span class="number">10</span>,</span><br><span class="line">    <span class="comment">// é‡æ–°æ”¾å…¥ä»¤ç‰Œæ¡¶æ•°é‡</span></span><br><span class="line">    Quantum: <span class="number">10</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">r := gin.New()</span><br><span class="line">r.Use(middleware.RateLimiter(methodLimiters))</span><br></pre></td></tr></table></figure>

<h3 id="ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–æ–¹å¼"><a href="#ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–æ–¹å¼" class="headerlink" title="ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–æ–¹å¼"></a>ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–æ–¹å¼</h3><h4 id="é…ç½®yaml"><a href="#é…ç½®yaml" class="headerlink" title="é…ç½®yaml"></a>é…ç½®yaml</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">Limiter:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">Limits:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">Key:</span> <span class="string">"/auth"</span></span><br><span class="line">      <span class="attr">FillInterval:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">Capacity:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">Quantum:</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">Key:</span> <span class="string">"/api/v1/tags"</span></span><br><span class="line">      <span class="attr">FillInterval:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">Capacity:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">Quantum:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>



<h4 id="é…ç½®Setting"><a href="#é…ç½®Setting" class="headerlink" title="é…ç½®Setting"></a>é…ç½®Setting</h4><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> LimiterSetting <span class="keyword">struct</span> &#123;</span><br><span class="line">    Limits []<span class="keyword">struct</span> &#123;</span><br><span class="line">        Key          <span class="keyword">string</span></span><br><span class="line">        FillInterval time.Duration</span><br><span class="line">        Capacity     <span class="keyword">int64</span></span><br><span class="line">        Quantum      <span class="keyword">int64</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ä¿®æ”¹ä¸­é—´ä»¶å‚æ•°ä¼ å…¥æ–¹å¼"><a href="#ä¿®æ”¹ä¸­é—´ä»¶å‚æ•°ä¼ å…¥æ–¹å¼" class="headerlink" title="ä¿®æ”¹ä¸­é—´ä»¶å‚æ•°ä¼ å…¥æ–¹å¼"></a>ä¿®æ”¹ä¸­é—´ä»¶å‚æ•°ä¼ å…¥æ–¹å¼</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newLimiter</span><span class="params">()</span> <span class="title">limiter</span>.<span class="title">LimiterIface</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> rules []limiter.LimiterBucketRule</span><br><span class="line">    <span class="keyword">for</span> _, limit := <span class="keyword">range</span> global.LimiterSetting.Limits &#123;</span><br><span class="line">        rules = <span class="built_in">append</span>(rules, limiter.LimiterBucketRule&#123;</span><br><span class="line">            <span class="comment">// ä»¤ç‰Œæ¡¶é™åˆ¶çš„url</span></span><br><span class="line">            Key: limit.Key,</span><br><span class="line">            <span class="comment">// æ—¶é—´é—´éš”</span></span><br><span class="line">            FillInterval: limit.FillInterval * time.Second,</span><br><span class="line">            <span class="comment">// ä»¤ç‰Œæ€»å®¹é‡</span></span><br><span class="line">            Capacity: limit.Capacity,</span><br><span class="line">            <span class="comment">// é‡æ–°æ”¾å…¥ä»¤ç‰Œæ¡¶æ•°é‡</span></span><br><span class="line">            Quantum: limit.Quantum,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> methodLimiters = limiter.NewMethodLimiter().AddBuckets(rules...)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> methodLimiters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">r.Use(middleware.RateLimiter(newLimiter()))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>gin</tag>
      </tags>
  </entry>
  <entry>
    <title>[è½¬]Python --- ä½¿ç”¨PySnooperè°ƒè¯•ä»£ç </title>
    <url>/2020/11/18/%E8%BD%AC-%E4%BD%BF%E7%94%A8PySnooper%E8%B0%83%E8%AF%95%E4%BB%A3%E7%A0%81/</url>
    <content><![CDATA[<h3 id="è½¬è½½"><a href="#è½¬è½½" class="headerlink" title="è½¬è½½"></a>è½¬è½½</h3><p><a href="https://mp.weixin.qq.com/s/wSmzU4cn0mTwlrtCSENeqg" target="_blank" rel="noopener">æ±‚ä½ äº†ï¼Œåˆ«å†ç”¨ print è°ƒè¯•ä»£ç äº†</a></p>
<h3 id="å¿«é€Ÿå®‰è£…"><a href="#å¿«é€Ÿå®‰è£…" class="headerlink" title="å¿«é€Ÿå®‰è£…"></a>å¿«é€Ÿå®‰è£…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python3 -m pip install pysnooper</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ–è€…</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> conda install -c conda-forge pysnooper</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ–è€…</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yay -S python-pysnooper</span></span><br></pre></td></tr></table></figure>

<h3 id="ç®€å•æ¡ˆä¾‹"><a href="#ç®€å•æ¡ˆä¾‹" class="headerlink" title="ç®€å•æ¡ˆä¾‹"></a>ç®€å•æ¡ˆä¾‹</h3><p>ä¸‹é¢è¿™æ®µä»£ç ï¼Œå®šä¹‰äº†ä¸€ä¸ª demo_func çš„å‡½æ•°ï¼Œåœ¨é‡Œé¢ç”Ÿæˆä¸€ä¸ª profile çš„å­—å…¸å˜é‡ï¼Œç„¶åå»æ›´æ–°å®ƒï¼Œæœ€åè¿”å›ã€‚</p>
<p>ä»£ç æœ¬èº«æ²¡æœ‰ä»€ä¹ˆå®é™…æ„ä¹‰ï¼Œä½†æ˜¯ç”¨æ¥æ¼”ç¤º PySnooper å·²ç»è¶³å¤Ÿã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pysnooper</span><br><span class="line"></span><br><span class="line"><span class="meta">@pysnooper.snoop()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_func</span><span class="params">()</span>:</span></span><br><span class="line">    profile = &#123;&#125;</span><br><span class="line">    profile[<span class="string">"name"</span>] = <span class="string">"å†™ä»£ç çš„æ˜å“¥"</span></span><br><span class="line">    profile[<span class="string">"age"</span>] = <span class="number">27</span></span><br><span class="line">    profile[<span class="string">"gender"</span>] = <span class="string">"male"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> profile</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    profile = demo_func()</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>ç°åœ¨æˆ‘ä½¿ç”¨ç»ˆç«¯å‘½ä»¤è¡Œçš„æ–¹å¼æ¥è¿è¡Œå®ƒ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iswbm ~]# python3 demo.py </span><br><span class="line">Source path:... demo.py</span><br><span class="line">17:52:49.624943 call         4 def demo_func():</span><br><span class="line">17:52:49.625124 line         5     profile = &#123;&#125;</span><br><span class="line">New var:....... profile = &#123;&#125;</span><br><span class="line">17:52:49.625156 line         6     profile["name"] = "å†™ä»£ç çš„æ˜å“¥"</span><br><span class="line">Modified var:.. profile = &#123;'name': 'å†™ä»£ç çš„æ˜å“¥'&#125;</span><br><span class="line">17:52:49.625207 line         7     profile["age"] = 27</span><br><span class="line">Modified var:.. profile = &#123;'name': 'å†™ä»£ç çš„æ˜å“¥', 'age': 27&#125;</span><br><span class="line">17:52:49.625254 line         8     profile["gender"] = "male"</span><br><span class="line">Modified var:.. profile = &#123;'name': 'å†™ä»£ç çš„æ˜å“¥', 'age': 27, 'gender': 'male'&#125;</span><br><span class="line">17:52:49.625306 line        10     return profile</span><br><span class="line">17:52:49.625344 return      10     return profile</span><br><span class="line">Return value:.. &#123;'name': 'å†™ä»£ç çš„æ˜å“¥', 'age': 27, 'gender': 'male'&#125;</span><br><span class="line">Elapsed time: 00:00:00.000486</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ° PySnooper æŠŠå‡½æ•°è¿è¡Œçš„è¿‡ç¨‹å…¨éƒ¨è®°å½•äº†ä¸‹æ¥ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>ä»£ç çš„ç‰‡æ®µã€è¡Œå·ç­‰ä¿¡æ¯ï¼Œä»¥åŠæ¯ä¸€è¡Œä»£ç æ˜¯ä½•æ—¶è°ƒç”¨çš„ï¼Ÿ</li>
<li>å‡½æ•°å†…å±€éƒ¨å˜é‡çš„å€¼å¦‚ä½•å˜åŒ–çš„ï¼Ÿä½•æ—¶æ–°å¢äº†å˜é‡ï¼Œä½•æ—¶ä¿®æ”¹äº†å˜é‡ã€‚</li>
<li>å‡½æ•°çš„è¿”å›å€¼æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>è¿è¡Œå‡½æ•°æ¶ˆè€—äº†å¤šå°‘æ—¶é—´ï¼Ÿ<br>è€Œä½œä¸ºå¼€å‘è€…ï¼Œè¦å¾—åˆ°è¿™äº›å¦‚æ­¤è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œä½ éœ€è¦åšçš„éå¸¸ç®€å•ï¼Œåªè¦ç»™ä½ æƒ³è¦è°ƒè¯•çš„å‡½æ•°ä¸Šå¸¦ä¸Šä¸€é¡¶å¸½å­ï¼ˆè£…é¥°å™¨ï¼‰ â€“ <code>@pysnooper.snoop()</code> å³å¯ã€‚</li>
</ul>
<h3 id="è¯¦ç»†ä½¿ç”¨"><a href="#è¯¦ç»†ä½¿ç”¨" class="headerlink" title="è¯¦ç»†ä½¿ç”¨"></a>è¯¦ç»†ä½¿ç”¨</h3><h4 id="é‡å®šå‘åˆ°æ—¥å¿—æ–‡ä»¶"><a href="#é‡å®šå‘åˆ°æ—¥å¿—æ–‡ä»¶" class="headerlink" title="é‡å®šå‘åˆ°æ—¥å¿—æ–‡ä»¶"></a>é‡å®šå‘åˆ°æ—¥å¿—æ–‡ä»¶</h4><p><code>@pysnooper.snoop()</code> ä¸åŠ ä»»ä½•å‚æ•°æ—¶ï¼Œä¼šé»˜è®¤å°†è°ƒè¯•çš„ä¿¡æ¯è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚</p>
<p>å¯¹äºå•æ¬¡è°ƒè¯•å°±èƒ½è§£å†³çš„ BUG ï¼Œè¿™æ ·æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯æœ‰ä¸€äº› BUG åªæœ‰åœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹æ‰ä¼šå‡ºç°ï¼Œéœ€è¦ä½ æŠŠç¨‹åºæ”¾åœ¨åé¢è·‘ä¸ªä¸€æ®µæ—¶é—´æ‰èƒ½å¤ç°ã€‚</p>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥å°†è°ƒè¯•ä¿¡æ¯é‡å®šå‘è¾“å‡ºåˆ°æŸä¸€æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿è¿½æº¯æ’æŸ¥ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pysnooper.snoop(output='/var/log/debug.log')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_func</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h4 id="è·Ÿè¸ªéå±€éƒ¨å˜é‡å€¼"><a href="#è·Ÿè¸ªéå±€éƒ¨å˜é‡å€¼" class="headerlink" title="è·Ÿè¸ªéå±€éƒ¨å˜é‡å€¼"></a>è·Ÿè¸ªéå±€éƒ¨å˜é‡å€¼</h4><p>PySnooper æ˜¯ä»¥å‡½æ•°ä¸ºå•ä½è¿›è¡Œè°ƒè¯•çš„ï¼Œå®ƒé»˜è®¤åªä¼šè·Ÿè¸ªå‡½æ•°ä½“å†…çš„å±€éƒ¨å˜é‡ï¼Œè‹¥æƒ³è·Ÿè¸ªå…¨å±€å˜é‡ï¼Œå¯ä»¥ç»™ <code>pysnooper.snoop()</code> åŠ ä¸Š <code>watch</code> å‚æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">out = &#123;<span class="string">"foo"</span>: <span class="string">"bar"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@pysnooper.snoop(watch=('out["foo"]'))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_func</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>å¦‚æ­¤ä¸€æ¥ï¼ŒPySnooper ä¼šåœ¨ <code>out[&quot;foo&quot;]</code> å€¼æœ‰å˜åŒ–æ—¶ï¼Œä¹Ÿå°†å…¶æ‰“å°å‡ºæ¥<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20201118200531.png" alt=""><br>watch å‚æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆå¯ä»¥æ˜¯list æˆ–è€… tupleï¼‰ï¼Œé‡Œé¢çš„å…ƒç´ ä¸ºå­—ç¬¦ä¸²è¡¨è¾¾å¼ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿçœ‹ä¸‹é¢ä¾‹å­å°±çŸ¥é“äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pysnooper.snoop(watch=('out["foo"]', 'foo.bar', 'self.foo["bar"]'))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_func</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>å’Œ <code>watch</code> ç›¸å¯¹çš„ï¼Œ<code>pysnooper.snoop()</code> è¿˜å¯ä»¥æ¥æ”¶ä¸€ä¸ªå‡½æ•° <code>watch_explode</code>ï¼Œè¡¨ç¤ºé™¤äº†è¿™å‡ ä¸ªå‚æ•°å¤–çš„å…¶ä»–æ‰€æœ‰å…¨å±€å˜é‡éƒ½ç›‘æ§ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pysnooper.snoop(watch_explode=('foo', 'bar'))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_func</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h4 id="è®¾ç½®è·Ÿè¸ªå‡½æ•°çš„æ·±åº¦"><a href="#è®¾ç½®è·Ÿè¸ªå‡½æ•°çš„æ·±åº¦" class="headerlink" title="è®¾ç½®è·Ÿè¸ªå‡½æ•°çš„æ·±åº¦"></a>è®¾ç½®è·Ÿè¸ªå‡½æ•°çš„æ·±åº¦</h4><p>å½“ä½ ä½¿ç”¨ PySnooper è°ƒè¯•æŸä¸ªå‡½æ•°æ—¶ï¼Œè‹¥è¯¥å‡½æ•°ä¸­è¿˜è°ƒç”¨äº†å…¶ä»–å‡½æ•°ï¼ŒPySnooper æ˜¯ä¸ä¼šå‚»å‚»çš„è·Ÿè¸ªè¿›å»çš„ã€‚</p>
<p>å¦‚æœä½ æƒ³ç»§ç»­è·Ÿè¸ªè¯¥å‡½æ•°ä¸­è°ƒç”¨çš„å…¶ä»–å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®š <code>depth</code> å‚æ•°æ¥è®¾ç½®è·Ÿè¸ªæ·±åº¦ï¼ˆä¸æŒ‡å®šçš„è¯é»˜è®¤ä¸º 1ï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pysnooper.snoop(depth=2)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_func</span><span class="params">()</span>:</span></span><br><span class="line"> ...</span><br></pre></td></tr></table></figure>

<h4 id="è®¾ç½®è°ƒè¯•æ—¥å¿—çš„å‰ç¼€"><a href="#è®¾ç½®è°ƒè¯•æ—¥å¿—çš„å‰ç¼€" class="headerlink" title="è®¾ç½®è°ƒè¯•æ—¥å¿—çš„å‰ç¼€"></a>è®¾ç½®è°ƒè¯•æ—¥å¿—çš„å‰ç¼€</h4><p>å½“ä½ åœ¨ä½¿ç”¨ PySnooper è·Ÿè¸ªå¤šä¸ªå‡½æ•°æ—¶ï¼Œè°ƒè¯•çš„æ—¥å¿—ä¼šæ˜¾å¾—æ‚ä¹±æ— ç« ï¼Œä¸æ–¹ä¾¿æŸ¥çœ‹ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒPySnooper æä¾›äº†ä¸€ä¸ªå‚æ•°ï¼Œæ–¹ä¾¿ä½ ä¸ºä¸åŒçš„å‡½æ•°è®¾ç½®ä¸åŒçš„æ ‡å¿—ï¼Œæ–¹ä¾¿ä½ åœ¨æŸ¥çœ‹æ—¥å¿—æ—¶è¿›è¡ŒåŒºåˆ†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pysnooper.snoop(output="/var/log/debug.log", prefix="demo_func: ")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_func</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå¦‚ä¸‹<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20201118200734.png" alt=""></p>
<h4 id="è®¾ç½®æœ€å¤§çš„è¾“å‡ºé•¿åº¦"><a href="#è®¾ç½®æœ€å¤§çš„è¾“å‡ºé•¿åº¦" class="headerlink" title="è®¾ç½®æœ€å¤§çš„è¾“å‡ºé•¿åº¦"></a>è®¾ç½®æœ€å¤§çš„è¾“å‡ºé•¿åº¦</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPySnooper è¾“å‡ºçš„å˜é‡å’Œå¼‚å¸¸ä¿¡æ¯ï¼Œå¦‚æœè¶…è¿‡ 100 ä¸ªå­—ç¬¦ï¼Œè¢«ä¼šæˆªæ–­ä¸º 100 ä¸ªå­—ç¬¦ã€‚</p>
<p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šå‚æ•° è¿›è¡Œä¿®æ”¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pysnooper.snoop(max_variable_length=200ï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_func</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨max_variable_length=Noneå®ƒä»ä¸æˆªæ–­å®ƒä»¬ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pysnooper.snoop(max_variable_length=Noneï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_func</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h4 id="æ”¯æŒå¤šçº¿ç¨‹è°ƒè¯•æ¨¡å¼"><a href="#æ”¯æŒå¤šçº¿ç¨‹è°ƒè¯•æ¨¡å¼" class="headerlink" title="æ”¯æŒå¤šçº¿ç¨‹è°ƒè¯•æ¨¡å¼"></a>æ”¯æŒå¤šçº¿ç¨‹è°ƒè¯•æ¨¡å¼</h4><p>PySnooper åŒæ ·æ”¯æŒå¤šçº¿ç¨‹çš„è°ƒè¯•ï¼Œé€šè¿‡è®¾ç½®å‚æ•° <code>thread_info=True</code>ï¼Œå®ƒå°±ä¼šåœ¨æ—¥å¿—ä¸­æ‰“å°å‡ºæ˜¯åœ¨å“ªä¸ªçº¿ç¨‹å¯¹å˜é‡è¿›è¡Œçš„ä¿®æ”¹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pysnooper.snoop(thread_info=True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_func</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå¦‚ä¸‹<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20201118200903.png" alt=""></p>
<h4 id="è‡ªå®šä¹‰å¯¹è±¡çš„æ ¼å¼è¾“å‡º"><a href="#è‡ªå®šä¹‰å¯¹è±¡çš„æ ¼å¼è¾“å‡º" class="headerlink" title="è‡ªå®šä¹‰å¯¹è±¡çš„æ ¼å¼è¾“å‡º"></a>è‡ªå®šä¹‰å¯¹è±¡çš„æ ¼å¼è¾“å‡º</h4><p><code>pysnooper.snoop()</code> å‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°æ˜¯ <code>custom_repr</code>ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå…ƒç»„å¯¹è±¡ã€‚</p>
<p>åœ¨è¿™ä¸ªå…ƒç»„é‡Œï¼Œä½ å¯ä»¥æŒ‡å®šç‰¹å®šç±»å‹çš„å¯¹è±¡ä»¥ç‰¹å®šæ ¼å¼è¿›è¡Œè¾“å‡ºã€‚</p>
<p>è¿™è¾¹æˆ‘ä¸¾ä¸ªä¾‹å­ã€‚</p>
<p>å‡å¦‚æˆ‘è¦è·Ÿè¸ª <code>person</code> è¿™ä¸ª <code>Person</code> ç±»å‹çš„å¯¹è±¡ï¼Œç”±äºå®ƒä¸æ˜¯å¸¸è§„çš„ Python åŸºç¡€ç±»å‹ï¼ŒPySnooper æ˜¯æ— æ³•æ­£å¸¸è¾“å‡ºå®ƒçš„ä¿¡æ¯çš„ã€‚</p>
<p>å› æ­¤æˆ‘åœ¨ <code>pysnooper.snoop()</code> å‡½æ•°ä¸­è®¾ç½®äº† <code>custom_repr</code> å‚æ•°ï¼Œè¯¥å‚æ•°çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º <code>Person</code>ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸º <code>print_persion_obj</code> å‡½æ•°ã€‚</p>
<p>PySnooper åœ¨æ‰“å°å¯¹è±¡çš„è°ƒè¯•ä¿¡æ¯æ—¶ï¼Œä¼šé€ä¸ªåˆ¤æ–­å®ƒæ˜¯å¦æ˜¯ Person ç±»å‹çš„å¯¹è±¡ï¼Œè‹¥æ˜¯ï¼Œå°±å°†è¯¥å¯¹è±¡ä¼ å…¥ <code>print_persion_obj</code> å‡½æ•°ä¸­ï¼Œç”±è¯¥å‡½æ•°æ¥å†³å®šå¦‚ä½•æ˜¾ç¤ºè¿™ä¸ªå¯¹è±¡çš„ä¿¡æ¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pysnooper</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span><span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_person_obj</span><span class="params">(obj)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f"&lt;Person <span class="subst">&#123;obj.name&#125;</span> <span class="subst">&#123;obj.age&#125;</span> <span class="subst">&#123;obj.gender&#125;</span>&gt;"</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@pysnooper.snoop(custom_repr=(Person, print_person_obj))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_func</span><span class="params">()</span>:</span></span><br><span class="line">    person = Person()</span><br><span class="line">    person.name = <span class="string">"å†™ä»£ç çš„æ˜å“¥"</span></span><br><span class="line">    person.age = <span class="number">27</span></span><br><span class="line">    person.gender = <span class="string">"male"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> person</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    profile = demo_func()</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œä¸€ä¸‹ï¼Œè§‚å¯Ÿä¸€ä¸‹æ•ˆæœã€‚<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20201118201026.png" alt=""><br>å¦‚æœä½ è¦è‡ªå®šä¹‰æ ¼å¼è¾“å‡ºçš„æœ‰å¾ˆå¤šä¸ªç±»å‹ï¼Œé‚£ä¹ˆ custom_repr å‚æ•°çš„å€¼å¯ä»¥è¿™ä¹ˆå†™</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pysnooper.snoop(custom_repr=((Person, print_person_obj), (numpy.ndarray, print_ndarray)))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_func</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ç‚¹æˆ‘æé†’ä¸€ä¸‹ï¼Œå…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¯ä»¥æ˜¯ç±»å‹ï¼ˆå¦‚ç±»åPerson æˆ–è€…å…¶ä»–åŸºç¡€ç±»å‹ listç­‰ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ¤æ–­å¯¹è±¡ç±»å‹çš„å‡½æ•°ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸‹é¢ä¸‰ç§å†™æ³•æ˜¯ç­‰ä»·çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ã€ç¬¬ä¸€ç§å†™æ³•ã€‘</span></span><br><span class="line"><span class="meta">@pysnooper.snoop(custom_repr=(Person, print_persion_obj))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_func</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ã€ç¬¬äºŒç§å†™æ³•ã€‘</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_persion_obj</span><span class="params">(obj)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> isinstance(obj, Person)</span><br><span class="line"></span><br><span class="line"><span class="meta">@pysnooper.snoop(custom_repr=(is_persion_obj, print_persion_obj))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_func</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ã€ç¬¬ä¸‰ç§å†™æ³•ã€‘</span></span><br><span class="line"><span class="meta">@pysnooper.snoop(custom_repr=(lambda obj: isinstance(obj, Person), print_persion_obj))</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_func</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>å‹æƒ…é“¾æ¥</title>
    <url>/2020/11/15/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5/</url>
    <content><![CDATA[<h3 id="å®˜æ–¹ç½‘ç«™"><a href="#å®˜æ–¹ç½‘ç«™" class="headerlink" title="å®˜æ–¹ç½‘ç«™"></a>å®˜æ–¹ç½‘ç«™</h3><p><a href="https://docs.python.org/zh-cn/3/index.html" target="_blank" rel="noopener">Python3å®˜æ–¹æ–‡æ¡£</a></p>
<p><a href="https://docs.djangoproject.com/en/2.2/" target="_blank" rel="noopener">Djangoå®˜æ–¹æ–‡æ¡£</a></p>
<p><a href="http://djangobook.py3k.cn/2.0/" target="_blank" rel="noopener">Djangoä¸­æ–‡ç‰ˆ</a></p>
<p><a href="https://www.django-rest-framework.org/" target="_blank" rel="noopener">rest-frameworkå®˜æ–¹æ–‡æ¡£</a></p>
<p><a href="http://drf.jiuyou.info/#/" target="_blank" rel="noopener">rest-frameworkæ–‡æ¡£ä¸­æ–‡ç‰ˆ</a></p>
<p><a href="https://redis-py.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">python-rediså®˜æ–¹æ–‡æ¡£</a></p>
<p><a href="https://django-redis-chs.readthedocs.io/zh_CN/latest/#id8" target="_blank" rel="noopener">django-redis ä¸­æ–‡æ–‡æ¡£</a></p>
<p><a href="https://www.rabbitmq.com/getstarted.html" target="_blank" rel="noopener">RabbitMQå®˜æ–¹æ–‡æ¡£</a></p>
<h3 id="Pythonå­¦ä¹ "><a href="#Pythonå­¦ä¹ " class="headerlink" title="Pythonå­¦ä¹ "></a>Pythonå­¦ä¹ </h3><p><a href="https://www.the5fire.com" target="_blank" rel="noopener">the5fire: Djangoä¼ä¸šå¼€å‘å®æˆ˜ä½œè€…</a></p>
<p><a href="https://github.com/MoonMonsters/eat_pyspark_in_10_days" target="_blank" rel="noopener">å¦‚ä½•ç”¨10å¤©åƒæ‰pyspark</a></p>
<h3 id="Golangå­¦ä¹ "><a href="#Golangå­¦ä¹ " class="headerlink" title="Golangå­¦ä¹ "></a>Golangå­¦ä¹ </h3><p><a href="https://lailin.xyz/post/go-design-pattern.html" target="_blank" rel="noopener">golangè®¾è®¡æ¨¡å¼</a></p>
<p><a href="https://wskdsgcf.gitbook.io/mastering-go-zh-cn/" target="_blank" rel="noopener">mastering-go-zh-cn: golangå…¥é—¨</a></p>
<p><a href="https://github.com/unknwon/the-way-to-go_ZH_CN/blob/master/eBook/directory.md" target="_blank" rel="noopener">the-way-to-go_ZH_CN: golangå…¥é—¨</a></p>
<p><a href="https://github.com/geektutu/7days-golang" target="_blank" rel="noopener">ä»é›¶å¼€å§‹ç³»åˆ—â€¦</a></p>
<p><a href="https://chai2010.cn/advanced-go-programming-book/" target="_blank" rel="noopener">Goè¯­è¨€é«˜çº§ç¼–ç¨‹(Advanced Go Programming)</a></p>
<p><a href="https://draveness.me/golang/" target="_blank" rel="noopener">Go è¯­è¨€è®¾è®¡ä¸å®ç°</a></p>
<p><a href="https://geektutu.com" target="_blank" rel="noopener">æå®¢å…”å…”</a></p>
<h3 id="å¸¸ç”¨è½¯ä»¶"><a href="#å¸¸ç”¨è½¯ä»¶" class="headerlink" title="å¸¸ç”¨è½¯ä»¶"></a>å¸¸ç”¨è½¯ä»¶</h3><p><a href="https://gitee.com/qishibo/AnotherRedisDesktopManager" target="_blank" rel="noopener">Rediså¯è§†åŒ–å®¢æˆ·ç«¯</a></p>
<p><a href="https://dbeaver.io/download/" target="_blank" rel="noopener">æ•°æ®åº“å®¢æˆ·ç«¯</a></p>
]]></content>
  </entry>
  <entry>
    <title>Golang --- æ¥å£æ–‡æ¡£æ¡†æ¶swagger</title>
    <url>/2020/11/15/golang-%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E6%A1%86%E6%9E%B6swagger/</url>
    <content><![CDATA[<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">go get -u github.com/swaggo/swag/cmd/swag@v1.6.5</span><br><span class="line">go get -u github.com/swaggo/gin-swagger@v1.2.0</span><br><span class="line">go get -u github.com/swaggo/files</span><br><span class="line">go get -u github.com/alecthomas/template</span><br></pre></td></tr></table></figure>

<p>éªŒè¯æ˜¯å¦æˆåŠŸ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â¯ swag -v</span><br><span class="line">swag version v1.6.5</span><br></pre></td></tr></table></figure>

<h3 id="å†™å…¥æ³¨è§£"><a href="#å†™å…¥æ³¨è§£" class="headerlink" title="å†™å…¥æ³¨è§£"></a>å†™å…¥æ³¨è§£</h3><p>åœ¨å®‰è£…å®ŒSwaggerå…³è”åº“å, å°±éœ€è¦åœ¨é¡¹ç›®é‡Œçš„APIæ¥å£ç¼–å†™æ³¨è§£,ä»¥ä¾¿åç»­åœ¨ç”Ÿæˆæ—¶èƒ½å¤Ÿæ­£ç¡®çš„è¿è¡Œ.</p>
<h4 id="å¸¸ç”¨æ³¨è§£"><a href="#å¸¸ç”¨æ³¨è§£" class="headerlink" title="å¸¸ç”¨æ³¨è§£"></a>å¸¸ç”¨æ³¨è§£</h4><table>
<thead>
<tr>
<th>æ³¨è§£</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>@Summary</td>
<td>æ‘˜è¦</td>
</tr>
<tr>
<td>@Produce</td>
<td>APIå¯ä»¥é•¿ç”Ÿçš„MIMEç±»å‹çš„åˆ—è¡¨. æˆ‘ä»¬å¯ä»¥æŠŠMIMEç±»å‹ç®€å•çš„ç†è§£ä¸ºå“åº”ç±»å‹, ä¾‹å¦‚JSON, XML, HTMLç­‰.</td>
</tr>
<tr>
<td>@Param</td>
<td>å‚æ•°æ ¼å¼, ä»å·¦åˆ°å³åˆ†åˆ«ä¸º: å‚æ•°å, å…¥å‚ç±»å‹, æ•°æ®ç±»å‹, æ˜¯å¦å¿…å¡«å’Œæ³¨é‡Š</td>
</tr>
<tr>
<td>@Success</td>
<td>å“åº”æˆåŠŸ, ä»å·¦åˆ°å³åˆ†åˆ«ä¸º: çŠ¶æ€ç , å‚æ•°ç±»å‹, æ•°æ®ç±»å‹å’Œæ³¨é‡Š</td>
</tr>
<tr>
<td>@Failure</td>
<td>å“åº”å¤±è´¥, ä»å·¦åˆ°å³åˆ†åˆ«ä¸ºçŠ¶æ€ç , å‚æ•°ç±»å‹, æ•°æ®ç±»å‹å’Œæ³¨é‡Š</td>
</tr>
<tr>
<td>@Router</td>
<td>è·¯ç”±, ä»å·¦åˆ°å³åˆ†åˆ«ä¸º: è·¯ç”±åœ°å€å’ŒHTTPæ–¹æ³•</td>
</tr>
</tbody></table>
<h4 id="APIå‡½æ•°ä»£ç ç¤ºä¾‹"><a href="#APIå‡½æ•°ä»£ç ç¤ºä¾‹" class="headerlink" title="APIå‡½æ•°ä»£ç ç¤ºä¾‹"></a>APIå‡½æ•°ä»£ç ç¤ºä¾‹</h4><p>ç”¨çš„æ˜¯Ginæ¡†æ¶.</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> v1</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Tag <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewTag</span><span class="params">()</span> <span class="title">Tag</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Tag&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Tag)</span> <span class="title">Get</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @Summary è·å–å¤šä¸ªæ ‡ç­¾</span></span><br><span class="line"><span class="comment">// @Produce json</span></span><br><span class="line"><span class="comment">// @Param name query string false "æ ‡ç­¾åç§°" maxlength(100)</span></span><br><span class="line"><span class="comment">// @Param state query int false "çŠ¶æ€" Enums(0, 1) default(1)</span></span><br><span class="line"><span class="comment">// @Param page query int false "é¡µç "</span></span><br><span class="line"><span class="comment">// @Param page_size query int false "æ¯é¡µæ•°é‡"</span></span><br><span class="line"><span class="comment">// @Success 200 &#123;object&#125; model.Tag "æˆåŠŸ"</span></span><br><span class="line"><span class="comment">// @Failure 400 &#123;object&#125; errcode.Error "è¯·æ±‚é”™è¯¯"</span></span><br><span class="line"><span class="comment">// @Failure 500 &#123;object&#125; errcode.Error "å†…éƒ¨é”™è¯¯"</span></span><br><span class="line"><span class="comment">// @Router /api/v1/tags [get]</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Tag)</span> <span class="title">List</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @Summary æ–°å¢æ ‡ç­¾</span></span><br><span class="line"><span class="comment">// @Product json</span></span><br><span class="line"><span class="comment">// @Param name body string true "æ ‡ç­¾åç§°" minlength(3) maxlength(100)</span></span><br><span class="line"><span class="comment">// @Param state body int false "çŠ¶æ€" Enums(0, 1) default(1)</span></span><br><span class="line"><span class="comment">// @Param created_by body string false "åˆ›å»ºè€…" minlength(3) maxlength(100)</span></span><br><span class="line"><span class="comment">// @Success 200 &#123;object&#125; model.Tag "æˆåŠŸ"</span></span><br><span class="line"><span class="comment">// @Failure 400 &#123;object&#125; errcode.Error "è¯·æ±‚é”™è¯¯"</span></span><br><span class="line"><span class="comment">// @Failure 500 &#123;object&#125; errcode.Error "å†…éƒ¨é”™è¯¯"</span></span><br><span class="line"><span class="comment">// @Router /api/v1/tags [post]</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Tag)</span> <span class="title">Create</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @Summary æ›´æ–°æ ‡ç­¾</span></span><br><span class="line"><span class="comment">// @Produce json</span></span><br><span class="line"><span class="comment">// @Param id path int true "æ ‡ç­¾ID"</span></span><br><span class="line"><span class="comment">// @Param name body string false "æ ‡ç­¾åç§°" minlength(3) maxlength(100)</span></span><br><span class="line"><span class="comment">// @Param state body int false "çŠ¶æ€" Enums(0, 1) default(1)</span></span><br><span class="line"><span class="comment">// @Param modified_by body string true "ä¿®æ”¹è€…" minlength(3) maxlength(100)</span></span><br><span class="line"><span class="comment">// @Success 200 &#123;array&#125; model.Tag "æˆåŠŸ"</span></span><br><span class="line"><span class="comment">// @Failure 400 &#123;object&#125; errcode.Error "è¯·æ±‚é”™è¯¯"</span></span><br><span class="line"><span class="comment">// @Failure 500 &#123;object&#125; errcode.Error "å†…éƒ¨é”™è¯¯"</span></span><br><span class="line"><span class="comment">// @Router /api/v1/tags/&#123;id&#125; [put]</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Tag)</span> <span class="title">Update</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @Summary åˆ é™¤æ ‡ç­¾</span></span><br><span class="line"><span class="comment">// @Produce json</span></span><br><span class="line"><span class="comment">// @Param id path int true "æ ‡ç­¾ID"</span></span><br><span class="line"><span class="comment">// @Success 200 &#123;string&#125; string "åˆ é™¤æˆåŠŸ"</span></span><br><span class="line"><span class="comment">// @Failure 400 &#123;object&#125; errcode.Error "è¯·æ±‚é”™è¯¯"</span></span><br><span class="line"><span class="comment">// @Failure 500 &#123;object&#125; errcode.Error "å†…éƒ¨é”™è¯¯"</span></span><br><span class="line"><span class="comment">// @Router /api/v1/tags/&#123;id&#125; [delete]</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t Tag)</span> <span class="title">Delete</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="mainæ–¹æ³•"><a href="#mainæ–¹æ³•" class="headerlink" title="mainæ–¹æ³•"></a>mainæ–¹æ³•</h4><p>é’ˆå¯¹æ•´ä¸ªé¡¹ç›®, ä¹Ÿèƒ½å†™å…¥æ³¨è§£.</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="comment">// @title åšå®¢ç³»ç»Ÿ</span></span><br><span class="line"><span class="comment">// @version 1.0</span></span><br><span class="line"><span class="comment">// @description Go+Ginæ¡†æ¶çš„åšå®¢é¡¹ç›®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    router := routers.NewRouter()</span><br><span class="line"></span><br><span class="line">    s := &amp;http.Server&#123;</span><br><span class="line">        Addr:           <span class="string">":8080"</span>,</span><br><span class="line">        Handler:        router,</span><br><span class="line">        ReadTimeout:    <span class="number">10</span> * time.Second,</span><br><span class="line">        WriteTimeout:   <span class="number">10</span> * time.Second,</span><br><span class="line">        MaxHeaderBytes: <span class="number">1</span> &lt;&lt; <span class="number">20</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    s.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="ç”Ÿæˆæ–‡æ¡£"><a href="#ç”Ÿæˆæ–‡æ¡£" class="headerlink" title="ç”Ÿæˆæ–‡æ¡£"></a>ç”Ÿæˆæ–‡æ¡£</h3><p>åœ¨é¡¹ç›®çš„ä¸»ç›®å½•ä¸‹, ä½¿ç”¨å‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">swag init</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œå®Œå, å¯ä»¥çœ‹åˆ°åœ¨docsæ–‡ä»¶å¤¹ä¸­ç”Ÿæˆäº†docs.go, swagger.jsonå’Œswagger.yarmä¸‰ä¸ªæ–‡ä»¶.</p>
<h3 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h3><figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  _ <span class="string">"GoProgrammingJourney/blog_service/docs"</span></span><br><span class="line">  ginSwagger <span class="string">"github.com/swaggo/gin-swagger"</span></span><br><span class="line">  <span class="string">"github.com/swaggo/gin-swagger/swaggerFiles"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">r := gin.New()</span><br><span class="line">r.GET(<span class="string">"/swagger/*any"</span>, ginSwagger.WrapHandler(swaggerFiles.Handler))</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹æ¥å£æ–‡æ¡£"><a href="#æŸ¥çœ‹æ¥å£æ–‡æ¡£" class="headerlink" title="æŸ¥çœ‹æ¥å£æ–‡æ¡£"></a>æŸ¥çœ‹æ¥å£æ–‡æ¡£</h3><p>è®¿é—®ç½‘å€å¯ä»¥çœ‹åˆ°ç”Ÿæˆåçš„é¡¹ç›®æ–‡æ¡£äº†.<br/><br><a href="http://127.0.0.1:8080/swagger/index.html" target="_blank" rel="noopener">http://127.0.0.1:8080/swagger/index.html</a></p>
<p><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20201115143526.png" alt=""></p>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]Redis --- å¸¸è§é¢è¯•é¢˜ä¹‹ç¼“å­˜é›ªå´©ã€ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿</title>
    <url>/2020/11/08/%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B9%8B%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9%E3%80%81%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E3%80%81%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF/</url>
    <content><![CDATA[<h3 id="è½¬è½½"><a href="#è½¬è½½" class="headerlink" title="è½¬è½½"></a>è½¬è½½</h3><p><a href="https://mp.weixin.qq.com/s?__biz=MzIzMDU0MTA3Nw==&mid=2247483988&idx=1&sn=3bd52650907867d65f1c4d5c3cff8f13&chksm=e8b0902edfc71938f7d7a29246d7278ac48e6c104ba27c684e12e840892252b0823de94b94c1&token=1558933779&lang=zh_CN#rd" target="_blank" rel="noopener">å¸¸è§é¢è¯•é¢˜ä¹‹ç¼“å­˜é›ªå´©ã€ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿</a></p>
<h3 id="ç¼“å­˜åº”ç”¨"><a href="#ç¼“å­˜åº”ç”¨" class="headerlink" title="ç¼“å­˜åº”ç”¨"></a>ç¼“å­˜åº”ç”¨</h3><p>ç¼“å­˜åœ¨æˆ‘ä»¬å¹³å¸¸çš„é¡¹ç›®ä¸­å¤šå¤šå°‘å°‘éƒ½ä¼šä½¿ç”¨åˆ°ï¼Œç¼“å­˜ä½¿ç”¨çš„ä½¿ç”¨åœºæ™¯è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œç¼“å­˜æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é‡è¦ç»„ä»¶ï¼Œä¸»è¦è§£å†³é«˜å¹¶å‘ã€å¤§æ•°æ®åœºæ™¯ä¸‹ï¼Œçƒ­ç‚¹æ•°æ®è®¿é—®çš„æ€§èƒ½é—®é¢˜ã€‚æé«˜æ€§èƒ½çš„æ•°æ®å¿«é€Ÿè®¿é—®ã€‚ä¸€æåˆ°ç¼“å­˜ï¼Œè¿™äº›æ˜¯æˆ‘ä»¬éƒ½èƒ½æƒ³åˆ°çš„ä¸€äº›ç¼“å­˜åº”ç”¨åœºæ™¯ï¼Œä½†æ˜¯æˆ‘ä»¬æ˜¯ä¸å¤ªæ¸…æ¥šç¼“å­˜çš„æœ¬è´¨æ€æƒ³æ˜¯ä»€ä¹ˆçš„ã€‚ç¼“å­˜çš„åŸºæœ¬æ€æƒ³å°±æ˜¯æˆ‘ä»¬éå¸¸ç†Ÿæ‚‰çš„ç©ºé—´æ¢æ—¶é—´ã€‚ç¼“å­˜ä¹Ÿå¹¶ä¸æ˜¯é‚£ä¹ˆçš„é«˜å¤§ä¸Šï¼Œè™½ç„¶ä»–å¯ä»¥ä¸ºç³»ç»Ÿçš„æ€§èƒ½è¿›è¡Œæå‡ã€‚ç¼“å­˜çš„æ€æƒ³å®é™…åœ¨æ“ä½œç³»ç»Ÿæˆ–è€…å…¶ä»–åœ°æ–¹éƒ½è¢«å¤§é‡ç”¨åˆ°ã€‚æ¯”å¦‚ ã€Œ<strong>CPU Cache ç¼“å­˜çš„æ˜¯å†…å­˜æ•°æ®ç”¨äºè§£å†³ CPU å¤„ç†é€Ÿåº¦å’Œå†…å­˜ä¸åŒ¹é…çš„é—®é¢˜ï¼Œå†…å­˜ç¼“å­˜çš„æ˜¯ç¡¬ç›˜æ•°æ®ç”¨äºè§£å†³ç¡¬ç›˜è®¿é—®é€Ÿåº¦è¿‡æ…¢çš„é—®é¢˜ã€‚</strong>ã€ ã€Œ<strong>å†æ¯”å¦‚æ“ä½œç³»ç»Ÿåœ¨ é¡µè¡¨æ–¹æ¡ˆ åŸºç¡€ä¹‹ä¸Šå¼•å…¥äº† å¿«è¡¨ æ¥åŠ é€Ÿè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå¿«è¡¨ç†è§£ä¸ºä¸€ç§ç‰¹æ®Šçš„é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ï¼ˆCacheï¼‰ã€‚</strong>ã€</p>
<p>ä¸Šé¢ç®€å•ä»‹ç»äº†ç¼“å­˜çš„åŸºæœ¬æ€æƒ³ï¼Œç°åœ¨å›åˆ°ä¸šåŠ¡ç³»ç»Ÿæ¥è¯´ï¼š<strong>æˆ‘ä»¬ä¸ºäº†é¿å…ç”¨æˆ·åœ¨è¯·æ±‚æ•°æ®çš„æ—¶å€™è·å–é€Ÿåº¦è¿‡äºç¼“æ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ•°æ®åº“ä¹‹ä¸Šå¢åŠ äº†ç¼“å­˜è¿™ä¸€å±‚æ¥å¼¥è¡¥ã€‚</strong>ç”»ä¸ªå›¾èƒ½æ›´åŠ æ–¹ä¾¿å¤§å®¶çš„ç†è§£ï¼š</p>
<p><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20201108204545.png" alt=""><br>ç®€å•ç‚¹è¯´å½“æˆ‘ä»¬æŸ¥è¯¢ä¸€æ¡æ•°æ®æ—¶ï¼Œå…ˆå»æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜æœ‰å°±ç›´æ¥è¿”å›ï¼Œå¦‚æœæ²¡æœ‰å°±å»æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åè¿”å›ã€‚è¿™ç§æƒ…å†µä¸‹å°±å¯èƒ½ä¼šå‡ºç°ä¸€äº›ç°è±¡ã€‚</p>
<h3 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h3><h4 id="ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©"><a href="#ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©" class="headerlink" title="ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©"></a>ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©</h4><p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­è¿›è¡Œåˆ†æã€‚æ¯”å¦‚é©¬è€å¸ˆçš„æŸå®ï¼Œæˆ‘ä»¬æ‰“å¼€æŸå®çš„é¦–é¡µæ—¶ï¼Œçœ‹åˆ°ä¸€äº›å›¾ç‰‡å‘€ã€æ¨èåº—é“ºä¿¡æ¯å‘€ç­‰ç­‰ï¼Œè¿™äº›éƒ½å±äºçƒ­ç‚¹æ•°æ®ï¼Œä¸ºä»€ä¹ˆä»–ä»¬ä¼šåŠ è½½çš„é‚£ä¹ˆå¿«å‘¢ï¼Ÿå› ä¸ºä½¿ç”¨åˆ°äº†ç¼“å­˜å‘—ã€‚è¿™äº›çƒ­ç‚¹æ•°æ®éƒ½åšäº†ç¼“å­˜ï¼Œå‡è®¾ç°åœ¨æŠŠè¿™äº›çƒ­ç‚¹æ•°æ®çš„ç¼“å­˜å¤±æ•ˆæ—¶é—´ä¸ºä¸€æ ·ï¼Œç°åœ¨æˆ‘ä»¬é©¬è€å¸ˆè¦åšä¸€ä¸ªç§’æ€æ´»åŠ¨ï¼Œå‡è®¾åœ¨ç§’æ€æ´»åŠ¨æ—¶æ¯ç§’æœ‰8000ä¸ªè¯·æ±‚ï¼Œæœ¬æ¥æœ‰ç¼“å­˜æˆ‘ä»¬æ˜¯å¯ä»¥æ‰›ä½æ¯ç§’ 6000 ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯ç¼“å­˜å½“æ—¶æ‰€æœ‰çš„Keyéƒ½å¤±æ•ˆäº†ã€‚æ­¤æ—¶ 1 ç§’ 8000 ä¸ªè¯·æ±‚å…¨éƒ¨è½æ•°æ®åº“ï¼Œæ•°æ®åº“å¿…ç„¶æ‰›ä¸ä½ï¼Œå®ƒä¼šæŠ¥ä¸€ä¸‹è­¦ï¼ŒçœŸå®æƒ…å†µå¯èƒ½DBAéƒ½æ²¡ååº”è¿‡æ¥å°±ç›´æ¥æŒ‚äº†ã€‚æ­¤æ—¶ï¼Œå¦‚æœæ²¡ç”¨ä»€ä¹ˆç‰¹åˆ«çš„æ–¹æ¡ˆæ¥å¤„ç†è¿™ä¸ªæ•…éšœï¼ŒDBA å¾ˆç€æ€¥ï¼Œé‡å¯æ•°æ®åº“ï¼Œä½†æ˜¯æ•°æ®åº“ç«‹é©¬åˆè¢«æ–°çš„æµé‡ç»™æ‰“æ­»äº†ã€‚ä¸Šé¢é€ æˆç¼“å­˜é›ªå´©çš„åŸå› æ˜¯å› ä¸ºå¤±æ•ˆæ—¶é—´é€ æˆï¼Œè¿˜æœ‰ä¸€ç§å¯èƒ½æ˜¯å› ä¸ºç¼“å­˜æœåŠ¡å®•æœºã€‚<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20201108205054.png" alt=""></p>
<h4 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h4><p>è¿™é‡Œåˆ†ä¸‰ä¸ªæ—¶é—´æ®µè¿›è¡Œè¿›è¡Œåˆ†æ</p>
<h5 id="äº‹å‰"><a href="#äº‹å‰" class="headerlink" title="äº‹å‰"></a>äº‹å‰</h5><p>å¦‚æœç¼“å­˜é›ªå´©é€ æˆçš„åŸå› æ˜¯å› ä¸ºç¼“å­˜æœåŠ¡å®•æœºé€ æˆçš„ï¼Œå¯ä»¥å°†redisé‡‡ç”¨é›†ç¾¤éƒ¨ç½²ï¼Œå¯ä»¥ä½¿ç”¨ ä¸»ä»+å“¨å…µ ï¼ŒRedis Cluster æ¥é¿å… Redis å…¨ç›˜å´©æºƒçš„æƒ…å†µã€‚è‹¥ç¼“å­˜é›ªå´©æ˜¯å› ä¸ºå¤§é‡ç¼“å­˜å› ä¸ºå¤±æ•ˆæ—¶é—´è€Œé€ æˆçš„ï¼Œæˆ‘ä»¬åœ¨æ‰¹é‡å¾€rediså­˜æ•°æ®çš„æ—¶å€™ï¼ŒæŠŠæ¯ä¸ªKeyçš„å¤±æ•ˆæ—¶é—´éƒ½åŠ ä¸ªéšæœºå€¼å°±å¥½äº†ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ•°æ®ä¸ä¼šåœ¨åŒä¸€æ—¶é—´å¤§é¢ç§¯å¤±æ•ˆï¼Œæˆ–è€…è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸è¿œä¸è¿‡æœŸï¼Œæœ‰æ›´æ–°æ“ä½œå°±æ›´æ–°ç¼“å­˜å°±å¯ä»¥äº†ã€‚</p>
<h5 id="äº‹ä¸­"><a href="#äº‹ä¸­" class="headerlink" title="äº‹ä¸­"></a>äº‹ä¸­</h5><p>å¦‚æœæˆ‘ä»¬ä¹‹å‰æ²¡æœ‰è€ƒè™‘ç¼“å­˜é›ªå´©çš„é—®é¢˜ï¼Œé‚£ä¹ˆåœ¨å®é™…ä½¿ç”¨ä¸­çœŸçš„å‘ç”Ÿç¼“å­˜é›ªå´©äº†ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ—¶æˆ‘ä»¬å°±è¦è€ƒè™‘ä½¿ç”¨å…¶ä»–æ–¹æ³•é¿å…å‡ºç°è¿™ç§æƒ…å†µäº†ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ehcache æœ¬åœ°ç¼“å­˜ + Hystrix é™æµ&amp;é™çº§ ,é¿å… MySQL è¢«æ‰“æ­»çš„æƒ…å†µå‘ç”Ÿã€‚<br>è¿™é‡Œä½¿ç”¨echacheæœ¬åœ°ç¼“å­˜çš„ç›®çš„å°±æ˜¯è€ƒè™‘åœ¨ Redis Cluster å®Œå…¨ä¸å¯ç”¨çš„æ—¶å€™ï¼Œehcache æœ¬åœ°ç¼“å­˜è¿˜èƒ½å¤Ÿæ”¯æ’‘ä¸€é˜µã€‚</p>
<p>ä½¿ç”¨ Hystrix è¿›è¡Œ é™æµ &amp; é™çº§ ï¼Œæ¯”å¦‚ä¸€ç§’æ¥äº†5000ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å‡è®¾åªèƒ½æœ‰ä¸€ç§’ 2000 ä¸ªè¯·æ±‚èƒ½é€šè¿‡è¿™ä¸ªç»„ä»¶ï¼Œé‚£ä¹ˆå…¶ä»–å‰©ä½™çš„ 3000 è¯·æ±‚å°±ä¼šèµ°é™æµé€»è¾‘ï¼Œç„¶åå»è°ƒç”¨æˆ‘ä»¬è‡ªå·±å¼€å‘çš„é™çº§ç»„ä»¶ï¼ˆé™çº§ï¼‰ã€‚æ¯”å¦‚è®¾ç½®çš„ä¸€äº›é»˜è®¤å€¼å‘€ä¹‹ç±»çš„ã€‚ä»¥æ­¤æ¥ä¿æŠ¤æœ€åçš„ MySQL ä¸ä¼šè¢«å¤§é‡çš„è¯·æ±‚ç»™æ‰“æ­»ã€‚</p>
<h5 id="äº‹å"><a href="#äº‹å" class="headerlink" title="äº‹å"></a>äº‹å</h5><p>å¦‚æœç¼“å­˜æœåŠ¡å®•æœºäº†ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥å¼€å¯ã€ŒRedisã€ æŒä¹…åŒ– ã€ŒRDBã€+ã€ŒAOFã€ï¼Œä¸€æ—¦é‡å¯ï¼Œè‡ªåŠ¨ä»ç£ç›˜ä¸ŠåŠ è½½æ•°æ®ï¼Œå¿«é€Ÿæ¢å¤ç¼“å­˜æ•°æ®ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œå¯ç”»å‡ºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20201108205219.png" alt=""></p>
<h3 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h3><h4 id="ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€"><a href="#ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€" class="headerlink" title="ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€"></a>ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€</h4><p>åœ¨æ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·æŸ¥è¯¢æ•°æ®éƒ½æ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯åœ¨å¼‚å¸¸æƒ…å†µä¸‹ï¼Œç¼“å­˜ä¸æ•°æ®éƒ½æ²¡æœ‰æ•°æ®ï¼Œä½†æ˜¯ç”¨æˆ·ä¸æ–­å‘èµ·è¯·æ±‚ï¼Œè¿™æ ·æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæ‰“åˆ°æ•°æ®åº“ä¸Šé¢å»ï¼Œè¿™æ—¶çš„ç”¨æˆ·å¾ˆå¯èƒ½æ˜¯æ”»å‡»è€…ï¼Œæ”»å‡»ä¼šå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼Œä¸¥é‡ä¼šå‡»å®æ•°æ®åº“ã€‚<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20201108205312.png" alt=""></p>
<h4 id="è§£å†³åŠæ³•-1"><a href="#è§£å†³åŠæ³•-1" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h4><h5 id="æ·»åŠ å‚æ•°æ ¡éªŒ"><a href="#æ·»åŠ å‚æ•°æ ¡éªŒ" class="headerlink" title="æ·»åŠ å‚æ•°æ ¡éªŒ"></a>æ·»åŠ å‚æ•°æ ¡éªŒ</h5><p>æˆ‘åˆšå…¥èŒçš„æ—¶å€™ï¼Œæˆ‘çš„è€å¤§å°±è·Ÿæˆ‘è¯´è¿‡ï¼Œä½œä¸ºä¸€ååç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸è¦ç›¸ä¿¡å‰ç«¯ä¼ æ¥çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æ•°æ®ä¸€å®šè¦åœ¨åç«¯è¿›è¡Œæ ¡éªŒã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ¥å£å±‚æ·»åŠ æ ¡éªŒï¼Œä¸åˆæ³•çš„ç›´æ¥è¿”å›å³å¯ï¼Œæ²¡å¿…è¦åšåç»­çš„æ“ä½œã€‚</p>
<h5 id="ç¼“å­˜ç©ºå€¼"><a href="#ç¼“å­˜ç©ºå€¼" class="headerlink" title="ç¼“å­˜ç©ºå€¼"></a>ç¼“å­˜ç©ºå€¼</h5><p>ä¸Šé¢æˆ‘ä»¬ä¹Ÿä»‹ç»äº†ï¼Œä¹‹æ‰€ä»¥ä¼šå‘ç”Ÿç©¿é€ï¼Œå°±æ˜¯å› ä¸ºç¼“å­˜ä¸­æ²¡æœ‰å­˜å‚¨è¿™äº›ç©ºæ•°æ®çš„keyã€‚ä»è€Œå¯¼è‡´æ¯æ¬¡æŸ¥è¯¢éƒ½åˆ°æ•°æ®åº“å»äº†ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä¸ºè¿™äº›key è®¾ç½®çš„å€¼è®¾ç½®ä¸ºnull ä¸¢åˆ°ç¼“å­˜é‡Œé¢å»ã€‚åé¢å†å‡ºç°æŸ¥è¯¢è¿™ä¸ªkey çš„è¯·æ±‚çš„æ—¶å€™ï¼Œç›´æ¥è¿”å›null ,å°±ä¸ç”¨åœ¨åˆ° æ•°æ®åº“ä¸­å»èµ°ä¸€åœˆäº†ã€‚ä½†æ˜¯åˆ«å¿˜äº†è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</p>
<h5 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h5><p>redisçš„ä¸€ä¸ªé«˜çº§ç”¨æ³•å°±æ˜¯ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰ï¼ŒBloomFilter ç±»ä¼¼äºä¸€ä¸ªhase set ç”¨æ¥åˆ¤æ–­æŸä¸ªå…ƒç´ ï¼ˆkeyï¼‰æ˜¯å¦å­˜åœ¨äºæŸä¸ªé›†åˆä¸­ã€‚è¿™ä¸ªä¹Ÿèƒ½å¾ˆå¥½çš„é˜²æ­¢ç¼“å­˜ç©¿é€çš„å‘ç”Ÿï¼Œä»–çš„åŸç†ä¹Ÿå¾ˆç®€å•å°±æ˜¯åˆ©ç”¨é«˜æ•ˆçš„æ•°æ®ç»“æ„å’Œç®—æ³•å¿«é€Ÿåˆ¤æ–­å‡ºä½ è¿™ä¸ªKeyæ˜¯å¦åœ¨æ•°æ®åº“ä¸­å­˜åœ¨ï¼Œä¸å­˜åœ¨ä½ returnå°±å¥½äº†ï¼Œå­˜åœ¨ä½ å°±å»æŸ¥äº†DBåˆ·æ–°KVå†returnã€‚</p>
<p><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/20201108205409.png" alt=""></p>
<p>ä¸Šé¢ä»‹ç»äº†ä¸‰ç§æ–¹æ³•ï¼Œç”¨å“ªç§æ–¹æ³•æœ€å¥½å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼š</p>
<p>ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæ·»åŠ å‚æ•°æ ¡éªŒï¼Œè¿™é‡Œæ˜¯å¿…é¡»è¦æ·»åŠ ï¼Œä¸è¿‡åªèƒ½è¿‡æ»¤æ‰ä¸€äº›ç‰¹æ®Šå€¼ï¼Œæ¯”å¦‚ä¼ çš„idä¸ºè´Ÿæ•°ï¼Œå¦‚æœä¼ çš„æ­£å¸¸idï¼Œè¿™é‡Œå‚æ•°æ ¡éªŒå°±ä¸èµ·ä½œç”¨äº†ã€‚</p>
<p>ç¬¬äºŒç§æ–¹æ³•ï¼Œå¦‚æœæœ‰ä¸€äº›æ¶æ„æ”»å‡»ï¼Œæ”»å‡»ä¼šå¸¦æ¥å¤§é‡çš„ke yæ˜¯ä¸å­˜åœ¨çš„ï¼Œè¿™æ ·é‡‡ç”¨ç¬¬äºŒç§æ–¹æ³•å°±ä¸åˆé€‚äº†ã€‚æ‰€ä»¥é’ˆå¯¹è¿™ç§key å¼‚å¸¸å¤šï¼Œè¯·æ±‚é‡å¤ç‡æ¯”è¾ƒä½çš„æ•°æ®ï¼Œæˆ‘ä»¬å°±æ²¡æœ‰å¿…è¦è¿›è¡Œç¼“å­˜ï¼Œä½¿ç”¨ç¬¬ä¸‰ç§æ–¹æ¡ˆç›´æ¥è¿‡æ»¤æ‰ã€‚</p>
<p>å¦‚æœå¯¹äºç©ºæ•°æ®keyæœ‰é™çš„ï¼Œé‡å¤ç‡æ¯”è¾ƒé«˜çš„ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥é‡‡ç”¨ç¬¬äºŒç§æ–¹å¼è¿›è¡Œç¼“å­˜ã€‚</p>
<h3 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h3><h4 id="ä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿"><a href="#ä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿" class="headerlink" title="ä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿"></a>ä»€ä¹ˆæ˜¯ç¼“å­˜å‡»ç©¿</h4><p>æˆ‘ä»¬åœ¨å¹³å¸¸é«˜å¹¶å‘çš„ç³»ç»Ÿä¸­ï¼Œå¤§é‡çš„è¯·æ±‚åŒæ—¶æŸ¥è¯¢ä¸€ä¸ªkeyæ—¶ï¼Œå‡è®¾æ­¤æ—¶ï¼Œè¿™ä¸ªkeyæ­£å¥½å¤±æ•ˆäº†ï¼Œå°±ä¼šå¯¼è‡´å¤§é‡çš„è¯·æ±‚éƒ½æ‰“åˆ°æ•°æ®åº“ä¸Šé¢å»ï¼Œè¿™ç§ç°è±¡æˆ‘ä»¬ç§°ä¸ºå‡»ç©¿ã€‚</p>
<p>è¿™ä¹ˆçœ‹ç¼“å­˜å‡»ç©¿å’Œç¼“å­˜é›ªå´©æœ‰ç‚¹åƒï¼Œä½†æ˜¯åˆæœ‰ä¸€ç‚¹ä¸ä¸€æ ·ï¼Œç¼“å­˜é›ªå´©æ˜¯å› ä¸ºå¤§é¢ç§¯çš„ç¼“å­˜å¤±æ•ˆï¼Œæ‰“å´©äº†DBï¼Œè€Œç¼“å­˜å‡»ç©¿ä¸åŒçš„æ˜¯ã€Œç¼“å­˜å‡»ç©¿ã€æ˜¯æŒ‡ä¸€ä¸ªKeyéå¸¸çƒ­ç‚¹ï¼Œåœ¨ä¸åœçš„æ‰›ç€å¤§å¹¶å‘ï¼Œå¤§å¹¶å‘é›†ä¸­å¯¹è¿™ä¸€ä¸ªç‚¹è¿›è¡Œè®¿é—®ï¼Œå½“è¿™ä¸ªKeyåœ¨å¤±æ•ˆçš„ç¬é—´ï¼ŒæŒç»­çš„å¤§å¹¶å‘å°±ç©¿ç ´ç¼“å­˜ï¼Œç›´æ¥è¯·æ±‚æ•°æ®åº“ï¼Œå°±åƒåœ¨ä¸€ä¸ªå®Œå¥½æ— æŸçš„æ¡¶ä¸Šå‡¿å¼€äº†ä¸€ä¸ªæ´ã€‚</p>
<p>ç¼“å­˜å‡»ç©¿å¸¦æ¥çš„é—®é¢˜å°±æ˜¯ä¼šé€ æˆæŸä¸€æ—¶åˆ»æ•°æ®åº“è¯·æ±‚é‡è¿‡å¤§ï¼Œå‹åŠ›å‰§å¢ã€‚</p>
<h4 id="è§£å†³åŠæ³•-2"><a href="#è§£å†³åŠæ³•-2" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h4><h5 id="ä¸è¿‡æœŸ"><a href="#ä¸è¿‡æœŸ" class="headerlink" title="ä¸è¿‡æœŸ"></a>ä¸è¿‡æœŸ</h5><p>æˆ‘ä»¬ç®€å•ç²—æš´ç‚¹ï¼Œç›´æ¥è®©çƒ­ç‚¹æ•°æ®æ°¸è¿œä¸è¿‡æœŸï¼Œå®šæ—¶ä»»åŠ¡å®šæœŸå»åˆ·æ–°æ•°æ®å°±å¯ä»¥äº†ã€‚ä¸è¿‡è¿™æ ·è®¾ç½®éœ€è¦åŒºåˆ†åœºæ™¯ï¼Œæ¯”å¦‚æŸå®é¦–é¡µå¯ä»¥è¿™ä¹ˆåšã€‚</p>
<h5 id="äº’æ–¥é”"><a href="#äº’æ–¥é”" class="headerlink" title="äº’æ–¥é”"></a>äº’æ–¥é”</h5><p>ä¸ºäº†é¿å…å‡ºç°ç¼“å­˜å‡»ç©¿çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¬¬ä¸€ä¸ªè¯·æ±‚å»æŸ¥è¯¢æ•°æ®åº“çš„æ—¶å€™å¯¹ä»–åŠ ä¸€ä¸ªäº’æ–¥é”ï¼Œå…¶ä½™çš„æŸ¥è¯¢è¯·æ±‚éƒ½ä¼šè¢«é˜»å¡ä½ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ï¼Œåé¢çš„çº¿ç¨‹è¿›æ¥å‘ç°å·²ç»æœ‰ç¼“å­˜äº†ï¼Œå°±ç›´æ¥èµ°ç¼“å­˜ï¼Œä»è€Œä¿æŠ¤æ•°æ®åº“ã€‚ä½†æ˜¯ä¹Ÿæ˜¯ç”±äºå®ƒä¼šé˜»å¡å…¶ä»–çš„çº¿ç¨‹ï¼Œæ­¤æ—¶ç³»ç»Ÿååé‡ä¼šä¸‹é™ã€‚éœ€è¦ç»“åˆå®é™…çš„ä¸šåŠ¡å»è€ƒè™‘æ˜¯å¦è¦è¿™ä¹ˆåšã€‚</p>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]Golang --- beegoæ¡†æ¶å…¥é—¨</title>
    <url>/2020/11/08/golang-%E8%BD%AC-beego%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<p><a href="https://www.jianshu.com/u/4bede98c5ae5" target="_blank" rel="noopener">è½¬è½½è‡³Clown1995</a></p>
<p><a href="https://www.jianshu.com/p/462e23ae402c" target="_blank" rel="noopener">Beegoè„±å‘ï¼ˆä¸€ï¼‰Beegoç®€ä»‹å’Œå®‰è£…</a></p>
<p><a href="https://www.jianshu.com/p/5a586b06c55f" target="_blank" rel="noopener">Beegoè„±å‘ï¼ˆäºŒï¼‰æ–°å»ºBeegoé¡¹ç›®</a></p>
<p><a href="https://www.jianshu.com/p/d0d1462113d4" target="_blank" rel="noopener">Beegoè„±å‘ï¼ˆä¸‰ï¼‰Router</a></p>
<p><a href="https://www.jianshu.com/p/a0ece5f05ab9" target="_blank" rel="noopener">Beegoè„±å‘ï¼ˆå››ï¼‰Controller</a></p>
<p><a href="https://www.jianshu.com/p/fa3dbf8aa774" target="_blank" rel="noopener">Beegoè„±å‘ï¼ˆäº”ï¼‰ä½¿ç”¨æ¨¡æ¿è·å–æ•°æ®</a></p>
<p><a href="https://www.jianshu.com/p/69c8b3f8d58c" target="_blank" rel="noopener">Beegoè„±å‘ï¼ˆå…­ï¼‰å¤šç§æ ¼å¼æ•°æ®è¾“å‡º</a></p>
<p><a href="https://www.jianshu.com/p/43459409ec00" target="_blank" rel="noopener">Beegoè„±å‘ï¼ˆä¸ƒï¼‰è·å–è¡¨å•æ•°æ®å¹¶è§£æåˆ°ç»“æ„ä½“</a></p>
<p><a href="https://www.jianshu.com/p/37abab5808bb" target="_blank" rel="noopener">Beegoè„±å‘ï¼ˆå…«ï¼‰è¡¨å•æ•°æ®éªŒè¯</a></p>
<p><a href="https://www.jianshu.com/p/9aee6d938c49" target="_blank" rel="noopener">Beegoè„±å‘ï¼ˆä¹ï¼‰Cookieå’ŒSession</a></p>
<p><a href="https://www.jianshu.com/p/a519cf3ff3b7" target="_blank" rel="noopener">Beegoè„±å‘ï¼ˆåï¼‰æ•°æ®ç»‘å®š</a></p>
<p><a href="https://www.jianshu.com/p/a63953b32e60" target="_blank" rel="noopener">Beegoè„±å‘ï¼ˆåä¸€ï¼‰æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½</a></p>
<p><a href="https://www.jianshu.com/p/a65cad84a4b9" target="_blank" rel="noopener">Beegoè„±å‘ï¼ˆåäºŒï¼‰ORMä»‹ç»å¹¶åˆ›å»ºç¬¬ä¸€ä¸ªè¡¨</a></p>
<p><a href="https://www.jianshu.com/p/d6bf1e3d6187" target="_blank" rel="noopener">Beegoè„±å‘ï¼ˆåä¸‰ï¼‰ORMåŸºæœ¬å¢åˆ æ”¹æŸ¥</a></p>
<p><a href="https://www.jianshu.com/p/6a1da3390615" target="_blank" rel="noopener">Beegoè„±å‘ï¼ˆåå››ï¼‰ORMé«˜çº§æŸ¥è¯¢</a></p>
<p><a href="https://www.jianshu.com/p/a0ffd74e7481" target="_blank" rel="noopener">Beegoè„±å‘ï¼ˆåäº”ï¼‰ORMå…³ç³»æŸ¥è¯¢</a></p>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>beego</tag>
      </tags>
  </entry>
  <entry>
    <title>[è½¬]Golang --- è§£å¯†Goåç¨‹çš„æ ˆå†…å­˜ç®¡ç†</title>
    <url>/2020/10/12/golang-%E8%BD%AC-%E8%A7%A3%E5%AF%86Go%E5%8D%8F%E7%A8%8B%E7%9A%84%E6%A0%88%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<p>è½¬è½½ï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzUzNTY5MzU2MA==&mid=2247485886&idx=1&sn=f29fe2ce95a485e2c2ef1c4cd33b5085&chksm=fa80d829cdf7513fdf45b16be023809d9725b150803b6482643c3dd84aa3c0090c2cb9efd3aa&token=940952510&lang=zh_CN#rd" target="_blank" rel="noopener">è§£å¯†Goåç¨‹çš„æ ˆå†…å­˜ç®¡ç†</a></p>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]Golang --- å›¾è§£Goå†…å­˜ç®¡ç†å™¨çš„å†…å­˜åˆ†é…ç­–ç•¥</title>
    <url>/2020/10/12/golang-%E8%BD%AC-%E5%9B%BE%E8%A7%A3Go%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%99%A8%E7%9A%84%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5/</url>
    <content><![CDATA[<p>è½¬è½½ï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzUzNTY5MzU2MA==&mid=2247485736&idx=1&sn=921a9dfe3d638074b68a4fd072ea3cb9&chksm=fa80d8bfcdf751a948ea49ee620ca9d88ff0a62b4ad4e3a53321fee6813b8f90098fd72f7b11&token=940952510&lang=zh_CN#rd" target="_blank" rel="noopener">å›¾è§£Goå†…å­˜ç®¡ç†å™¨çš„å†…å­˜åˆ†é…ç­–ç•¥</a></p>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]Golang --- å›¾æ–‡ç»“åˆï¼Œç™½è¯Goçš„åƒåœ¾å›æ”¶åŸç†</title>
    <url>/2020/10/12/golang-%E8%BD%AC-%E5%9B%BE%E6%96%87%E7%BB%93%E5%90%88%EF%BC%8C%E7%99%BD%E8%AF%9DGo%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<p>è½¬è½½: <a href="https://zhuanlan.zhihu.com/p/264789260" target="_blank" rel="noopener">å›¾æ–‡ç»“åˆï¼Œç™½è¯Goçš„åƒåœ¾å›æ”¶åŸç†</a></p>
<p><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/hexo/v2-9515a7f1156f98371a25361572b25f0d_720w.jpg" alt=""></p>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2020/09/21/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
<h3 id="æ›´æ¢ç”µè„‘åï¼Œå¦‚ä½•æ›´æ–°åšå®¢"><a href="#æ›´æ¢ç”µè„‘åï¼Œå¦‚ä½•æ›´æ–°åšå®¢" class="headerlink" title="æ›´æ¢ç”µè„‘åï¼Œå¦‚ä½•æ›´æ–°åšå®¢"></a>æ›´æ¢ç”µè„‘åï¼Œå¦‚ä½•æ›´æ–°åšå®¢</h3><p><a href="https://www.zhihu.com/question/21193762/answer/79109280" target="_blank" rel="noopener">ä½¿ç”¨hexoï¼Œå¦‚æœæ¢äº†ç”µè„‘æ€ä¹ˆæ›´æ–°åšå®¢ï¼Ÿ</a></p>
<h4 id="å…³äºæ—¥å¸¸çš„æ”¹åŠ¨æµç¨‹"><a href="#å…³äºæ—¥å¸¸çš„æ”¹åŠ¨æµç¨‹" class="headerlink" title="å…³äºæ—¥å¸¸çš„æ”¹åŠ¨æµç¨‹"></a>å…³äºæ—¥å¸¸çš„æ”¹åŠ¨æµç¨‹</h4><ol>
<li>ä¾æ¬¡æ‰§è¡Œgit add .ã€git commit -m â€œâ€¦â€ã€git push origin hexoæŒ‡ä»¤å°†æ”¹åŠ¨æ¨é€åˆ°GitHubï¼ˆæ­¤æ—¶å½“å‰åˆ†æ”¯åº”ä¸ºhexoï¼‰</li>
<li>ç„¶åæ‰æ‰§è¡Œhexo g -då‘å¸ƒç½‘ç«™åˆ°masteråˆ†æ”¯ä¸Š</li>
</ol>
]]></content>
      <categories>
        <category>ç½®é¡¶</category>
      </categories>
  </entry>
  <entry>
    <title>Golang --- ä½¿ç”¨å‡½æ•°è‡ªå®šä¹‰æ’åº</title>
    <url>/2020/06/06/golang-%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<h1 id="golang-ä½¿ç”¨å‡½æ•°è‡ªå®šä¹‰æ’åº"><a href="#golang-ä½¿ç”¨å‡½æ•°è‡ªå®šä¹‰æ’åº" class="headerlink" title="golang - ä½¿ç”¨å‡½æ•°è‡ªå®šä¹‰æ’åº"></a>golang - ä½¿ç”¨å‡½æ•°è‡ªå®šä¹‰æ’åº</h1><p>æœ‰æ—¶å€™æˆ‘ä»¬æƒ³ä½¿ç”¨å’Œé›†åˆçš„è‡ªç„¶æ’åºä¸åŒçš„æ–¹æ³•å¯¹é›†åˆè¿›è¡Œæ’åºã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³æŒ‰ç…§å­—æ¯çš„é•¿åº¦è€Œä¸æ˜¯é¦–å­—æ¯é¡ºåºå¯¹å­—ç¬¦ä¸²æ’åºã€‚ </p>
<p>åœ¨golangè‡ªå¸¦çš„sortæ¨¡å—ä¸­, å¯ä»¥å…ˆé˜…è¯»ä¸‹å‡½æ•°çš„ä»£ç :</p>
<p><code>sort.Sort</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sort</span><span class="params">(data Interface)</span></span> &#123;</span><br><span class="line">    n := data.Len()</span><br><span class="line">    quickSort(data, <span class="number">0</span>, n, maxDepth(n))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>sort.quickSort</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">quickSort</span><span class="params">(data Interface, a, b, maxDepth <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> b-a &gt; <span class="number">12</span> &#123; <span class="comment">// Use ShellSort for slices &lt;= 12 elements</span></span><br><span class="line">        <span class="keyword">if</span> maxDepth == <span class="number">0</span> &#123;</span><br><span class="line">            heapSort(data, a, b)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        maxDepth--</span><br><span class="line">        mlo, mhi := doPivot(data, a, b)</span><br><span class="line">        <span class="comment">// Avoiding recursion on the larger subproblem guarantees</span></span><br><span class="line">        <span class="comment">// a stack depth of at most lg(b-a).</span></span><br><span class="line">        <span class="keyword">if</span> mlo-a &lt; b-mhi &#123;</span><br><span class="line">            quickSort(data, a, mlo, maxDepth)</span><br><span class="line">            a = mhi <span class="comment">// i.e., quickSort(data, mhi, b)</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            quickSort(data, mhi, b, maxDepth)</span><br><span class="line">            b = mlo <span class="comment">// i.e., quickSort(data, a, mlo)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> b-a &gt; <span class="number">1</span> &#123;</span><br><span class="line">        <span class="comment">// Do ShellSort pass with gap 6</span></span><br><span class="line">        <span class="comment">// It could be written in this simplified form cause b-a &lt;= 12</span></span><br><span class="line">        <span class="keyword">for</span> i := a + <span class="number">6</span>; i &lt; b; i++ &#123;</span><br><span class="line">            <span class="keyword">if</span> data.Less(i, i<span class="number">-6</span>) &#123;</span><br><span class="line">                data.Swap(i, i<span class="number">-6</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        insertionSort(data, a, b)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>å…·ä½“å®ç°æ–¹å¼å¯ä»¥æš‚æ—¶å¿½ç•¥, ä»ä¸­æ‰¾åˆ°å‡ ä¸ªé‡ç‚¹:</p>
<ol>
<li>å‚æ•°æ˜¯ Interface ç±»å‹</li>
<li>éœ€è¦é‡å†™Interfaceä¸‹çš„ä¸‰ä¸ªå‡½æ•°, <code>Len()</code>, <code>Swap()</code>, <code>Less()</code></li>
</ol>
<p><code>sort.Interface</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface <span class="keyword">interface</span> &#123;</span><br><span class="line">    <span class="comment">// Len is the number of elements in the collection.</span></span><br><span class="line">    Len() <span class="keyword">int</span></span><br><span class="line">    <span class="comment">// Less reports whether the element with</span></span><br><span class="line">    <span class="comment">// index i should sort before the element with index j.</span></span><br><span class="line">    Less(i, j <span class="keyword">int</span>) <span class="keyword">bool</span></span><br><span class="line">    <span class="comment">// Swap swaps the elements with indexes i and j.</span></span><br><span class="line">    Swap(i, j <span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>å…·ä½“å®ç°å¦‚ä¸‹:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">æ–¹ä¾¿å®ç°æ’åºåŠŸèƒ½, è‡ªå®šä¹‰ç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> StringSortByLength []<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">ä»sort.Sortçš„ä»£ç çœ‹, éœ€è¦å®ç°è¿™ä¸¤ä¸ªå‡½æ•°æ‰èƒ½å®ç°è‡ªå®šä¹‰çš„æ’åºåŠŸèƒ½</span></span><br><span class="line"><span class="comment">Lesså‡½æ•°æ˜¯æ§åˆ¶å®é™…çš„è‡ªå®šä¹‰æ’åºé€»è¾‘</span></span><br><span class="line"><span class="comment">æƒ³å®ç°æŒ‰é•¿åº¦æ’åºåŠŸèƒ½, é‚£ä¹ˆå°±è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦, å¹¶åœ¨Lessä¸­ä½¿ç”¨lenæ¯”è¾ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s StringSortByLength)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s StringSortByLength)</span> <span class="title">Swap</span><span class="params">(i <span class="keyword">int</span>, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    s[i], s[j] = s[j], s[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s StringSortByLength)</span> <span class="title">Less</span><span class="params">(i <span class="keyword">int</span>, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(s[i]) &lt; <span class="built_in">len</span>(s[j])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    types := StringSortByLength&#123;<span class="string">"string"</span>, <span class="string">"int"</span>, <span class="string">"float"</span>, <span class="string">"float64"</span>, <span class="string">"int32"</span>&#125;</span><br><span class="line">    sort.Sort(types)</span><br><span class="line">    fmt.Println(types)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Golang</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]Golang --- web - ä¸­é—´ä»¶ä»‹ç»</title>
    <url>/2020/06/06/%E8%BD%AC-golang-web-%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<p>æœ¬ç« å°†å¯¹ç°åœ¨æµè¡Œçš„Webæ¡†æ¶ä¸­çš„ä¸­é—´ä»¶(middleware)æŠ€æœ¯åŸç†è¿›è¡Œåˆ†æï¼Œå¹¶ä»‹ç»å¦‚ä½•ä½¿ç”¨ä¸­é—´ä»¶æŠ€æœ¯å°†ä¸šåŠ¡å’Œéä¸šåŠ¡ä»£ç åŠŸèƒ½è¿›è¡Œè§£è€¦ã€‚</p>
<h3 id="ä»£ç æ³¥æ½­"><a href="#ä»£ç æ³¥æ½­" class="headerlink" title="ä»£ç æ³¥æ½­"></a>ä»£ç æ³¥æ½­</h3><p>å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// middleware/hello.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(wr http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    wr.Write([]<span class="keyword">byte</span>(<span class="string">"hello"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    http.HandleFunc(<span class="string">"/"</span>, hello)</span><br><span class="line">    err := http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„WebæœåŠ¡ï¼ŒæŒ‚è½½äº†ä¸€ä¸ªç®€å•çš„è·¯ç”±ã€‚æˆ‘ä»¬çš„çº¿ä¸ŠæœåŠ¡ä¸€èˆ¬ä¹Ÿæ˜¯ä»è¿™æ ·ç®€å•çš„æœåŠ¡å¼€å§‹é€æ¸æ‹“å±•å¼€å»çš„ã€‚</p>
<p>ç°åœ¨çªç„¶æ¥äº†ä¸€ä¸ªæ–°çš„éœ€æ±‚ï¼Œæˆ‘ä»¬æƒ³è¦ç»Ÿè®¡ä¹‹å‰å†™çš„helloæœåŠ¡çš„å¤„ç†è€—æ—¶ï¼Œéœ€æ±‚å¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯¹ä¸Šé¢çš„ç¨‹åºè¿›è¡Œå°‘é‡ä¿®æ”¹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// middleware/hello_with_time_elapse.go</span></span><br><span class="line"><span class="keyword">var</span> logger = log.New(os.Stdout, <span class="string">""</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(wr http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    timeStart := time.Now()</span><br><span class="line">    wr.Write([]<span class="keyword">byte</span>(<span class="string">"hello"</span>))</span><br><span class="line">    timeElapsed := time.Since(timeStart)</span><br><span class="line">    logger.Println(timeElapsed)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä¾¿å¯ä»¥åœ¨æ¯æ¬¡æ¥æ”¶åˆ°httpè¯·æ±‚æ—¶ï¼Œæ‰“å°å‡ºå½“å‰è¯·æ±‚æ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚</p>
<a id="more"></a>

<p>å®Œæˆäº†è¿™ä¸ªéœ€æ±‚ä¹‹åï¼Œæˆ‘ä»¬ç»§ç»­è¿›è¡Œä¸šåŠ¡å¼€å‘ï¼Œæä¾›çš„APIé€æ¸å¢åŠ ï¼Œç°åœ¨æˆ‘ä»¬çš„è·¯ç”±çœ‹èµ·æ¥æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// middleware/hello_with_more_routes.go</span></span><br><span class="line"><span class="comment">// çœç•¥äº†ä¸€äº›ç›¸åŒçš„ä»£ç </span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">helloHandler</span><span class="params">(wr http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">showInfoHandler</span><span class="params">(wr http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">showEmailHandler</span><span class="params">(wr http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">showFriendsHandler</span><span class="params">(wr http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    timeStart := time.Now()</span><br><span class="line">    wr.Write([]<span class="keyword">byte</span>(<span class="string">"your friends is tom and alex"</span>))</span><br><span class="line">    timeElapsed := time.Since(timeStart)</span><br><span class="line">    logger.Println(timeElapsed)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    http.HandleFunc(<span class="string">"/"</span>, helloHandler)</span><br><span class="line">    http.HandleFunc(<span class="string">"/info/show"</span>, showInfoHandler)</span><br><span class="line">    http.HandleFunc(<span class="string">"/email/show"</span>, showEmailHandler)</span><br><span class="line">    http.HandleFunc(<span class="string">"/friends/show"</span>, showFriendsHandler)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸€ä¸ªhandleré‡Œéƒ½æœ‰ä¹‹å‰æåˆ°çš„è®°å½•è¿è¡Œæ—¶é—´çš„ä»£ç ï¼Œæ¯æ¬¡å¢åŠ æ–°çš„è·¯ç”±æˆ‘ä»¬ä¹ŸåŒæ ·éœ€è¦æŠŠè¿™äº›çœ‹èµ·æ¥é•¿å¾—å·®ä¸å¤šçš„ä»£ç æ‹·è´åˆ°æˆ‘ä»¬éœ€è¦çš„åœ°æ–¹å»ã€‚å› ä¸ºä»£ç ä¸å¤ªå¤šï¼Œæ‰€ä»¥å®æ–½èµ·æ¥ä¹Ÿæ²¡æœ‰é‡åˆ°ä»€ä¹ˆå¤§é—®é¢˜ã€‚</p>
<p>æ¸æ¸çš„æˆ‘ä»¬çš„ç³»ç»Ÿå¢åŠ åˆ°äº†30ä¸ªè·¯ç”±å’Œ<code>handler</code>å‡½æ•°ï¼Œæ¯æ¬¡å¢åŠ æ–°çš„handlerï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ä»¶å·¥ä½œå°±æ˜¯æŠŠä¹‹å‰å†™çš„æ‰€æœ‰å’Œä¸šåŠ¡é€»è¾‘æ— å…³çš„å‘¨è¾¹ä»£ç å…ˆæ‹·è´è¿‡æ¥ã€‚</p>
<p>æ¥ä¸‹æ¥ç³»ç»Ÿå®‰ç¨³åœ°è¿è¡Œäº†ä¸€æ®µæ—¶é—´ï¼Œçªç„¶æœ‰ä¸€å¤©ï¼Œè€æ¿æ‰¾åˆ°ä½ ï¼Œæˆ‘ä»¬æœ€è¿‘æ‰¾äººæ–°å¼€å‘äº†ç›‘æ§ç³»ç»Ÿï¼Œä¸ºäº†ç³»ç»Ÿè¿è¡Œå¯ä»¥æ›´åŠ å¯æ§ï¼Œéœ€è¦æŠŠæ¯ä¸ªæ¥å£è¿è¡Œçš„è€—æ—¶æ•°æ®ä¸»åŠ¨ä¸ŠæŠ¥åˆ°æˆ‘ä»¬çš„ç›‘æ§ç³»ç»Ÿé‡Œã€‚ç»™ç›‘æ§ç³»ç»Ÿèµ·ä¸ªåå­—å§ï¼Œå«metricsã€‚ç°åœ¨ä½ éœ€è¦ä¿®æ”¹ä»£ç å¹¶æŠŠè€—æ—¶é€šè¿‡HTTP Postçš„æ–¹å¼å‘ç»™metricsç³»ç»Ÿäº†ã€‚æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹<code>helloHandler()</code>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">helloHandler</span><span class="params">(wr http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    timeStart := time.Now()</span><br><span class="line">    wr.Write([]<span class="keyword">byte</span>(<span class="string">"hello"</span>))</span><br><span class="line">    timeElapsed := time.Since(timeStart)</span><br><span class="line">    logger.Println(timeElapsed)</span><br><span class="line">    <span class="comment">// æ–°å¢è€—æ—¶ä¸ŠæŠ¥</span></span><br><span class="line">    metrics.Upload(<span class="string">"timeHandler"</span>, timeElapsed)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹åˆ°è¿™é‡Œï¼Œæœ¬èƒ½åœ°å‘ç°æˆ‘ä»¬çš„å¼€å‘å·¥ä½œå¼€å§‹é™·å…¥äº†æ³¥æ½­ã€‚æ— è®ºæœªæ¥å¯¹æˆ‘ä»¬çš„è¿™ä¸ªWebç³»ç»Ÿæœ‰ä»»ä½•å…¶å®ƒçš„éåŠŸèƒ½æˆ–ç»Ÿè®¡éœ€æ±‚ï¼Œæˆ‘ä»¬çš„ä¿®æ”¹å¿…ç„¶ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚åªè¦å¢åŠ ä¸€ä¸ªéå¸¸ç®€å•çš„éä¸šåŠ¡ç»Ÿè®¡ï¼Œæˆ‘ä»¬å°±éœ€è¦å»å‡ åä¸ªhandleré‡Œå¢åŠ è¿™äº›ä¸šåŠ¡æ— å…³çš„ä»£ç ã€‚è™½ç„¶ä¸€å¼€å§‹æˆ‘ä»¬ä¼¼ä¹å¹¶æ²¡æœ‰åšé”™ï¼Œä½†æ˜¯æ˜¾ç„¶éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œæˆ‘ä»¬çš„è¡Œäº‹æ–¹å¼è®©æˆ‘ä»¬é™·å…¥äº†ä»£ç çš„æ³¥æ½­ã€‚</p>
<h3 id="ä½¿ç”¨ä¸­é—´ä»¶å‰¥ç¦»éä¸šåŠ¡é€»è¾‘"><a href="#ä½¿ç”¨ä¸­é—´ä»¶å‰¥ç¦»éä¸šåŠ¡é€»è¾‘" class="headerlink" title="ä½¿ç”¨ä¸­é—´ä»¶å‰¥ç¦»éä¸šåŠ¡é€»è¾‘"></a>ä½¿ç”¨ä¸­é—´ä»¶å‰¥ç¦»éä¸šåŠ¡é€»è¾‘</h3><p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼Œä¸€å¼€å§‹åœ¨å“ªé‡Œåšé”™äº†å‘¢ï¼Ÿæˆ‘ä»¬åªæ˜¯ä¸€æ­¥ä¸€æ­¥åœ°æ»¡è¶³éœ€æ±‚ï¼ŒæŠŠæˆ‘ä»¬éœ€è¦çš„é€»è¾‘æŒ‰ç…§æµç¨‹å†™ä¸‹å»å‘€ï¼Ÿ</p>
<p>æˆ‘ä»¬çŠ¯çš„æœ€å¤§çš„é”™è¯¯ï¼Œæ˜¯æŠŠä¸šåŠ¡ä»£ç å’Œéä¸šåŠ¡ä»£ç æ‰åœ¨äº†ä¸€èµ·ã€‚å¯¹äºå¤§å¤šæ•°çš„åœºæ™¯æ¥è®²ï¼Œéä¸šåŠ¡çš„éœ€æ±‚éƒ½æ˜¯åœ¨httpè¯·æ±‚å¤„ç†å‰åšä¸€äº›äº‹æƒ…ï¼Œå¹¶ä¸”åœ¨å“åº”å®Œæˆä¹‹ååšä¸€äº›äº‹æƒ…ã€‚æˆ‘ä»¬æœ‰æ²¡æœ‰åŠæ³•ä½¿ç”¨ä¸€äº›é‡æ„æ€è·¯æŠŠè¿™äº›å…¬å…±çš„éä¸šåŠ¡åŠŸèƒ½ä»£ç å‰¥ç¦»å‡ºå»å‘¢ï¼Ÿå›åˆ°åˆšå¼€å¤´çš„ä¾‹å­ï¼Œæˆ‘ä»¬éœ€è¦ç»™æˆ‘ä»¬çš„<code>helloHandler()</code>å¢åŠ è¶…æ—¶æ—¶é—´ç»Ÿè®¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§å«<code>function adapter</code>çš„æ–¹æ³•æ¥å¯¹<code>helloHandler()</code>è¿›è¡ŒåŒ…è£…ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(wr http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    wr.Write([]<span class="keyword">byte</span>(<span class="string">"hello"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">timeMiddleware</span><span class="params">(next http.Handler)</span> <span class="title">http</span>.<span class="title">Handler</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> http.HandlerFunc(<span class="function"><span class="keyword">func</span><span class="params">(wr http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        timeStart := time.Now()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// next handler</span></span><br><span class="line">        next.ServeHTTP(wr, r)</span><br><span class="line"></span><br><span class="line">        timeElapsed := time.Since(timeStart)</span><br><span class="line">        logger.Println(timeElapsed)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    http.Handle(<span class="string">"/"</span>, timeMiddleware(http.HandlerFunc(hello)))</span><br><span class="line">    err := http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±éå¸¸è½»æ¾åœ°å®ç°äº†ä¸šåŠ¡ä¸éä¸šåŠ¡ä¹‹é—´çš„å‰¥ç¦»ï¼Œé­”æ³•å°±åœ¨äºè¿™ä¸ª<code>timeMiddleware</code>ã€‚å¯ä»¥ä»ä»£ç ä¸­çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„<code>timeMiddleware()</code>ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶å‚æ•°ä¸º<code>http.Handler</code>ï¼Œ<code>http.Handler</code>çš„å®šä¹‰åœ¨<code>net/http</code>åŒ…ä¸­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Handler <span class="keyword">interface</span> &#123;</span><br><span class="line">    ServeHTTP(ResponseWriter, *Request)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»»ä½•æ–¹æ³•å®ç°äº†<code>ServeHTTP</code>ï¼Œå³æ˜¯ä¸€ä¸ªåˆæ³•çš„<code>http.Handler</code>ï¼Œè¯»åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šæœ‰ä¸€äº›æ··ä¹±ï¼Œæˆ‘ä»¬å…ˆæ¥æ¢³ç†ä¸€ä¸‹httpåº“çš„<code>Handler</code>ï¼Œ<code>HandlerFunc</code>å’Œ<code>ServeHTTP</code>çš„å…³ç³»ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Handler <span class="keyword">interface</span> &#123;</span><br><span class="line">    ServeHTTP(ResponseWriter, *Request)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> HandlerFunc <span class="function"><span class="keyword">func</span><span class="params">(ResponseWriter, *Request)</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f HandlerFunc)</span> <span class="title">ServeHTTP</span><span class="params">(w ResponseWriter, r *Request)</span></span> &#123;</span><br><span class="line">    f(w, r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªè¦ä½ çš„handlerå‡½æ•°ç­¾åæ˜¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ResponseWriter, *Request)</span></span></span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆè¿™ä¸ª<code>handler</code>å’Œ<code>http.HandlerFunc()</code>å°±æœ‰äº†ä¸€è‡´çš„å‡½æ•°ç­¾åï¼Œå¯ä»¥å°†è¯¥<code>handler()</code>å‡½æ•°è¿›è¡Œç±»å‹è½¬æ¢ï¼Œè½¬ä¸º<code>http.HandlerFunc</code>ã€‚è€Œ<code>http.HandlerFunc</code>å®ç°äº†<code>http.Handler</code>è¿™ä¸ªæ¥å£ã€‚åœ¨<code>http</code>åº“éœ€è¦è°ƒç”¨ä½ çš„handlerå‡½æ•°æ¥å¤„ç†httpè¯·æ±‚æ—¶ï¼Œä¼šè°ƒç”¨<code>HandlerFunc()</code>çš„<code>ServeHTTP()</code>å‡½æ•°ï¼Œå¯è§ä¸€ä¸ªè¯·æ±‚çš„åŸºæœ¬è°ƒç”¨é“¾æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">h = getHandler() =&gt; h.ServeHTTP(w, r) =&gt; h(w, r)</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢æåˆ°çš„æŠŠè‡ªå®šä¹‰<code>handler</code>è½¬æ¢ä¸º<code>http.HandlerFunc()</code>è¿™ä¸ªè¿‡ç¨‹æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„<code>handler</code>æ²¡æœ‰ç›´æ¥å®ç°<code>ServeHTTP</code>è¿™ä¸ªæ¥å£ã€‚ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬çœ‹åˆ°çš„HandleFunc(æ³¨æ„HandlerFuncå’ŒHandleFuncçš„åŒºåˆ«)é‡Œä¹Ÿå¯ä»¥çœ‹åˆ°è¿™ä¸ªå¼ºåˆ¶è½¬æ¢è¿‡ç¨‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HandleFunc</span><span class="params">(pattern <span class="keyword">string</span>, handler <span class="keyword">func</span>(ResponseWriter, *Request)</span>)</span> &#123;</span><br><span class="line">    DefaultServeMux.HandleFunc(pattern, handler)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mux *ServeMux)</span> <span class="title">HandleFunc</span><span class="params">(pattern <span class="keyword">string</span>, handler <span class="keyword">func</span>(ResponseWriter, *Request)</span>)</span> &#123;</span><br><span class="line">    mux.Handle(pattern, HandlerFunc(handler))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çŸ¥é“handleræ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œæˆ‘ä»¬çš„ä¸­é—´ä»¶é€šè¿‡åŒ…è£…handlerï¼Œå†è¿”å›ä¸€ä¸ªæ–°çš„handlerå°±å¥½ç†è§£äº†ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ä¸­é—´ä»¶è¦åšçš„äº‹æƒ…å°±æ˜¯é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°å¯¹handlerè¿›è¡ŒåŒ…è£…ï¼Œè¿”å›ä¸€ä¸ªåŒ…æ‹¬äº†å„ä¸ªä¸­é—´ä»¶é€»è¾‘çš„å‡½æ•°é“¾ã€‚æˆ‘ä»¬æŠŠä¸Šé¢çš„åŒ…è£…å†åšå¾—å¤æ‚ä¸€äº›ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">customizedHandler = logger(timeout(ratelimit(helloHandler)))</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°é“¾åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡å¯ä»¥ç”¨å›¾æ¥è¡¨ç¤ºã€‚</p>
<p><img src="https://i.loli.net/2020/06/06/9i3fgTvmAOx5RBz.png" alt="img"></p>
<p>å†ç›´ç™½ä¸€äº›ï¼Œè¿™ä¸ªæµç¨‹åœ¨è¿›è¡Œè¯·æ±‚å¤„ç†çš„æ—¶å€™å°±æ˜¯ä¸æ–­åœ°è¿›è¡Œå‡½æ•°å‹æ ˆå†å‡ºæ ˆï¼Œæœ‰ä¸€äº›ç±»ä¼¼äºé€’å½’çš„æ‰§è¡Œæµï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[exec of logger logic]           å‡½æ•°æ ˆ: []</span><br><span class="line"></span><br><span class="line">[exec of timeout logic]          å‡½æ•°æ ˆ: [logger]</span><br><span class="line"></span><br><span class="line">[exec of ratelimit logic]        å‡½æ•°æ ˆ: [timeout&#x2F;logger]</span><br><span class="line"></span><br><span class="line">[exec of helloHandler logic]     å‡½æ•°æ ˆ: [ratelimit&#x2F;timeout&#x2F;logger]</span><br><span class="line"></span><br><span class="line">[exec of ratelimit logic part2]  å‡½æ•°æ ˆ: [timeout&#x2F;logger]</span><br><span class="line"></span><br><span class="line">[exec of timeout logic part2]    å‡½æ•°æ ˆ: [logger]</span><br><span class="line"></span><br><span class="line">[exec of logger logic part2]     å‡½æ•°æ ˆ: []</span><br></pre></td></tr></table></figure>

<p>åŠŸèƒ½å®ç°äº†ï¼Œä½†åœ¨ä¸Šé¢çš„ä½¿ç”¨è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†ï¼Œè¿™ç§å‡½æ•°å¥—å‡½æ•°çš„ç”¨æ³•ä¸æ˜¯å¾ˆç¾è§‚ï¼ŒåŒæ—¶ä¹Ÿä¸å…·å¤‡ä»€ä¹ˆå¯è¯»æ€§ã€‚</p>
<h3 id="æ›´ä¼˜é›…çš„ä¸­é—´ä»¶å†™æ³•"><a href="#æ›´ä¼˜é›…çš„ä¸­é—´ä»¶å†™æ³•" class="headerlink" title="æ›´ä¼˜é›…çš„ä¸­é—´ä»¶å†™æ³•"></a>æ›´ä¼˜é›…çš„ä¸­é—´ä»¶å†™æ³•</h3><p>ä¸Šä¸€èŠ‚ä¸­è§£å†³äº†ä¸šåŠ¡åŠŸèƒ½ä»£ç å’Œéä¸šåŠ¡åŠŸèƒ½ä»£ç çš„è§£è€¦ï¼Œä½†ä¹Ÿæåˆ°äº†ï¼Œçœ‹èµ·æ¥å¹¶ä¸ç¾è§‚ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹è¿™äº›å‡½æ•°çš„é¡ºåºï¼Œæˆ–è€…å¢åˆ ä¸­é—´ä»¶è¿˜æ˜¯æœ‰ç‚¹è´¹åŠ²ï¼Œæœ¬èŠ‚æˆ‘ä»¬æ¥è¿›è¡Œä¸€äº›â€œå†™æ³•â€ä¸Šçš„ä¼˜åŒ–ã€‚</p>
<p>çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">r = NewRouter()</span><br><span class="line">r.Use(logger)</span><br><span class="line">r.Use(timeout)</span><br><span class="line">r.Use(ratelimit)</span><br><span class="line">r.Add(<span class="string">"/"</span>, helloHandler)</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡å¤šæ­¥è®¾ç½®ï¼Œæˆ‘ä»¬æ‹¥æœ‰äº†å’Œä¸Šä¸€èŠ‚å·®ä¸å¤šçš„æ‰§è¡Œå‡½æ•°é“¾ã€‚èƒœåœ¨ç›´è§‚æ˜“æ‡‚ï¼Œå¦‚æœæˆ‘ä»¬è¦å¢åŠ æˆ–è€…åˆ é™¤ä¸­é—´ä»¶ï¼Œåªè¦ç®€å•åœ°å¢åŠ åˆ é™¤å¯¹åº”çš„<code>Use()</code>è°ƒç”¨å°±å¯ä»¥äº†ã€‚éå¸¸æ–¹ä¾¿ã€‚</p>
<p>ä»æ¡†æ¶çš„è§’åº¦æ¥è®²ï¼Œæ€ä¹ˆå®ç°è¿™æ ·çš„åŠŸèƒ½å‘¢ï¼Ÿä¹Ÿä¸å¤æ‚ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> middleware <span class="function"><span class="keyword">func</span><span class="params">(http.Handler)</span> <span class="title">http</span>.<span class="title">Handler</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Router <span class="keyword">struct</span> &#123;</span><br><span class="line">    middlewareChain [] middleware</span><br><span class="line">    mux <span class="keyword">map</span>[<span class="keyword">string</span>] http.Handler</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewRouter</span><span class="params">()</span> *<span class="title">Router</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Router&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Router)</span> <span class="title">Use</span><span class="params">(m middleware)</span></span> &#123;</span><br><span class="line">    r.middlewareChain = <span class="built_in">append</span>(r.middlewareChain, m)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Router)</span> <span class="title">Add</span><span class="params">(route <span class="keyword">string</span>, h http.Handler)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> mergedHandler = h</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="built_in">len</span>(r.middlewareChain) - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        mergedHandler = r.middlewareChain[i](mergedHandler)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r.mux[route] = mergedHandler</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ä»£ç ä¸­çš„<code>middleware</code>æ•°ç»„éå†é¡ºåºï¼Œå’Œç”¨æˆ·å¸Œæœ›çš„è°ƒç”¨é¡ºåºåº”è¯¥æ˜¯â€ç›¸åâ€çš„ã€‚åº”è¯¥ä¸éš¾ç†è§£ã€‚</p>
<h3 id="å“ªäº›äº‹æƒ…é€‚åˆåœ¨ä¸­é—´ä»¶ä¸­åš"><a href="#å“ªäº›äº‹æƒ…é€‚åˆåœ¨ä¸­é—´ä»¶ä¸­åš" class="headerlink" title="å“ªäº›äº‹æƒ…é€‚åˆåœ¨ä¸­é—´ä»¶ä¸­åš"></a>å“ªäº›äº‹æƒ…é€‚åˆåœ¨ä¸­é—´ä»¶ä¸­åš</h3><p>ä»¥è¾ƒæµè¡Œçš„å¼€æºGoè¯­è¨€æ¡†æ¶chiä¸ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">compress.go</span><br><span class="line">  &#x3D;&gt; å¯¹httpçš„å“åº”ä½“è¿›è¡Œå‹ç¼©å¤„ç†</span><br><span class="line">heartbeat.go</span><br><span class="line">  &#x3D;&gt; è®¾ç½®ä¸€ä¸ªç‰¹æ®Šçš„è·¯ç”±ï¼Œä¾‹å¦‚&#x2F;pingï¼Œ&#x2F;healthcheckï¼Œç”¨æ¥ç»™è´Ÿè½½å‡è¡¡ä¸€ç±»çš„å‰ç½®æœåŠ¡è¿›è¡Œæ¢æ´»</span><br><span class="line">logger.go</span><br><span class="line">  &#x3D;&gt; æ‰“å°è¯·æ±‚å¤„ç†å¤„ç†æ—¥å¿—ï¼Œä¾‹å¦‚è¯·æ±‚å¤„ç†æ—¶é—´ï¼Œè¯·æ±‚è·¯ç”±</span><br><span class="line">profiler.go</span><br><span class="line">  &#x3D;&gt; æŒ‚è½½pproféœ€è¦çš„è·¯ç”±ï¼Œå¦‚&#96;&#x2F;pprof&#96;ã€&#96;&#x2F;pprof&#x2F;trace&#96;åˆ°ç³»ç»Ÿä¸­</span><br><span class="line">realip.go</span><br><span class="line">  &#x3D;&gt; ä»è¯·æ±‚å¤´ä¸­è¯»å–X-Forwarded-Forå’ŒX-Real-IPï¼Œå°†http.Requestä¸­çš„RemoteAddrä¿®æ”¹ä¸ºå¾—åˆ°çš„RealIP</span><br><span class="line">requestid.go</span><br><span class="line">  &#x3D;&gt; ä¸ºæœ¬æ¬¡è¯·æ±‚ç”Ÿæˆå•ç‹¬çš„requestidï¼Œå¯ä¸€è·¯é€ä¼ ï¼Œç”¨æ¥ç”Ÿæˆåˆ†å¸ƒå¼è°ƒç”¨é“¾è·¯ï¼Œä¹Ÿå¯ç”¨äºåœ¨æ—¥å¿—ä¸­ä¸²è¿å•æ¬¡è¯·æ±‚çš„æ‰€æœ‰é€»è¾‘</span><br><span class="line">timeout.go</span><br><span class="line">  &#x3D;&gt; ç”¨context.Timeoutè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¹¶å°†å…¶é€šè¿‡http.Requestä¸€è·¯é€ä¼ ä¸‹å»</span><br><span class="line">throttler.go</span><br><span class="line">  &#x3D;&gt; é€šè¿‡å®šé•¿å¤§å°çš„channelå­˜å‚¨tokenï¼Œå¹¶é€šè¿‡è¿™äº›tokenå¯¹æ¥å£è¿›è¡Œé™æµ</span><br></pre></td></tr></table></figure>



<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://chai2010.gitbooks.io/advanced-go-programming-book/content/ch5-web/ch5-03-middleware.html" target="_blank" rel="noopener">ä¸­é—´ä»¶</a></p>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]Golang --- å‘å¸ƒè®¢é˜…æ¨¡å‹</title>
    <url>/2020/06/04/%5B%E8%BD%AC%5Dgolang-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B/</url>
    <content><![CDATA[<h3 id="å‘å¸ƒè®¢é˜…è€…"><a href="#å‘å¸ƒè®¢é˜…è€…" class="headerlink" title="å‘å¸ƒè®¢é˜…è€…"></a>å‘å¸ƒè®¢é˜…è€…</h3><figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> pubsub</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"sync"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> (</span><br><span class="line">    <span class="comment">// è®¢é˜…è€…æ˜¯ä¸€ä¸ªç®¡é“</span></span><br><span class="line">    subscriber <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    <span class="comment">// ä¸»é¢˜æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨</span></span><br><span class="line">    topicFunc <span class="function"><span class="keyword">func</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span></span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘å¸ƒè€…å¯¹è±¡</span></span><br><span class="line"><span class="keyword">type</span> Publisher <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// è¯»å†™é”</span></span><br><span class="line">    m sync.RWMutex</span><br><span class="line">    <span class="comment">// è®¢é˜…é˜Ÿåˆ—çš„ç¼“å­˜å¤§å°</span></span><br><span class="line">    buffer <span class="keyword">int</span></span><br><span class="line">    <span class="comment">// å‘å¸ƒçš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">    timeout time.Duration</span><br><span class="line">    <span class="comment">// è®¢é˜…è€…ä¿¡æ¯</span></span><br><span class="line">    subscribers <span class="keyword">map</span>[subscriber]topicFunc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„å»ºä¸€ä¸ªå‘å¸ƒè€…, è®¾ç½®è¶…æ—¶æ—¶é—´å’Œç¼“å­˜é˜Ÿåˆ—é•¿åº¦</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPublisher</span><span class="params">(publishTimeout time.Duration, buffer <span class="keyword">int</span>)</span> *<span class="title">Publisher</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Publisher&#123;</span><br><span class="line">        buffer:      buffer,</span><br><span class="line">        timeout:     publishTimeout,</span><br><span class="line">        subscribers: <span class="built_in">make</span>(<span class="keyword">map</span>[subscriber]topicFunc),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ ä¸€ä¸ªè®¢é˜…è€…, è®¢é˜…è¿‡æ»¤å™¨ç­›é€‰åçš„ä¸»é¢˜</span></span><br><span class="line"><span class="comment">// æ·»åŠ è®¢é˜…ä¸»é¢˜å‚æ•°, è¿”å›è®¢é˜…è€…</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Publisher)</span> <span class="title">SubscribeTopic</span><span class="params">(topic topicFunc)</span> <span class="title">chan</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;, p.buffer)</span><br><span class="line">    p.m.Lock()</span><br><span class="line">    p.subscribers[ch] = topic</span><br><span class="line">    p.m.Unlock()</span><br><span class="line">    <span class="keyword">return</span> ch</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¢é˜…æ‰€æœ‰çš„ä¸»é¢˜</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Publisher)</span> <span class="title">Subscribe</span><span class="params">()</span> <span class="title">chan</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> p.SubscribeTopic(<span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€€è®¢</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Publisher)</span> <span class="title">Evict</span><span class="params">(sub <span class="keyword">chan</span> <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    p.m.Lock()</span><br><span class="line">    <span class="keyword">defer</span> p.m.Unlock()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">delete</span>(p.subscribers, sub)</span><br><span class="line">    <span class="built_in">close</span>(sub)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€ä¸€ä¸ªä¸»é¢˜</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Publisher)</span> <span class="title">Publish</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    p.m.RLock()</span><br><span class="line">    <span class="keyword">defer</span> p.m.RUnlock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">    <span class="comment">// éå†æ‰€æœ‰çš„è®¢é˜…è€…, ä¸€ä¸ªä¸ªçš„å‘å¸ƒ</span></span><br><span class="line">    <span class="keyword">for</span> sub, topic := <span class="keyword">range</span> p.subscribers &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> p.sendTopic(sub, topic, v, &amp;wg)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®é™…ä¸Šçš„å‘é€å‡½æ•°</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">sub: è®¢é˜…è€…, chan</span></span><br><span class="line"><span class="comment">topic: è®¢é˜…ä¸»é¢˜, å³ä¼ è¿›æ¥çš„å‡½æ•°</span></span><br><span class="line"><span class="comment">v: å‡½æ•°å‚æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Publisher)</span> <span class="title">sendTopic</span><span class="params">(sub subscriber, topic topicFunc, v <span class="keyword">interface</span>&#123;&#125;, wg *sync.WaitGroup)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> wg.Done()</span><br><span class="line">    <span class="comment">// è¯¥ä»£ç ä¸­, topicä¼šè¿”å›trueæˆ–è€…false, å¦‚æœè¿”å›falseå°±è¡¨ç¤ºæ²¡æœ‰è®¢é˜…</span></span><br><span class="line">    <span class="comment">// å¦‚æœtopicæ˜¯nil, å°±è¡¨ç¤ºå…¨è®¢é˜…</span></span><br><span class="line">    <span class="keyword">if</span> topic != <span class="literal">nil</span> &amp;&amp; !topic(v) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> sub &lt;- v:	<span class="comment">// å°†å‚æ•°ä¼ é€’ç»™äº†è®¢é˜…è€…, è®¢é˜…è€…èƒ½æ‰“å°, åˆ™è¡¨ç¤ºæ”¶åˆ°å‘å¸ƒçš„å†…å®¹</span></span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(p.timeout):	<span class="comment">// è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­å‘å¸ƒè€…å¯¹è±¡, åŒæ—¶å…³é—­æ‰€æœ‰çš„è®¢é˜…è€…ç®¡é“</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Publisher)</span> <span class="title">Close</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p.m.Lock()</span><br><span class="line">    <span class="keyword">defer</span> p.m.Unlock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> sub := <span class="keyword">range</span> p.subscribers &#123;</span><br><span class="line">        <span class="built_in">delete</span>(p.subscribers, sub)</span><br><span class="line">        <span class="built_in">close</span>(sub)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>

<h3 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h3><figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"GoStudy/chai2010.gitbooks.io/p1/pubsub"</span></span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"strings"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p := pubsub.NewPublisher(<span class="number">100</span>*time.Microsecond, <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">defer</span> p.Close()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¢é˜…æ‰€æœ‰ä¸»é¢˜</span></span><br><span class="line">    all := p.Subscribe()</span><br><span class="line">    <span class="comment">// è®¢é˜…åŒ…å«äº†golangå­—ç¬¦ä¸²çš„ä¸»é¢˜</span></span><br><span class="line">    <span class="comment">// è¿”å›äº†ä¸€ä¸ªchan</span></span><br><span class="line">    golang := p.SubscribeTopic(<span class="function"><span class="keyword">func</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> s, ok := v.(<span class="keyword">string</span>); ok &#123;</span><br><span class="line">            <span class="keyword">return</span> strings.Contains(s, <span class="string">"golang"</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    p.Publish(<span class="string">"hello World!"</span>)</span><br><span class="line">    p.Publish(<span class="string">"hello golang!"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> msg := <span class="keyword">range</span> all &#123;</span><br><span class="line">            fmt.Println(<span class="string">"all: "</span>, msg)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> msg := <span class="keyword">range</span> golang &#123;</span><br><span class="line">            fmt.Println(<span class="string">"golang: "</span>, msg)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    time.Sleep(<span class="number">3</span> * time.Second)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://chai2010.gitbooks.io/advanced-go-programming-book/content/ch1-basic/ch1-06-goroutine.html" target="_blank" rel="noopener">å¸¸è§çš„å¹¶å‘æ¨¡å¼</a></p>
]]></content>
      <categories>
        <category>Golang</category>
      </categories>
  </entry>
  <entry>
    <title>Django-rest-framework --- æƒé™</title>
    <url>/2020/05/23/django-rest-framework-%E6%9D%83%E9%99%90/</url>
    <content><![CDATA[<h3 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    USER_COMMON = <span class="number">0</span></span><br><span class="line">    USER_VIP = <span class="number">100</span></span><br><span class="line">    USER_SVIP = <span class="number">200</span></span><br><span class="line">    <span class="comment"># ç”¨æˆ·ç±»å‹</span></span><br><span class="line">    USER_TYPE = (</span><br><span class="line">        (USER_COMMON, <span class="string">'æ™®é€šç”¨æˆ·'</span>),</span><br><span class="line">        (USER_VIP, <span class="string">'VIP'</span>),</span><br><span class="line">        (USER_SVIP, <span class="string">'SVIP'</span>)</span><br><span class="line">    )</span><br><span class="line"> </span><br><span class="line">    user_type = models.IntegerField(choices=USER_TYPE, default=USER_COMMON)</span><br><span class="line">    <span class="comment"># å»ºç«‹1å¯¹1å…³ç³»æ¨¡å‹</span></span><br><span class="line">    user = models.OneToOneField(User, on_delete=models.CASCADE,</span><br><span class="line">related_name=<span class="string">'userinfo'</span>)</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="æƒé™"><a href="#æƒé™" class="headerlink" title="æƒé™"></a>æƒé™</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> permissions</span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> demo.models <span class="keyword">import</span> UserInfo</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VipUserPermission</span><span class="params">(permissions.BasePermission)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    VIPç”¨æˆ·æ‰å¯è®¿é—®</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_permission</span><span class="params">(self, request, view)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> request.user.is_authenticated <span class="keyword">and</span></span><br><span class="line">request.user.userinfo.user_type == UserInfo.USER_VIP</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SvipUserPermission</span><span class="params">(permissions.BasePermission)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    SVIPç”¨æˆ·æ‰å¯è®¿é—®</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_permission</span><span class="params">(self, request, view)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> request.user.is_authenticated <span class="keyword">and</span></span><br><span class="line">request.user.userinfo.user_type == UserInfo.USER_VIP</span><br></pre></td></tr></table></figure>

<h3 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> login</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> permissions</span><br><span class="line"><span class="keyword">from</span> demo.permissions <span class="keyword">import</span> VipUserPermission, SvipUserPermission</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginApiView</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="comment"># ä»»ä½•äººéƒ½å¯è®¿é—®æ­¤è§†å›¾</span></span><br><span class="line">    permission_classes = []</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'demo/index.html'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        username = self.request.POST.get(<span class="string">'username'</span>, <span class="string">''</span>)</span><br><span class="line">        password = self.request.POST.get(<span class="string">'password'</span>, <span class="string">''</span>)</span><br><span class="line"> </span><br><span class="line">        user = User.objects.filter(username=username).first()</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">and</span> user.password == password:</span><br><span class="line">            login(request, user)</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">'result'</span>: <span class="literal">True</span>&#125;)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">'result'</span>: <span class="literal">False</span>&#125;)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonUserApiView</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="comment"># ç™»å½•ç”¨æˆ·æ‰å¯è®¿é—®æ­¤è§†å›¾</span></span><br><span class="line">    permission_classes = [permissions.IsAuthenticated]</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">'result'</span>: <span class="literal">True</span>&#125;)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VipUserApiView</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="comment"># äº¤é›†å…³ç³»,å¿…é¡»åŒæ—¶æˆç«‹éªŒè¯æ‰é€šè¿‡</span></span><br><span class="line">    <span class="comment"># vipç”¨æˆ·æ‰å¯è®¿é—®</span></span><br><span class="line">    permission_classes = [VipUserPermission, SvipUserPermission]</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">'result'</span>: <span class="literal">True</span>&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="å…¨å±€é…ç½®"></a>å…¨å±€é…ç½®</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">"DEFAULT_PERMISSION_CLASSES"</span>: [<span class="string">'demo.permissions.MyPermission'</span>],  <span class="comment">#</span></span><br><span class="line">è¡¨ç¤ºæ¯ä¸€ä¸ªè§†å›¾ç±»ï¼ˆåªè¦ä¸é‡å†™permission_classeså±æ€§ï¼‰ï¼Œéƒ½éœ€è¦æ‹¥æœ‰è¯¥æƒé™ç”¨æˆ·æ‰èƒ½è®¿é—®ã€‚</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol>
<li>é€šè¿‡æƒé™,å¯æ§åˆ¶ç”¨æˆ·å¯è®¿é—®çš„è§†å›¾</li>
<li>å¯åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®æ€»æƒé™,å¦‚æœè§†å›¾ä¸­æ²¡æœ‰é‡å†™permission_classes,é‚£ä¹ˆå°±é»˜è®¤ä½¿ç”¨è¯¥æƒé™</li>
<li>å¦‚æœä¸éœ€è¦æƒé™,é‚£ä¹ˆpermission_classeså°±è®¾ç½®ä¸ºç©º</li>
<li>å¦‚æœè§†å›¾çš„permission_classesä¸­é…ç½®äº†å¤šä¸ªæƒé™,éœ€è¦åŒæ—¶æ»¡è¶³æ‰èƒ½è®¿é—®è¯¥è§†å›¾</li>
</ol>
<h3 id="æºä»£ç "><a href="#æºä»£ç " class="headerlink" title="æºä»£ç "></a>æºä»£ç </h3><h4 id="dispatchå‡½æ•°"><a href="#dispatchå‡½æ•°" class="headerlink" title="dispatchå‡½æ•°"></a>dispatchå‡½æ•°</h4><p>ä¼šåœ¨dispatchå‡½æ•°ä¸­è°ƒç”¨initialå‡½æ•°,åˆå§‹åŒ–APIViewä¸­çš„æŸäº›å±æ€§</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dispatch</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    `.dispatch()` is pretty much the same as Django's regular dispatch,</span></span><br><span class="line"><span class="string">    but with extra hooks for startup, finalize, and exception handling.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    ...</span><br><span class="line">    request = self.initialize_request(request, *args, **kwargs)</span><br><span class="line">    ...</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        self.initial(request, *args, **kwargs)</span><br><span class="line"> </span><br><span class="line">        ...</span><br><span class="line">        ....</span><br></pre></td></tr></table></figure>

<h4 id="initialå‡½æ•°"><a href="#initialå‡½æ•°" class="headerlink" title="initialå‡½æ•°"></a>initialå‡½æ•°</h4><p>åœ¨initialå‡½æ•°ä¸­,ä¼šæ£€æŸ¥è¯¥è§†å›¾éœ€è¦çš„æƒé™</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initial</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Runs anything that needs to occur prior to calling the method handler.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    ...</span><br><span class="line">    self.check_permissions(request)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>


<h4 id="check-permissionså‡½æ•°"><a href="#check-permissionså‡½æ•°" class="headerlink" title="check_permissionså‡½æ•°"></a>check_permissionså‡½æ•°</h4><p>åœ¨check_permissionså‡½æ•°ä¸­,ä¼šè°ƒç”¨get_permissions()å‡½æ•°,å¾—åˆ°Permissionså¯¹è±¡åˆ—è¡¨,å¹¶è°ƒç”¨å„ä¸ªå¯¹è±¡ä¸‹çš„has_permission()å‡½æ•°,<br>åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å…·æœ‰æŸæƒé™,å¦‚æœæœ‰ä¸€ä¸ªä¸æ»¡è¶³,åˆ™ä¼šè°ƒç”¨permission_deniedå‡½æ•°,ç»™å‡ºé”™è¯¯æ¶ˆæ¯æé†’.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_permissions</span><span class="params">(self, request)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Check if the request should be permitted.</span></span><br><span class="line"><span class="string">    Raises an appropriate exception if the request is not permitted.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> permission <span class="keyword">in</span> self.get_permissions():</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> permission.has_permission(request, self):</span><br><span class="line">            self.permission_denied(</span><br><span class="line">                request, message=getattr(permission, <span class="string">'message'</span>, <span class="literal">None</span>)</span><br><span class="line">            )</span><br></pre></td></tr></table></figure>

<h4 id="permission-deniedå‡½æ•°"><a href="#permission-deniedå‡½æ•°" class="headerlink" title="permission_deniedå‡½æ•°"></a>permission_deniedå‡½æ•°</h4><p>messageçš„æ„æ€æ˜¯,å¦‚æœåœ¨è‡ªå®šä¹‰çš„Permissionç±»ä¸­å®šä¹‰äº†messageçš„å€¼,é‚£ä¹ˆæƒé™ä¸é€šè¿‡æ—¶å°±ä¼šè¿”å›messageçš„æç¤º,<br>ä¸å†ä¼šé‡‡ç”¨é»˜è®¤çš„äº†.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">permission_denied</span><span class="params">(self, request, message=None)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    If request is not permitted, determine what kind of exception to raise.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> request.authenticators <span class="keyword">and</span> <span class="keyword">not</span> request.successful_authenticator:</span><br><span class="line">        <span class="keyword">raise</span> exceptions.NotAuthenticated()</span><br><span class="line">    <span class="keyword">raise</span> exceptions.PermissionDenied(detail=message)</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PermissionDenied</span><span class="params">(APIException)</span>:</span></span><br><span class="line">    status_code = status.HTTP_403_FORBIDDEN</span><br><span class="line">    default_detail = _(<span class="string">'You do not have permission to perform this</span></span><br><span class="line"><span class="string">action.'</span>)</span><br><span class="line">    default_code = <span class="string">'permission_denied'</span></span><br></pre></td></tr></table></figure>

<h3 id="get-permissionså‡½æ•°"><a href="#get-permissionså‡½æ•°" class="headerlink" title="get_permissionså‡½æ•°"></a>get_permissionså‡½æ•°</h3><p>ä¼šéå†è§†å›¾ä¸­é‡å†™çš„permission_classesåˆ—è¡¨å¹¶åˆ›å»ºå…¶ä¸­çš„ç±»å¯¹è±¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def get_permissions(self):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Instantiates and returns the list of permissions that this view</span><br><span class="line">requires.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    return [permission() for permission in self.permission_classes]</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè§†å›¾æ²¡æœ‰é‡å†™è¯¥å±æ€§,å°†é‡‡ç”¨é»˜è®¤å€¼,é»˜è®¤å€¼å°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­REST_FRAMEWORKä¸‹é…ç½®çš„å€¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">permission_classes = api_settings.DEFAULT_PERMISSION_CLASSES</span><br></pre></td></tr></table></figure>

<h4 id="BasePermissionç±»"><a href="#BasePermissionç±»" class="headerlink" title="BasePermissionç±»"></a>BasePermissionç±»</h4><p>è‹¥æ˜¯ç»§æ‰¿äº†BasePermissionç±»,ä½†å´æ²¡é‡å†™,ä¸¤ä¸ªå‡½æ•°éƒ½é»˜è®¤è¿”å›True</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@six.add_metaclass(BasePermissionMetaclass)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasePermission</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    A base class from which all permission classes should inherit.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_permission</span><span class="params">(self, request, view)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Return `True` if permission is granted, `False` otherwise.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_object_permission</span><span class="params">(self, request, view, obj)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Return `True` if permission is granted, `False` otherwise.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h4 id="check-object-permissions"><a href="#check-object-permissions" class="headerlink" title="check_object_permissions"></a>check_object_permissions</h4><p>æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å…·æœ‰è®¿é—®æŸå•ä¸ªå¯¹è±¡çš„æƒé™,è·Ÿcheck_permissionä¸€æ ·.<br>å¦‚æœé‡å†™äº†get_objectå‡½æ•°,é‚£ä¹ˆå°±éœ€è¦æ‰‹åŠ¨è°ƒç”¨,å¦åˆ™æ— æ³•å®ç°æ£€æŸ¥å•ä¸ªå¯¹è±¡æƒé™çš„åŠŸèƒ½</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_object_permissions</span><span class="params">(self, request, obj)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Check if the request should be permitted for a given object.</span></span><br><span class="line"><span class="string">    Raises an appropriate exception if the request is not permitted.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> permission <span class="keyword">in</span> self.get_permissions():</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> permission.has_object_permission(request, self, obj):</span><br><span class="line">            self.permission_denied(</span><br><span class="line">                request, message=getattr(permission, <span class="string">'message'</span>, <span class="literal">None</span>)</span><br><span class="line">            )</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
        <tag>django-rest-framework</tag>
      </tags>
  </entry>
  <entry>
    <title>Python --- å±æ€§æè¿°ç¬¦å’Œå±æ€§æŸ¥æ‰¾è¿‡ç¨‹</title>
    <url>/2020/05/23/python%E5%B1%9E%E6%80%A7%E6%8F%8F%E8%BF%B0%E7%AC%A6%E5%92%8C%E5%B1%9E%E6%80%A7%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B/</url>
    <content><![CDATA[<h3 id="å¯¹è±¡çš„è‡ªçœæœºåˆ¶"><a href="#å¯¹è±¡çš„è‡ªçœæœºåˆ¶" class="headerlink" title="å¯¹è±¡çš„è‡ªçœæœºåˆ¶"></a>å¯¹è±¡çš„è‡ªçœæœºåˆ¶</h3><p>è‡ªçœæ˜¯é€šè¿‡ä¸€å®šçš„æœºåˆ¶æŸ¥è¯¢åˆ°å¯¹è±¡çš„å†…éƒ¨ç»“æ„ã€‚</p>
<h4 id="dir-obj"><a href="#dir-obj" class="headerlink" title="dir(obj)"></a><code>dir(obj)</code></h4><p>diræ˜¯pythonæä¾›çš„ä¸€ä¸ªapiå‡½æ•°ï¼Œä¼šè¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨ä¸­åŒ…å«è¯¥å¯¹è±¡ï¼ˆå®ä¾‹å¯¹è±¡æˆ–è€…ç±»å¯¹è±¡ï¼‰çš„æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼ˆåŒ…æ‹¬ä»çˆ¶ç±»ä¸­è·å–çš„ï¼‰</p>
<a id="more"></a>

<h4 id="dict"><a href="#dict" class="headerlink" title="__dict__"></a><code>__dict__</code></h4><p><strong>dict</strong>å­—å…¸ä¸­å­˜å‚¨çš„æ˜¯å¯¹è±¡æˆ–ç±»çš„éƒ¨åˆ†å±æ€§ï¼Œé”®ä¸ºå±æ€§åï¼Œå€¼ä¸ºå±æ€§å€¼ã€‚<br>å®ä¾‹å¯¹è±¡çš„<strong>dict</strong>ä¸­åªå­˜å‚¨è·Ÿå®ä¾‹å¯¹è±¡ç›¸å…³çš„å±æ€§ã€‚<br>ç±»å¯¹è±¡çš„<strong>dict</strong>ä¸­å­˜å‚¨ç€èƒ½å’Œå®ä¾‹å¯¹è±¡å…±äº«çš„å±æ€§å’Œæ–¹æ³•ï¼Œç±»çš„<strong>dict</strong>ä¸­å¹¶ä¸åŒ…å«ä»çˆ¶ç±»ç»§æ‰¿çš„å±æ€§å’Œæ–¹æ³•ã€‚</p>
<h4 id="dirå’Œ-dict-çš„åŒºåˆ«"><a href="#dirå’Œ-dict-çš„åŒºåˆ«" class="headerlink" title="dirå’Œ__dict__çš„åŒºåˆ«"></a><code>dir</code>å’Œ<code>__dict__</code>çš„åŒºåˆ«</h4><ul>
<li>diræ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›çš„æ•°æ®æ˜¯ä¸€ä¸ªlistï¼Œåªæœ‰å±æ€§åå’Œå‡½æ•°å</li>
<li><strong>dict</strong>æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé”®ä¸ºå±æ€§å\æ–¹æ³•ï¼ˆå‡½æ•°ï¼‰åï¼Œå€¼æ˜¯å±æ€§çš„å€¼æˆ–è€…å…·ä½“çš„æ–¹æ³•ï¼ˆå‡½æ•°ï¼‰</li>
<li>dirç”¨æ¥å¯»æ‰¾ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼ŒåŒ…æ‹¬ä»çˆ¶ç±»ä¸­ç»§æ‰¿çš„</li>
</ul>
<h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">    Aname = <span class="string">'hello'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__age = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	@property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__age</span><br><span class="line"></span><br><span class="line"><span class="meta">	@age.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span><span class="params">(self, _)</span>:</span></span><br><span class="line">        self.__age = _</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">funA</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'---&gt;funcA'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    Bname = <span class="string">'world'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(B, self).__init__()</span><br><span class="line">        self.__sex = <span class="string">'ç”·'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">funcB</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'---&gt;funB'</span>)</span><br><span class="line"></span><br><span class="line">b = B()</span><br></pre></td></tr></table></figure>
<p><code>b.__dict__</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#39;_A__age&#39;: 20, &#39;_B__sex&#39;: &#39;ç”·&#39;&#125;</span><br></pre></td></tr></table></figure>

<p><code>B.__dict__</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'Bname'</span>: <span class="string">'world'</span>, <span class="string">'__init__'</span>: &lt;function B.__init__ at <span class="number">0x7fd2a753e378</span>&gt;, <span class="string">'funcB'</span>: &lt;function B.funcB at <span class="number">0x7fd2a753e400</span>&gt;, <span class="string">'__doc__'</span>: <span class="literal">None</span>&#125;</span><br></pre></td></tr></table></figure>
<p><code>dir(b)</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="string">'Aname'</span>, <span class="string">'Bname'</span>, <span class="string">'_A__age'</span>, <span class="string">'_B__sex'</span>, <span class="string">'__class__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dict__'</span>, <span class="string">'__dir__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>, <span class="string">'__format__'</span>, <span class="string">'__ge__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__gt__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__init_subclass__'</span>, <span class="string">'__le__'</span>, <span class="string">'__lt__'</span>, <span class="string">'__module__'</span>, <span class="string">'__ne__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'__weakref__'</span>, <span class="string">'age'</span>, <span class="string">'funA'</span>, <span class="string">'funcB'</span>]</span><br></pre></td></tr></table></figure>
<p><code>dir(B)</code><br>ä¸<code>dir(b)</code>å¯¹æ¯”å¯ä»¥çœ‹å‡ºï¼Œå®ä¾‹å¯¹è±¡çš„å€¼åœ¨è¿™ä¸ªåˆ—è¡¨é‡Œé¢ä¸å­˜åœ¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="string">'Aname'</span>, <span class="string">'Bname'</span>, <span class="string">'__class__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dict__'</span>, <span class="string">'__dir__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>, <span class="string">'__format__'</span>, <span class="string">'__ge__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__gt__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__init_subclass__'</span>, <span class="string">'__le__'</span>, <span class="string">'__lt__'</span>, <span class="string">'__module__'</span>, <span class="string">'__ne__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'__weakref__'</span>, <span class="string">'age'</span>, <span class="string">'funA'</span>, <span class="string">'funcB'</span>]</span><br></pre></td></tr></table></figure>

<h3 id="getattr-å’Œ-getattribute-é­”æ³•æ–¹æ³•"><a href="#getattr-å’Œ-getattribute-é­”æ³•æ–¹æ³•" class="headerlink" title="__getattr__å’Œ__getattribute__é­”æ³•æ–¹æ³•"></a><code>__getattr__</code>å’Œ<code>__getattribute__</code>é­”æ³•æ–¹æ³•</h3><p><code>__getattr__</code>æ˜¯åœ¨æŸ¥æ‰¾ä¸åˆ°å±æ€§æ—¶è°ƒç”¨<br><code>__getattribute__</code>åœ¨è®¿é—®å¯¹è±¡æ—¶ä¼˜å…ˆè°ƒç”¨ï¼Œä¸ç®¡å±æ€§æ˜¯å¦å­˜åœ¨ï¼Œæ‰€ä»¥ä¸å»ºè®®é‡å†™è¯¥é­”æ³•æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">    name = <span class="string">'chen'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.age = <span class="number">20</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'__getattr__'</span>)</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattribute__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'__getattribute__'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> super(A, self).__getattribute__(item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A()</span><br></pre></td></tr></table></figure>

<p>å½“è°ƒç”¨å­˜åœ¨çš„å±æ€§æ—¶æ‰“å°ï¼š<br><code>a.name</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">__getattribute__</span><br><span class="line">chen</span><br></pre></td></tr></table></figure>
<p>å½“è°ƒç”¨ä¸å­˜åœ¨çš„å±æ€§æ—¶æ‰“å°ï¼š<br><code>a.sss</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">__getattribute__</span><br><span class="line">__getattr__</span><br><span class="line">sss</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡è°ƒç”¨çš„å±æ€§å­˜åœ¨ä¸å­˜åœ¨ï¼Œéƒ½ä¼šè°ƒç”¨<code>__getattribute__</code>é­”æ³•æ–¹æ³•ï¼›å½“è°ƒç”¨çš„å±æ€§ä¸å­˜åœ¨æ—¶ï¼Œ<code>__getattribute__</code>ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œ<code>AttributeError</code>ï¼Œç„¶ååœ¨å†…éƒ¨è°ƒç”¨<code>__getattr__</code>å‡½æ•°ã€‚</p>
<blockquote>
<p>æ³¨æ„:<br>ä¸èƒ½åœ¨<code>__getattribute__</code>æ–¹æ³•ä¸­ä½¿ç”¨<code>self.xx</code>æˆ–è€…<code>self.__dict__[xxx]</code>æˆ–è€…<code>hasattr(self, xxx)</code>ç­‰æ“ä½œï¼Œä¼šé™·å…¥æ— é™é€’å½’ä¹‹ä¸­</p>
</blockquote>
<h3 id="å±æ€§æè¿°ç¬¦"><a href="#å±æ€§æè¿°ç¬¦" class="headerlink" title="å±æ€§æè¿°ç¬¦"></a>å±æ€§æè¿°ç¬¦</h3><p><code>__get__</code><br><code>__set__</code><br><code>__delete__</code><br>å®ç°ä¸Šé¢ä¸‰ä¸ªé­”æ³•å‡½æ•°ä¹‹ä¸€å°±å¯ç§°ä¹‹ä¸ºå±æ€§æè¿°ç¬¦ï¼Œå¦‚æœåªå®ç°äº†<code>__get__</code>åˆ™ç§°ä¸ºéæ•°æ®å±æ€§æè¿°ç¬¦(no-data descriptor)ï¼Œåªæœ‰åŒæ—¶å®ç°äº†<code>__get__</code>å’Œ<code>__set__</code>æ‰ç§°ä¹‹ä¸ºæ•°æ®å±æ€§æè¿°ç¬¦(data descriptor)ã€‚</p>
<p>ä»¥ä¸‹ä¾‹å­å°±æ˜¯å®ç°äº†ä¸€ä¸ªintç±»å‹çš„æ•°æ®å±æ€§æè¿°ç¬¦</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numbers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Integer</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, numbers.Integral):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'å¿…é¡»æ˜¯intç±»å‹æ•°æ®'</span>)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">'__set__'</span>)</span><br><span class="line">        self.__value = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'__get__'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.__value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        print(<span class="string">'__delete__'</span>)</span><br><span class="line">        <span class="keyword">del</span> self.__value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span><span class="params">(object)</span>:</span></span><br><span class="line">    age = Integer()</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t = Test()</span><br><span class="line">t.age = <span class="number">100</span></span><br><span class="line">print(t.age)</span><br><span class="line"><span class="keyword">del</span> t.age</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">__set__</span><br><span class="line">__get__</span><br><span class="line"><span class="number">100</span></span><br><span class="line">__delete__</span><br></pre></td></tr></table></figure>

<h3 id="å±æ€§æŸ¥æ‰¾è¿‡ç¨‹"><a href="#å±æ€§æŸ¥æ‰¾è¿‡ç¨‹" class="headerlink" title="å±æ€§æŸ¥æ‰¾è¿‡ç¨‹"></a>å±æ€§æŸ¥æ‰¾è¿‡ç¨‹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numbers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Integer</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, numbers.Integral):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'å¿…é¡»æ˜¯intç±»å‹æ•°æ®'</span>)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">'__set__'</span>)</span><br><span class="line">        self.__value = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'__get__'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.__value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        print(<span class="string">'__delete__'</span>)</span><br><span class="line">        <span class="keyword">del</span> self.__value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span><span class="params">(object)</span>:</span></span><br><span class="line">    age = Integer()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.score = Integer()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'__getattr__'</span>)</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattribute__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'__getattribute__'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> super(Test, self).__getattribute__(item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t = Test()</span><br></pre></td></tr></table></figure>

<ul>
<li><p>å¦‚æœattræ˜¯æ•°æ®å±æ€§æè¿°ç¬¦ï¼Œå¹¶ä¸”æ˜¯ç±»å¯¹è±¡å±æ€§ï¼Œå³ä»£ç ä¸­<code>age</code>å±æ€§ï¼Œé‚£ä¹ˆè°ƒç”¨æ—¶ï¼Œæ‰§è¡Œé¡ºåº: <code>__getattribute__</code> â€“&gt; <code>__get__</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t.age = <span class="number">100</span></span><br><span class="line">print(t.age)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">__set__</span><br><span class="line">__getattribute__</span><br><span class="line">__get__</span><br><span class="line"><span class="number">100</span></span><br></pre></td></tr></table></figure></li>
<li><p>å¦‚æœattræ˜¯æ•°æ®å±æ€§æè¿°ç¬¦ï¼Œä½†ä¸ºå¯¹è±¡å®ä¾‹çš„å±æ€§æ—¶ï¼Œå³<code>score</code>å±æ€§ï¼Œæ‰§è¡Œé¡ºåºä¸ºå°±æ˜¯è°ƒç”¨<code>__getattribute__</code>å–æ•°æ®ï¼Œå³ç›´æ¥è°ƒç”¨<code>self.__dict__</code>ä¸­å–æ•°æ®äº†ï¼Œè·Ÿæ˜¯å¦æ—¶æ•°æ®å±æ€§æè¿°ç¬¦æ— å…³ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t.score = <span class="number">99</span></span><br><span class="line">print(t.score)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">__getattribute__</span><br><span class="line"><span class="number">99</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœattrå­˜åœ¨ï¼Œåˆ™æ‰§è¡Œé¡ºåºæ˜¯<code>__geattribute__</code> â€“&gt; <code>t.__dict__</code> â€“&gt; <code>Test.__dict__</code></p>
</li>
<li><p>å¦‚æœatträ¸å­˜åœ¨ï¼Œåˆ™æŸ¥æ‰¾é¡ºåºæ˜¯<code>__getattribute__</code> â€“&gt; <code>t.__dict__</code> â€“&gt; <code>Test.__dict__</code> â€“&gt; <code>__getattr__</code></p>
</li>
</ul>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">https://www.cnblogs.com/xyz2b/p/<span class="number">10529068.</span>html</span><br><span class="line">https://www.cnblogs.com/xybaby/p/<span class="number">6270551.</span>html</span><br><span class="line">https://www.jianshu.com/p/<span class="number">885</span>d59db57fc</span><br><span class="line">https://blog.csdn.net/qq_26442553/article/details/<span class="number">82467777</span></span><br><span class="line">https://www.cnblogs.com/cccy0/archive/<span class="number">2018</span>/<span class="number">05</span>/<span class="number">20</span>/<span class="number">9063679.</span>html</span><br><span class="line">https://www.cnblogs.com/Vito2008/p/<span class="number">5280216.</span>html</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>æ•°æ®ç»“æ„ --- æ±‚ä¸¤ä¸ªå•é“¾è¡¨çš„äº¤å‰èŠ‚ç‚¹</title>
    <url>/2020/05/23/%E6%B1%82%E4%B8%A4%E4%B8%AA%E5%8D%95%E9%93%BE%E8%A1%A8%E7%9A%84%E4%BA%A4%E5%8F%89%E8%8A%82%E7%82%B9/</url>
    <content><![CDATA[<p>æ€è·¯:<br>å¦‚æœä¸¤ä¸ªå•é“¾è¡¨æœ‰äº¤å‰èŠ‚ç‚¹,é‚£ä¹ˆä»–ä»¬çš„å°¾èŠ‚ç‚¹ä¸€å®šæ˜¯ç›¸åŒçš„,æ‰€ä»¥å¯ä»¥è®¡ç®—å‡ºé“¾è¡¨çš„é•¿åº¦,ç„¶ååˆ¤æ–­é•¿çŸ­,å°†é•¿åº¦è¾ƒé•¿çš„é“¾è¡¨çš„å¤´èŠ‚ç‚¹ç§»åŠ¨(é•¿-çŸ­)ä¸ªèŠ‚ç‚¹,ç„¶åéå†ä¹‹åçš„èŠ‚ç‚¹.</p>
<a id="more"></a>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val)</span>:</span></span><br><span class="line">        self.val = val</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.val</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_communal_node</span><span class="params">(head1, head2)</span>:</span></span><br><span class="line">    <span class="comment"># è·å–äº¤å‰èŠ‚ç‚¹</span></span><br><span class="line">    length1= get_length(head1)</span><br><span class="line">    lenght2 = get_length(head2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœé“¾è¡¨1çš„é•¿åº¦å¤§äºé“¾è¡¨2</span></span><br><span class="line">    <span class="comment"># é‚£ä¹ˆå°±å°†é“¾è¡¨1çš„å¤´èŠ‚ç‚¹ç§»åŠ¨length1-length2ä¸ªä½ç½®</span></span><br><span class="line">    <span class="keyword">if</span> length1 &gt; lenght2:</span><br><span class="line">        <span class="keyword">while</span> lenght2 &lt; length1:</span><br><span class="line">            head1 = head1.next</span><br><span class="line">            lenght2 += <span class="number">1</span></span><br><span class="line">    <span class="comment"># åŒä¸Š</span></span><br><span class="line">    <span class="keyword">elif</span> lenght2 &gt; length1:</span><br><span class="line">        <span class="keyword">while</span> length1 &lt; lenght2:</span><br><span class="line">            head2 = head2.next</span><br><span class="line">            length1 += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä»åŒä¸€èµ·ç‚¹ä½ç½®å¼€å§‹ç§»åŠ¨</span></span><br><span class="line">    <span class="keyword">while</span> (head1 <span class="keyword">and</span> head2):</span><br><span class="line">        <span class="comment"># å¦‚æœå€¼ç›¸ç­‰(å®é™…ä¸Šåº”è¯¥åˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹),å°±è¯´æ˜è¿™ä¸ªæ˜¯äº¤å‰çš„èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> head1.val == head2.val:</span><br><span class="line">            <span class="keyword">return</span> head1</span><br><span class="line"></span><br><span class="line">        head1 = head1.next</span><br><span class="line">        head2 = head2.next</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_length</span><span class="params">(head)</span>:</span></span><br><span class="line">    <span class="comment"># è·å–é“¾è¡¨é•¿åº¦</span></span><br><span class="line">    length = <span class="number">0</span></span><br><span class="line">    <span class="comment"># head = copy.deepcopy(_head)</span></span><br><span class="line">    <span class="keyword">while</span> head:</span><br><span class="line">        length += <span class="number">1</span></span><br><span class="line">        head = head.next</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> length</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_head</span><span class="params">(links)</span>:</span></span><br><span class="line">    <span class="comment"># æ„å»ºé“¾è¡¨,è¿”å›å¤´èŠ‚ç‚¹</span></span><br><span class="line">    head = <span class="literal">None</span></span><br><span class="line">    cur = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> val <span class="keyword">in</span> links:</span><br><span class="line">        node = Node(val)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> head:</span><br><span class="line">            head = node</span><br><span class="line">            cur = head</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cur.next = node</span><br><span class="line">            cur = cur.next</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> head</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    head1 = get_head([<span class="string">'java'</span>, <span class="string">'world'</span>, <span class="string">'node'</span>, <span class="string">'B+'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>])</span><br><span class="line">    head2 = get_head([<span class="string">'ab'</span>, <span class="string">'bc'</span>, <span class="string">'ef'</span>, <span class="string">'hello'</span>, <span class="string">'python'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>])</span><br><span class="line"></span><br><span class="line">    node = get_communal_node(head1, head2)</span><br><span class="line">    print(node)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
  </entry>
  <entry>
    <title>Django-rest-framework --- åˆ†é¡µ</title>
    <url>/2020/05/23/django-rest-framework-%E5%88%86%E9%A1%B5/</url>
    <content><![CDATA[<h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>drfæ¡†æ¶çš„åˆ†é¡µä¸»è¦æœ‰ä¸‰ç§ï¼š</p>
<ol>
<li>æ™®é€šåˆ†é¡µï¼Œçœ‹ç¬¬né¡µï¼Œæ¯é¡µæ˜¾ç¤ºmæ¡æ•°æ®</li>
<li>åˆ‡å‰²åˆ†é¡µï¼Œåœ¨ç¬¬nä¸ªä½ç½®ï¼Œå‘åæŸ¥çœ‹mæ¡æ•°æ®</li>
<li>åŠ å¯†åˆ†é¡µï¼Œä¸æ™®é€šåˆ†é¡µä¸€æ ·ï¼Œä¸è¿‡å¯¹urlä¸­çš„è¯·æ±‚é¡µç è¿›è¡ŒåŠ å¯†</li>
</ol>
<a id="more"></a>

<h3 id="æ™®é€šåˆ†é¡µ"><a href="#æ™®é€šåˆ†é¡µ" class="headerlink" title="æ™®é€šåˆ†é¡µ"></a>æ™®é€šåˆ†é¡µ</h3><h4 id="è‡ªå®šä¹‰åˆ†é¡µç±»"><a href="#è‡ªå®šä¹‰åˆ†é¡µç±»" class="headerlink" title="è‡ªå®šä¹‰åˆ†é¡µç±»"></a>è‡ªå®šä¹‰åˆ†é¡µç±»</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> pagination</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentPagination</span><span class="params">(pagination.PageNumberPagination)</span>:</span></span><br><span class="line">    <span class="comment"># é»˜è®¤å€¼ ï¼Œæ¯ä¸€é¡µçš„æ•°é‡ï¼Œå¦‚æœæ²¡æœ‰sizeå‚æ•°çš„è¯</span></span><br><span class="line">    page_size = <span class="number">8</span></span><br><span class="line">    <span class="comment"># æœ€å¤§æ•°é‡ï¼Œå³ä½¿ å¸¦ä¸Šäº†sizeå‚æ•°ï¼Œä¹Ÿæ— æ³•è¶…è¿‡è¿™ä¸ªå€¼</span></span><br><span class="line">    max_page_size = <span class="number">10</span></span><br><span class="line">    <span class="comment"># é€šè¿‡GETè¯·æ±‚è·å–æ¯ä¸€é¡µéœ€è¦çš„æ•°é‡ï¼Œ/?size=xçš„sizeå‚æ•°</span></span><br><span class="line">    page_size_query_param = <span class="string">'size'</span></span><br><span class="line">    <span class="comment"># urlä¸­è¦æŸ¥æ‰¾çš„pageå‚æ•°ï¼Œå³/?page=xä¸­çš„pageå‚æ•°</span></span><br><span class="line">    page_query_param = <span class="string">'page'</span></span><br></pre></td></tr></table></figure>

<h4 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentView</span><span class="params">(generics.ListAPIView)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Student.objects.all().order_by(<span class="string">'-id'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># å®ä¾‹åŒ–æˆ‘ä»¬å®šä¹‰çš„åˆ†é¡µç±»</span></span><br><span class="line">        pagination = StudentPagination()</span><br><span class="line">        <span class="comment"># å¯¹å®ä¾‹åŒ–ç±»è¿›è¡Œä¼ å‚æ§åˆ¶</span></span><br><span class="line">        students = pagination.paginate_queryset(self.get_queryset(), request=request, view=self)</span><br><span class="line">        <span class="comment"># å°†åˆ†é¡µåçš„å¯¹è±¡ä½œåºåˆ—åŒ–</span></span><br><span class="line">        serializer = StudentSerializer(students, many=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pagination.get_paginated_response(serializer.data)</span><br></pre></td></tr></table></figure>

<h4 id="url"><a href="#url" class="headerlink" title="url"></a>url</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.StudentView.as_view())</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>åœ¨è¯·æ±‚æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>http://127.0.0.1:8000/students/?page=10&amp;size=3</code>ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨ä»é“¾æ¥ä¸­æå–pageå’Œsizeçš„å€¼äº†ã€‚æ­¤å¤„çš„æ„æ€æ˜¯ï¼Œè¯·æ±‚ç¬¬10é¡µçš„3ä¸ªæ•°æ®ã€‚</p>
<h3 id="åˆ‡å‰²åˆ†é¡µ"><a href="#åˆ‡å‰²åˆ†é¡µ" class="headerlink" title="åˆ‡å‰²åˆ†é¡µ"></a>åˆ‡å‰²åˆ†é¡µ</h3><h4 id="è‡ªå®šä¹‰åˆ†é¡µç±»-1"><a href="#è‡ªå®šä¹‰åˆ†é¡µç±»-1" class="headerlink" title="è‡ªå®šä¹‰åˆ†é¡µç±»"></a>è‡ªå®šä¹‰åˆ†é¡µç±»</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentLimitOffsetPagination</span><span class="params">(pagination.LimitOffsetPagination)</span>:</span></span><br><span class="line">    <span class="comment"># é»˜è®¤æ¯ä¸€é¡µæ˜¾ç¤ºå¤šå°‘æ¡æ•°æ®</span></span><br><span class="line">    default_limit = <span class="number">8</span></span><br><span class="line">    <span class="comment"># urlä¸­è®¾ç½®æ˜¾ç¤ºæ•°æ®æ•°é‡çš„å‚æ•°</span></span><br><span class="line">    limit_query_param = <span class="string">'limit'</span></span><br><span class="line">    <span class="comment"># ä»æ•°æ®åº“ä¸­çš„ç¬¬å‡ æ¡å¼€å§‹æŸ¥è¯¢ï¼ŒæŸ¥è¯¢limitæ¡</span></span><br><span class="line">    offset_query_param = <span class="string">'offset'</span></span><br><span class="line">    <span class="comment"># æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œè¿”å›æœ€å¤§æ•°é‡</span></span><br><span class="line">    max_limit = <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä»–çš„å†™æ³•è·Ÿæ™®é€šåˆ†é¡µæ— å¼‚ã€‚</p>
<h3 id="åŠ å¯†åˆ†é¡µ"><a href="#åŠ å¯†åˆ†é¡µ" class="headerlink" title="åŠ å¯†åˆ†é¡µ"></a>åŠ å¯†åˆ†é¡µ</h3><h4 id="è‡ªå®šä¹‰åˆ†é¡µç±»-2"><a href="#è‡ªå®šä¹‰åˆ†é¡µç±»-2" class="headerlink" title="è‡ªå®šä¹‰åˆ†é¡µç±»"></a>è‡ªå®šä¹‰åˆ†é¡µç±»</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentCursorPagination</span><span class="params">(pagination.CursorPagination)</span>:</span></span><br><span class="line">    <span class="comment"># æŸ¥è¯¢å‚æ•°</span></span><br><span class="line">    cursor_query_param = <span class="string">'cursor'</span></span><br><span class="line">    <span class="comment"># æ’åºæ–¹å¼</span></span><br><span class="line">    ordering = <span class="string">'-id'</span></span><br><span class="line">    <span class="comment"># æ¯é¡µæŸ¥è¯¢æ•°é‡</span></span><br><span class="line">    page_size_query_param = <span class="string">'size'</span></span><br><span class="line">    <span class="comment"># æ¯é¡µå¤§å°</span></span><br><span class="line">    page_size = <span class="number">8</span></span><br><span class="line">    <span class="comment"># æœ€å¤§é™åˆ¶</span></span><br><span class="line">    max_page_size = <span class="number">10</span></span><br></pre></td></tr></table></figure>



<p>ä½†è¿”å›æ•°æ®å´æœ‰ä¸åŒï¼Œæ— æ³•é€šè¿‡ä¿®æ”¹urlæ¥å¾—åˆ°æŒ‡å®šæŸé¡µçš„æ•°æ®ï¼Œåªèƒ½é€šè¿‡è¿”å›æ•°æ®ä¸­çš„previouså’Œnextæ¥å¾—åˆ°ä¸Šä¸€é¡µæˆ–è€…ä¸‹ä¸€é¡µçš„æ•°æ®ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"next"</span>: <span class="string">"http://127.0.0.1:8000/students/?cursor=cD04NQ%3D%3D"</span>,</span><br><span class="line">    <span class="attr">"previous"</span>: <span class="string">"http://127.0.0.1:8000/students/?cursor=cj0xJnA9OTI%3D"</span>,</span><br><span class="line">    <span class="attr">"results"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">92</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"test91"</span>,</span><br><span class="line">            <span class="attr">"age"</span>: <span class="number">101</span>,</span><br><span class="line">            <span class="attr">"sex"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"height"</span>: <span class="number">0.349139736956964</span>,</span><br><span class="line">            <span class="attr">"weight"</span>: <span class="number">105.24197499223212</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
        <tag>django-rest-framework</tag>
      </tags>
  </entry>
  <entry>
    <title>Django-rest-framework --- JWTAuthentication</title>
    <url>/2020/05/23/django-rest-framework-JWTAuthentication/</url>
    <content><![CDATA[<h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>  JWT æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†(RFC 7519)ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç”¨äºç®€æ´ï¼Œè‡ªåŒ…å«çš„ç”¨äºé€šä¿¡åŒæ–¹ä¹‹é—´ä»¥ JSON å¯¹è±¡çš„å½¢å¼å®‰å…¨ä¼ é€’ä¿¡æ¯çš„æ–¹æ³•ã€‚JWT å¯ä»¥ä½¿ç”¨ HMAC ç®—æ³•æˆ–è€…æ˜¯ RSA çš„å…¬é’¥å¯†é’¥å¯¹è¿›è¡Œç­¾åã€‚å®ƒå…·å¤‡ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p>
<ul>
<li>ç®€æ´(Compact)<br>å¯ä»¥é€šè¿‡URL, POST å‚æ•°æˆ–è€…åœ¨ HTTP header å‘é€ï¼Œå› ä¸ºæ•°æ®é‡å°ï¼Œä¼ è¾“é€Ÿåº¦å¿«</li>
</ul>
<ul>
<li>è‡ªåŒ…å«(Self-contained)<br>è´Ÿè½½ä¸­åŒ…å«äº†æ‰€æœ‰ç”¨æˆ·æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡æŸ¥è¯¢æ•°æ®åº“</li>
</ul>
<a id="more"></a>

<h4 id="JWT-ç»„æˆ"><a href="#JWT-ç»„æˆ" class="headerlink" title="JWT ç»„æˆ"></a>JWT ç»„æˆ</h4><ul>
<li><p>Header å¤´éƒ¨<br>å¤´éƒ¨åŒ…å«äº†ä¸¤éƒ¨åˆ†ï¼Œtoken ç±»å‹å’Œé‡‡ç”¨çš„åŠ å¯†ç®—æ³•,å®ƒä¼šä½¿ç”¨ Base64 ç¼–ç ç»„æˆ JWT ç»“æ„çš„ç¬¬ä¸€éƒ¨åˆ†.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"alg"</span>: <span class="string">"HS256"</span>,</span><br><span class="line">  <span class="string">"typ"</span>: <span class="string">"JWT"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Payload è´Ÿè½½<br>è¿™éƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬å­˜æ”¾ä¿¡æ¯çš„åœ°æ–¹äº†ï¼Œä½ å¯ä»¥æŠŠç”¨æˆ· ID ç­‰ä¿¡æ¯æ”¾åœ¨è¿™é‡Œï¼ŒJWT è§„èŒƒé‡Œé¢å¯¹è¿™éƒ¨åˆ†æœ‰è¿›è¡Œäº†æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ï¼Œå¸¸ç”¨çš„ç”± issï¼ˆç­¾å‘è€…ï¼‰ï¼Œexpï¼ˆè¿‡æœŸæ—¶é—´ï¼‰ï¼Œsubï¼ˆé¢å‘çš„ç”¨æˆ·ï¼‰ï¼Œaudï¼ˆæ¥æ”¶æ–¹ï¼‰ï¼Œiatï¼ˆç­¾å‘æ—¶é—´ï¼‰ã€‚<br>åŒæ ·çš„ï¼Œå®ƒä¼šä½¿ç”¨ Base64 ç¼–ç ç»„æˆ JWT ç»“æ„çš„ç¬¬äºŒéƒ¨åˆ†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"iss"</span>: <span class="string">"lion1ou JWT"</span>,</span><br><span class="line">    <span class="string">"iat"</span>: <span class="number">1441593502</span>,</span><br><span class="line">    <span class="string">"exp"</span>: <span class="number">1441594722</span>,</span><br><span class="line">    <span class="string">"aud"</span>: <span class="string">"qxinhai.cn"</span>,</span><br><span class="line">    <span class="string">"sub"</span>: <span class="string">"qxinhai@yeah.net"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Signature ç­¾å<br>å‰é¢ä¸¤éƒ¨åˆ†éƒ½æ˜¯ä½¿ç”¨ Base64 è¿›è¡Œç¼–ç çš„ï¼Œå³å‰ç«¯å¯ä»¥è§£å¼€çŸ¥é“é‡Œé¢çš„ä¿¡æ¯ã€‚Signature éœ€è¦ä½¿ç”¨ç¼–ç åçš„ header å’Œ payload ä»¥åŠæˆ‘ä»¬æä¾›çš„ä¸€ä¸ªå¯†é’¥ï¼Œç„¶åä½¿ç”¨ header ä¸­æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆHS256ï¼‰è¿›è¡Œç­¾åã€‚ç­¾åçš„ä½œç”¨æ˜¯ä¿è¯ JWT æ²¡æœ‰è¢«ç¯¡æ”¹è¿‡ã€‚<br>ä¸‰ä¸ªéƒ¨åˆ†é€šè¿‡.è¿æ¥åœ¨ä¸€èµ·å°±æ˜¯æˆ‘ä»¬çš„ JWT äº†ï¼Œå®ƒå¯èƒ½é•¿è¿™ä¸ªæ ·å­ï¼Œé•¿åº¦è²Œä¼¼å’Œä½ çš„åŠ å¯†ç®—æ³•å’Œç§é’¥æœ‰å…³ç³»ã€‚<br><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjU3ZmVmMTY0ZTU0YWY2NGZmYzUzZGJkNSIsInhzcmYiOiI0ZWE1YzUwOGE2NTY2ZTc2MjQwNTQzZjhmZWIwNmZkNDU3Nzc3YmUzOTU0OWM0MDE2NDM2YWZkYTY1ZDIzMzBlIiwiaWF0IjoxNDc2NDI3OTMzfQ.PA3QjeyZSUh7H0GfE0vJaKW4LjKJuC3dVLQiY4hii8s</code><br>å…¶å®åˆ°è¿™ä¸€æ­¥å¯èƒ½å°±æœ‰äººä¼šæƒ³äº†ï¼ŒHTTP è¯·æ±‚æ€»ä¼šå¸¦ä¸Š tokenï¼Œè¿™æ ·è¿™ä¸ª token ä¼ æ¥ä¼ å»å ç”¨ä¸å¿…è¦çš„å¸¦å®½å•Šã€‚å¦‚æœä½ è¿™ä¹ˆæƒ³äº†ï¼Œé‚£ä½ å¯ä»¥å»äº†è§£ä¸‹ HTTP2ï¼ŒHTTP2 å¯¹å¤´éƒ¨è¿›è¡Œäº†å‹ç¼©ï¼Œç›¸ä¿¡ä¹Ÿè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
</li>
<li><p>ç­¾åçš„ç›®çš„<br>æœ€åä¸€æ­¥ç­¾åçš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šæ˜¯å¯¹å¤´éƒ¨ä»¥åŠè´Ÿè½½å†…å®¹è¿›è¡Œç­¾åï¼Œé˜²æ­¢å†…å®¹è¢«çªœæ”¹ã€‚å¦‚æœæœ‰äººå¯¹å¤´éƒ¨ä»¥åŠè´Ÿè½½çš„å†…å®¹è§£ç ä¹‹åè¿›è¡Œä¿®æ”¹ï¼Œå†è¿›è¡Œç¼–ç ï¼Œæœ€ååŠ ä¸Šä¹‹å‰çš„ç­¾åç»„åˆå½¢æˆæ–°çš„JWTçš„è¯ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ç«¯ä¼šåˆ¤æ–­å‡ºæ–°çš„å¤´éƒ¨å’Œè´Ÿè½½å½¢æˆçš„ç­¾åå’ŒJWTé™„å¸¦ä¸Šçš„ç­¾åæ˜¯ä¸ä¸€æ ·çš„ã€‚å¦‚æœè¦å¯¹æ–°çš„å¤´éƒ¨å’Œè´Ÿè½½è¿›è¡Œç­¾åï¼Œåœ¨ä¸çŸ¥é“æœåŠ¡å™¨åŠ å¯†æ—¶ç”¨çš„å¯†é’¥çš„è¯ï¼Œå¾—å‡ºæ¥çš„ç­¾åä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
</li>
<li><p>ä¿¡æ¯æš´éœ²<br>åœ¨è¿™é‡Œå¤§å®¶ä¸€å®šä¼šé—®ä¸€ä¸ªé—®é¢˜ï¼šBase64æ˜¯ä¸€ç§ç¼–ç ï¼Œæ˜¯å¯é€†çš„ï¼Œé‚£ä¹ˆæˆ‘çš„ä¿¡æ¯ä¸å°±è¢«æš´éœ²äº†å—ï¼Ÿ<br>æ˜¯çš„ã€‚æ‰€ä»¥ï¼Œåœ¨JWTä¸­ï¼Œä¸åº”è¯¥åœ¨è´Ÿè½½é‡Œé¢åŠ å…¥ä»»ä½•æ•æ„Ÿçš„æ•°æ®ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼ è¾“çš„æ˜¯ç”¨æˆ·çš„User IDã€‚è¿™ä¸ªå€¼å®é™…ä¸Šä¸æ˜¯ä»€ä¹ˆæ•æ„Ÿå†…å®¹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¢«çŸ¥é“ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚ä½†æ˜¯åƒå¯†ç è¿™æ ·çš„å†…å®¹å°±ä¸èƒ½è¢«æ”¾åœ¨JWTä¸­äº†ã€‚å¦‚æœå°†ç”¨æˆ·çš„å¯†ç æ”¾åœ¨äº†JWTä¸­ï¼Œé‚£ä¹ˆæ€€æœ‰æ¶æ„çš„ç¬¬ä¸‰æ–¹é€šè¿‡Base64è§£ç å°±èƒ½å¾ˆå¿«åœ°çŸ¥é“ä½ çš„å¯†ç äº†ã€‚<br>å› æ­¤JWTé€‚åˆç”¨äºå‘Webåº”ç”¨ä¼ é€’ä¸€äº›éæ•æ„Ÿä¿¡æ¯ã€‚JWTè¿˜ç»å¸¸ç”¨äºè®¾è®¡ç”¨æˆ·è®¤è¯å’Œæˆæƒç³»ç»Ÿï¼Œç”šè‡³å®ç°Webåº”ç”¨çš„å•ç‚¹ç™»å½•ã€‚</p>
</li>
</ul>
<h4 id="JWT-ä½¿ç”¨"><a href="#JWT-ä½¿ç”¨" class="headerlink" title="JWT ä½¿ç”¨"></a>JWT ä½¿ç”¨</h4><ol>
<li>é¦–å…ˆï¼Œå‰ç«¯é€šè¿‡Webè¡¨å•å°†è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç å‘é€åˆ°åç«¯çš„æ¥å£ã€‚è¿™ä¸€è¿‡ç¨‹ä¸€èˆ¬æ˜¯ä¸€ä¸ªHTTP POSTè¯·æ±‚ã€‚å»ºè®®çš„æ–¹å¼æ˜¯é€šè¿‡SSLåŠ å¯†çš„ä¼ è¾“ï¼ˆhttpsåè®®ï¼‰ï¼Œä»è€Œé¿å…æ•æ„Ÿä¿¡æ¯è¢«å—…æ¢ã€‚</li>
<li>åç«¯æ ¸å¯¹ç”¨æˆ·åå’Œå¯†ç æˆåŠŸåï¼Œå°†ç”¨æˆ·çš„idç­‰å…¶ä»–ä¿¡æ¯ä½œä¸ºJWT Payloadï¼ˆè´Ÿè½½ï¼‰ï¼Œå°†å…¶ä¸å¤´éƒ¨åˆ†åˆ«è¿›è¡ŒBase64ç¼–ç æ‹¼æ¥åç­¾åï¼Œå½¢æˆä¸€ä¸ªJWTã€‚å½¢æˆçš„JWTå°±æ˜¯ä¸€ä¸ªå½¢åŒlll.zzz.xxxçš„å­—ç¬¦ä¸²ã€‚</li>
<li>åç«¯å°†JWTå­—ç¬¦ä¸²ä½œä¸ºç™»å½•æˆåŠŸçš„è¿”å›ç»“æœè¿”å›ç»™å‰ç«¯ã€‚å‰ç«¯å¯ä»¥å°†è¿”å›çš„ç»“æœä¿å­˜åœ¨localStorageæˆ–sessionStorageä¸Šï¼Œé€€å‡ºç™»å½•æ—¶å‰ç«¯åˆ é™¤ä¿å­˜çš„JWTå³å¯ã€‚</li>
<li>å‰ç«¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å°†JWTæ”¾å…¥HTTP Headerä¸­çš„Authorizationä½ã€‚(è§£å†³XSSå’ŒXSRFé—®é¢˜)</li>
<li>åç«¯æ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œå¦‚å­˜åœ¨éªŒè¯JWTçš„æœ‰æ•ˆæ€§ã€‚ä¾‹å¦‚ï¼Œæ£€æŸ¥ç­¾åæ˜¯å¦æ­£ç¡®ï¼›æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸï¼›æ£€æŸ¥Tokençš„æ¥æ”¶æ–¹æ˜¯å¦æ˜¯è‡ªå·±ï¼ˆå¯é€‰ï¼‰ã€‚</li>
<li>éªŒè¯é€šè¿‡ååç«¯ä½¿ç”¨JWTä¸­åŒ…å«çš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œå…¶ä»–é€»è¾‘æ“ä½œï¼Œè¿”å›ç›¸åº”ç»“æœã€‚</li>
</ol>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>ï½€pip install djangorestframework-jwtï½€</p>
<h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>åœ¨settings.pyä¸­æ·»åŠ ä»¥ä¸‹app</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">'rest_framework'</span>,</span><br><span class="line"><span class="string">'rest_framework_jwt'</span>,</span><br></pre></td></tr></table></figure>

<h4 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework_jwt.authentication <span class="keyword">import</span> JSONWebTokenAuthentication</span><br><span class="line"><span class="keyword">from</span> rest_framework_jwt.settings <span class="keyword">import</span> api_settings</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†ç”¨æˆ·æ•°æ®æ·»åŠ è¿›è½½è·</span></span><br><span class="line">jwt_payload_handler = api_settings.JWT_PAYLOAD_HANDLER</span><br><span class="line"><span class="comment"># åŠ å¯†</span></span><br><span class="line">jwt_encode_handler = api_settings.JWT_ENCODE_HANDLER</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginView</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ç™»å½•åŠŸèƒ½</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        username = request.data.get(<span class="string">'username'</span>)</span><br><span class="line">        password = request.data.get(<span class="string">'password'</span>)</span><br><span class="line">        user = User.objects.filter(username=username).first()</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">and</span> user.check_password(password):</span><br><span class="line">            payload = jwt_payload_handler(user)</span><br><span class="line">            token = jwt_encode_handler(payload)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">'token'</span>: token&#125;, status=status.HTTP_200_OK)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">'message'</span>: <span class="string">'ç™»å½•å¤±è´¥'</span>&#125;, status=status.HTTP_401_UNAUTHORIZED)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksView</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    è·å–æµ‹è¯•æ•°æ®</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    authentication_classes = [JSONWebTokenAuthentication, ]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        data = [</span><br><span class="line">            &#123;<span class="string">'name'</span>: <span class="string">'java'</span>, <span class="string">'price'</span>: <span class="number">57</span>&#125;,</span><br><span class="line">            &#123;<span class="string">'name'</span>: <span class="string">'python'</span>, <span class="string">'price'</span>: <span class="number">93</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">'books'</span>: data&#125;)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœç”¨æˆ·ç™»å½•æˆåŠŸï¼Œå°†è¿”å›tokenå€¼ã€‚<br>ä¸»è¦é ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°æ¥ç”Ÿæˆtokenå€¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å°†ç”¨æˆ·æ•°æ®æ·»åŠ è¿›è½½è·</span></span><br><span class="line">jwt_payload_handler = api_settings.JWT_PAYLOAD_HANDLER</span><br><span class="line"><span class="comment"># åŠ å¯†</span></span><br><span class="line">jwt_encode_handler = api_settings.JWT_ENCODE_HANDLER</span><br><span class="line"></span><br><span class="line">payload = jwt_payload_handler(user)</span><br><span class="line">token = jwt_encode_handler(payload)</span><br></pre></td></tr></table></figure>
<p>ä¸‹æ¬¡è®¿é—®æ—¶ï¼Œéœ€è¦ä½¿ç”¨tokenå€¼æ¥éªŒè¯èº«ä»½ã€‚<br>ä¸ç®¡æ˜¯å‰ç«¯è®¿é—®ï¼Œè¿˜æ˜¯requestsè®¿é—®ï¼Œéƒ½è¦ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¦æ±‚:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'Authorization'</span>: <span class="string">'JWT '</span> + token</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JWTå’Œtokenä¹‹é—´æœ‰ç©ºæ ¼ã€‚</p>
<p>ä»æºç çœ‹ï¼Œç»§æ‰¿é¡ºåºæ˜¯è¿™æ ·çš„:<br><code>JSONWebTokenAuthentication -&gt; BaseJSONWebTokenAuthentication -&gt; BaseAuthentication</code>ï¼Œæœ€ç»ˆä¹Ÿæ˜¯ç»§æ‰¿è‡ª<code>BaseAuthentication</code>ï¼Œä¹ŸåŒæ ·æœ‰ä¸ªè·Ÿ<code>TokenAuthentication</code>å’Œ<code>BasicAuthentication</code>çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯æ²¡æœ‰å¯¹<code>å¦‚æœä¸ä¼ å…¥Authorizationæ•°æ®</code>è¿™ç§æƒ…å†µæŠ›å¼‚å¸¸å¤„ç†ã€‚è¯¦ç»†è®²å°±æ˜¯ï¼Œä¸€ä¸ªè§†å›¾ç±»ä½¿ç”¨äº†<code>JSONWebTokenAuthentication</code>è®¤è¯ï¼Œå¦‚æœä½ ä¸ä¼ å…¥<code>Authorization</code>æ•°æ®ï¼Œå®ƒä¸ä¼šæŠ›å¼‚å¸¸ï¼Œä½†å¦‚æœä½ ä¼ å…¥äº†è¿™ä¸ªæ•°æ®ï¼Œæ•°æ®å´é”™äº†ï¼Œå°±ä¼šæŠ›å¼‚å¸¸ã€‚<br>çœ‹äº†è®¤è¯ç›¸å…³çš„æºç ï¼Œéƒ½æ˜¯åœ¨<code>authenticate()</code>å‡½æ•°ä¸­è¿”å›äº†<code>None</code>ä¹‹åï¼Œå°±æ²¡æœ‰åšä»»ä½•åˆ¤æ–­äº†ã€‚ä¸å¤ªæ¸…æ¥šå®˜æ–¹çš„æ­£ç¡®åšæ³•åº”è¯¥æ˜¯ä»€ä¹ˆï¼Œä½†åœ¨è§£å†³<code>ä¸ä¼ å…¥Authorizationæ•°æ®å´èƒ½æ­£å¸¸è®¿é—®</code>é—®é¢˜æ—¶ï¼Œä¼šä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼ã€‚</p>
<ol>
<li><p>é‡å†™dispathå’Œhandle_exceptionå‡½æ•°<br>åœ¨è°ƒç”¨getæˆ–è€…postå‡½æ•°ä¹‹å‰ï¼Œéƒ½ä¼šå…ˆè°ƒç”¨dispatchå‡½æ•°ï¼Œåœ¨æ­¤æ—¶åˆ¤æ–­ç”¨æˆ·æ˜¯å¦éªŒè¯æˆåŠŸ.<br>éªŒè¯æˆåŠŸæ—¶,<code>request.user</code>ä¼šè¿”å›ç™»å½•çš„Userå¯¹è±¡ï¼Œå¦åˆ™æ˜¯<code>AnonymousUser</code>, <code>request.auth</code>ä¹Ÿä¼šæ‰“è¿”å›tokenå€¼ã€‚åœ¨æ­¤æ—¶å¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªæ•°æ®ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ç»§ç»­æ‰§è¡Œæ¥ä¸‹æ¥å®é™…çš„è§†å›¾å‡½æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicApiView</span><span class="params">(APIView)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    å¹¶ä¸ä¸€å®šè¦ç»§æ‰¿APIViewï¼Œå¯ä»¥æŒ‰ç…§éœ€æ±‚ç»§æ‰¿</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dispatch</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        é‡å†™dispatchå‡½æ•°ï¼Œåœ¨postå’Œgetä¹‹å‰è°ƒç”¨</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        response = super(BasicApiView, self).dispatch(request, *args, **kwargs)</span><br><span class="line">        <span class="comment"># ç™»å½•çš„ç”¨æˆ·</span></span><br><span class="line">        <span class="comment"># request.user</span></span><br><span class="line">        <span class="comment"># tokenå€¼</span></span><br><span class="line">        <span class="comment"># request.auth</span></span><br><span class="line">        <span class="comment"># å¦‚æœç”¨æˆ·è®¤è¯å¤±è´¥</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> request.user <span class="keyword">or</span> isinstance(request.user, AnonymousUser):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">                <span class="keyword">raise</span> exceptions.AuthenticationFailed(<span class="string">'è®¤è¯å¤±è´¥'</span>)</span><br><span class="line">            <span class="keyword">except</span> exceptions.AuthenticationFailed <span class="keyword">as</span> exc:</span><br><span class="line">                <span class="comment"># æ•è·å¤„ç†åçš„å¼‚å¸¸</span></span><br><span class="line">                response = self.handle_exception(exc)</span><br><span class="line">                <span class="comment"># ä¸€å®šè¦åŠ ä¸Šè¿™ä¸€è¡Œï¼Œå¦åˆ™æŠ¥é”™</span></span><br><span class="line">                response = self.finalize_response(request, response, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_exception</span><span class="params">(self, exc)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># å¦‚æœæ˜¯éªŒè¯å¤±è´¥çš„å¼‚å¸¸ï¼Œè¿”å›401</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(exc, (exceptions.AuthenticationFailed, exceptions.NotAuthenticated)):</span><br><span class="line">            <span class="keyword">return</span> Response(&#123;<span class="string">'message'</span>: str(exc)&#125;, status=status.HTTP_401_UNAUTHORIZED)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å…¶ä»–çš„é”™è¯¯ç»Ÿä¸€å½’ä¸ºå†…éƒ¨é”™è¯¯ï¼Œå¦‚æœæœ‰éœ€è¦å•ç‹¬å¤„ç†ï¼Œæ”¾åœ¨ä¹‹å‰ç”¨ifåˆ¤æ–­å¤„ç†</span></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">'message'</span>: str(exc)&#125;, status=status.HTTP_500_INTERNAL_SERVER_ERROR)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksView</span><span class="params">(BasicApiView)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    è·å–æµ‹è¯•æ•°æ®</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    authentication_classes = [JSONWebTokenAuthentication, ]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        data = [</span><br><span class="line">            &#123;<span class="string">'name'</span>: <span class="string">'java'</span>, <span class="string">'price'</span>: <span class="number">57</span>&#125;,</span><br><span class="line">            &#123;<span class="string">'name'</span>: <span class="string">'python'</span>, <span class="string">'price'</span>: <span class="number">93</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">'books'</span>: data&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç»§æ‰¿è®¤è¯ç±»ï¼Œé‡å†™authenticate()å‡½æ•°</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JWTAuthentication</span><span class="params">(JSONWebTokenAuthentication)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">authenticate</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="comment"># è·å–è¿”å›å€¼(user, token)</span></span><br><span class="line">        user_auth_tuple = super().authenticate(request)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœè¿”å›å€¼ä¸ºç©ºï¼Œåˆ™è¯´æ˜éªŒè¯å¤±è´¥</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user_auth_tuple <span class="keyword">or</span> <span class="keyword">not</span> user_auth_tuple[<span class="number">0</span>] <span class="keyword">or</span> <span class="keyword">not</span> user_auth_tuple[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">raise</span> exceptions.AuthenticationFailed(<span class="string">'å¸å·æˆ–å¯†ç é”™è¯¯'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦åˆ™ç»§ç»­å¾€ä¸‹æ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> user_auth_tuple</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨è§†å›¾ç±»ä¸­é…ç½®å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">authentication_classes = [JWTAuthentication, ]</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæ˜¯æœ€åŸºæœ¬çš„ç”¨æ³•ï¼Œå¦‚æœæœ‰å®šåˆ¶è¦æ±‚ï¼Œä¹Ÿä¸ä¼šå·®çš„å¤ªè¿œã€‚</p>
<h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><h4 id="JSONWebTokenAuthentication"><a href="#JSONWebTokenAuthentication" class="headerlink" title="JSONWebTokenAuthentication"></a>JSONWebTokenAuthentication</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_jwt_value</span><span class="params">(self, request)</span>:</span></span><br><span class="line">  	<span class="comment"># è·å–è¯·æ±‚å¤´ä¸­Authoriztionæ•°æ®</span></span><br><span class="line">      auth = get_authorization_header(request).split()</span><br><span class="line">      <span class="comment"># è·å–æ ‡å¿—ä½ï¼Œå¦‚æœæ²¡æœ‰è‡ªå®šä¹‰ï¼Œå°±æ˜¯ JWT</span></span><br><span class="line">      auth_header_prefix = api_settings.JWT_AUTH_HEADER_PREFIX.lower()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> auth:</span><br><span class="line">          <span class="keyword">if</span> api_settings.JWT_AUTH_COOKIE:</span><br><span class="line">              <span class="keyword">return</span> request.COOKIES.get(api_settings.JWT_AUTH_COOKIE)</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> smart_text(auth[<span class="number">0</span>].lower()) != auth_header_prefix:</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> len(auth) == <span class="number">1</span>:</span><br><span class="line">          msg = _(<span class="string">'Invalid Authorization header. No credentials provided.'</span>)</span><br><span class="line">          <span class="keyword">raise</span> exceptions.AuthenticationFailed(msg)</span><br><span class="line">      <span class="keyword">elif</span> len(auth) &gt; <span class="number">2</span>:</span><br><span class="line">          msg = _(<span class="string">'Invalid Authorization header. Credentials string '</span></span><br><span class="line">                  <span class="string">'should not contain spaces.'</span>)</span><br><span class="line">          <span class="keyword">raise</span> exceptions.AuthenticationFailed(msg)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># è¿”å›tokenæ•°æ®</span></span><br><span class="line">      <span class="keyword">return</span> auth[<span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">authenticate</span><span class="params">(self, request)</span>:</span></span><br><span class="line">    <span class="comment"># tokenæ•°æ®</span></span><br><span class="line">       jwt_value = self.get_jwt_value(request)</span><br><span class="line">       <span class="keyword">if</span> jwt_value <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span>:</span><br><span class="line">       	<span class="comment"># è§£ætokenå€¼</span></span><br><span class="line">       	<span class="comment"># jwt_decode_handler = api_settings.JWT_DECODE_HANDLER</span></span><br><span class="line">       	<span class="comment"># å…·ä½“ä»£ç è§æºç åˆ†æ</span></span><br><span class="line">           payload = jwt_decode_handler(jwt_value)</span><br><span class="line">       <span class="keyword">except</span> jwt.ExpiredSignature:</span><br><span class="line">           msg = _(<span class="string">'Signature has expired.'</span>)</span><br><span class="line">           <span class="keyword">raise</span> exceptions.AuthenticationFailed(msg)</span><br><span class="line">       <span class="keyword">except</span> jwt.DecodeError:</span><br><span class="line">           msg = _(<span class="string">'Error decoding signature.'</span>)</span><br><span class="line">           <span class="keyword">raise</span> exceptions.AuthenticationFailed(msg)</span><br><span class="line">       <span class="keyword">except</span> jwt.InvalidTokenError:</span><br><span class="line">           <span class="keyword">raise</span> exceptions.AuthenticationFailed()</span><br><span class="line"></span><br><span class="line">       user = self.authenticate_credentials(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¤è¯æˆåŠŸåï¼Œè¿”å›ç™»å½•çš„Userå¯¹è±¡å’Œtokenæ•°æ®</span></span><br><span class="line">       <span class="keyword">return</span> (user, jwt_value)</span><br></pre></td></tr></table></figure>

<h4 id="rest-framework-jwt-settings"><a href="#rest-framework-jwt-settings" class="headerlink" title="rest_framework_jwt.settings"></a>rest_framework_jwt.settings</h4><p>è·¯å¾„:<code>rest_framework_jwt.settings.py</code></p>
<p>æˆ‘ä»¬ä¸€èˆ¬éƒ½å¯ä»¥ç”¨CTRL + å·¦é”®æŸ¥çœ‹å‡½æ•°\å±æ€§çš„å…·ä½“ä¿¡æ¯ï¼Œä½†æˆ‘åœ¨ä¸‹é¢ä½¿ç”¨ä¸‹é¢ä¸¤è¡Œä»£ç æ—¶å´å‘ç°æ— æ³•ç‚¹å‡»ï¼Œæ‰€ä»¥å¥½å¥‡å°±çœ‹äº†ä¸‹ç›¸å…³çš„ä»£ç ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å°†ç”¨æˆ·æ•°æ®æ·»åŠ è¿›è½½è·</span></span><br><span class="line">jwt_payload_handler = api_settings.JWT_PAYLOAD_HANDLER</span><br><span class="line"><span class="comment"># åŠ å¯†</span></span><br><span class="line">jwt_encode_handler = api_settings.JWT_ENCODE_HANDLER</span><br></pre></td></tr></table></figure>

<p>api_settingsæ˜¯APISettingsçš„å¯¹è±¡å®ä¾‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">api_settings = APISettings(USER_SETTINGS, DEFAULTS, IMPORT_STRINGS)</span><br></pre></td></tr></table></figure>

<p>settingså®é™…ä¸Šå°±æ˜¯djangoè¿è¡Œæ—¶ä½¿ç”¨çš„é…ç½®æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®JWT_AUTHæ•°æ®ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºapt_settingså¯¹è±¡æ—¶å°±ä»é…ç½®æ–‡ä»¶ä¸­å°†æ‰€æœ‰çš„ç”¨æˆ·è‡ªå®šä¹‰çš„æ•°æ®è¯»å–å‡ºæ¥ï¼Œå­˜æ”¾åˆ°USER_SETTINGSä¸­ï¼Œå¹¶ä¼ å…¥ApiSettingsä¸­ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">USER_SETTINGS = getattr(settings, <span class="string">'JWT_AUTH'</span>, <span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<p>DEFAULTSä¸­çš„æ•°æ®æ˜¯æœ€é½å…¨çš„ï¼Œç”¨æˆ·èƒ½è‡ªå®šä¹‰çš„æ•°æ®éƒ½åœ¨è¯¥å­—å…¸ä¸­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DEFAULTS = &#123;</span><br><span class="line">    <span class="string">'JWT_ENCODE_HANDLER'</span>:</span><br><span class="line">    <span class="string">'rest_framework_jwt.utils.jwt_encode_handler'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_DECODE_HANDLER'</span>:</span><br><span class="line">    <span class="string">'rest_framework_jwt.utils.jwt_decode_handler'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_PAYLOAD_HANDLER'</span>:</span><br><span class="line">    <span class="string">'rest_framework_jwt.utils.jwt_payload_handler'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_PAYLOAD_GET_USER_ID_HANDLER'</span>:</span><br><span class="line">    <span class="string">'rest_framework_jwt.utils.jwt_get_user_id_from_payload_handler'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_PRIVATE_KEY'</span>:</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_PUBLIC_KEY'</span>:</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_PAYLOAD_GET_USERNAME_HANDLER'</span>:</span><br><span class="line">    <span class="string">'rest_framework_jwt.utils.jwt_get_username_from_payload_handler'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_RESPONSE_PAYLOAD_HANDLER'</span>:</span><br><span class="line">    <span class="string">'rest_framework_jwt.utils.jwt_response_payload_handler'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_SECRET_KEY'</span>: settings.SECRET_KEY,</span><br><span class="line">    <span class="string">'JWT_GET_USER_SECRET_KEY'</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">'JWT_ALGORITHM'</span>: <span class="string">'HS256'</span>,</span><br><span class="line">    <span class="string">'JWT_VERIFY'</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">'JWT_VERIFY_EXPIRATION'</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">'JWT_LEEWAY'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'JWT_EXPIRATION_DELTA'</span>: datetime.timedelta(seconds=<span class="number">300</span>),</span><br><span class="line">    <span class="string">'JWT_AUDIENCE'</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">'JWT_ISSUER'</span>: <span class="literal">None</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_ALLOW_REFRESH'</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">'JWT_REFRESH_EXPIRATION_DELTA'</span>: datetime.timedelta(days=<span class="number">7</span>),</span><br><span class="line"></span><br><span class="line">    <span class="string">'JWT_AUTH_HEADER_PREFIX'</span>: <span class="string">'JWT'</span>,</span><br><span class="line">    <span class="string">'JWT_AUTH_COOKIE'</span>: <span class="literal">None</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·å¯å¯¼å…¥ï¼ˆè°ƒç”¨ï¼‰çš„æ•°æ®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">IMPORT_STRINGS = (</span><br><span class="line">    <span class="string">'JWT_ENCODE_HANDLER'</span>,</span><br><span class="line">    <span class="string">'JWT_DECODE_HANDLER'</span>,</span><br><span class="line">    <span class="string">'JWT_PAYLOAD_HANDLER'</span>,</span><br><span class="line">    <span class="string">'JWT_PAYLOAD_GET_USER_ID_HANDLER'</span>,</span><br><span class="line">    <span class="string">'JWT_PAYLOAD_GET_USERNAME_HANDLER'</span>,</span><br><span class="line">    <span class="string">'JWT_RESPONSE_PAYLOAD_HANDLER'</span>,</span><br><span class="line">    <span class="string">'JWT_GET_USER_SECRET_KEY'</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="APISettings"><a href="#APISettings" class="headerlink" title="APISettings"></a>APISettings</h4><p>APISettingsçš„è·¯å¾„ï¼š<code>rest-framework.settings</code><br><code>__getattr__</code>é­”æ³•æ–¹æ³•çš„ä½œç”¨æ˜¯ï¼Œå¯¹è±¡å®ä¾‹åœ¨è°ƒç”¨æ–¹æ³•æˆ–è€…å±æ€§æ—¶éƒ½å°†è°ƒç”¨<code>__getattr__</code>ã€‚é‚£ä¹ˆæ­¤å¤„çš„ä½œç”¨ï¼Œå°±ç›¸å½“äºå¦‚æœä½ æƒ³è¦è°ƒç”¨<code>rest_framework_jwt.utils.jwt_payload_handler</code>å‡½æ•°ï¼Œä½ å°±åªéœ€è¦ä½¿ç”¨<code>api_settings.JWT_PAYLOAD_HANDLER</code>å³å¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, attr)</span>:</span></span><br><span class="line">    <span class="comment"># defautlsé…ç½®æ–‡ä»¶æ•°æ®æ˜¯æœ€é½å…¨çš„ï¼Œå¦‚æœdefaultsæ²¡æœ‰ï¼Œå°±è¯´æ˜å¯¹è±¡è°ƒç”¨é”™äº†ã€‚</span></span><br><span class="line">    <span class="comment"># attræ˜¯å±æ€§åï¼Œæˆ–è€…æ–¹æ³•å</span></span><br><span class="line">    <span class="keyword">if</span> attr <span class="keyword">not</span> <span class="keyword">in</span> self.defaults:</span><br><span class="line">        <span class="keyword">raise</span> AttributeError(<span class="string">"Invalid API setting: '%s'"</span> % attr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># åˆ¤æ–­ç”¨æˆ·æ˜¯å¦è‡ªå®šä¹‰äº†attrå±æ€§</span></span><br><span class="line">        val = self.user_settings[attr]</span><br><span class="line">    <span class="keyword">except</span> KeyError:</span><br><span class="line">        <span class="comment"># å¦‚æœç”¨æˆ·æ²¡æœ‰è‡ªå®šä¹‰ï¼Œé‚£ä¹ˆå°±ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–</span></span><br><span class="line">        val = self.defaults[attr]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœattråœ¨import_stringsä¸­ï¼Œå°±è¯´æ˜å…¶å®æ˜¯ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">    <span class="comment"># ç°åœ¨å­˜å…¥çš„æ˜¯ä¸€ä¸ªæœ‰å…·ä½“è·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œéœ€è¦å°†å…¶è½¬æ¢æˆå¯è°ƒç”¨çš„å‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> attr <span class="keyword">in</span> self.import_strings:</span><br><span class="line">        val = perform_import(val, attr)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŠ å…¥ç¼“å­˜</span></span><br><span class="line">    <span class="comment"># å†æ¬¡è°ƒç”¨attræ—¶ï¼Œä¸ä¼šå†è§¦å‘__getattr__é­”æ³•æ–¹æ³•</span></span><br><span class="line">    self._cached_attrs.add(attr)</span><br><span class="line">    <span class="comment"># è¿™è¡Œä»£ç ï¼Œç±»ä¼¼äºè¿™ç§æ•ˆæœ</span></span><br><span class="line">    <span class="comment"># a = A() setattr(a, 'a', 10)</span></span><br><span class="line">    <span class="comment"># æ‰“å° a.a å°†è¿”å›10</span></span><br><span class="line">    setattr(self, attr, val)</span><br><span class="line">    <span class="keyword">return</span> val</span><br></pre></td></tr></table></figure>

<p><code>rest_framework.settings</code>ä¸‹ä¹Ÿæœ‰ä¸ªapi_settings,<br><code>api_settings = APISettings(None, DEFAULTS, IMPORT_STRINGS)</code>ï¼Œä¸<code>rest_framework_jwt.settings</code>ä¸‹çš„api_settingsä¸æ˜¯åŒä¸€ä¸ªï¼Œä¸è¦æ··ç”¨äº†ã€‚</p>
<h4 id="jwt-payload-handler"><a href="#jwt-payload-handler" class="headerlink" title="jwt_payload_handler"></a>jwt_payload_handler</h4><p>è·¯å¾„ï¼š<code>rest_framework_jwt.utils.jwt_payload_handler</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jwt_payload_handler</span><span class="params">(user)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># å°†ç”¨æˆ·idï¼Œç”¨æˆ·åï¼Œtokençš„æœ‰æ•ˆæ—¶é—´ï¼Œé‚®ç®±éƒ½å†™å…¥è½½è·ä¸­</span></span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">'user_id'</span>: user.pk,</span><br><span class="line">        <span class="string">'username'</span>: username,</span><br><span class="line">        <span class="string">'exp'</span>: datetime.utcnow() + api_settings.JWT_EXPIRATION_DELTA</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> hasattr(user, <span class="string">'email'</span>):</span><br><span class="line">        payload[<span class="string">'email'</span>] = user.email</span><br><span class="line">    <span class="keyword">if</span> isinstance(user.pk, uuid.UUID):</span><br><span class="line">        payload[<span class="string">'user_id'</span>] = str(user.pk)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h4 id="åŠ å¯†ä¸è§£å¯†"><a href="#åŠ å¯†ä¸è§£å¯†" class="headerlink" title="åŠ å¯†ä¸è§£å¯†"></a>åŠ å¯†ä¸è§£å¯†</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jwt_encode_handler</span><span class="params">(payload)</span>:</span></span><br><span class="line">    key = api_settings.JWT_PRIVATE_KEY <span class="keyword">or</span> jwt_get_secret_key(payload)</span><br><span class="line">    <span class="keyword">return</span> jwt.encode(</span><br><span class="line">        payload,</span><br><span class="line">        key,</span><br><span class="line">        api_settings.JWT_ALGORITHM</span><br><span class="line">    ).decode(<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jwt_decode_handler</span><span class="params">(token)</span>:</span></span><br><span class="line">    options = &#123;</span><br><span class="line">        <span class="string">'verify_exp'</span>: api_settings.JWT_VERIFY_EXPIRATION,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># get user from token, BEFORE verification, to get user secret key</span></span><br><span class="line">    unverified_payload = jwt.decode(token, <span class="literal">None</span>, <span class="literal">False</span>)</span><br><span class="line">    secret_key = jwt_get_secret_key(unverified_payload)</span><br><span class="line">    <span class="keyword">return</span> jwt.decode(</span><br><span class="line">        token,</span><br><span class="line">        api_settings.JWT_PUBLIC_KEY <span class="keyword">or</span> secret_key,</span><br><span class="line">        api_settings.JWT_VERIFY,</span><br><span class="line">        options=options,</span><br><span class="line">        leeway=api_settings.JWT_LEEWAY,</span><br><span class="line">        audience=api_settings.JWT_AUDIENCE,</span><br><span class="line">        issuer=api_settings.JWT_ISSUER,</span><br><span class="line">        algorithms=[api_settings.JWT_ALGORITHM]</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h4 id="ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®"><a href="#ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®" class="headerlink" title="ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®"></a>ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®</h4><p>ä»¥ä¸‹æ˜¯å¸¸ç”¨çš„å‡ ä¸ªï¼Œå¦‚æœéœ€è¦æ›´å¤šçš„ï¼ŒæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p>
<h5 id="JWT-SECRET-KEY"><a href="#JWT-SECRET-KEY" class="headerlink" title="JWT_SECRET_KEY"></a>JWT_SECRET_KEY</h5><p>ç”¨æ¥ç»™tokenåŠ å¯†çš„ï¼Œé»˜è®¤æ˜¯<code>settings.SECRET_KEY</code></p>
<h5 id="JWT-ALGORITHM"><a href="#JWT-ALGORITHM" class="headerlink" title="JWT_ALGORITHM"></a>JWT_ALGORITHM</h5><p>åŠ å¯†ç®—æ³•ï¼Œé»˜è®¤æ˜¯HS256</p>
<h5 id="JWT-VERIFY"><a href="#JWT-VERIFY" class="headerlink" title="JWT_VERIFY"></a>JWT_VERIFY</h5><p>è§£å¯†å¤±è´¥æ—¶å°†æŠ›å‡ºä¸€ä¸ªDecodeErroré”™è¯¯ï¼Œé»˜è®¤æ˜¯Trueï¼Œæ”¹ä¸ºFalseæ—¶ï¼Œä»å¯ä»¥è·å–è½½è·</p>
<h5 id="JWT-VERIFY-EXPIRATION"><a href="#JWT-VERIFY-EXPIRATION" class="headerlink" title="JWT_VERIFY_EXPIRATION"></a>JWT_VERIFY_EXPIRATION</h5><p>æ˜¯å¦è®¾ç½®æœ‰æ•ˆæ—¶é—´ï¼Œé»˜è®¤æ˜¯True</p>
<h5 id="JWT-LEEWAY"><a href="#JWT-LEEWAY" class="headerlink" title="JWT_LEEWAY"></a>JWT_LEEWAY</h5><p>tokenè¿‡æœŸæ—¶é—´çš„ç¼“å†²æœŸï¼Œé»˜è®¤ä¸º0.å°±æ˜¯è¯´ï¼Œå¦‚æœè®¾ç½®äº†ä¸€ä¸ªtokençš„è¿‡æœŸæ—¶é—´æ˜¯10åˆ†é’Ÿï¼Œä½†å¦‚æœä½ è®¾ç½®äº†è¿™ä¸ªå€¼ä¸º1åˆ†é’Ÿï¼Œé‚£ä¹ˆåœ¨10ï½11åˆ†é’Ÿå†…ï¼Œè¯¥tokenä»æœ‰æ•ˆã€‚</p>
<h5 id="JWT-EXPIRATION-DELTA"><a href="#JWT-EXPIRATION-DELTA" class="headerlink" title="JWT_EXPIRATION_DELTA"></a>JWT_EXPIRATION_DELTA</h5><p>tokençš„æœ‰æ•ˆæ—¶é—´ï¼Œé»˜è®¤æ˜¯5åˆ†é’Ÿã€‚<code>datetime.timedelta</code>æ•°æ®ç±»å‹ã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;getblimp.github.io&#x2F;django-rest-framework-jwt&#x2F;</span><br><span class="line">https:&#x2F;&#x2F;www.django-rest-framework.org&#x2F;api-guide&#x2F;settings&#x2F;</span><br><span class="line">https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;180a870a308a</span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;chengqiang20152015&#x2F;article&#x2F;details&#x2F;81146545</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
        <tag>django-rest-framework</tag>
      </tags>
  </entry>
  <entry>
    <title>Django-rest-framework --- è®¤è¯</title>
    <url>/2020/05/23/django-rest-framework-%E8%AE%A4%E8%AF%81/</url>
    <content><![CDATA[<h3 id="æ•°æ®è¡¨"><a href="#æ•°æ®è¡¨" class="headerlink" title="æ•°æ®è¡¨"></a>æ•°æ®è¡¨</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    USER_TYPE = (</span><br><span class="line">        (<span class="number">1</span>, <span class="string">'æ™®é€šç”¨æˆ·'</span>),</span><br><span class="line">        (<span class="number">2</span>, <span class="string">'VIP'</span>),</span><br><span class="line">        (<span class="number">3</span>, <span class="string">'SVIP'</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    user_type = models.IntegerField(choices=USER_TYPE, default=USER_TYPE[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">    username = models.CharField(max_length=<span class="number">128</span>)</span><br><span class="line">    password = models.CharField(max_length=<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserToken</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    user = models.OneToOneField(UserInfo, on_delete=models.CASCADE)</span><br><span class="line">    token = models.CharField(max_length=<span class="number">256</span>)</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="è‡ªå®šä¹‰è®¤è¯å¯¹è±¡"><a href="#è‡ªå®šä¹‰è®¤è¯å¯¹è±¡" class="headerlink" title="è‡ªå®šä¹‰è®¤è¯å¯¹è±¡"></a>è‡ªå®šä¹‰è®¤è¯å¯¹è±¡</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomerAuthentication</span><span class="params">(authentication.BaseAuthentication)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">authenticate</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="comment"># è·å–urlä¸­çš„tokenå€¼</span></span><br><span class="line">        token = request._request.GET.get(<span class="string">'token'</span>)</span><br><span class="line">        <span class="comment"># åˆ¤æ–­å¯¹åº”ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        user_token = UserToken.objects.filter(token=token).first()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user_token:</span><br><span class="line">            <span class="keyword">raise</span> exceptions.AuthenticationFailed(<span class="string">'ç”¨æˆ·è®¤è¯å¤±è´¥'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¿…é¡»è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„ tuple</span></span><br><span class="line">        <span class="keyword">return</span> (user_token.user, user_token)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">authenticate_header</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>



<h3 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> generics</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> students.models <span class="keyword">import</span> UserInfo, UserToken</span><br><span class="line"><span class="keyword">from</span> students.authenticates <span class="keyword">import</span> CustomerAuthentication</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(user)</span>:</span></span><br><span class="line">    <span class="keyword">import</span> hashlib</span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">    ctime = str(time.time())</span><br><span class="line"></span><br><span class="line">    m = hashlib.md5()</span><br><span class="line">    m.update(ctime.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    m.update(user.username.encode(<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> m.hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthApiView</span><span class="params">(APIView)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        ret = &#123;<span class="string">'code'</span>: <span class="number">200</span>, <span class="string">'msg'</span>: <span class="string">'success'</span>&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            username = request.POST.get(<span class="string">'username'</span>)</span><br><span class="line">            password = request.POST.get(<span class="string">'password'</span>)</span><br><span class="line">            user = UserInfo.objects.filter(username=username).first()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">                UserInfo.objects.create(username=username, password=password)</span><br><span class="line">                ret[<span class="string">'code'</span>] = <span class="number">201</span></span><br><span class="line">                ret[<span class="string">'msg'</span>] = <span class="string">'åˆ›å»ºæˆåŠŸ'</span></span><br><span class="line"></span><br><span class="line">            token = md5(user)</span><br><span class="line">            UserToken.objects.update_or_create(user=user, defaults=&#123;<span class="string">'token'</span>: token&#125;)</span><br><span class="line">            ret[<span class="string">'token'</span>] = token</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">import</span> traceback</span><br><span class="line">            traceback.print_exc()</span><br><span class="line">            ret[<span class="string">'code'</span>] = <span class="number">1002</span></span><br><span class="line">            ret[<span class="string">'msg'</span>] = <span class="string">'è¯·æ±‚å¼‚å¸¸'</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(ret)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderApiView</span><span class="params">(generics.ListAPIView)</span>:</span></span><br><span class="line">    authentication_classes = [CustomerAuthentication, ]</span><br><span class="line"></span><br><span class="line">    ORDER_DATA = &#123;</span><br><span class="line">        <span class="number">1</span>: &#123;</span><br><span class="line">            <span class="string">'name'</span>: <span class="string">'apple'</span>,</span><br><span class="line">            <span class="string">'number'</span>: <span class="number">20</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="number">2</span>: &#123;</span><br><span class="line">            <span class="string">'name'</span>: <span class="string">'banana'</span>,</span><br><span class="line">            <span class="string">'number'</span>: <span class="number">30</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(OrderApiView.ORDER_DATA)</span><br></pre></td></tr></table></figure>







<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œç”Ÿæˆtokenå¹¶ä¿å­˜åˆ°æ•°æ®è¡¨ä¸­ï¼Œæ¯æ¬¡è¯·æ±‚æ—¶éƒ½å¸¦ä¸Š token;</p>
<p>åœ¨è§†å›¾ç±»ä¸­é‡å†™authentication_classeså±æ€§ï¼Œå°†è‡ªå®šä¹‰è®¤è¯å¯¹è±¡ä»¥åˆ—è¡¨å½¢å¼èµ‹å€¼ç»™ä»–ï¼Œå½“è°ƒç”¨è¯¥è§†å›¾æ—¶ä¼šè‡ªåŠ¨éªŒè¯ï¼›</p>
<p>å¦‚æœæƒ³è®©æ‰€æœ‰çš„drfè§†å›¾éƒ½ä½¿ç”¨åŒä¸€ä¸ªè®¤è¯ç±»ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨settings.pyä¸­é…ç½®,</p>
<p><code>&#39;DEFAULT_AUTHENTICATION_CLASSES&#39;:[&#39;students.authenticates.CustomerAuthentication&#39;]</code>;</p>
<p>è‹¥ä¸æƒ³ä½¿ç”¨settings.pyä¸­çš„è®¤è¯ï¼Œåœ¨è§†å›¾ç±»ä¸­é‡å†™authentication_classeså±æ€§å³å¯ã€‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
        <tag>django-rest-framework</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®ç»“æ„ --- æ•£åˆ—è¡¨çš„åˆ†ç¦»é“¾æ¥æ³•ä»£ç å®ç°</title>
    <url>/2020/05/23/%E6%95%A3%E5%88%97%E8%A1%A8%E7%9A%84%E5%88%86%E7%A6%BB%E9%93%BE%E6%8E%A5%E6%B3%95%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<p>ç†è®ºæ€§çš„ä¸œè¥¿å»è¿™ç¯‡åšå®¢çœ‹å§,è‡ªå·±å†™çš„è‚¯å®šæ²¡è¿™ç¯‡å¥½.<br><a href="https://www.cnblogs.com/linxiyue/p/3795396.html" target="_blank" rel="noopener">Pythonæ•°æ®ç»“æ„â€”â€”æ•£åˆ—è¡¨</a></p>
<p>åœ¨ä¸Šç¯‡åšå®¢ä¸­,è§‰å¾—åˆ†ç¦»æ•£åˆ—æ³•æ˜¯å¾ˆæœ‰æ„æ€çš„ä¸€ç§å†™æ³•,æ‰€ä»¥èŠ±ç‚¹æ—¶é—´å°†å…¶å®ç°äº†,è™½ç„¶çœ‹ç€ä¹Ÿå¾ˆç®€å•.<br>ä¸»è¦æ€è·¯å¦‚å›¾,å°±æ˜¯åœ¨åˆ—è¡¨ä¸­å­˜å‚¨ç€å•é“¾è¡¨çš„å¤´èŠ‚ç‚¹.<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/pic/85.jpg" alt=""></p>
<br/>
å¾ˆæ— å¥ˆï¼Œæ ¼å¼ä¸€ç›´è°ƒä¸å¯¹ï¼Œ"""æ–‡æ¡£æ³¨é‡Š"""æ€»æ˜¯å‡ºç°å¯¹ä¸é½çš„æƒ…å†µ

<a id="more"></a>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-5-22 22:33</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val)</span>:</span></span><br><span class="line">        self.val = val</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(self.val)</span><br><span class="line"></span><br><span class="line">    __repr__ = __str__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HashTable</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, init_length=<span class="number">15</span>)</span>:</span></span><br><span class="line">        <span class="comment"># é•¿åº¦</span></span><br><span class="line">        self.__table = [<span class="literal">None</span>] * init_length</span><br><span class="line">        <span class="comment"># å½“å‰è¡¨ä¸­æ•°æ®ä¸ªæ•°</span></span><br><span class="line">        self.__count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, val)</span>:</span></span><br><span class="line">        <span class="comment"># æ’å…¥</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç´¢å¼•</span></span><br><span class="line">        index = self.hash_index(val)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.__table[index]:</span><br><span class="line">            self.__table[index] = Node(val)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            head = self.__table[index]</span><br><span class="line">            <span class="keyword">while</span> head.next:</span><br><span class="line">                head = head.next</span><br><span class="line"></span><br><span class="line">            <span class="comment"># æ·»åŠ åˆ°é“¾è¡¨å°¾éƒ¨</span></span><br><span class="line">            head.next = Node(val)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># é•¿åº¦+1</span></span><br><span class="line">        self.count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¡ç®—æ˜¯å¦è¾¾åˆ°é™åˆ¶å®¹é‡</span></span><br><span class="line">        <span class="keyword">if</span> self.need_rehash():</span><br><span class="line">            self.rehash()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, val)</span>:</span></span><br><span class="line">        <span class="comment"># åˆ é™¤å€¼</span></span><br><span class="line"></span><br><span class="line">        index = self.hash_index(val)</span><br><span class="line">        <span class="comment"># å¾—åˆ°å¤´ç»“ç‚¹</span></span><br><span class="line">        node = self.__table[index]</span><br><span class="line">        <span class="comment"># ä¿å­˜å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        pre = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> node:</span><br><span class="line">            <span class="keyword">if</span> node.val == val:</span><br><span class="line">                <span class="comment"># å¦‚æœpreä¸ºç©º,å³valæ˜¯å¤´ç»“ç‚¹çš„å€¼</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> pre:</span><br><span class="line">                    <span class="comment"># è¦åˆ é™¤çš„æ˜¯å¤´ç»“ç‚¹,é‚£ä¹ˆå°†å¤´ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ”¾åˆ°è¡¨ä¸­</span></span><br><span class="line">                    self.__table[index] = node.next</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    pre.next = node.next</span><br><span class="line">                self.count -= <span class="number">1</span></span><br><span class="line">                <span class="comment"># åˆ é™¤</span></span><br><span class="line">                <span class="keyword">del</span> node</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            pre = node</span><br><span class="line">            node = node.next</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self, val)</span>:</span></span><br><span class="line">        <span class="comment"># æœç´¢</span></span><br><span class="line">        <span class="comment"># :param val: éœ€è¦æœç´¢çš„å€¼</span></span><br><span class="line">        <span class="comment"># :return: å¦‚æœæ²¡æœ‰æ‰¾åˆ°,è¿”å›None,æ‰¾åˆ°äº†å°±è¿”å›èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">        index = self.hash_index(val)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¾—åˆ°å¤´ç»“ç‚¹</span></span><br><span class="line">        node = self.__table[index]</span><br><span class="line">        <span class="keyword">while</span> node:</span><br><span class="line">            <span class="keyword">if</span> node.val == val:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            node = node.next</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">traverse</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># éå†æ•°æ®</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> node <span class="keyword">in</span> self.__table:</span><br><span class="line">            <span class="keyword">if</span> node:</span><br><span class="line">                <span class="comment"># éå†ä¸€æ¡é“¾è¡¨çš„æ•°æ®</span></span><br><span class="line">                <span class="keyword">while</span> node:</span><br><span class="line">                    print(node.val, end=<span class="string">' '</span>)</span><br><span class="line">                    node = node.next</span><br><span class="line">                print()</span><br><span class="line"></span><br><span class="line"><span class="meta">	@property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># å½“å‰æ•°æ®ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.__count</span><br><span class="line"></span><br><span class="line"><span class="meta">	@count.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(self, count)</span>:</span></span><br><span class="line">        self.__count = count</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">table_length</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># è¡¨æ€»é•¿åº¦</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> len(self.__table)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__used_index</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># ä½¿ç”¨äº†ä¸‹æ ‡çš„ä¸ªæ•°,å³æœ‰å¤šå°‘ä¸ªç´¢å¼•ä¸‹æ ‡ä½¿ç”¨äº†</span></span><br><span class="line"></span><br><span class="line">        length = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> node <span class="keyword">in</span> self.__table:</span><br><span class="line">            <span class="keyword">if</span> node:</span><br><span class="line">                length += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> length</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rehash</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># å½“è¾¾åˆ°é™åˆ¶å®¹é‡æ—¶,æ‰©å®¹åé‡æ–°èµ‹å€¼</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä¸´æ—¶è¡¨,æ‰©å®¹ä½¿ç”¨,æ‰©å®¹å€æ•°*2</span></span><br><span class="line">        tmp = [<span class="literal">None</span>] * (self.table_length() * <span class="number">2</span>)</span><br><span class="line">        <span class="comment"># è¯»å–å¤´èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> node <span class="keyword">in</span> self.__table:</span><br><span class="line">            <span class="keyword">if</span> node:</span><br><span class="line">                <span class="comment"># å¤´èŠ‚ç‚¹ä¸­çš„å€¼</span></span><br><span class="line">                val = node.val</span><br><span class="line">                <span class="comment"># è®¡ç®—ç´¢å¼•</span></span><br><span class="line">                index = self.hash_index(val, tmp)</span><br><span class="line">                <span class="comment"># å°†å¤´èŠ‚ç‚¹æ”¾åˆ°ä¸´æ—¶è¡¨ä¸­æ–°çš„ç´¢å¼•å¤„</span></span><br><span class="line">                tmp[index] = node</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆ é™¤è¡¨å,å°†ä¸´æ—¶è¡¨é‡æ–°èµ‹å€¼</span></span><br><span class="line">        <span class="keyword">del</span> self.__table</span><br><span class="line">        self.__table = tmp</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">need_rehash</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># æ˜¯å¦éœ€è¦æ‰©å®¹,å¦‚æœå·²ç»ä½¿ç”¨è¶…è¿‡70%å®¹é‡,å°±éœ€è¦æ‰©å®¹</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.__used_index() / self.table_length() &gt;= <span class="number">0.7</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hash_index</span><span class="params">(self, val, table=None)</span>:</span></span><br><span class="line">        <span class="comment"># è®¡ç®—ç´¢å¼•</span></span><br><span class="line">        <span class="comment"># :param val: è¦è®¡ç®—çš„å€¼</span></span><br><span class="line">        <span class="comment"># :param table: è¡¨,æœ‰å¯èƒ½æ˜¯ä¸´æ—¶è¡¨(æ‰©å®¹ä¸­ç”¨ä¸Š)</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç›´æ¥ä½¿ç”¨hashç®—æ³•,å°±ä¸ç”¨è‡ªå·±å†™äº†</span></span><br><span class="line">        <span class="comment"># å…ˆè½¬åŒ–æˆstrç±»å‹,é¿å…æŸäº›listä¹‹ç±»çš„ä¸å¯hashå¯¼è‡´æŠ¥é”™</span></span><br><span class="line">        <span class="comment"># é™¤ä»¥æ€»é•¿åº¦å¾—åˆ°ç´¢å¼•ä½ç½®</span></span><br><span class="line">        <span class="keyword">return</span> int(hash(str(val))) % len(table <span class="keyword">if</span> table <span class="keyword">else</span> self.__table)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    table = HashTable(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">    vals = [random.randint(<span class="number">1</span>, <span class="number">100</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">100</span>)]</span><br><span class="line">    <span class="keyword">for</span> val <span class="keyword">in</span> vals:</span><br><span class="line">        table.insert(val)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'---&gt;éå†'</span>)</span><br><span class="line">    table.traverse()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'---&gt;é•¿åº¦'</span>)</span><br><span class="line">    print(table.count)</span><br><span class="line">    print(table.table_length())</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'---&gt;æœç´¢'</span>)</span><br><span class="line">    print(table.search(vals[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">    table.delete(vals[<span class="number">0</span>])</span><br><span class="line">    print(<span class="string">'---&gt;åˆ é™¤åçš„é•¿åº¦'</span>)</span><br><span class="line">    print(table.count)</span><br><span class="line">    print(table.table_length())</span><br></pre></td></tr></table></figure>

<p>æ„Ÿè§‰ä¸Šé¢çš„å†™æ³•å¾ˆé€—æ¯”ï¼Œæ ¹æœ¬ä¸æ˜¯å“ˆå¸Œè¡¨ï¼Œæ‰€ä»¥æ”¹æˆäº†ä¸‹é¢çš„å†™æ³•ï¼Œä½†è¿˜æ˜¯è§‰å¾—å“ªé‡Œä¸å¯¹åŠ²â€¦</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-5-23 22:48</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        self.key = key</span><br><span class="line">        self.value = value</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(self.value)</span><br><span class="line"></span><br><span class="line">    __repr__ = __str__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HashTable</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, init_length=<span class="number">15</span>)</span>:</span></span><br><span class="line">        self.__table = [<span class="literal">None</span>] * init_length</span><br><span class="line">        <span class="comment"># åˆ—è¡¨ä¸­æ€»å…±å³å¤šå°‘æ•°æ®</span></span><br><span class="line">        self.__size = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        self.__insert(key, value)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__search(item)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        self.__delete(key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># è¿­ä»£å™¨</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'index'</span>):</span><br><span class="line">            self.index = <span class="number">-1</span></span><br><span class="line">        self.index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.index &lt; len(self.__table):</span><br><span class="line">            node = self.__table[self.index]</span><br><span class="line">            values = []</span><br><span class="line">            <span class="keyword">if</span> node:</span><br><span class="line">                <span class="keyword">while</span> node:</span><br><span class="line">                    values.append(node.value)</span><br><span class="line">                    node = node.next</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> values</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__insert</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        <span class="comment"># æ’å…¥</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è·å–ç´¢å¼•</span></span><br><span class="line">        index = self.__hash_index(key)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.__table[index]:</span><br><span class="line">            self.__table[index] = Node(key, value)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            node = self.__table[index]</span><br><span class="line">            <span class="keyword">while</span> node.next:</span><br><span class="line">                <span class="comment"># å¦‚æœkeyå€¼ç›¸åŒäº†ï¼Œå°±è¯´æ˜å€¼éœ€è¦è¦†ç›–</span></span><br><span class="line">                <span class="keyword">if</span> node.key == key:</span><br><span class="line">                    node.value = value</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                node = node.next</span><br><span class="line">            <span class="comment"># å¦‚æœæ˜¯æ­£å¸¸é€€å‡ºï¼Œå°±è¿½åŠ åˆ°é“¾è¡¨ç»“å°¾</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># æ·»åŠ åˆ°é“¾è¡¨å°¾éƒ¨</span></span><br><span class="line">                node.next = Node(key, value)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># é•¿åº¦+1</span></span><br><span class="line">        self.__size += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># self.__rehash()</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__search</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="comment"># æœç´¢</span></span><br><span class="line">        <span class="comment"># :param val: éœ€è¦æœç´¢çš„å€¼</span></span><br><span class="line">        <span class="comment"># :return: å¦‚æœæ²¡æœ‰æ‰¾åˆ°,è¿”å›None,æ‰¾åˆ°äº†å°±è¿”å›èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">        index = self.__hash_index(key)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¾—åˆ°å¤´ç»“ç‚¹</span></span><br><span class="line">        node = self.__table[index]</span><br><span class="line">        <span class="keyword">while</span> node:</span><br><span class="line">            <span class="keyword">if</span> node.key == key:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            node = node.next</span><br><span class="line">        <span class="comment"># å¦‚æœæ­£å¸¸é€€å‡ºï¼Œå°±è¯´æ˜æ²¡æœ‰æ‰¾åˆ°</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="comment"># åˆ é™¤å€¼</span></span><br><span class="line"></span><br><span class="line">        index = self.__hash_index(key)</span><br><span class="line">        <span class="comment"># å¾—åˆ°å¤´ç»“ç‚¹</span></span><br><span class="line">        node = self.__table[index]</span><br><span class="line">        <span class="comment"># ä¿å­˜å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        pre = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> node:</span><br><span class="line">            <span class="keyword">if</span> node.key == key:</span><br><span class="line">                <span class="comment"># å¦‚æœpreä¸ºç©º,è¡¨ç¤ºè¦åˆ é™¤çš„ç‚¹æ—¶å¤´ç»“ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> pre:</span><br><span class="line">                    <span class="comment"># è¦åˆ é™¤çš„æ˜¯å¤´ç»“ç‚¹,é‚£ä¹ˆå°†å¤´ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ”¾åˆ°è¡¨ä¸­</span></span><br><span class="line">                    self.__table[index] = node.next</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    pre.next = node.next</span><br><span class="line"></span><br><span class="line">                self.__size -= <span class="number">1</span></span><br><span class="line">                <span class="comment"># åˆ é™¤</span></span><br><span class="line">                <span class="keyword">del</span> node</span><br><span class="line">                <span class="comment"># å€¼åˆ é™¤ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„ç‚¹</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            pre = node</span><br><span class="line">            node = node.next</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> KeyError(<span class="string">'No Such Value'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__hash_index</span><span class="params">(self, key, table=None)</span>:</span></span><br><span class="line">        <span class="comment"># è®¡ç®—ç´¢å¼•</span></span><br><span class="line">        <span class="keyword">return</span> int(hash(key)) % len(table <span class="keyword">if</span> table <span class="keyword">else</span> self.__table)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__rehash</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># å®¹é‡è¾¾åˆ°ä½¿ç”¨ä¸Šé™ï¼Œæ‰©å®¹åé‡æ–°åˆ†é…</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.__need_rehash():</span><br><span class="line">            tmp = [<span class="literal">None</span>] * len(self.__table) * <span class="number">2</span></span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> self.__table:</span><br><span class="line">                <span class="keyword">if</span> t:</span><br><span class="line">                    index = self.__hash_index(t.key, tmp)</span><br><span class="line">                    tmp[index] = t</span><br><span class="line"></span><br><span class="line">            <span class="keyword">del</span> self.__table</span><br><span class="line">            self.__table = tmp</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__need_rehash</span><span class="params">(self)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.__table_count() / len(self.__table) &gt;= <span class="number">0.7</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__table_count</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># tableä¸­ä½¿ç”¨äº†ç´¢å¼•çš„æ•°æ®é•¿åº¦</span></span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> self.__table:</span><br><span class="line">            <span class="keyword">if</span> t:</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    table = HashTable(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">    values = [random.randint(<span class="number">1</span>, <span class="number">100</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">50</span>)]</span><br><span class="line">    <span class="keyword">for</span> index, value <span class="keyword">in</span> enumerate(values):</span><br><span class="line">        table[index] = value</span><br><span class="line"></span><br><span class="line">    <span class="comment"># del table[10]</span></span><br><span class="line">    <span class="comment"># print(table[1])</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">del</span> table[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">del</span> table[<span class="number">10</span>]</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> table:</span><br><span class="line">        print(t)</span><br><span class="line">    </span><br><span class="line">    print(table[<span class="number">49</span>])</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
  </entry>
  <entry>
    <title>Django --- sessionæºç åˆ†æ</title>
    <url>/2020/05/23/django-session%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h3 id="cookieå’Œseesionçš„åŒºåˆ«"><a href="#cookieå’Œseesionçš„åŒºåˆ«" class="headerlink" title="cookieå’Œseesionçš„åŒºåˆ«"></a>cookieå’Œseesionçš„åŒºåˆ«</h3><p>ç®€å•æ¥è®²å°±æ˜¯éƒ½æ˜¯key-valueå½¢å¼çš„æ•°æ®ï¼Œä¸åŒçš„æ˜¯ï¼Œcookieå­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œsessionå­˜å‚¨åœ¨æœåŠ¡ç«¯ã€‚å…·ä½“çš„è§£é‡Šå¯ä»¥ä¸Šç½‘æœï¼Œä¸åšå™è¿°ã€‚</p>
<a id="more"></a>

<h3 id="Sessionæ¨¡å‹"><a href="#Sessionæ¨¡å‹" class="headerlink" title="Sessionæ¨¡å‹"></a>Sessionæ¨¡å‹</h3><p>åœ¨<code>settings.py</code>ä¸­çš„<code>INSTALLED_APPS</code>å¢åŠ <code>django.contrib.sessions</code>ã€‚</p>
<p>æ•°æ®æ¨¡å‹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AbstractBaseSession</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    session_key = models.CharField(_(<span class="string">'session key'</span>), max_length=<span class="number">40</span>, primary_key=<span class="literal">True</span>)</span><br><span class="line">    session_data = models.TextField(_(<span class="string">'session data'</span>))</span><br><span class="line">    expire_date = models.DateTimeField(_(<span class="string">'expire date'</span>), db_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    objects = BaseSessionManager()</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        abstract = <span class="literal">True</span></span><br><span class="line">        verbose_name = _(<span class="string">'session'</span>)</span><br><span class="line">        verbose_name_plural = _(<span class="string">'sessions'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Session</span><span class="params">(AbstractBaseSession)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span><span class="params">(AbstractBaseSession.Meta)</span>:</span></span><br><span class="line">        db_table = <span class="string">'django_session'</span></span><br></pre></td></tr></table></figure>
<p>ç»¼ä¸Šï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œå®Œ<code>python manage.py migrate</code>æŒ‡ä»¤åï¼Œå°†åœ¨æ•°æ®åº“ä¸­ç”Ÿæˆ<code>django_session</code>æ•°æ®è¡¨ï¼Œè¡¨ä¸­å­—æ®µåªæœ‰ä¸‰ä¸ª<br/><br><code>session_key</code>ï¼Œ<code>session_data</code>ï¼Œ<code>expire_date</code>ã€‚<br/><br><code>session_key</code>,ä¼šåœ¨cookieä¸­å­˜å‚¨ä¸€ä¸ªå”¯ä¸€æ€§çš„<code>session_id</code>ï¼Œåœ¨å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ä¸­ï¼Œä¼šä»cookieä¸­è·å–åˆ°è¿™ä¸ªidå€¼ï¼Œä»æ•°æ®è¡¨ä¸­è·å–å¯¹åº”çš„æ•°æ®ã€‚<br/><br><code>session_data</code>,å­˜å‚¨åŠ å¯†åçš„æ•°æ®ï¼Œä¾‹å¦‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">request.session[&#39;hello&#39;] &#x3D; &#39;world&#39;</span><br><span class="line">request.session.save()</span><br></pre></td></tr></table></figure>
<p>å­˜å‚¨çš„åæ•°æ®å°±æ˜¯<code>NjdjMmY3ZGRlMDNmNTRlM2FlMTNjNmMzODMzYzgyNTgxMjE5NDVkNjp7ImhlbGxvIjoid29ybGQifQ</code>ï¼Œæ ¹æ®<code>secret_key</code>ä¸åŒï¼Œå­˜å‚¨åçš„æ•°æ®ä¹Ÿè‚¯å®šä¼šä¸åŒã€‚<br/><br><code>expire_date</code>ï¼Œsessionçš„æœ‰æ•ˆæœŸã€‚<br>ä¸¾ä¾‹:<br/><br>åœ¨cookieä¸­æœ‰æ•°æ®, key=â€session_idâ€, value=â€r7bwqr8ba5pypolyq4e502zjxaxcl9v5â€, é‚£ä¹ˆæ­¤valueå°±æ˜¯<code>django_session</code>è¡¨çš„<code>session_key</code>æ•°æ®ã€‚</p>
<h3 id="sessionå­˜å‚¨æ–¹å¼"><a href="#sessionå­˜å‚¨æ–¹å¼" class="headerlink" title="sessionå­˜å‚¨æ–¹å¼"></a>sessionå­˜å‚¨æ–¹å¼</h3><p>ä»djangoçš„ä»£ç è·¯å¾„<code>django.contrib.sessions</code>å¯ä»¥è·å–åˆ°å…·ä½“åˆ†ç±»ï¼Œå…·ä½“ä½¿ç”¨å“ªç§å¯ä»¥åœ¨<code>settings.py</code>ä¸­é…ç½®<code>SESSION_ENGINE</code>å±æ€§ï¼Œä¾‹å¦‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.signed_cookies'</span></span><br></pre></td></tr></table></figure>
<h4 id="django-contrib-sessions-file"><a href="#django-contrib-sessions-file" class="headerlink" title="django.contrib.sessions.file"></a>django.contrib.sessions.file</h4><p>å°†sessionæ•°æ®å­˜æ”¾åœ¨æ–‡ä»¶ä¸­ï¼Œä¸€èˆ¬æ–‡ä»¶éƒ½æ˜¯æ”¾åœ¨/tmpä¸‹ï¼Œä¾‹å¦‚windowså¹³å°å°±æ˜¯åœ¨<code>C:\Users\Administrator\AppData\Local\Temp</code>è·¯å¾„ä¸‹ã€‚<br/><br>ä¸æ¨èã€‚</p>
<h4 id="django-contrib-sessions-cache"><a href="#django-contrib-sessions-cache" class="headerlink" title="django.contrib.sessions.cache"></a>django.contrib.sessions.cache</h4><p>å°†sessionæ•°æ®æ”¾åœ¨ç¼“å­˜ä¸­ã€‚<br/><br>ä½¿ç”¨redisåšç¼“å­˜é…ç½®å¦‚ä¸‹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">"default"</span>: &#123;</span><br><span class="line">        <span class="string">"BACKEND"</span>: <span class="string">"django_redis.cache.RedisCache"</span>,</span><br><span class="line">        <span class="string">"LOCATION"</span>: <span class="string">"redis://127.0.0.1:6379/1"</span>,</span><br><span class="line">        <span class="string">"OPTIONS"</span>: &#123;</span><br><span class="line">            <span class="string">"CLIENT_CLASS"</span>: <span class="string">"django_redis.client.DefaultClient"</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">SESSION_ENGINE = <span class="string">"django.contrib.sessions.backends.cache"</span></span><br><span class="line">SESSION_CACHE_ALIAS = <span class="string">"default"</span></span><br></pre></td></tr></table></figure>

<h4 id="django-contrib-sessions-db"><a href="#django-contrib-sessions-db" class="headerlink" title="django.contrib.sessions.db"></a>django.contrib.sessions.db</h4><p>å°†sessionæ”¾åœ¨æ•°æ®åº“ä¸­ï¼Œè¿™ä¸ªæ˜¯é»˜è®¤æ–¹å¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># The module to store session data</span></span><br><span class="line">SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.db'</span></span><br></pre></td></tr></table></figure>
<h4 id="django-contrib-sessions-cache-db"><a href="#django-contrib-sessions-cache-db" class="headerlink" title="django.contrib.sessions.cache_db"></a>django.contrib.sessions.cache_db</h4><p>æ··åˆå­˜å‚¨ï¼Œä¼˜å…ˆä»ç¼“å­˜ä¸­è·å–sessionï¼Œå¦‚æœæ²¡æœ‰å†ä»æ•°æ®åº“ä¸­è·å–ï¼Œç»“åˆäº†ä¸Šé¢ä¸¤ç§ã€‚</p>
<h4 id="django-contrib-sessions-signed-cookies"><a href="#django-contrib-sessions-signed-cookies" class="headerlink" title="django.contrib.sessions.signed_cookies"></a>django.contrib.sessions.signed_cookies</h4><p>å°†sessionæ•°æ®åŠ å¯†åæ”¾åœ¨cookieä¸­ã€‚<br/><br>ä¸æ¨èã€‚</p>
<h3 id="æºç ä»‹ç»"><a href="#æºç ä»‹ç»" class="headerlink" title="æºç ä»‹ç»"></a>æºç ä»‹ç»</h3><p>çœ‹äº†ä¸‹ä»£ç ï¼Œå‘ç°sessionçš„ä»£ç æ¯”æˆ‘æƒ³è±¡ä¸­çš„ç®€å•å¤ªå¤šï¼Œå°±ç¨å¾®æ‹¿æ•°æ®åº“å­˜å‚¨æ–¹å¼è¯´ä¸‹ã€‚</p>
<h4 id="SessionBase"><a href="#SessionBase" class="headerlink" title="SessionBase"></a>SessionBase</h4><p>sessionçš„æ‰€æœ‰å­˜å‚¨æ–¹å¼çš„ç±»éƒ½å«åš<code>SessionStore</code>ï¼Œè€Œæ‰€æœ‰çš„ç±»éƒ½ç»§æ‰¿è‡ª<code>SessionBase</code>ã€‚<br/><br>åœ¨ä½¿ç”¨sessionæ—¶å®Œæˆå°±æ˜¯æŒ‰ç…§dictä½¿ç”¨çš„ï¼Œçœ‹äº†ä¸‹å®ƒçš„ä»£ç ï¼Œè™½ç„¶è¯´å¹¶æ²¡æœ‰ç»§æ‰¿è‡ªdictæˆ–è·Ÿdictç›¸å…³çš„ç±»ï¼Œä½†å…¶å®ä¸€çœ‹å°±è·Ÿdictçš„ç”¨æ³•ä¸€è‡´ã€‚<br/><br>è·¯å¾„ï¼š<code>django.contrib.sessions.backends.base.SessionBase</code></p>
<h5 id="åˆå§‹åŒ–æ•°æ®"><a href="#åˆå§‹åŒ–æ•°æ®" class="headerlink" title="åˆå§‹åŒ–æ•°æ®"></a>åˆå§‹åŒ–æ•°æ®</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, session_key=None)</span>:</span></span><br><span class="line">    <span class="comment"># å®¢æˆ·ç«¯çš„session_idçš„å€¼</span></span><br><span class="line">    self._session_key = session_key</span><br><span class="line">    <span class="comment"># æ˜¯å¦è®¿é—®</span></span><br><span class="line">    self.accessed = <span class="literal">False</span></span><br><span class="line">    <span class="comment"># æ˜¯å¦ä¿®æ”¹</span></span><br><span class="line">    self.modified = <span class="literal">False</span></span><br><span class="line">    <span class="comment"># åºåˆ—åŒ–æ–¹å¼ï¼Œé»˜è®¤æ˜¯json</span></span><br><span class="line">    self.serializer = import_string(settings.SESSION_SERIALIZER)</span><br></pre></td></tr></table></figure>

<h5 id="å…¶ä»–å¸¸ç”¨æ–¹æ³•"><a href="#å…¶ä»–å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å…¶ä»–å¸¸ç”¨æ–¹æ³•"></a>å…¶ä»–å¸¸ç”¨æ–¹æ³•</h5><p>å…·ä½“çš„å¯ä»¥æŸ¥çœ‹æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    åˆ¤æ–­sessionæ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> key <span class="keyword">in</span> self._session</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    è·å–sessionæ•°æ®</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> self._session[key]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    è®¾ç½®æ•°æ®</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    self._session[key] = value</span><br><span class="line">    <span class="comment"># å› ä¸ºè®¾ç½®äº†æ•°æ®ï¼Œé‚£ä¹ˆå°±æ˜¯è¯´å·²ç»ä¿®æ”¹äº†</span></span><br><span class="line">    self.modified = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    åˆ é™¤æ•°æ®</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">del</span> self._session[key]</span><br><span class="line">    self.modified = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key, default=None)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self._session.get(key, default)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self, key, default=__not_given)</span>:</span></span><br><span class="line">    self.modified = self.modified <span class="keyword">or</span> key <span class="keyword">in</span> self._session</span><br><span class="line">    <span class="comment"># åœ¨popæ•°æ®æ—¶ï¼Œæ˜¯å¦æœ‰å­˜å…¥é»˜è®¤å€¼</span></span><br><span class="line">    args = () <span class="keyword">if</span> default <span class="keyword">is</span> self.__not_given <span class="keyword">else</span> (default,)</span><br><span class="line">    <span class="keyword">return</span> self._session.pop(key, *args)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setdefault</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">in</span> self._session:</span><br><span class="line">        <span class="keyword">return</span> self._session[key]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.modified = <span class="literal">True</span></span><br><span class="line">        self._session[key] = value</span><br><span class="line">        <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure>

<h5 id="ç»§æ‰¿æ—¶éœ€è¦å®ç°çš„æ–¹æ³•"><a href="#ç»§æ‰¿æ—¶éœ€è¦å®ç°çš„æ–¹æ³•" class="headerlink" title="ç»§æ‰¿æ—¶éœ€è¦å®ç°çš„æ–¹æ³•"></a>ç»§æ‰¿æ—¶éœ€è¦å®ç°çš„æ–¹æ³•</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exists</span><span class="params">(self, session_key)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Returns True if the given session_key already exists.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">raise</span> NotImplementedError(<span class="string">'subclasses of SessionBase must provide an exists() method'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Creates a new session instance. Guaranteed to create a new object with</span></span><br><span class="line"><span class="string">    a unique key and will have saved the result once (with empty data)</span></span><br><span class="line"><span class="string">    before the method returns.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">raise</span> NotImplementedError(<span class="string">'subclasses of SessionBase must provide a create() method'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">(self, must_create=False)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Saves the session data. If 'must_create' is True, a new session object</span></span><br><span class="line"><span class="string">    is created (otherwise a CreateError exception is raised). Otherwise,</span></span><br><span class="line"><span class="string">    save() only updates an existing object and does not create one</span></span><br><span class="line"><span class="string">    (an UpdateError is raised).</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">raise</span> NotImplementedError(<span class="string">'subclasses of SessionBase must provide a save() method'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, session_key=None)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Deletes the session data under this key. If the key is None, the</span></span><br><span class="line"><span class="string">    current session key value is used.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">raise</span> NotImplementedError(<span class="string">'subclasses of SessionBase must provide a delete() method'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Loads the session data and returns a dictionary.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">raise</span> NotImplementedError(<span class="string">'subclasses of SessionBase must provide a load() method'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clear_expired</span><span class="params">(cls)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Remove expired sessions from the session store.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If this operation isn't possible on a given backend, it should raise</span></span><br><span class="line"><span class="string">    NotImplementedError. If it isn't necessary, because the backend has</span></span><br><span class="line"><span class="string">    a built-in expiration mechanism, it should be a no-op.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">raise</span> NotImplementedError(<span class="string">'This backend does not support clear_expired().'</span>)</span><br></pre></td></tr></table></figure>

<h5 id="get-sessionæ–¹æ³•"><a href="#get-sessionæ–¹æ³•" class="headerlink" title="_get_sessionæ–¹æ³•"></a>_get_sessionæ–¹æ³•</h5><p>åœ¨ä»£ç ä¸­ï¼Œè·å–æˆ–è®¾ç½®æ•°æ®æ—¶éƒ½æ˜¯è°ƒç”¨çš„<code>self._session</code>,ä»ä»£ç çœ‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_session</span><span class="params">(self, no_load=False)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Lazily loads session from storage (unless "no_load" is True, when only</span></span><br><span class="line"><span class="string">    an empty dict is stored) and stores it in the current instance.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    self.accessed = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> self._session_cache</span><br><span class="line">    <span class="keyword">except</span> AttributeError:</span><br><span class="line">        <span class="keyword">if</span> self.session_key <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> no_load:</span><br><span class="line">            self._session_cache = &#123;&#125;</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._session_cache = self.load()</span><br><span class="line">    <span class="keyword">return</span> self._session_cache</span><br><span class="line"></span><br><span class="line">_session = property(_get_session)</span><br></pre></td></tr></table></figure>
<p><code>_session</code>æ˜¯é€šè¿‡è°ƒç”¨<code>self.load()</code>è·å–åˆ°çš„ï¼Œä¹Ÿå°±æ˜¯å…·ä½“é€»è¾‘è¦å­ç±»å®ç°äº†ï¼Œæ ¹æ®å­˜å‚¨çš„æ–¹å¼ä¸åŒå®ç°çš„ä»£ç ä¹Ÿå°±ä¸åŒã€‚</p>
<h4 id="SessionStoreï¼Œdbæ–¹å¼"><a href="#SessionStoreï¼Œdbæ–¹å¼" class="headerlink" title="SessionStoreï¼Œdbæ–¹å¼"></a>SessionStoreï¼Œdbæ–¹å¼</h4><h5 id="è·å–dbæ–¹å¼æ•°æ®è¡¨æ¨¡å‹"><a href="#è·å–dbæ–¹å¼æ•°æ®è¡¨æ¨¡å‹" class="headerlink" title="è·å–dbæ–¹å¼æ•°æ®è¡¨æ¨¡å‹"></a>è·å–dbæ–¹å¼æ•°æ®è¡¨æ¨¡å‹</h5><p>ä¹Ÿå°±æ˜¯æœ€å¼€å§‹æåˆ°çš„<code>Session</code>æ¨¡å‹äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_model_class</span><span class="params">(cls)</span>:</span></span><br><span class="line">    <span class="keyword">from</span> django.contrib.sessions.models <span class="keyword">import</span> Session</span><br><span class="line">    <span class="keyword">return</span> Session</span><br><span class="line"></span><br><span class="line"><span class="meta">@cached_property</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">model</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.get_model_class()</span><br></pre></td></tr></table></figure>

<h5 id="load"><a href="#load" class="headerlink" title="load"></a>load</h5><p>å®ç°çˆ¶ç±»çš„loadæ–¹æ³•ã€‚<br/><br>å…¶å®å°±æ˜¯ä¸€èˆ¬çš„ormä½¿ç”¨æ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨è¿”å›æ•°æ®çš„Sessionå¯¹è±¡ï¼Œä¸å­˜åœ¨åˆ™è¿”å›ç©ºdictï¼Œé¢å¤–åšäº†ä¸€ä¸ªæœ‰æ•ˆæœŸçš„åˆ¤æ–­ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = self.model.objects.get(</span><br><span class="line">            session_key=self.session_key,</span><br><span class="line">            expire_date__gt=timezone.now()</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> self.decode(s.session_data)</span><br><span class="line">    <span class="keyword">except</span> (self.model.DoesNotExist, SuspiciousOperation) <span class="keyword">as</span> e:</span><br><span class="line">        self._session_key = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h5 id="create"><a href="#create" class="headerlink" title="create"></a>create</h5><p>åˆ›å»ºSessionå¯¹è±¡ã€‚<br>_get_new_session_key()æ–¹æ³•ä¼šç”Ÿæˆä¸€ä¸ª32ä½çš„éšæœºå­—ç¬¦ä¸²ï¼Œç”Ÿæˆåå°±ç«‹å³ä¿å­˜äº†ï¼Œé¿å…keyå€¼å‡ºç°é‡å¤ã€‚<br/><br>è¿™å„¿ç¨å¾®æäº†ä¸‹ï¼Œå› ä¸ºåœ¨å·¥ä½œä¸­å¥½åƒé‡åˆ°è¿‡è¿™ç±»é—®é¢˜ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        self._session_key = self._get_new_session_key()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># Save immediately to ensure we have a unique entry in the database.</span></span><br><span class="line">            self.save(must_create=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">except</span> CreateError:</span><br><span class="line">            <span class="comment"># Key wasn't unique. Try again.</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        self.modified = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<h4 id="ä¸­é—´ä»¶SessionMiddleware"><a href="#ä¸­é—´ä»¶SessionMiddleware" class="headerlink" title="ä¸­é—´ä»¶SessionMiddleware"></a>ä¸­é—´ä»¶SessionMiddleware</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SessionMiddleware</span><span class="params">(MiddlewareMixin)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, get_response=None)</span>:</span></span><br><span class="line">        self.get_response = get_response</span><br><span class="line">        <span class="comment"># sessionçš„å­˜å‚¨æ–¹å¼æ˜¯å¯é…ç½®çš„ï¼Œé‚£ä¹ˆæ ¹æ®settings.pyä¸­çš„é…ç½®è·å–ä¸åŒçš„SessionStoreç±»</span></span><br><span class="line">        <span class="comment"># import_moduleæ ¹æ®è·¯å¾„ï¼ˆå­—ç¬¦ä¸²ï¼‰è·å–æ¨¡å—å¯¹è±¡</span></span><br><span class="line">        engine = import_module(settings.SESSION_ENGINE)</span><br><span class="line">        self.SessionStore = engine.SessionStore</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="comment"># å­˜æ”¾åœ¨cookieä¸­çš„django_sessionè¡¨çš„session_keyå¯¹åº”çš„keyå€¼ï¼Œé»˜è®¤æ˜¯sessionid</span></span><br><span class="line">        session_key = request.COOKIES.get(settings.SESSION_COOKIE_NAME)</span><br><span class="line">        <span class="comment"># è·å–sessionå¯¹è±¡</span></span><br><span class="line">        request.session = self.SessionStore(session_key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self, request, response)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># æ˜¯å¦å·²è®¿é—®</span></span><br><span class="line">            accessed = request.session.accessed</span><br><span class="line">            <span class="comment"># æ˜¯å¦å·²ä¿®æ”¹</span></span><br><span class="line">            modified = request.session.modified</span><br><span class="line">            <span class="comment"># æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">            empty = request.session.is_empty()</span><br><span class="line">        <span class="keyword">except</span> AttributeError:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># First check if we need to delete this cookie.</span></span><br><span class="line">            <span class="comment"># The session should be deleted only if the session is entirely empty</span></span><br><span class="line">            <span class="keyword">if</span> settings.SESSION_COOKIE_NAME <span class="keyword">in</span> request.COOKIES <span class="keyword">and</span> empty:</span><br><span class="line">                response.delete_cookie(</span><br><span class="line">                    settings.SESSION_COOKIE_NAME,</span><br><span class="line">                    path=settings.SESSION_COOKIE_PATH,</span><br><span class="line">                    domain=settings.SESSION_COOKIE_DOMAIN,</span><br><span class="line">                )</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> accessed:</span><br><span class="line">                    patch_vary_headers(response, (<span class="string">'Cookie'</span>,))</span><br><span class="line">                <span class="keyword">if</span> (modified <span class="keyword">or</span> settings.SESSION_SAVE_EVERY_REQUEST) <span class="keyword">and</span> <span class="keyword">not</span> empty:</span><br><span class="line">                    <span class="comment"># ç¡®å®šsessionçš„æœ‰æ•ˆæœŸ</span></span><br><span class="line">                    <span class="keyword">if</span> request.session.get_expire_at_browser_close():</span><br><span class="line">                        max_age = <span class="literal">None</span></span><br><span class="line">                        expires = <span class="literal">None</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        max_age = request.session.get_expiry_age()</span><br><span class="line">                        expires_time = time.time() + max_age</span><br><span class="line">                        expires = cookie_date(expires_time)</span><br><span class="line">                    <span class="keyword">if</span> response.status_code != <span class="number">500</span>:</span><br><span class="line">                        <span class="keyword">try</span>:</span><br><span class="line">                            <span class="comment"># æœåŠ¡ç«¯ä¿å­˜</span></span><br><span class="line">                            request.session.save()</span><br><span class="line">                        <span class="keyword">except</span> UpdateError:</span><br><span class="line">                            <span class="keyword">return</span> redirect(request.path)</span><br><span class="line">                        <span class="comment"># å®¢æˆ·ç«¯ä¿å­˜</span></span><br><span class="line">                        response.set_cookie(</span><br><span class="line">                            settings.SESSION_COOKIE_NAME,</span><br><span class="line">                            request.session.session_key, max_age=max_age,</span><br><span class="line">                            expires=expires, domain=settings.SESSION_COOKIE_DOMAIN,</span><br><span class="line">                            path=settings.SESSION_COOKIE_PATH,</span><br><span class="line">                            secure=settings.SESSION_COOKIE_SECURE <span class="keyword">or</span> <span class="literal">None</span>,</span><br><span class="line">                            httponly=settings.SESSION_COOKIE_HTTPONLY <span class="keyword">or</span> <span class="literal">None</span>,</span><br><span class="line">                        )</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¹‹å‰ä¸€ç›´æƒ³æŠŠè¿™éƒ¨åˆ†æºç è¿‡ä¸€éï¼Œä½†æ‹–å»¶ç—‡å¤ªä¸¥é‡ä¸€ç›´æ”¾ç€äº†ã€‚ç°åœ¨èŠ±ç‚¹æ—¶é—´çœ‹äº†ä¸‹æºç ï¼Œæ¯”æƒ³è±¡ä¸­çš„ç®€å•å¥½å¤šï¼Œä¸€ä¸‹å­éƒ½ä¸çŸ¥é“ç¬”è®°è¯¥æ€ä¹ˆå†™äº†ï¼Œå°±éšä¾¿å¤åˆ¶äº†ç‚¹çœ‹èµ·æ¥é‡è¦çš„ä»£ç æ·»åŠ ç‚¹æ³¨é‡Šäº†ã€‚<br/><br>sessionæ¨¡å—ä¸»è¦çš„ä»£ç éƒ½åœ¨<code>django.contrib.session.backends</code>è·¯å¾„ä¸‹ï¼Œä»£ç å¾ˆç®€å•ï¼Œé…åˆdjangoçš„æ³¨é‡Šå¾ˆå®¹æ˜“è¯»æ‡‚ï¼Œå°±è¿™æ ·äº†ã€‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title>[è½¬]Redis --- å‡ ä¸ªrediså¸¸ç”¨é—®é¢˜</title>
    <url>/2020/05/23/%E8%BD%AC-%E5%87%A0%E4%B8%AAredis%E5%B8%B8%E7%94%A8%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h3 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h3><h4 id="ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ</h4><p>å¦‚æœæˆ‘ä»¬çš„ç¼“å­˜æŒ‚æ‰äº†ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬çš„å…¨éƒ¨è¯·æ±‚éƒ½è·‘å»æ•°æ®åº“äº†ã€‚<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/blog/20191215/1.jpg" alt="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/blog/20191215/1.jpg"><br>æˆ‘ä»¬éƒ½çŸ¥é“Redisä¸å¯èƒ½æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½ç¼“å­˜èµ·æ¥(å†…å­˜æ˜‚è´µä¸”æœ‰é™)ï¼Œæ‰€ä»¥Rediséœ€è¦å¯¹æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¹¶é‡‡ç”¨çš„æ˜¯æƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤ä¸¤ç§ç­–ç•¥å¯¹è¿‡æœŸé”®åˆ é™¤ã€‚</p>
<p>å¦‚æœç¼“å­˜æ•°æ®è®¾ç½®çš„è¿‡æœŸæ—¶é—´æ˜¯ç›¸åŒçš„ï¼Œå¹¶ä¸”Redisæ°å¥½å°†è¿™éƒ¨åˆ†æ•°æ®å…¨éƒ¨åˆ å…‰äº†ã€‚è¿™å°±ä¼šå¯¼è‡´åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œè¿™äº›ç¼“å­˜åŒæ—¶å¤±æ•ˆï¼Œå…¨éƒ¨è¯·æ±‚åˆ°æ•°æ®åº“ä¸­ã€‚</p>
<p>è¿™å°±æ˜¯ç¼“å­˜é›ªå´©ï¼šRedisæŒ‚æ‰äº†ï¼Œè¯·æ±‚å…¨éƒ¨èµ°æ•°æ®åº“ã€‚</p>
<p>ç¼“å­˜é›ªå´©å¦‚æœå‘ç”Ÿäº†ï¼Œå¾ˆå¯èƒ½å°±æŠŠæˆ‘ä»¬çš„æ•°æ®åº“æå®ï¼Œå¯¼è‡´æ•´ä¸ªæœåŠ¡ç˜«ç—ªï¼</p>
<a id="more"></a>

<h4 id="å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©ï¼Ÿ"><a href="#å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©ï¼Ÿ" class="headerlink" title="å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©ï¼Ÿ"></a>å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©ï¼Ÿ</h4><p>åœ¨ç¼“å­˜çš„æ—¶å€™ç»™è¿‡æœŸæ—¶é—´åŠ ä¸Šä¸€ä¸ªéšæœºå€¼ï¼Œè¿™æ ·å°±ä¼šå¤§å¹…åº¦çš„å‡å°‘ç¼“å­˜åœ¨åŒä¸€æ—¶é—´è¿‡æœŸã€‚</p>
<p>å¯¹äºâ€œRedisæŒ‚æ‰äº†ï¼Œè¯·æ±‚å…¨éƒ¨èµ°æ•°æ®åº“â€è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä»¥ä¸‹çš„æ€è·¯ï¼š</p>
<p>äº‹å‘å‰ï¼šå®ç°Redisçš„é«˜å¯ç”¨(ä¸»ä»æ¶æ„+Sentinel æˆ–è€…Redis Cluster)ï¼Œå°½é‡é¿å…RedisæŒ‚æ‰è¿™ç§æƒ…å†µå‘ç”Ÿã€‚</p>
<p>äº‹å‘ä¸­ï¼šä¸‡ä¸€RedisçœŸçš„æŒ‚äº†ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®æœ¬åœ°ç¼“å­˜(ehcache)+é™æµ(hystrix)ï¼Œå°½é‡é¿å…æˆ‘ä»¬çš„æ•°æ®åº“è¢«å¹²æ‰(èµ·ç èƒ½ä¿è¯æˆ‘ä»¬çš„æœåŠ¡è¿˜æ˜¯èƒ½æ­£å¸¸å·¥ä½œçš„)</p>
<p>äº‹å‘åï¼šredisæŒä¹…åŒ–ï¼Œé‡å¯åè‡ªåŠ¨ä»ç£ç›˜ä¸ŠåŠ è½½æ•°æ®ï¼Œå¿«é€Ÿæ¢å¤ç¼“å­˜æ•°æ®ã€‚</p>
<h3 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h3><h4 id="ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€"><a href="#ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€" class="headerlink" title="ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€"></a>ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€</h4><p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ã€‚ç”±äºç¼“å­˜ä¸å‘½ä¸­ï¼Œå¹¶ä¸”å‡ºäºå®¹é”™è€ƒè™‘ï¼Œå¦‚æœä»æ•°æ®åº“æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°æ•°æ®åº“å»æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/blog/20191215/2.jpg" alt="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/blog/20191215/2.jpg"><br>è¿™å°±æ˜¯ç¼“å­˜ç©¿é€ï¼š</p>
<p>è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜å¤§é‡ä¸å‘½ä¸­ï¼Œå¯¼è‡´è¯·æ±‚èµ°æ•°æ®åº“ã€‚</p>
<p>ç¼“å­˜ç©¿é€å¦‚æœå‘ç”Ÿäº†ï¼Œä¹Ÿå¯èƒ½æŠŠæˆ‘ä»¬çš„æ•°æ®åº“æå®ï¼Œå¯¼è‡´æ•´ä¸ªæœåŠ¡ç˜«ç—ªï¼</p>
<h4 id="å¦‚ä½•è§£å†³ç¼“å­˜ç©¿é€ï¼Ÿ"><a href="#å¦‚ä½•è§£å†³ç¼“å­˜ç©¿é€ï¼Ÿ" class="headerlink" title="å¦‚ä½•è§£å†³ç¼“å­˜ç©¿é€ï¼Ÿ"></a>å¦‚ä½•è§£å†³ç¼“å­˜ç©¿é€ï¼Ÿ</h4><p>è§£å†³ç¼“å­˜ç©¿é€ä¹Ÿæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p>
<p>ç”±äºè¯·æ±‚çš„å‚æ•°æ˜¯ä¸åˆæ³•çš„(æ¯æ¬¡éƒ½è¯·æ±‚ä¸å­˜åœ¨çš„å‚æ•°)ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨(BloomFilter)æˆ–è€…å‹ç¼©filteræå‰æ‹¦æˆªï¼Œä¸åˆæ³•å°±ä¸è®©è¿™ä¸ªè¯·æ±‚åˆ°æ•°æ®åº“å±‚ï¼</p>
<p>å½“æˆ‘ä»¬ä»æ•°æ®åº“æ‰¾ä¸åˆ°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå°†è¿™ä¸ªç©ºå¯¹è±¡è®¾ç½®åˆ°ç¼“å­˜é‡Œè¾¹å»ã€‚ä¸‹æ¬¡å†è¯·æ±‚çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä»ç¼“å­˜é‡Œè¾¹è·å–äº†ã€‚</p>
<p>è¿™ç§æƒ…å†µæˆ‘ä»¬ä¸€èˆ¬ä¼šå°†ç©ºå¯¹è±¡è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ã€‚</p>
<h3 id="ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´"><a href="#ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´" class="headerlink" title="ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´"></a>ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´</h3><h4 id="å¯¹äºè¯»æ“ä½œï¼Œæµç¨‹æ˜¯è¿™æ ·çš„"><a href="#å¯¹äºè¯»æ“ä½œï¼Œæµç¨‹æ˜¯è¿™æ ·çš„" class="headerlink" title="å¯¹äºè¯»æ“ä½œï¼Œæµç¨‹æ˜¯è¿™æ ·çš„"></a>å¯¹äºè¯»æ“ä½œï¼Œæµç¨‹æ˜¯è¿™æ ·çš„</h4><p>å¦‚æœæˆ‘ä»¬çš„æ•°æ®åœ¨ç¼“å­˜é‡Œè¾¹æœ‰ï¼Œé‚£ä¹ˆå°±ç›´æ¥å–ç¼“å­˜çš„ã€‚</p>
<p>å¦‚æœç¼“å­˜é‡Œæ²¡æœ‰æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œæˆ‘ä»¬ä¼šå…ˆå»æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå°†æ•°æ®åº“æŸ¥å‡ºæ¥çš„æ•°æ®å†™åˆ°ç¼“å­˜ä¸­ã€‚æœ€åå°†æ•°æ®è¿”å›ç»™è¯·æ±‚ã€‚</p>
<h4 id="ä»€ä¹ˆæ˜¯ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´é—®é¢˜ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´é—®é¢˜ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´é—®é¢˜ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´é—®é¢˜ï¼Ÿ</h4><p>å¦‚æœä»…ä»…æŸ¥è¯¢çš„è¯ï¼Œç¼“å­˜çš„æ•°æ®å’Œæ•°æ®åº“çš„æ•°æ®æ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬è¦æ›´æ–°æ—¶å€™å‘¢ï¼Ÿå„ç§æƒ…å†µå¾ˆå¯èƒ½å°±é€ æˆæ•°æ®åº“å’Œç¼“å­˜çš„æ•°æ®ä¸ä¸€è‡´äº†ã€‚</p>
<p>è¿™é‡Œä¸ä¸€è‡´æŒ‡çš„æ˜¯ï¼šæ•°æ®åº“çš„æ•°æ®è·Ÿç¼“å­˜çš„æ•°æ®ä¸ä¸€è‡´<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/blog/20191215/3.jpg" alt="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/blog/20191215/3.jpg"><br>ä»ç†è®ºä¸Šè¯´ï¼Œåªè¦æˆ‘ä»¬è®¾ç½®äº†é”®çš„è¿‡æœŸæ—¶é—´ï¼Œæˆ‘ä»¬å°±èƒ½ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®æœ€ç»ˆæ˜¯ä¸€è‡´çš„ã€‚å› ä¸ºåªè¦ç¼“å­˜æ•°æ®è¿‡æœŸäº†ï¼Œå°±ä¼šè¢«åˆ é™¤ã€‚éšåè¯»çš„æ—¶å€™ï¼Œå› ä¸ºç¼“å­˜é‡Œæ²¡æœ‰ï¼Œå°±å¯ä»¥æŸ¥æ•°æ®åº“çš„æ•°æ®ï¼Œç„¶åå°†æ•°æ®åº“æŸ¥å‡ºæ¥çš„æ•°æ®å†™å…¥åˆ°ç¼“å­˜ä¸­ã€‚</p>
<p>é™¤äº†è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åšæ›´å¤šçš„æªæ–½æ¥å°½é‡é¿å…æ•°æ®åº“ä¸ç¼“å­˜å¤„äºä¸ä¸€è‡´çš„æƒ…å†µå‘ç”Ÿã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">https://mp.weixin.qq.com/s/Fx6mcL4cycBG3x29117d9Q</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Redis</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]Golang --- Goè¯­è¨€ä¸­new()å’Œ make()çš„åŒºåˆ«</title>
    <url>/2020/05/23/%E8%BD%AC-Go%E8%AF%AD%E8%A8%80%E4%B8%ADnew-%E5%92%8C-make-%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Go è¯­è¨€ä¸­çš„ new å’Œ make ä¸€ç›´æ˜¯æ–°æ‰‹æ¯”è¾ƒå®¹æ˜“æ··æ·†çš„ä¸œè¥¿ï¼Œå’‹ä¸€çœ‹å¾ˆç›¸ä¼¼ã€‚ä¸è¿‡è§£é‡Šä¸¤è€…ä¹‹é—´çš„ä¸åŒä¹Ÿéå¸¸å®¹æ˜“ã€‚</p>
<h3 id="new-çš„ä¸»è¦ç‰¹æ€§"><a href="#new-çš„ä¸»è¦ç‰¹æ€§" class="headerlink" title="new çš„ä¸»è¦ç‰¹æ€§"></a>new çš„ä¸»è¦ç‰¹æ€§</h3><p>é¦–å…ˆ new æ˜¯å†…å»ºå‡½æ•°ï¼Œä½ å¯ä»¥ä» <a href="http://golang.org/pkg/builtin/#new" target="_blank" rel="noopener">http://golang.org/pkg/builtin/#new</a> è¿™å„¿çœ‹åˆ°å®ƒï¼Œå®ƒçš„å®šä¹‰ä¹Ÿå¾ˆç®€å•ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">new</span><span class="params">(Type)</span> *<span class="title">Type</span></span></span><br></pre></td></tr></table></figure>
<p>å®˜æ–¹æ–‡æ¡£å¯¹äºå®ƒçš„æè¿°æ˜¯ï¼š</p>
<blockquote>
<p>å†…å»ºå‡½æ•° new ç”¨æ¥åˆ†é…å†…å­˜ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªç±»å‹ï¼Œä¸æ˜¯ä¸€ä¸ªå€¼ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡å‘æ–°åˆ†é…ç±»å‹é›¶å€¼çš„æŒ‡é’ˆ</p>
</blockquote>
<p>æ ¹æ®è¿™æ®µæè¿°ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªç±»ä¼¼ new çš„åŠŸèƒ½ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newInt</span><span class="params">()</span> *<span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line">  <span class="keyword">return</span> &amp;i</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">someInt := newInt()</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½è·Ÿ someInt := new(int) ä¸€æ¨¡ä¸€æ ·ã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬è‡ªå·±å®šä¹‰ new å¼€å¤´çš„å‡½æ•°æ—¶ï¼Œå‡ºäºçº¦å®šä¹Ÿåº”è¯¥è¿”å›ç±»å‹çš„æŒ‡é’ˆã€‚</p>
<a id="more"></a>

<h3 id="make-çš„ä¸»è¦ç‰¹æ€§"><a href="#make-çš„ä¸»è¦ç‰¹æ€§" class="headerlink" title="make çš„ä¸»è¦ç‰¹æ€§"></a>make çš„ä¸»è¦ç‰¹æ€§</h3><p>make ä¹Ÿæ˜¯å†…å»ºå‡½æ•°ï¼Œä½ å¯ä»¥ä» <a href="http://golang.org/pkg/builtin/#make" target="_blank" rel="noopener">http://golang.org/pkg/builtin/#make</a> è¿™å„¿çœ‹åˆ°å®ƒï¼Œå®ƒçš„å®šä¹‰æ¯” new å¤šäº†ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›å€¼ä¹Ÿä¸åŒï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">make</span><span class="params">(Type, size IntegerType)</span> <span class="title">Type</span></span></span><br></pre></td></tr></table></figure>
<p>å®˜æ–¹æ–‡æ¡£å¯¹äºå®ƒçš„æè¿°æ˜¯ï¼š</p>
<blockquote>
<p>å†…å»ºå‡½æ•° make ç”¨æ¥ä¸º sliceï¼Œmap æˆ– chan ç±»å‹åˆ†é…å†…å­˜å’Œåˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡(æ³¨æ„ï¼šåªèƒ½ç”¨åœ¨è¿™ä¸‰ç§ç±»å‹ä¸Š)ï¼Œè·Ÿ new ç±»ä¼¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªç±»å‹è€Œä¸æ˜¯ä¸€ä¸ªå€¼ï¼Œè·Ÿ new ä¸åŒçš„æ˜¯ï¼Œmake è¿”å›ç±»å‹çš„å¼•ç”¨è€Œä¸æ˜¯æŒ‡é’ˆï¼Œè€Œè¿”å›å€¼ä¹Ÿä¾èµ–äºå…·ä½“ä¼ å…¥çš„ç±»å‹ï¼Œå…·ä½“è¯´æ˜å¦‚ä¸‹ï¼š<br/><br><b>Slice</b>: ç¬¬äºŒä¸ªå‚æ•° size æŒ‡å®šäº†å®ƒçš„é•¿åº¦ï¼Œå®ƒçš„å®¹é‡å’Œé•¿åº¦ç›¸åŒã€‚<br>ä½ å¯ä»¥ä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°æ¥æŒ‡å®šä¸åŒçš„å®¹é‡å€¼ï¼Œä½†å¿…é¡»ä¸èƒ½æ¯”é•¿åº¦å€¼å°ã€‚<br>æ¯”å¦‚ make([]int, 0, 10)<br/><br><b>Map</b>: æ ¹æ® size å¤§å°æ¥åˆå§‹åŒ–åˆ†é…å†…å­˜ï¼Œä¸è¿‡åˆ†é…åçš„ map é•¿åº¦ä¸º 0ï¼Œå¦‚æœ size è¢«å¿½ç•¥äº†ï¼Œé‚£ä¹ˆä¼šåœ¨åˆå§‹åŒ–åˆ†é…å†…å­˜æ—¶åˆ†é…ä¸€ä¸ªå°å°ºå¯¸çš„å†…å­˜<br/><br><b>Channel</b>: ç®¡é“ç¼“å†²åŒºä¾æ®ç¼“å†²åŒºå®¹é‡è¢«åˆå§‹åŒ–ã€‚å¦‚æœå®¹é‡ä¸º 0 æˆ–è€…å¿½ç•¥å®¹é‡ï¼Œç®¡é“æ˜¯æ²¡æœ‰ç¼“å†²åŒºçš„<br/></p>
</blockquote>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>new çš„ä½œç”¨æ˜¯åˆå§‹åŒ–ä¸€ä¸ªæŒ‡å‘ç±»å‹çš„æŒ‡é’ˆ(*T)ï¼Œmake çš„ä½œç”¨æ˜¯ä¸º sliceï¼Œmap æˆ– chan åˆå§‹åŒ–å¹¶è¿”å›å¼•ç”¨(T)ã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">https://www.jb51.net/article/56837.htm</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Golang</category>
      </categories>
  </entry>
  <entry>
    <title>Golang --- æ¥å£ä»‹ç»</title>
    <url>/2020/05/23/golang-%E6%8E%A5%E5%8F%A3%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<p>Goè¯­è¨€çš„ä¸»è¦è®¾è®¡è€…ä¹‹ä¸€ç½—å¸ƒÂ·æ´¾å…‹ï¼ˆRob Pikeï¼‰æ›¾ç»è¯´è¿‡ï¼Œå¦‚æœåªèƒ½é€‰æ‹©ä¸€ä¸ªGoè¯­è¨€çš„ç‰¹ æ€§ç§»æ¤åˆ°å…¶ä»–è¯­è¨€ä¸­ï¼Œä»–ä¼šé€‰æ‹©æ¥å£ã€‚</p>
<p>æ¥å£åœ¨Goè¯­è¨€æœ‰ç€è‡³å…³é‡è¦çš„åœ°ä½ã€‚å¦‚æœè¯´goroutineå’Œchannelæ˜¯æ”¯æ’‘èµ·Goè¯­è¨€çš„å¹¶å‘æ¨¡å‹ çš„åŸºçŸ³ï¼Œè®©Goè¯­è¨€åœ¨å¦‚ä»Šé›†ç¾¤åŒ–ä¸å¤šæ ¸åŒ–çš„æ—¶ä»£æˆä¸ºä¸€é“æä¸ºäº®ä¸½çš„é£æ™¯ï¼Œé‚£ä¹ˆæ¥å£æ˜¯Goè¯­è¨€ æ•´ä¸ªç±»å‹ç³»ç»Ÿçš„åŸºçŸ³ï¼Œè®©Goè¯­è¨€åœ¨åŸºç¡€ç¼–ç¨‹å“²å­¦çš„æ¢ç´¢ä¸Šè¾¾åˆ°å‰æ‰€æœªæœ‰çš„é«˜åº¦ã€‚</p>
<p>Goè¯­è¨€åœ¨ç¼–ç¨‹å“²å­¦ä¸Šæ˜¯å˜é©æ´¾ï¼Œè€Œä¸æ˜¯æ”¹è‰¯æ´¾ã€‚è¿™ä¸æ˜¯å› ä¸ºGoè¯­è¨€æœ‰goroutineå’Œchannelï¼Œ è€Œæ›´é‡è¦çš„æ˜¯å› ä¸ºGoè¯­è¨€çš„ç±»å‹ç³»ç»Ÿï¼Œæ›´æ˜¯å› ä¸ºGoè¯­è¨€çš„æ¥å£ã€‚Goè¯­è¨€çš„ç¼–ç¨‹å“²å­¦å› ä¸ºæœ‰æ¥å£ è€Œè¶‹è¿‘å®Œç¾ã€‚</p>
<a id="more"></a>


<pre><code>æ¥å£åªæœ‰æ–¹æ³•å£°æ˜ï¼Œæ²¡æœ‰å®ç°ï¼Œä¹Ÿæ²¡æœ‰æ•°æ®å­—æ®µã€‚
æ¥å£å¯ä»¥åŒ¿ååµŒå…¥åˆ°å…¶ä»–æ¥å£ã€‚
å¯¹è±¡èµ‹å€¼ç»™æ¥å£æ—¶ï¼Œä¼šå‘ç”Ÿæ‹·è´ã€‚
åªæœ‰å½“æ¥å£å­˜å‚¨çš„ç±»å‹å’Œå¯¹è±¡éƒ½æ˜¯nilæ—¶ï¼Œæ¥å£ç­‰äºnilã€‚
ç©ºæ¥å£å¯ä»¥æ¥æ”¶ä»»æ„çš„æ•°æ®ç±»å‹ã€‚
ä¸€ä¸ªç±»å‹å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚
æ¥å£å˜é‡åä¹ æƒ¯ä»¥ er ç»“å°¾ã€‚</code></pre><br/>

<pre><code>æ¥å£ç±»å‹æ˜¯å¯¹å…¶å®ƒç±»å‹è¡Œä¸ºçš„æŠ½è±¡å’Œæ¦‚æ‹¬ï¼Œæ¥å£ç±»å‹ä¸ä¼šå’Œç‰¹å®šçš„å®ç°ç»†èŠ‚ç»‘å®šã€‚
Goæ¥å£ç‹¬ç‰¹åœ¨å®ƒæ˜¯éšå¼å®ç°çš„ï¼Œè¿™æ˜¯æŒ‡ï¼šä¸€ä¸ªç»“æ„ä½“åªè¦å®ç°äº†æ¥å£è¦æ±‚çš„æ‰€æœ‰æ–¹æ³•ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ªç»“æ„ä½“å®ç°äº†è¯¥æ¥å£ã€‚</code></pre><p>â€‹    </p>
<h3 id="æ¥å£è¯­æ³•"><a href="#æ¥å£è¯­æ³•" class="headerlink" title="æ¥å£è¯­æ³•"></a>æ¥å£è¯­æ³•</h3><p>æ¥å£åœ¨ç°å®ä¸–ç•Œä¹Ÿæ˜¯æœ‰çœŸå®åœºæ™¯çš„ï¼Œå¦‚åŒç¬”è®°æœ¬ä¸Šéƒ½æœ‰USBæ’å£ï¼Œä¸”ä¸ç”¨æ‹…å¿ƒè¿™ä¸ªæ’æ§½æ˜¯ä¸ºæ‰‹æœºã€Uç›˜ã€å¹³æ¿å“ªä¸€ä¸ªå‡†å¤‡çš„ï¼Œå› ä¸ºç¬”è®°æœ¬çš„usbæ’æ§½å’Œå„ç§è®¾å¤‡çš„å‚å®¶ç»Ÿä¸€äº†USBçš„æ’æ§½è§„èŒƒã€‚</p>
<pre><code>type æ¥å£å interface {
    method1(å‚æ•°åˆ—è¡¨)è¿”å›å€¼åˆ—è¡¨
    method2(å‚æ•°åˆ—è¡¨)è¿”å›å€¼åˆ—è¡¨
}
interfaceç±»å‹å¯ä»¥å®šä¹‰ä¸€ç»„æ–¹æ³•ï¼Œä¸”ä¸éœ€è¦å®ç°è¿™äº›æ–¹æ³•ï¼å¹¶ä¸”interfaceä¸èƒ½æœ‰ä»»ä½•å˜é‡ã€‚
åªè¦æœ‰ä¸€ä¸ªå˜é‡ç±»å‹ï¼Œå«æœ‰æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œå°±è¯´è¿™ä¸ªå˜é‡ç±»å‹å®ç°äº†è¿™ä¸ªæ¥å£ã€‚</code></pre><h4 id="Goå¤šæ€ä¸æ¥å£"><a href="#Goå¤šæ€ä¸æ¥å£" class="headerlink" title="Goå¤šæ€ä¸æ¥å£"></a>Goå¤šæ€ä¸æ¥å£</h4><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªUsbæ¥å£ï¼Œä¸”å®šä¹‰UsbåŠŸèƒ½æ–¹æ³•</span></span><br><span class="line"><span class="keyword">type</span> Usb <span class="keyword">interface</span> &#123;</span><br><span class="line">    Start()</span><br><span class="line">    Stop()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Phone <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name  <span class="keyword">string</span></span><br><span class="line">    Price <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è®©æ‰‹æœºPhoneå®ç°Usbæ¥å£çš„æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Phone)</span> <span class="title">Start</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"æ‰‹æœºå·²è¿æ¥USB,å¼€å§‹å·¥ä½œ"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¿…é¡»å®ç°æ¥å£æ‰€æœ‰çš„æ–¹æ³•ï¼Œå°‘ä¸€ä¸ªéƒ½æŠ¥é”™  å¦‚ä¸‹ï¼šPhone does not implement Usb (missing Stop method)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Phone)</span> <span class="title">Stop</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"æ‰‹æœºæ–­å¼€äº†USBï¼Œåœæ­¢å·¥ä½œ"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> IPad <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name  <span class="keyword">string</span></span><br><span class="line">    Price <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p IPad)</span> <span class="title">Start</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"ipadå·²ç»è¿æ¥USBï¼Œå¼€å§‹å·¥ä½œ"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p IPad)</span> <span class="title">Stop</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"ipadæ–­å¼€äº†USBï¼Œåœæ­¢å·¥ä½œ"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªç”µè„‘ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“å¯ä»¥å®ç°usbçš„æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> Computer <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®šä¹‰workingæ–¹æ³•ï¼Œæ¥æ”¶Usbæ¥å£ç±»å‹å˜é‡</span></span><br><span class="line"><span class="comment">//å®ç°Usbæ¥å£å£°æ˜çš„æ‰€æœ‰æ–¹æ³•</span></span><br><span class="line"><span class="comment">//è¿™æ˜¯ä¸€ä¸ªå¤šæ€çš„å‡½æ•°ï¼Œè°ƒç”¨åŒä¸€ä¸ªWorkingå‡½æ•°ï¼Œä¸åŒçš„æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mbp Computer)</span> <span class="title">Working</span><span class="params">(usb Usb)</span></span> &#123;</span><br><span class="line">    <span class="comment">//ä¸åŒçš„usbå®å‚ï¼Œå®ç°ä¸åŒçš„åŠŸèƒ½</span></span><br><span class="line">    <span class="comment">//åªè¦å®ç°äº†usbæ¥å£çš„æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å‹çš„å˜é‡ï¼Œå°±å¯ä»¥ç»™usbæ¥å£å˜é‡èµ‹å€¼</span></span><br><span class="line">    usb.Start()</span><br><span class="line">    usb.Stop()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//åˆ†åˆ«åˆ›å»ºç»“æ„ä½“å¯¹è±¡</span></span><br><span class="line">    c := Computer&#123;&#125;</span><br><span class="line">    p := Phone&#123;<span class="string">"è‹¹æœæ‰‹æœº"</span>, <span class="number">6999</span>&#125;</span><br><span class="line">    i := IPad&#123;<span class="string">"åä¸ºå¹³æ¿"</span>, <span class="number">7999</span>&#125; </span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//æ‰‹æœºè¿æ¥ç¬”è®°æœ¬ï¼Œæ’ä¸Šæ‰‹æœº</span></span><br><span class="line">    c.Working(p)</span><br><span class="line">    fmt.Printf(<span class="string">"åå­—:%v ä»·æ ¼:%d\n"</span>, p.Name, p.Price)</span><br><span class="line">    fmt.Println(<span class="string">"------------------"</span>)</span><br><span class="line">    <span class="comment">//å¹³æ¿è¿æ¥ç¬”è®°æœ¬ï¼Œæ’ä¸Šå¹³æ¿</span></span><br><span class="line">    c.Working(i)</span><br><span class="line">    fmt.Printf(<span class="string">"åå­—ï¼š%v ä»·æ ¼ï¼š%d\n"</span>, i.Name, i.Price)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹2:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"><span class="comment">//å‘˜å·¥æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> Employer <span class="keyword">interface</span> &#123;</span><br><span class="line">    CalcSalary() <span class="keyword">float32</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¼€å‘è€…</span></span><br><span class="line"><span class="keyword">type</span> Programer <span class="keyword">struct</span> &#123;</span><br><span class="line">    name  <span class="keyword">string</span></span><br><span class="line">    base  <span class="keyword">float32</span></span><br><span class="line">    extra <span class="keyword">float32</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ›å»ºå¼€å‘è€…å®ä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewProgramer</span><span class="params">(name <span class="keyword">string</span>, base <span class="keyword">float32</span>, extra <span class="keyword">float32</span>)</span> <span class="title">Programer</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Programer&#123;</span><br><span class="line">        name,</span><br><span class="line">        base,</span><br><span class="line">        extra,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è®¡ç®—å¼€å‘è€…å·¥èµ„ï¼Œå®ç°äº†CalcSalaryæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Programer)</span> <span class="title">CalcSalary</span><span class="params">()</span> <span class="title">float32</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> p.base</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é”€å”®ç¾¤ä½“</span></span><br><span class="line"><span class="keyword">type</span> Sale <span class="keyword">struct</span> &#123;</span><br><span class="line">    name  <span class="keyword">string</span></span><br><span class="line">    base  <span class="keyword">float32</span></span><br><span class="line">    extra <span class="keyword">float32</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ›å»ºé”€å”®å®ä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSale</span><span class="params">(name <span class="keyword">string</span>, base <span class="keyword">float32</span>, extra <span class="keyword">float32</span>)</span> <span class="title">Sale</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Sale&#123;</span><br><span class="line">        name,</span><br><span class="line">        base,</span><br><span class="line">        extra,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®ç°äº†CalcSalaryæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Sale)</span> <span class="title">CalcSalary</span><span class="params">()</span> <span class="title">float32</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> p.base + p.extra*p.base*<span class="number">0.5</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è®¡ç®—æ‰€æœ‰äººçš„å·¥èµ„æ¥æ”¶å‚æ•°ï¼Œæ¥å£åˆ‡ç‰‡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">calcAll</span><span class="params">(e []Employer)</span> <span class="title">float32</span></span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        fmt.Println(e)</span></span><br><span class="line"><span class="comment">        [&#123;ç äº‘ 50000 0&#125; &#123;åˆ˜æŠ¢ä¸œ 40000 0&#125; &#123;éº»èŠ±è—¤ 30000 0&#125; &#123;æ ¼æ ¼ 3000 2.5&#125; &#123;å°é›ª 1800 2.5&#125; &#123;å°é›¨ 2000 2.5&#125;]</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">var</span> cost <span class="keyword">float32</span></span><br><span class="line">    <span class="comment">//å¿½ç•¥ç´¢å¼•ï¼Œvæ˜¯æ¯ä¸€ä¸ªç»“æ„ä½“</span></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> e &#123;</span><br><span class="line">        cost = cost + v.CalcSalary()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cost</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    p1 := NewProgramer(<span class="string">"ç äº‘"</span>, <span class="number">50000.0</span>, <span class="number">0</span>)</span><br><span class="line">    p2 := NewProgramer(<span class="string">"åˆ˜æŠ¢ä¸œ"</span>, <span class="number">40000</span>, <span class="number">0</span>)</span><br><span class="line">    p3 := NewProgramer(<span class="string">"éº»èŠ±è—¤"</span>, <span class="number">30000</span>, <span class="number">0</span>)</span><br><span class="line">    s1 := NewSale(<span class="string">"æ ¼æ ¼"</span>, <span class="number">3000</span>, <span class="number">2.5</span>)</span><br><span class="line">    s2 := NewSale(<span class="string">"å°é›ª"</span>, <span class="number">1800</span>, <span class="number">2.5</span>)</span><br><span class="line">    s3 := NewSale(<span class="string">"å°é›¨"</span>, <span class="number">2000</span>, <span class="number">2.5</span>)</span><br><span class="line">    <span class="keyword">var</span> employList []Employer</span><br><span class="line">    employList = <span class="built_in">append</span>(employList, p1)</span><br><span class="line">    employList = <span class="built_in">append</span>(employList, p2)</span><br><span class="line">    employList = <span class="built_in">append</span>(employList, p3)</span><br><span class="line">    employList = <span class="built_in">append</span>(employList, s1)</span><br><span class="line">    employList = <span class="built_in">append</span>(employList, s2)</span><br><span class="line">    employList = <span class="built_in">append</span>(employList, s3)</span><br><span class="line">    cost := calcAll(employList)</span><br><span class="line">    fmt.Printf(<span class="string">"è¿™ä¸ªæœˆäººåŠ›æˆæœ¬ï¼š%f\n"</span>, cost)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Goæ¥å£ç»†èŠ‚"><a href="#Goæ¥å£ç»†èŠ‚" class="headerlink" title="Goæ¥å£ç»†èŠ‚"></a>Goæ¥å£ç»†èŠ‚</h3><pre><code>1.æ¥å£æœ¬èº«ä¸èƒ½åˆ›å»ºå®ä¾‹ï¼Œä½†æ˜¯å¯ä»¥æŒ‡å‘ä¸€ä¸ªå®ç°äº†è¯¥æ¥å£çš„å˜é‡å®ä¾‹ï¼Œå¦‚ç»“æ„ä½“
2.æ¥å£ä¸­æ‰€æœ‰æ–¹æ³•éƒ½æ²¡æœ‰æ–¹æ³•ä½“ï¼Œæ˜¯æ²¡æœ‰å®ç°çš„æ–¹æ³•
3.Goä¸­ä¸ä»…æ˜¯structå¯ä»¥å®ç°æ¥å£ï¼Œè‡ªå®šä¹‰ç±»å‹ä¹Ÿå¯ä»¥å®ç°æ¥å£ï¼Œå¦‚type myInt int è‡ªå®šä¹‰ç±»å‹
4.ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹ï¼Œåªæœ‰å®ç°äº†æŸä¸ªæ¥å£ï¼Œæ‰å¯ä»¥å°†è‡ªå®šä¹‰ç±»å‹çš„å®ä¾‹å˜é‡ï¼Œèµ‹ç»™æ¥å£ç±»å‹ï¼Œå¦åˆ™æŠ¥é”™missing xx method
5.ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹ï¼Œå¯ä»¥å®ç°å¤šä¸ªæ¥å£(å®ç°å¤šä¸ªæ¥å£çš„æ‰€æœ‰æ–¹æ³•)
6.æ¥å£ç±»å‹ä¸å¾—å†™å…¥ä»»ä½•å˜é‡ å¦‚
type Usb interface{
    method1()
    method2()
    Name string  //é”™è¯¯ï¼Œç¼–è¯‘å™¨ä¸é€šè¿‡
}
7.æ¥å£Aå¯ä»¥ç»§æ‰¿å¤šä¸ªåˆ«çš„æ¥å£Bã€æ¥å£Cï¼Œæƒ³è¦å®ç°Aï¼Œä¹Ÿå¿…é¡»å®ç°Bã€Cæ‰€æœ‰æ–¹æ³•ï¼Œç§°ä½œæ¥å£ç»„åˆ
8.interfaceç±»å‹ï¼Œé»˜è®¤æ˜¯æŒ‡é’ˆ(å¼•ç”¨ç±»å‹)ï¼Œå¦‚æœæ²¡åˆå§‹ç›´æ¥ä½¿ç”¨ï¼Œè¾“å‡ºnilï¼Œå¯ä»¥èµ‹ç»™å®ç°äº†æ¥å£çš„å˜é‡
9.ç©ºæ¥å£interface{}ï¼Œæ²¡æœ‰ä»»ä½•ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å®ç°äº†ä»»ä½•ç±»å‹ï¼Œå¯ä»¥å§ä»»ä½•ä¸€ä¸ªå˜é‡èµ‹ç»™ç©ºæ¥å£
10.åŒ¿åç»„åˆçš„æ¥å£ï¼Œä¸å¯ä»¥æœ‰åŒåæ–¹æ³•ï¼Œå¦åˆ™æŠ¥é”™duplicate method</code></pre><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">https://pythonav.com/wiki/detail/4/54/</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Golang</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]Django-rest-framework --- ä½¿ç”¨ç¼“å­˜drf-extensions</title>
    <url>/2020/05/23/%E8%BD%AC-DRF%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98drf-extensions/</url>
    <content><![CDATA[<p>(è¿™ä¸ªåº“å¾ˆç®€å•,ç›´æ¥è½¬å‘åˆ«äººçš„äº†.)<br/></p>
<p>åœ¨å¼€å‘æŸäº›ç½‘ç«™çš„æ—¶å€™ï¼Œæ¯”å¦‚æœ‰äº›ä¸ç»å¸¸æˆ–è€…é•¿æ—¶é—´ä¸ä¼šå˜æ›´çš„æ•°æ®ï¼Œä½†æ˜¯ï¼Œç”¨æˆ·ä¼šç»å¸¸æŸ¥è¯¢çš„æ•°æ®ï¼Œä¸ºäº†é¿å…å¤šæ¬¡æŸ¥è¯¢æ•°æ®åº“ç»™æ•°æ®åº“å¸¦æ¥å¤ªå¤§çš„å‹åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥åŠå°†è¿™äº›ç»å¸¸è¢«æŸ¥è¯¢çš„æ•°æ®ï¼Œåœ¨è¢«æŸ¥è¯¢ä¸€æ¬¡ä¹‹åï¼Œå¯ä»¥åœ¨å­˜æ”¾åœ¨redisç¼“å­˜ä¸­ï¼Œä¸‹æ¬¡å†è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥ä»redisè¿›è¡Œè·å–ï¼Œè€Œä¸éœ€è¦å†æŸ¥è¯¢å­˜å‚¨æ•°æ®çš„ï¼ˆä¾‹å¦‚mysqlï¼‰æ•°æ®åº“äº†ï¼›</p>
<a id="more"></a>

<p>åœ¨Django REST frameworkä¸­ä½¿ç”¨ç¼“å­˜ï¼Œå¯ä»¥é€šè¿‡drf-extensionsæ‰©å±•æ¥å®ç°ã€‚</p>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip install drf-extensions</span><br></pre></td></tr></table></figure>
<p>æœ€æ–°ç‰ˆæœ¬æ˜¯0.5.0,å…¼å®¹py3ä»¥åŠdrf3.9ä»¥ä¸Šçš„ç‰ˆæœ¬,å¦‚æœè¦åœ¨py2.7å’Œdrf3.6çš„ç‰ˆæœ¬ä¸Šä½¿ç”¨,éœ€è¦å®‰è£…<code>0.3.1</code>ç‰ˆæœ¬.</p>
<h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><h4 id="1-ä½¿ç”¨è£…é¥°å™¨"><a href="#1-ä½¿ç”¨è£…é¥°å™¨" class="headerlink" title="1.ä½¿ç”¨è£…é¥°å™¨"></a>1.ä½¿ç”¨è£…é¥°å™¨</h4><p>å¯ä»¥åœ¨ä½¿ç”¨<code>rest_framework_extensions.cache.decorators</code>ä¸­çš„<code>cache_response</code>è£…é¥°å™¨æ¥è£…é¥°è¿”å›æ•°æ®çš„ç±»è§†å›¾çš„å¯¹è±¡æ–¹æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CityView</span><span class="params">(views.APIView)</span>:</span></span><br><span class="line"><span class="meta">    @cache_response()</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br></pre></td></tr></table></figure>
<p><code>cache_response</code>è£…é¥°å™¨å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@cache_response(timeout=60*60, cache='default')</span></span><br></pre></td></tr></table></figure>
<p>timeout ç¼“å­˜æ—¶é—´<br/><br>cache ç¼“å­˜ä½¿ç”¨çš„Djangoç¼“å­˜åç«¯ï¼ˆå³CACHESé…ç½®ä¸­çš„é”®åç§°ï¼‰<br/><br>å¦‚æœåœ¨ä½¿ç”¨cache_responseè£…é¥°å™¨æ—¶æœªæŒ‡æ˜timeoutæˆ–è€…cacheå‚æ•°ï¼Œåˆ™ä¼šä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤é…ç½®ï¼Œå¯ä»¥é€šè¿‡åœ¨settings.pyä¸­è¿›è¡Œå…¨å±€æ–¹æ³•é…ç½®ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># DRFæ‰©å±• </span></span><br><span class="line">REST_FRAMEWORK_EXTENSIONS = &#123; </span><br><span class="line">    <span class="comment"># ç¼“å­˜æ—¶é—´ </span></span><br><span class="line">    <span class="string">'DEFAULT_CACHE_RESPONSE_TIMEOUT'</span>: <span class="number">60</span> * <span class="number">60</span>, </span><br><span class="line">    <span class="comment"># ç¼“å­˜å­˜å‚¨ </span></span><br><span class="line">    <span class="string">'DEFAULT_USE_CACHE'</span>: <span class="string">'default'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œcache_responseè£…é¥°å™¨æ—¢å¯ä»¥è£…é¥°åœ¨ç±»è§†å›¾ä¸­çš„getæ–¹æ³•ä¸Šï¼Œä¹Ÿå¯ä»¥è£…é¥°åœ¨REST frameworkæ‰©å±•ç±»æä¾›çš„listæˆ–retrieveæ–¹æ³•ä¸Šã€‚ä½¿ç”¨cache_responseè£…é¥°å™¨æ— éœ€ä½¿ç”¨method_decoratorè¿›è¡Œè½¬æ¢ã€‚</p>
<h4 id="ä½¿ç”¨drf-extensionsæä¾›çš„æ‰©å±•ç±»"><a href="#ä½¿ç”¨drf-extensionsæä¾›çš„æ‰©å±•ç±»" class="headerlink" title="ä½¿ç”¨drf-extensionsæä¾›çš„æ‰©å±•ç±»"></a>ä½¿ç”¨drf-extensionsæä¾›çš„æ‰©å±•ç±»</h4><p>drf-extensionsæ‰©å±•å¯¹äºç¼“å­˜æä¾›äº†ä¸‰ä¸ªæ‰©å±•ç±»ï¼š</p>
<pre><code>ListCacheResponseMixin
ç”¨äºç¼“å­˜è¿”å›åˆ—è¡¨æ•°æ®çš„è§†å›¾ï¼Œä¸ListModelMixinæ‰©å±•ç±»é…åˆä½¿ç”¨ï¼Œå®é™…æ˜¯ä¸ºlistæ–¹æ³•æ·»åŠ äº†cache_responseè£…é¥°å™¨

RetrieveCacheResponseMixin
ç”¨äºç¼“å­˜è¿”å›å•ä¸€æ•°æ®çš„è§†å›¾ï¼Œä¸RetrieveModelMixinæ‰©å±•ç±»é…åˆä½¿ç”¨ï¼Œå®é™…æ˜¯ä¸ºretrieveæ–¹æ³•æ·»åŠ äº†cache_responseè£…é¥°å™¨

CacheResponseMixin
ä¸ºè§†å›¾é›†åŒæ—¶è¡¥å……Listå’ŒRetrieveä¸¤ç§ç¼“å­˜ï¼Œä¸ListModelMixinå’ŒRetrieveModelMixinä¸€èµ·é…åˆä½¿ç”¨ã€‚</code></pre><p>ä¸‰ä¸ªæ‰©å±•ç±»éƒ½æ˜¯åœ¨rest_framework_extensions.cache.mixinsä¸­ã€‚</p>
<p>è¿™ä¸ªæ‰©å±•ç±»åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œåªè¦éœ€è¦è¿›è¡Œç¼“å­˜å¤„ç†çš„è§†å›¾å‡½æ•°åœ¨ç»§æ‰¿çš„æ—¶å€™ï¼Œç»§æ‰¿ç›¸å…³çš„æ‰©å±•ç±»ï¼Œåœ¨å…¨éƒ¨çš„settingsä¸­è¿›è¡Œç¼“å­˜æœ‰æ•ˆæœŸå’Œç¼“å­˜ä½¿ç”¨çš„åç«¯å³å¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CityView</span><span class="params">(CacheResponseMixin, ReadOnlyModelViewSet)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># DRFæ‰©å±• </span></span><br><span class="line">REST_FRAMEWORK_EXTENSIONS = &#123; </span><br><span class="line"><span class="comment"># ç¼“å­˜æ—¶é—´ </span></span><br><span class="line">    <span class="string">'DEFAULT_CACHE_RESPONSE_TIMEOUT'</span>: <span class="number">60</span> * <span class="number">60</span>, </span><br><span class="line"><span class="comment"># ç¼“å­˜å­˜å‚¨ </span></span><br><span class="line">    <span class="string">'DEFAULT_USE_CACHE'</span>: <span class="string">'default'</span>, </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">https://blog.csdn.net/gymaisyl/article/details/84452994</span><br><span class="line">https://github.com/chibisov/drf-extensions/releases</span><br><span class="line">http://chibisov.github.io/drf-extensions/docs/#0-3-1</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
        <tag>django-rest-framework</tag>
      </tags>
  </entry>
  <entry>
    <title>Python --- ä½¿ç”¨fakeråº“éšæœºäº§ç”Ÿè™šæ‹Ÿæ•°æ®</title>
    <url>/2020/05/23/%E4%BD%BF%E7%94%A8faker%E5%BA%93%E9%9A%8F%E6%9C%BA%E4%BA%A7%E7%94%9F%E8%99%9A%E6%8B%9F%E6%95%B0%E6%8D%AE/</url>
    <content><![CDATA[<p>å®‰è£…:<br/><br><code>pip install faker</code></p>
<a id="more"></a>

<p>ä½¿ç”¨:<br/></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author   : FELIX</span></span><br><span class="line"><span class="comment"># @Date     : 2018/6/30 9:49</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> faker <span class="keyword">import</span> Factory</span><br><span class="line"></span><br><span class="line"><span class="comment"># zh_CN è¡¨ç¤ºä¸­å›½å¤§é™†ç‰ˆ</span></span><br><span class="line">fake = Factory().create(<span class="string">'zh_CN'</span>)</span><br><span class="line"><span class="comment"># äº§ç”Ÿéšæœºæ‰‹æœºå·</span></span><br><span class="line">print(fake.phone_number())</span><br><span class="line"><span class="comment"># äº§ç”Ÿéšæœºå§“å</span></span><br><span class="line">print(fake.name())</span><br><span class="line"><span class="comment"># äº§ç”Ÿéšæœºåœ°å€</span></span><br><span class="line">print(fake.address())</span><br><span class="line"><span class="comment"># éšæœºäº§ç”Ÿå›½å®¶å</span></span><br><span class="line">print(fake.country())</span><br><span class="line"><span class="comment"># éšæœºäº§ç”Ÿå›½å®¶ä»£ç </span></span><br><span class="line">print(fake.country_code())</span><br><span class="line"><span class="comment"># éšæœºäº§ç”ŸåŸå¸‚å</span></span><br><span class="line">print(fake.city_name())</span><br><span class="line"><span class="comment"># éšæœºäº§ç”ŸåŸå¸‚</span></span><br><span class="line">print(fake.city())</span><br><span class="line"><span class="comment"># éšæœºäº§ç”Ÿçœä»½</span></span><br><span class="line">print(fake.province())</span><br><span class="line"><span class="comment"># äº§ç”Ÿéšæœºemail</span></span><br><span class="line">print(fake.email())</span><br><span class="line"><span class="comment"># äº§ç”ŸéšæœºIPV4åœ°å€</span></span><br><span class="line">print(fake.ipv4())</span><br><span class="line"><span class="comment"># äº§ç”Ÿé•¿åº¦åœ¨æœ€å¤§å€¼ä¸æœ€å°å€¼ä¹‹é—´çš„éšæœºå­—ç¬¦ä¸²</span></span><br><span class="line">print(fake.pystr(min_chars=<span class="number">0</span>, max_chars=<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># éšæœºäº§ç”Ÿè½¦ç‰Œå·</span></span><br><span class="line">print(fake.license_plate())</span><br><span class="line"></span><br><span class="line"><span class="comment"># éšæœºäº§ç”Ÿé¢œè‰²</span></span><br><span class="line">print(fake.rgb_color())  <span class="comment"># rgb</span></span><br><span class="line">print(fake.safe_hex_color())  <span class="comment"># 16è¿›åˆ¶</span></span><br><span class="line">print(fake.color_name())  <span class="comment"># é¢œè‰²åå­—</span></span><br><span class="line">print(fake.hex_color()) <span class="comment"># 16è¿›åˆ¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éšæœºäº§ç”Ÿå…¬å¸å</span></span><br><span class="line">print(fake.company())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># éšæœºäº§ç”Ÿå·¥ä½œå²—ä½</span></span><br><span class="line">print(fake.job())</span><br><span class="line"><span class="comment"># éšæœºç”Ÿæˆå¯†ç </span></span><br><span class="line">print(fake.password(length=<span class="number">10</span>, special_chars=<span class="literal">True</span>, digits=<span class="literal">True</span>, upper_case=<span class="literal">True</span>, lower_case=<span class="literal">True</span>))</span><br><span class="line"><span class="comment"># éšæœºç”Ÿæˆuuid</span></span><br><span class="line">print(fake.uuid4())</span><br><span class="line"><span class="comment"># éšæœºç”Ÿæˆsha1</span></span><br><span class="line">print(fake.sha1(raw_output=<span class="literal">False</span>))</span><br><span class="line"><span class="comment"># éšæœºç”Ÿæˆmd5</span></span><br><span class="line">print(fake.md5(raw_output=<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># éšæœºç”Ÿæˆå¥³æ€§åå­—</span></span><br><span class="line">print(fake.name_female())</span><br><span class="line"><span class="comment"># ç”·æ€§åå­—</span></span><br><span class="line">print(fake.name_male())</span><br><span class="line"><span class="comment"># éšæœºç”Ÿæˆåå­—</span></span><br><span class="line">print(fake.name())</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”ŸæˆåŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">print(fake.profile(fields=<span class="literal">None</span>, sex=<span class="literal">None</span>))</span><br><span class="line">print(fake.simple_profile(sex=<span class="literal">None</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># éšæœºç”Ÿæˆæµè§ˆå™¨å¤´user_agent</span></span><br><span class="line">print(fake.user_agent())</span><br><span class="line"></span><br><span class="line"><span class="comment"># éšæœºäº§ç”Ÿæ—¶é—´</span></span><br><span class="line">fake.month_name()</span><br><span class="line"><span class="comment"># 'September'</span></span><br><span class="line">fake.date_time_this_century(before_now=<span class="literal">True</span>, after_now=<span class="literal">False</span>, tzinfo=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.datetime(2010, 7, 21, 18, 52, 43)</span></span><br><span class="line">fake.time_object(end_datetime=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.time(6, 39, 26)</span></span><br><span class="line">fake.date_time_between(start_date=<span class="string">"-30y"</span>, end_date=<span class="string">"now"</span>, tzinfo=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.datetime(2013, 10, 11, 18, 43, 40)</span></span><br><span class="line">fake.future_date(end_date=<span class="string">"+30d"</span>, tzinfo=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.date(2018, 7, 8)</span></span><br><span class="line">fake.date_time(tzinfo=<span class="literal">None</span>, end_datetime=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.datetime(2006, 9, 4, 20, 46, 6)</span></span><br><span class="line">fake.date(pattern=<span class="string">"%Y-%m-%d"</span>, end_datetime=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># '1998-08-02'</span></span><br><span class="line">fake.date_time_this_month(before_now=<span class="literal">True</span>, after_now=<span class="literal">False</span>, tzinfo=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.datetime(2018, 6, 8, 9, 56, 24)</span></span><br><span class="line">fake.timezone()</span><br><span class="line"><span class="comment"># 'Africa/Conakry'</span></span><br><span class="line">fake.date_time_this_decade(before_now=<span class="literal">True</span>, after_now=<span class="literal">False</span>, tzinfo=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.datetime(2017, 6, 27, 21, 18, 28)</span></span><br><span class="line">fake.month()</span><br><span class="line"><span class="comment"># '04'</span></span><br><span class="line">fake.day_of_week()</span><br><span class="line"><span class="comment"># 'Wednesday'</span></span><br><span class="line">fake.iso8601(tzinfo=<span class="literal">None</span>, end_datetime=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># '1988-02-28T09:22:29'</span></span><br><span class="line">fake.time_delta(end_datetime=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.timedelta(10832, 82660)</span></span><br><span class="line">fake.date_object(end_datetime=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.date(2005, 8, 18)</span></span><br><span class="line">fake.date_this_decade(before_today=<span class="literal">True</span>, after_today=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># datetime.date(2015, 1, 5)</span></span><br><span class="line">fake.date_this_century(before_today=<span class="literal">True</span>, after_today=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># datetime.date(2000, 6, 1)</span></span><br><span class="line">fake.date_this_month(before_today=<span class="literal">True</span>, after_today=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># datetime.date(2018, 6, 13)</span></span><br><span class="line">fake.am_pm()</span><br><span class="line"><span class="comment"># 'AM'</span></span><br><span class="line">fake.past_datetime(start_date=<span class="string">"-30d"</span>, tzinfo=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.datetime(2018, 6, 25, 7, 41, 34)</span></span><br><span class="line">fake.date_this_year(before_today=<span class="literal">True</span>, after_today=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># datetime.date(2018, 2, 24)</span></span><br><span class="line">fake.date_time_between_dates(datetime_start=<span class="literal">None</span>, datetime_end=<span class="literal">None</span>, tzinfo=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.datetime(2018, 6, 26, 14, 40, 5)</span></span><br><span class="line">fake.date_time_ad(tzinfo=<span class="literal">None</span>, end_datetime=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.datetime(673, 1, 28, 18, 17, 55)</span></span><br><span class="line">fake.date_between_dates(date_start=<span class="literal">None</span>, date_end=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.date(2018, 6, 26)</span></span><br><span class="line">fake.future_datetime(end_date=<span class="string">"+30d"</span>, tzinfo=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.datetime(2018, 7, 4, 10, 53, 6)</span></span><br><span class="line">fake.century()</span><br><span class="line"><span class="comment"># 'IX'</span></span><br><span class="line">fake.past_date(start_date=<span class="string">"-30d"</span>, tzinfo=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.date(2018, 5, 30)</span></span><br><span class="line">fake.time(pattern=<span class="string">"%H:%M:%S"</span>, end_datetime=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># '01:32:14'</span></span><br><span class="line">fake.day_of_month()</span><br><span class="line"><span class="comment"># '19'</span></span><br><span class="line">fake.unix_time(end_datetime=<span class="literal">None</span>, start_datetime=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># 1284297794</span></span><br><span class="line">fake.date_time_this_year(before_now=<span class="literal">True</span>, after_now=<span class="literal">False</span>, tzinfo=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># datetime.datetime(2018, 5, 24, 11, 25, 25)</span></span><br><span class="line">fake.date_between(start_date=<span class="string">"-30y"</span>, end_date=<span class="string">"today"</span>)</span><br><span class="line"><span class="comment"># datetime.date(2003, 1, 11)</span></span><br><span class="line">fake.year()</span><br><span class="line"><span class="comment"># '1993'</span></span><br><span class="line">fake.time_series(start_date=<span class="string">"-30d"</span>, end_date=<span class="string">"now"</span>, precision=<span class="literal">None</span>, distrib=<span class="literal">None</span>, tzinfo=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># &lt;generator object time_series at 0x7f44e702a620&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># éšæœºäº§ç”Ÿæ–‡ä»¶</span></span><br><span class="line">fake.file_extension(category=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># 'xls'</span></span><br><span class="line">fake.file_name(category=<span class="literal">None</span>, extension=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># 'è¡¨ç¤º.csv'</span></span><br><span class="line">fake.file_path(depth=<span class="number">1</span>, category=<span class="literal">None</span>, extension=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># '/æ•™è‚²/å®¢æˆ·.js'</span></span><br><span class="line">fake.unix_device(prefix=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># '/dev/sdf'</span></span><br><span class="line">fake.unix_partition(prefix=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># '/dev/vdf0'</span></span><br><span class="line">fake.mime_type(category=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># 'multipart/form-data'</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>[è½¬]Python --- superæ²¡é‚£ä¹ˆç®€å•</title>
    <url>/2020/05/23/%E8%BD%AC-super%E6%B2%A1%E9%82%A3%E4%B9%88%E7%AE%80%E5%8D%95/</url>
    <content><![CDATA[<p>è¯´åˆ° superï¼Œ å¤§å®¶å¯èƒ½è§‰å¾—å¾ˆç®€å•å‘€ï¼Œä¸å°±æ˜¯ç”¨æ¥è°ƒç”¨çˆ¶ç±»æ–¹æ³•çš„å˜›ã€‚å¦‚æœçœŸçš„è¿™ä¹ˆç®€å•çš„è¯ä¹Ÿå°±ä¸ä¼šæœ‰è¿™ç¯‡æ–‡ç« äº†ï¼Œä¸”å¬æˆ‘ç»†ç»†é“æ¥ã€‚?</p>
<h3 id="çº¦å®š"><a href="#çº¦å®š" class="headerlink" title="çº¦å®š"></a>çº¦å®š</h3><p>åœ¨å¼€å§‹ä¹‹å‰æˆ‘ä»¬æ¥çº¦å®šä¸€ä¸‹æœ¬æ–‡æ‰€ä½¿ç”¨çš„ Python ç‰ˆæœ¬ã€‚é»˜è®¤ç”¨çš„æ˜¯ Python 3ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šæœ¬æ–‡æ‰€å®šä¹‰çš„ç±»éƒ½æ˜¯æ–°å¼ç±»ã€‚å¦‚æœä½ ç”¨åˆ°æ˜¯ Python 2 çš„è¯ï¼Œè®°å¾—ç»§æ‰¿ object:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ï¼Œ Python 3</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>

<p>Python 3 å’Œ Python 2 çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯: Python 3 å¯ä»¥ä½¿ç”¨ç›´æ¥ä½¿ç”¨ super().xxx ä»£æ›¿ super(Class, self).xxx :</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ï¼ŒPython 3</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        super().add(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python 2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        super(B, self).add(x)</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ï¼Œä½ å¦‚æœç”¨çš„æ˜¯ Python 2 çš„è¯ï¼Œè®°å¾—å°†æœ¬æ–‡çš„ super() æ›¿æ¢ä¸º suepr(Class, self) ã€‚</p>
<p>å¦‚æœè¿˜æœ‰å…¶ä»–ä¸å…¼å®¹ Python 2 çš„æƒ…å†µï¼Œæˆ‘ä¼šåœ¨æ–‡ä¸­æ³¨æ˜çš„ã€‚</p>
<h3 id="å•ç»§æ‰¿"><a href="#å•ç»§æ‰¿" class="headerlink" title="å•ç»§æ‰¿"></a>å•ç»§æ‰¿</h3><p>åœ¨å•ç»§æ‰¿ä¸­ super å°±åƒå¤§å®¶æ‰€æƒ³çš„é‚£æ ·ï¼Œä¸»è¦æ˜¯ç”¨æ¥è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.n = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, m)</span>:</span></span><br><span class="line">        print(<span class="string">'self is &#123;0&#125; @A.add'</span>.format(self))</span><br><span class="line">        self.n += m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.n = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, m)</span>:</span></span><br><span class="line">        print(<span class="string">'self is &#123;0&#125; @B.add'</span>.format(self))</span><br><span class="line">        super().add(m)</span><br><span class="line">        self.n += <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>ä½ è§‰å¾—æ‰§è¡Œä¸‹é¢ä»£ç åï¼Œ b.n çš„å€¼æ˜¯å¤šå°‘å‘¢ï¼Ÿ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">b = B()</span><br><span class="line">b.add(<span class="number">2</span>)</span><br><span class="line">print(b.n)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self <span class="keyword">is</span> &lt;__main__.B object at <span class="number">0x106c49b38</span>&gt; @B.add</span><br><span class="line">self <span class="keyword">is</span> &lt;__main__.B object at <span class="number">0x106c49b38</span>&gt; @A.add</span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªç»“æœè¯´æ˜äº†ä¸¤ä¸ªé—®é¢˜:</p>
<pre><code>super().add(m) ç¡®å®è°ƒç”¨äº†çˆ¶ç±» A çš„ add æ–¹æ³•ã€‚
super().add(m) è°ƒç”¨çˆ¶ç±»æ–¹æ³• def add(self, m) æ—¶, æ­¤æ—¶çˆ¶ç±»ä¸­ self å¹¶ä¸æ˜¯çˆ¶ç±»çš„å®ä¾‹è€Œæ˜¯å­ç±»çš„å®ä¾‹, æ‰€ä»¥ b.add(2) ä¹‹åçš„ç»“æœæ˜¯ 5 è€Œä¸æ˜¯ 4 ã€‚</code></pre><p>ä¸çŸ¥é“è¿™ä¸ªç»“æœæ˜¯å¦å’Œä½ æƒ³åˆ°ä¸€æ ·å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå¤šç»§æ‰¿çš„ä¾‹å­ã€‚</p>
<h3 id="å¤šç»§æ‰¿"><a href="#å¤šç»§æ‰¿" class="headerlink" title="å¤šç»§æ‰¿"></a>å¤šç»§æ‰¿</h3><p>è¿™æ¬¡æˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ª class Cï¼Œä¸€ä¸ª class D:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.n = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, m)</span>:</span></span><br><span class="line">        print(<span class="string">'self is &#123;0&#125; @C.add'</span>.format(self))</span><br><span class="line">        super().add(m)</span><br><span class="line">        self.n += <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(B, C)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.n = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, m)</span>:</span></span><br><span class="line">        print(<span class="string">'self is &#123;0&#125; @D.add'</span>.format(self))</span><br><span class="line">        super().add(m)</span><br><span class="line">        self.n += <span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢çš„ä»£ç åˆè¾“å‡ºå•¥å‘¢ï¼Ÿ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d = D()</span><br><span class="line">d.add(<span class="number">2</span>)</span><br><span class="line">print(d.n)</span><br></pre></td></tr></table></figure>
<p>è¿™æ¬¡çš„è¾“å‡ºå¦‚ä¸‹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self <span class="keyword">is</span> &lt;__main__.D object at <span class="number">0x10ce10e48</span>&gt; @D.add</span><br><span class="line">self <span class="keyword">is</span> &lt;__main__.D object at <span class="number">0x10ce10e48</span>&gt; @B.add</span><br><span class="line">self <span class="keyword">is</span> &lt;__main__.D object at <span class="number">0x10ce10e48</span>&gt; @C.add</span><br><span class="line">self <span class="keyword">is</span> &lt;__main__.D object at <span class="number">0x10ce10e48</span>&gt; @A.add</span><br><span class="line"><span class="number">19</span></span><br></pre></td></tr></table></figure>
<p>ä½ è¯´å¯¹äº†å—ï¼Ÿä½ å¯èƒ½ä¼šè®¤ä¸ºä¸Šé¢ä»£ç çš„è¾“å‡ºç±»ä¼¼: </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self <span class="keyword">is</span> &lt;__main__.D object at <span class="number">0x10ce10e48</span>&gt; @D.add</span><br><span class="line">self <span class="keyword">is</span> &lt;__main__.D object at <span class="number">0x10ce10e48</span>&gt; @B.add</span><br><span class="line">self <span class="keyword">is</span> &lt;__main__.D object at <span class="number">0x10ce10e48</span>&gt; @A.add</span><br><span class="line"><span class="number">15</span></span><br></pre></td></tr></table></figure>
<p>ä¸ºä»€ä¹ˆä¼šè·Ÿé¢„æœŸçš„ä¸ä¸€æ ·å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬å°†ä¸€èµ·æ¥çœ‹çœ‹ super çš„å¥¥ç§˜ã€‚</p>
<h3 id="super-æ˜¯ä¸ªç±»"><a href="#super-æ˜¯ä¸ªç±»" class="headerlink" title="super æ˜¯ä¸ªç±»"></a>super æ˜¯ä¸ªç±»</h3><p>å½“æˆ‘ä»¬è°ƒç”¨ super() çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯å®ä¾‹åŒ–äº†ä¸€ä¸ª super ç±»ã€‚ä½ æ²¡çœ‹é”™ï¼Œ super æ˜¯ä¸ªç±»ï¼Œæ—¢ä¸æ˜¯å…³é”®å­—ä¹Ÿä¸æ˜¯å‡½æ•°ç­‰å…¶ä»–æ•°æ®ç»“æ„:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span> <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = super(A)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(s)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">super</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ super åŒ…å«äº†ä¸¤ä¸ªéå¸¸é‡è¦çš„ä¿¡æ¯: ä¸€ä¸ª MRO ä»¥åŠ MRO ä¸­çš„ä¸€ä¸ªç±»ã€‚å½“ä»¥å¦‚ä¸‹æ–¹å¼è°ƒç”¨ super æ—¶: </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">super(a_type, obj)</span><br></pre></td></tr></table></figure>
<p>MRO æŒ‡çš„æ˜¯ type(obj) çš„ MRO, MRO ä¸­çš„é‚£ä¸ªç±»å°±æ˜¯ a_type , åŒæ—¶ isinstance(obj, a_type) == True ã€‚<br>å½“è¿™æ ·è°ƒç”¨æ—¶: </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">super(type1, type2)</span><br></pre></td></tr></table></figure>
<p>MRO æŒ‡çš„æ˜¯ type2 çš„ MRO, MRO ä¸­çš„é‚£ä¸ªç±»å°±æ˜¯ type1 ï¼ŒåŒæ—¶ issubclass(type2, type1) == True ã€‚<br>é‚£ä¹ˆï¼Œ super() å®é™…ä¸Šåšäº†å•¥å‘¢ï¼Ÿç®€å•æ¥è¯´å°±æ˜¯ï¼šæä¾›ä¸€ä¸ª MRO ä»¥åŠä¸€ä¸ª MRO ä¸­çš„ç±» C ï¼Œ super() å°†è¿”å›ä¸€ä¸ªä» MRO ä¸­ C ä¹‹åçš„ç±»ä¸­æŸ¥æ‰¾æ–¹æ³•çš„å¯¹è±¡ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸ¥æ‰¾æ–¹å¼æ—¶ä¸æ˜¯åƒå¸¸è§„æ–¹æ³•ä¸€æ ·ä»æ‰€æœ‰çš„ MRO ç±»ä¸­æŸ¥æ‰¾ï¼Œè€Œæ˜¯ä» MRO çš„ tail ä¸­æŸ¥æ‰¾ã€‚<br>ä¸¾ä¸ªæ —å­, æœ‰ä¸ª MRO: </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[A, B, C, D, E, object]</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢çš„è°ƒç”¨: </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">super(C, A).foo()</span><br></pre></td></tr></table></figure>
<p>super åªä¼šä» C ä¹‹åæŸ¥æ‰¾ï¼Œå³: åªä¼šåœ¨ D æˆ– E æˆ– object ä¸­æŸ¥æ‰¾ foo æ–¹æ³•ã€‚</p>
<h3 id="å¤šç»§æ‰¿ä¸­-super-çš„å·¥ä½œæ–¹å¼"><a href="#å¤šç»§æ‰¿ä¸­-super-çš„å·¥ä½œæ–¹å¼" class="headerlink" title="å¤šç»§æ‰¿ä¸­ super çš„å·¥ä½œæ–¹å¼"></a>å¤šç»§æ‰¿ä¸­ super çš„å·¥ä½œæ–¹å¼</h3><p>å†å›åˆ°å‰é¢çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d = D()</span><br><span class="line">d.add(<span class="number">2</span>)</span><br><span class="line">print(d.n)</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ä½ å¯èƒ½å·²ç»æœ‰ç‚¹çœ‰ç›®ï¼Œä¸ºä»€ä¹ˆè¾“å‡ºä¼šæ˜¯ :</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self <span class="keyword">is</span> &lt;__main__.D object at <span class="number">0x10ce10e48</span>&gt; @D.add</span><br><span class="line">self <span class="keyword">is</span> &lt;__main__.D object at <span class="number">0x10ce10e48</span>&gt; @B.add</span><br><span class="line">self <span class="keyword">is</span> &lt;__main__.D object at <span class="number">0x10ce10e48</span>&gt; @C.add</span><br><span class="line">self <span class="keyword">is</span> &lt;__main__.D object at <span class="number">0x10ce10e48</span>&gt; @A.add</span><br><span class="line"><span class="number">19</span></span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æˆ‘ä»¬æ¥å…·ä½“åˆ†æä¸€ä¸‹:</p>
<pre><code>D çš„ MRO æ˜¯: [D, B, C, A, object] ã€‚ å¤‡æ³¨: å¯ä»¥é€šè¿‡ D.mro() (Python 2 ä½¿ç”¨ D.__mro__ ) æ¥æŸ¥çœ‹ D çš„ MRO ä¿¡æ¯ï¼‰
è¯¦ç»†çš„ä»£ç åˆ†æå¦‚ä¸‹:</code></pre><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.n = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, m)</span>:</span></span><br><span class="line">        <span class="comment"># ç¬¬å››æ­¥</span></span><br><span class="line">        <span class="comment"># æ¥è‡ª D.add ä¸­çš„ super</span></span><br><span class="line">        <span class="comment"># self == d, self.n == d.n == 5</span></span><br><span class="line">        print(<span class="string">'self is &#123;0&#125; @A.add'</span>.format(self))</span><br><span class="line">        self.n += m</span><br><span class="line">        <span class="comment"># d.n == 7</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.n = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, m)</span>:</span></span><br><span class="line">        <span class="comment"># ç¬¬äºŒæ­¥</span></span><br><span class="line">        <span class="comment"># æ¥è‡ª D.add ä¸­çš„ super</span></span><br><span class="line">        <span class="comment"># self == d, self.n == d.n == 5</span></span><br><span class="line">        print(<span class="string">'self is &#123;0&#125; @B.add'</span>.format(self))</span><br><span class="line">        <span class="comment"># ç­‰ä»·äº suepr(B, self).add(m)</span></span><br><span class="line">        <span class="comment"># self çš„ MRO æ˜¯ [D, B, C, A, object]</span></span><br><span class="line">        <span class="comment"># ä» B ä¹‹åçš„ [C, A, object] ä¸­æŸ¥æ‰¾ add æ–¹æ³•</span></span><br><span class="line">        super().add(m)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç¬¬å…­æ­¥</span></span><br><span class="line">        <span class="comment"># d.n = 11</span></span><br><span class="line">        self.n += <span class="number">3</span></span><br><span class="line">        <span class="comment"># d.n = 14</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.n = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, m)</span>:</span></span><br><span class="line">        <span class="comment"># ç¬¬ä¸‰æ­¥</span></span><br><span class="line">        <span class="comment"># æ¥è‡ª B.add ä¸­çš„ super</span></span><br><span class="line">        <span class="comment"># self == d, self.n == d.n == 5</span></span><br><span class="line">        print(<span class="string">'self is &#123;0&#125; @C.add'</span>.format(self))</span><br><span class="line">        <span class="comment"># ç­‰ä»·äº suepr(C, self).add(m)</span></span><br><span class="line">        <span class="comment"># self çš„ MRO æ˜¯ [D, B, C, A, object]</span></span><br><span class="line">        <span class="comment"># ä» C ä¹‹åçš„ [A, object] ä¸­æŸ¥æ‰¾ add æ–¹æ³•</span></span><br><span class="line">        super().add(m)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç¬¬äº”æ­¥</span></span><br><span class="line">        <span class="comment"># d.n = 7</span></span><br><span class="line">        self.n += <span class="number">4</span></span><br><span class="line">        <span class="comment"># d.n = 11</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(B, C)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.n = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, m)</span>:</span></span><br><span class="line">        <span class="comment"># ç¬¬ä¸€æ­¥</span></span><br><span class="line">        print(<span class="string">'self is &#123;0&#125; @D.add'</span>.format(self))</span><br><span class="line">        <span class="comment"># ç­‰ä»·äº super(D, self).add(m)</span></span><br><span class="line">        <span class="comment"># self çš„ MRO æ˜¯ [D, B, C, A, object]</span></span><br><span class="line">        <span class="comment"># ä» D ä¹‹åçš„ [B, C, A, object] ä¸­æŸ¥æ‰¾ add æ–¹æ³•</span></span><br><span class="line">        super().add(m)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç¬¬ä¸ƒæ­¥</span></span><br><span class="line">        <span class="comment"># d.n = 14</span></span><br><span class="line">        self.n += <span class="number">5</span></span><br><span class="line">        <span class="comment"># self.n = 19</span></span><br><span class="line"></span><br><span class="line">d = D()</span><br><span class="line">d.add(<span class="number">2</span>)</span><br><span class="line">print(d.n)</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨è¿‡ç¨‹å›¾å¦‚ä¸‹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">D.mro() == [D, B, C, A, object]</span><br><span class="line">d = D()</span><br><span class="line">d.n == <span class="number">5</span></span><br><span class="line">d.add(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(B, C)</span>:</span>          <span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span>            <span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(A)</span>:</span>             <span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, m)</span>:</span>       <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, m)</span>:</span>      <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, m)</span>:</span>       <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, m)</span>:</span></span><br><span class="line">        super().add(m)  1.---&gt;  super().add(m) 2.---&gt;  super().add(m)  3.---&gt;  self.n += m</span><br><span class="line">        self.n += <span class="number">5</span>   &lt;-----<span class="number">-6.</span> self.n += <span class="number">3</span>    &lt;---<span class="number">-5.</span> self.n += <span class="number">4</span>     &lt;---<span class="number">-4.</span> &lt;--|</span><br><span class="line">        (<span class="number">14</span>+<span class="number">5</span>=<span class="number">19</span>)               (<span class="number">11</span>+<span class="number">3</span>=<span class="number">14</span>)              (<span class="number">7</span>+<span class="number">4</span>=<span class="number">11</span>)                (<span class="number">5</span>+<span class="number">2</span>=<span class="number">7</span>)</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ä½ çŸ¥é“ä¸ºä»€ä¹ˆ d.add(2) å d.n çš„å€¼æ˜¯ 19 äº†å§ ;)</p>
<h3 id="è½¬è½½"><a href="#è½¬è½½" class="headerlink" title="è½¬è½½"></a>è½¬è½½</h3><p><a href="https://segmentfault.com/a/1190000008150517" target="_blank" rel="noopener">super æ²¡é‚£ä¹ˆç®€å•</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Python --- ä½¿ç”¨geventå®ç°å¹¶å‘è¯·æ±‚ç½‘ç»œé“¾æ¥</title>
    <url>/2020/05/23/%E4%BD%BF%E7%94%A8gevent%E5%AE%9E%E7%8E%B0%E5%B9%B6%E5%8F%91%E8%AF%B7%E6%B1%82%E7%BD%91%E7%BB%9C%E9%93%BE%E6%8E%A5/</url>
    <content><![CDATA[<h4 id="æ­£å¸¸è®¿é—®"><a href="#æ­£å¸¸è®¿é—®" class="headerlink" title="æ­£å¸¸è®¿é—®"></a>æ­£å¸¸è®¿é—®</h4><p>è€—æ—¶:<code>&gt;&gt;&gt;total_time = 61.8569815158844</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_urls</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">               <span class="string">'https://www.baidu.com'</span>,</span><br><span class="line">               <span class="string">'https://www.zhihu.com'</span>,</span><br><span class="line">               <span class="string">'http://moonmonsters.pythonanywhere.com'</span>,</span><br><span class="line">               <span class="string">'http://sina.com'</span>,</span><br><span class="line">               <span class="string">'https://www.missshi.cn/api/view/blog/5a98e4fe5b925d0aae000005'</span></span><br><span class="line">           ] * <span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_request_url</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> requests.get(url).content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> _urls():</span><br><span class="line">        _request_url(url)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'&gt;&gt;&gt;total_time = '</span> + str(time.time() - start))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="å¹¶å‘è®¿é—®"><a href="#å¹¶å‘è®¿é—®" class="headerlink" title="å¹¶å‘è®¿é—®"></a>å¹¶å‘è®¿é—®</h3><p>è€—æ—¶:<code>&gt;&gt;&gt;total_time = 29.00442862510681</code></p>
<p>å¯¹äºgeventè€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä¸ªä»»åŠ¡åˆ—è¡¨ã€‚</p>
<p>ä»»åŠ¡åˆ—è¡¨ä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªgevent.spawn()å¯¹è±¡ã€‚</p>
<p>å…¶ä¸­ï¼Œgevent.spawn()å‡½æ•°å¯ä»¥æ¥æ”¶ä¸€è‡³å¤šä¸ªå‚æ•°ã€‚</p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä»»åŠ¡éœ€è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œåç»­çš„å‚æ•°ä¸ºå‡½æ•°å¯¹åº”çš„è¾“å…¥å‚æ•°ã€‚</p>
<p>æœ€ç»ˆï¼Œå½“æˆ‘ä»¬å¾—åˆ°å®Œæˆçš„ä»»åŠ¡åˆ—è¡¨åï¼Œå¯ä»¥è°ƒç”¨gevent.joinall()æ¥æ‰§è¡Œè¯¥åˆ—è¡¨ä¸­çš„ä»»åŠ¡ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æˆ‘ä»¬å¼•å…¥çŒ´å­è¡¥ä¸åï¼Œä¼šå¯¹å·²ç»ä»¥åçš„æ–¹æ³•è¿›è¡Œæ”¹å†™ã€‚</p>
<p>å› æ­¤ï¼Œä¸å»ºè®®åœ¨å…¨å±€èŒƒå›´å†…å¼•å…¥çŒ´å­è¡¥ä¸ï¼Œæœ€å¥½æ˜¯åœ¨å“ªéƒ¨åˆ†ä¸ºå¹¶å‘æ‰§è¡Œå‡½æ•°ï¼Œåˆ™åœ¨å“ªéƒ¨åˆ†å¼•å…¥çŒ´å­è¡¥ä¸ã€‚</p>
<p>åœ¨å¼•å…¥çŒ´å­è¡¥ä¸åï¼Œå½“è¿è¡Œåˆ°ç½‘ç»œè¯·æ±‚æ—¶ï¼Œåˆ™ä¼šåˆ‡æ¢è‡³å…¶ä»–ä»»åŠ¡ç»§ç»­æ‰§è¡Œï¼Œè€Œä¸æ˜¯åœ¨å½“å‰ä»»åŠ¡ä¸­ç»§ç»­ç­‰å¾…ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_urls</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">               <span class="string">'https://www.baidu.com'</span>,</span><br><span class="line">               <span class="string">'https://www.zhihu.com'</span>,</span><br><span class="line">               <span class="string">'http://moonmonsters.pythonanywhere.com'</span>,</span><br><span class="line">               <span class="string">'http://sina.com'</span>,</span><br><span class="line">               <span class="string">'https://www.missshi.cn/api/view/blog/5a98e4fe5b925d0aae000005'</span></span><br><span class="line">           ] * <span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_request_url</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="comment"># çŒ´å­è¡¥ä¸</span></span><br><span class="line">    <span class="keyword">from</span> gevent <span class="keyword">import</span> monkey</span><br><span class="line">    monkey.patch_socket()</span><br><span class="line">    <span class="keyword">return</span> requests.get(url).content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    task_list = []</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> _urls():</span><br><span class="line">        task_list.append(gevent.spawn(_request_url, url))</span><br><span class="line"></span><br><span class="line">    gevent.joinall(task_list)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'&gt;&gt;&gt;total_time = '</span> + str(time.time() - start))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Django --- è®¾ç½®ç¼“å­˜çš„å‡ ç§æ–¹å¼</title>
    <url>/2020/05/23/django-%E8%AE%BE%E7%BD%AE%E7%BC%93%E5%AD%98%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<h3 id="ç¼“å­˜ç±»å‹"><a href="#ç¼“å­˜ç±»å‹" class="headerlink" title="ç¼“å­˜ç±»å‹"></a>ç¼“å­˜ç±»å‹</h3><h4 id="memcached"><a href="#memcached" class="headerlink" title="memcached"></a>memcached</h4><p><code>Memcached</code> æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„åˆ†å¸ƒå¼å†…å­˜å¯¹è±¡ç¼“å­˜ç³»ç»Ÿã€‚pythonä½¿ç”¨å®ƒéœ€è¦å®‰è£… <code>python-memcached</code> ä¾èµ–ã€‚ å¹¶ä¸”æ”¯æŒåˆ†å¸ƒå¼ç¼“å­˜æœåŠ¡å™¨:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.MemcachedCache'</span>,</span><br><span class="line">        <span class="string">'LOCATION'</span>: [</span><br><span class="line">            <span class="string">'172.19.26.xxx:11211'</span>,</span><br><span class="line">            <span class="string">'172.19.26.xxx:11211'</span>,</span><br><span class="line">            <span class="string">'172.19.26.xxx:11213'</span>,</span><br><span class="line">        ]</span><br><span class="line">        <span class="comment"># 'LOCATION': '127.0.0.1:11211', # å¦‚æœåªæœ‰å•å°</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>memchacheçš„ç¼“å­˜å®Œå…¨æ˜¯åœ¨å†…å­˜ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯ï¼ŒæœåŠ¡å™¨ä¸€æ—¦å´©æºƒæˆ–é‡å¯ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¸å¤å­˜åœ¨ï¼Œå› æ­¤ï¼Œå†³ä¸èƒ½å°†ç¼“å­˜ä½œä¸ºå”¯ä¸€çš„æ•°æ®å­˜å‚¨æ–¹å¼ã€‚</p>
<a id="more"></a>

<h4 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h4><p>redisä¹Ÿæ˜¯å†…å­˜å‹ç¼“å­˜ï¼Œä½†ç›¸æ¯”memcachedï¼Œå¤šäº†æŒä¹…åŒ–çš„åŠŸèƒ½ï¼Œæ›´æ¨èä½¿ç”¨è¿™ä¸ªã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">"default"</span>: &#123;</span><br><span class="line">        <span class="string">"BACKEND"</span>: <span class="string">"django_redis.cache.RedisCache"</span>,</span><br><span class="line">        <span class="comment"># "LOCATION": "redis://:xxx@192.168.0.7:6379/3",</span></span><br><span class="line">        <span class="string">"LOCATION"</span>: <span class="string">"redis://127.0.0.1:6379/3"</span>,</span><br><span class="line">        <span class="string">"OPTIONS"</span>: &#123;</span><br><span class="line">            <span class="string">"CLIENT_CLASS"</span>: <span class="string">"django_redis.client.DefaultClient"</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h4><p>è¿™ç§ç¼“å­˜æ–¹å¼å°±ä¸æ€•æ–­ç”µä¸¢å¤±æ•°æ®äº†ï¼Œå»ºè¡¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python manage.py createcachetable [cache_table_name]</span><br></pre></td></tr></table></figure>
<p>è¡¨åä¸è¦å’Œå…¶ä»–å†²çªå°±è¡Œäº†ï¼Œæ²¡ä»€ä¹ˆéœ€è¦æ³¨æ„çš„äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.db.DatabaseCache'</span>,</span><br><span class="line">        <span class="string">'LOCATION'</span>: <span class="string">'my_cache_table'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h4><p>æ–‡ä»¶è·¯å¾„éœ€ç”¨ ç»å¯¹è·¯å¾„ï¼Œå¹¶ä¸”è®°å¾—èµ‹äºˆè¯»å†™æƒé™ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.filebased.FileBasedCache'</span>,</span><br><span class="line">        <span class="string">'LOCATION'</span>: <span class="string">'/var/tmp/django_cache'</span>,</span><br><span class="line">        <span class="comment">#'LOCATION': 'c:/foo/bar',#windowsä¸‹çš„ç¤ºä¾‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æœ¬åœ°å†…å­˜"><a href="#æœ¬åœ°å†…å­˜" class="headerlink" title="æœ¬åœ°å†…å­˜"></a>æœ¬åœ°å†…å­˜</h4><p>å¦‚æœæœ‰å†…å­˜æœ‰ç‚¹ï¼Œä½†æ²¡èƒ½åŠ›è¿è¡Œmemcacheï¼Œå°±å¯ä»¥è€ƒè™‘é‡‡ç”¨æœ¬åœ°å†…å­˜ç¼“å­˜ï¼Œè¿™ä¸ªç¼“å­˜æ˜¯å¤šè¿›ç¨‹å’Œçº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.locmem.LocMemCache'</span>,</span><br><span class="line">        <span class="string">'LOCATION'</span>: <span class="string">'unique-snowflake'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼“å­˜LOCATIONç”¨æ¥åŒºåˆ†æ¯ä¸ªå†…å­˜å­˜å‚¨ï¼Œå¦‚æœä½ åªæœ‰ä¸€ä¸ªæœ¬åœ°å†…å­˜ç¼“å­˜ï¼Œä½ å¯ä»¥å¿½ç•¥è¿™ä¸ªè®¾ç½®ï¼›ä½†å¦‚æœä½ æœ‰å¤šä¸ªçš„æ—¶å€™ï¼Œä½ éœ€è¦è‡³å°‘ç»™ä»–ä»¬ä¸­ä¸€ä¸ªèµ‹äºˆåå­—ä»¥åŒºåˆ†ä»–ä»¬ã€‚</p>
<p>æ³¨æ„æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰å®ƒä»¬è‡ªå·±çš„ç§æœ‰ç¼“å­˜å®ä¾‹ï¼Œæ‰€ä»¥è·¨è¿›ç¨‹ç¼“å­˜æ˜¯ä¸å¯èƒ½çš„ï¼Œå› æ­¤ï¼Œæœ¬åœ°å†…å­˜ç¼“å­˜ä¸æ˜¯ç‰¹åˆ«æœ‰æ•ˆç‡çš„ï¼Œå»ºè®®ä½ åªæ˜¯åœ¨å†…éƒ¨å¼€å‘æµ‹æ—¶ä½¿ç”¨ï¼Œä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p>
<h4 id="è™šæ‹Ÿç¼“å­˜"><a href="#è™šæ‹Ÿç¼“å­˜" class="headerlink" title="è™šæ‹Ÿç¼“å­˜"></a>è™šæ‹Ÿç¼“å­˜</h4><p>ä¸æ˜¯çœŸå®çš„ç¼“å­˜ï¼Œåªæ˜¯å®ç°äº†ç¼“å­˜çš„æ¥å£è€Œå·²ã€‚å½“å¦‚æœä½ éœ€è¦åœ¨å¼€å‘å’Œæµ‹è¯•ä¸­ä¸æƒ³ä½¿ç”¨ç¼“å­˜ï¼Œä½†ä¸æƒ³ä¿®æ”¹ç¼“å­˜ç›¸å…³çš„ä»£ç ï¼Œè¿™ç§æƒ…å†µå°±å¯ä»¥ä½¿ç”¨è™šæ‹Ÿç¼“å­˜äº†ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.dummy.DummyCache'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å…¶ä»–è®¾ç½®"><a href="#å…¶ä»–è®¾ç½®" class="headerlink" title="å…¶ä»–è®¾ç½®"></a>å…¶ä»–è®¾ç½®</h3><p>æœ‰äº›ç¼“å­˜è¡Œä¸ºéœ€è¦é¢å¤–çš„å‚æ•°æ¥æ§åˆ¶ï¼š</p>
<pre><code>TIMEOUT:ç¼“å­˜çš„é»˜è®¤è¿‡æœŸæ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œ è¿™ä¸ªå‚æ•°é»˜è®¤æ˜¯ 300 seconds (5 åˆ†é’Ÿ).
OPTIONS: è¿™ä¸ªå‚æ•°åº”è¯¥è¢«ä¼ åˆ°ç¼“å­˜åç«¯ã€‚æœ‰æ•ˆçš„å¯é€‰é¡¹åˆ—è¡¨æ ¹æ®ç¼“å­˜çš„åç«¯ä¸åŒè€Œä¸åŒï¼Œç”±ç¬¬ä¸‰æ–¹åº“æ‰€æ”¯æŒçš„ç¼“å­˜å°†ä¼šæŠŠè¿™äº›é€‰é¡¹ç›´æ¥é…ç½®åˆ°åº•å±‚çš„ç¼“å­˜åº“ã€‚
    MAX_ENTRIES:é«˜é€Ÿç¼“å­˜å…è®¸çš„æœ€å¤§æ¡ç›®æ•°ï¼Œè¶…å‡ºè¿™ä¸ªæ•°åˆ™æ—§å€¼å°†è¢«åˆ é™¤. è¿™ä¸ªå‚æ•°é»˜è®¤æ˜¯300.
    CULL_FREQUENCY:å½“è¾¾åˆ°MAX_ENTRIES çš„æ—¶å€™,è¢«åˆ é™¤çš„æ¡ç›®æ¯”ç‡ã€‚ å®é™…æ¯”ç‡æ˜¯ 1 / CULL_FREQUENCY, æ‰€ä»¥è®¾ç½®CULL_FREQUENCY ä¸º2ä¼šåœ¨è¾¾åˆ°MAX_ENTRIES æ‰€è®¾ç½®å€¼æ—¶åˆ å»ä¸€åŠçš„ç¼“å­˜ã€‚è¿™ä¸ªå‚æ•°åº”è¯¥æ˜¯æ•´æ•°ï¼Œé»˜è®¤ä¸º 3ã€‚ æŠŠ CULL_FREQUENCYçš„å€¼è®¾ç½®ä¸º 0 æ„å‘³ç€å½“è¾¾åˆ°MAX_ENTRIESæ—¶,ç¼“å­˜å°†è¢«æ¸…ç©ºã€‚
KEY_PREFIXï¼šå°†è‡ªåŠ¨åŒ…å«ï¼ˆé»˜è®¤æƒ…å†µä¸‹é¢„ç½®ä¸ºï¼‰DjangoæœåŠ¡å™¨ä½¿ç”¨çš„æ‰€æœ‰ç¼“å­˜é”®çš„å­—ç¬¦ä¸²ã€‚
VERSIONï¼šç”±DjangoæœåŠ¡å™¨ç”Ÿæˆçš„ç¼“å­˜é”®çš„é»˜è®¤ç‰ˆæœ¬å·ã€‚
KEY_FUNCTIONåŒ…å«å‡½æ•°çš„è™šçº¿è·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œå®šä¹‰å¦‚ä½•å°†å‰ç¼€ï¼Œç‰ˆæœ¬å’Œé”®ç»„æˆæœ€ç»ˆç¼“å­˜é”®ã€‚</code></pre><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.filebased.FileBasedCache'</span>,</span><br><span class="line">        <span class="string">'LOCATION'</span>: <span class="string">'/var/tmp/django_cache'</span>,</span><br><span class="line">        <span class="string">'TIMEOUT'</span>: <span class="number">60</span>,</span><br><span class="line">        <span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">            <span class="string">'MAX_ENTRIES'</span>: <span class="number">1000</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://hongweipeng.com/index.php/archives/1163/" target="_blank" rel="noopener">ç¼“å­˜æ¶æ„</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
      </tags>
  </entry>
  <entry>
    <title>Bug --- å¤šæ•°æ®åº“ä½¿ç”¨å¤–é”®é”™è¯¯</title>
    <url>/2020/05/23/django-%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BD%BF%E7%94%A8%E5%A4%96%E9%94%AE%E9%94%99%E8%AF%AF/</url>
    <content><![CDATA[<h3 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h3><p>åœ¨é¡¹ç›®ä¸­ï¼ŒAæ•°æ®åº“ä¸­çš„æŸå¼ è¡¨ï¼Œæƒ³è¦å…³è”ä¸ŠBæ•°æ®åº“çš„Userè¡¨ï¼Œåœ¨ä½¿ç”¨<code>makemigrations</code>å’Œ<code>migrate</code>å‘½ä»¤æ—¶éƒ½æ˜¯æ­£å¸¸çš„ï¼Œæ•°æ®è¡¨ä¹Ÿå¯åˆ›å»ºï¼Œä½†åœ¨æ’å…¥æ•°æ®ï¼Œå…³è”Userå¯¹è±¡æ—¶ï¼ŒæŠ¥äº†é”™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Unable to save with save_model using database router</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="å‡ºé”™åŸå› "><a href="#å‡ºé”™åŸå› " class="headerlink" title="å‡ºé”™åŸå› "></a>å‡ºé”™åŸå› </h3><p>åœ¨stackoverflowä¸Šæ‰¾åˆ°äº†åŒæ ·çš„bugï¼Œè§£é‡Šå¦‚ä¸‹ï¼š</p>
<p>The problem you are encountering arises from the difficulty of storing relations between objects that are stored in two distinct databases. In your example, you stated that you have created one database to store all Django contributed objects, which includes User objects created by the auth app. Meanwhile, the second modelâ€™s objects will be stored in a distinct and entirely separate database. When you attempt to create a relationship between the new object stored in one database and the User object, you are attempting cross-database relations.</p>
<p>Cross-database relations are a difficult problem which has not been solved yet when using multiple databases in Django. If you would like more information about this issue, the Django documentation has a brief note about this problem (copied below for clarity).</p>
<blockquote>
</blockquote>
<pre><code>Django doesnâ€™t currently provide any support for foreign key or many-to-many relationships spanning multiple databases. If you have used a router to partition models to different databases, any foreign key and many-to-many relationships defined by those models must be internal to a single database.

This is because of referential integrity. In order to maintain a relationship between two objects, Django needs to know that the primary key of the related object is valid. If the primary key is stored on a separate database, itâ€™s not possible to easily evaluate the validity of a primary key.

If youâ€™re using Postgres, Oracle, or MySQL with InnoDB, this is enforced at the database integrity level â€“ database level key constraints prevent the creation of relations that canâ€™t be validated.

However, if youâ€™re using SQLite or MySQL with MyISAM tables, there is no enforced referential integrity; as a result, you may be able to â€˜fakeâ€™ cross database foreign keys. However, this configuration is not officially supported by Django.</code></pre><p>â€‹<br>ä¸æƒ³ç¿»è¯‘ï¼Œçœ‹çš„æ‡‚å°±è¡Œï¼Œæ€»ç»“ä¸€å¥è¯å°±æ˜¯ï¼Œdjangoæ²¡æœ‰å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>â€¦é‚£ä¹ˆå°±ä¸ä½¿ç”¨å¤–é”®å…³è”äº†ï¼Œç›´æ¥åœ¨Aæ•°æ®åº“çš„è¡¨ä¸­å­˜å…¥ä¸€ä¸ªå­—æ®µåä¸º<code>user_id</code>çš„intç±»å‹æ•°æ®å³å¯ï¼Œè™½ç„¶ä¹‹åçš„æ“ä½œä¼šç¨å¾®ç»•ä¸€ä¸‹ï¼Œä½†å¹¶ä¸ä¼šå½±å“åŠŸèƒ½çš„å®ç°ã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://stackoverflow.com/questions/26579231/unable-to-save-with-save-model-using-database-router" target="_blank" rel="noopener">unable-to-save-with-save-model-using-database-router</a></p>
]]></content>
      <categories>
        <category>Bug</category>
      </categories>
      <tags>
        <tag>django</tag>
      </tags>
  </entry>
  <entry>
    <title>Django-rest-framework --- ListSerializerçš„ä½¿ç”¨åŠæºç åˆ†æ</title>
    <url>/2020/05/23/django-rest-framework-ListSerializer%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8F%8A%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h3 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h3><p>æƒ³æ ¹æ®ä¸åŒçš„æƒ…å†µï¼Œä¾‹å¦‚ç™»å½•ç”¨æˆ·çš„èº«ä»½ï¼Œæƒé™ç­‰ï¼Œå¯æ·»åŠ æˆ–åˆ é™¤è¿”å›çš„æ•°æ®ä¸­çš„å­—æ®µã€‚</p>
<p>æœ€å¼€å§‹ä»¥ä¸ºåªéœ€è¦å®šä¹‰ä¸€ä¸ªåºåˆ—åŒ–ç±»ç„¶åé‡å†™dataæ–¹æ³•å³å¯ï¼Œä½†å‘ç°è¿”å›å¤šæ¡æ•°æ®æ—¶ï¼Œè¦åˆ é™¤çš„å­—æ®µä¸€ç›´å­˜åœ¨ã€‚ç¿»çœ‹äº†å®˜æ–¹æ–‡æ¡£ï¼Œç»“åˆæºç æ‰å‘ç°è¿˜éœ€è¦å…¶ä»–æ“ä½œã€‚</p>
<p>è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œç‰¹ç®€å• è®°å½•ä¸‹ã€‚</p>
<a id="more"></a>

<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><h4 id="åºåˆ—åŒ–ç±»"><a href="#åºåˆ—åŒ–ç±»" class="headerlink" title="åºåˆ—åŒ–ç±»"></a>åºåˆ—åŒ–ç±»</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> demo.models <span class="keyword">import</span> Student</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentListSerializer</span><span class="params">(serializers.ListSerializer)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Student</span><br><span class="line">        fields = <span class="string">'__all__'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, instance, validated_data)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">data</span><span class="params">(self)</span>:</span></span><br><span class="line">        _data = super(StudentListSerializer, self).data</span><br><span class="line">        <span class="comment"># åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">for</span> d <span class="keyword">in</span> _data:</span><br><span class="line">            d.pop(<span class="string">'id'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Student</span><br><span class="line">        <span class="comment"># é‡è¦</span></span><br><span class="line">        <span class="comment"># å½“åºåˆ—åŒ–æ“ä½œä¸ºmanyæ—¶ï¼Œè°ƒç”¨çš„åºåˆ—åŒ–ç±»</span></span><br><span class="line">        list_serializer_class = StudentListSerializer</span><br><span class="line">        fields = <span class="string">'__all__'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">data</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># å•æ¡æ•°æ®</span></span><br><span class="line">        _data = super(StudentSerializer, self).data</span><br><span class="line">        <span class="comment"># ç§»é™¤æ‰idå­—æ®µ</span></span><br><span class="line">        _data.pop(<span class="string">'id'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _data</span><br></pre></td></tr></table></figure>



<h4 id="è§†å›¾ç±»"><a href="#è§†å›¾ç±»" class="headerlink" title="è§†å›¾ç±»"></a>è§†å›¾ç±»</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> mixins</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> viewsets</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> pagination</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> demo.models <span class="keyword">import</span> Student</span><br><span class="line"><span class="keyword">from</span> demo.serializers <span class="keyword">import</span> StudentSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentView</span><span class="params">(mixins.ListModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                  viewsets.GenericViewSet)</span>:</span></span><br><span class="line">    serializer_class = StudentSerializer</span><br><span class="line">    queryset = Student.objects.all()</span><br><span class="line">    pagination_class = pagination.PageNumberPagination</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentDetailView</span><span class="params">(mixins.RetrieveModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">                        viewsets.GenericViewSet)</span>:</span></span><br><span class="line">    serializer_class = StudentSerializer</span><br><span class="line">    queryset = Student.objects.all()</span><br></pre></td></tr></table></figure>



<h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><h4 id="ListModelMixin"><a href="#ListModelMixin" class="headerlink" title="ListModelMixin"></a>ListModelMixin</h4><p>åœ¨è§†å›¾ä¸­ï¼Œä½¿ç”¨äº†mixinæ¨¡å¼ï¼Œç»§æ‰¿äº†<code>ListModelMixin</code>ç±»ï¼Œè¯¥ç±»ä¸‹ï¼Œåœ¨è¿”å›åºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œä¼šä¼ å…¥<code>many=True</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListModelMixin</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    List a queryset.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        queryset = self.filter_queryset(self.get_queryset())</span><br><span class="line"></span><br><span class="line">        page = self.paginate_queryset(queryset)</span><br><span class="line">        <span class="keyword">if</span> page <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># éœ€è¦è¿”å›ä¸€ç»„æ•°æ®ï¼Œéœ€è¦ä¼ å…¥many=Trueå‚æ•°</span></span><br><span class="line">            serializer = self.get_serializer(page, many=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> self.get_paginated_response(serializer.data)</span><br><span class="line"></span><br><span class="line">        serializer = self.get_serializer(queryset, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>



<h4 id="ger-serializer"><a href="#ger-serializer" class="headerlink" title="ger_serializer"></a>ger_serializer</h4><p>è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯è¿”å›åœ¨Viewä¸­å®šä¹‰çš„è§†å›¾ç±»å¯¹è±¡ï¼Œå¹¶ä¼ å…¥å‚æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">serializer_class = StudentSerializer</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_serializer</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">    serializer_class = self.get_serializer_class()</span><br><span class="line">    kwargs[<span class="string">'context'</span>] = self.get_serializer_context()</span><br><span class="line">    <span class="keyword">return</span> serializer_class(*args, **kwargs)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_serializer_class</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> self.serializer_class <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, (</span><br><span class="line">        <span class="string">"'%s' should either include a `serializer_class` attribute, "</span></span><br><span class="line">        <span class="string">"or override the `get_serializer_class()` method."</span></span><br><span class="line">        % self.__class__.__name__</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> self.serializer_class</span><br></pre></td></tr></table></figure>



<h4 id="data"><a href="#data" class="headerlink" title="data()"></a>data()</h4><p>åœ¨è¿”å›æ•°æ®æ—¶ï¼Œéƒ½æ˜¯ä½¿ç”¨åºåˆ—åŒ–å¯¹è±¡è°ƒç”¨dataæ–¹æ³•ï¼Œåƒ<code>serializer.data</code>ã€‚</p>
<p>æ‰€ä»¥è¦æƒ³æ·»åŠ æˆ–åˆ é™¤è¿”å›çš„æ•°æ®å­—æ®µæ—¶ï¼Œå°±éœ€è¦é‡å†™dataæ–¹æ³•äº†ã€‚</p>
<p><code>ModelSerializer</code>ç±»ä¸‹æ²¡æœ‰dataæ–¹æ³•;</p>
<p><code>ListSerializer</code>ä¸‹çš„dataæ–¹æ³•:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@property</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data</span><span class="params">(self)</span>:</span></span><br><span class="line">    ret = super(ListSerializer, self).data</span><br><span class="line">    <span class="keyword">return</span> ReturnList(ret, serializer=self)</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨çˆ¶ç±»<code>BaseSerializer</code>ä¸‹çš„dataæ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@property</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">data</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> hasattr(self, <span class="string">'initial_data'</span>) <span class="keyword">and</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_validated_data'</span>):</span><br><span class="line">        msg = (</span><br><span class="line">            <span class="string">'When a serializer is passed a `data` keyword argument you '</span></span><br><span class="line">            <span class="string">'must call `.is_valid()` before attempting to access the '</span></span><br><span class="line">            <span class="string">'serialized `.data` representation.\n'</span></span><br><span class="line">            <span class="string">'You should either call `.is_valid()` first, '</span></span><br><span class="line">            <span class="string">'or access `.initial_data` instead.'</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">raise</span> AssertionError(msg)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_data'</span>):</span><br><span class="line">        <span class="keyword">if</span> self.instance <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> getattr(self, <span class="string">'_errors'</span>, <span class="literal">None</span>):</span><br><span class="line">            self._data = self.to_representation(self.instance)</span><br><span class="line">        <span class="keyword">elif</span> hasattr(self, <span class="string">'_validated_data'</span>) <span class="keyword">and</span> <span class="keyword">not</span> getattr(self, <span class="string">'_errors'</span>, <span class="literal">None</span>):</span><br><span class="line">            self._data = self.to_representation(self.validated_data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._data = self.get_initial()</span><br><span class="line">    <span class="keyword">return</span> self._data</span><br></pre></td></tr></table></figure>



<h4 id="new"><a href="#new" class="headerlink" title="__new__"></a>__new__</h4><p>åœ¨åˆ›å»ºåºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œä¼šåˆ¤æ–­æ˜¯å¦ä¼ å…¥äº†<code>many</code>å‚æ•°ï¼Œå¦‚æœä¸ºTrueçš„è¯ï¼Œå°±ä¼šè°ƒç”¨<code>many_init</code>æ–¹æ³•ï¼Œæœ€ç»ˆæ‰§è¡Œçš„ä»£ç æ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ¤æ–­Serializerç±»ä¸­æ˜¯å¦å®šä¹‰äº†Metaç±»</span></span><br><span class="line">meta = getattr(cls, <span class="string">'Meta'</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="comment"># å¦‚æœMetaä¸­æ²¡æœ‰è®¾ç½®list_serializer_classå­—æ®µï¼Œé‚£ä¹ˆå°±é»˜è®¤ä½¿ç”¨ListSerializeråºåˆ—åŒ–ç±»</span></span><br><span class="line">list_serializer_class = getattr(meta, <span class="string">'list_serializer_class'</span>, ListSerializer)</span><br></pre></td></tr></table></figure>

<p>å†å›åˆ°<code>StudentListSerializer</code>ä¸­ï¼Œå¦‚æœè¦æƒ³é‡å†™<code>data</code>æ–¹æ³•ç”Ÿæ•ˆï¼Œé‚£ä¹ˆå°±éœ€è¦è®¾ç½®è¯¥å­—æ®µ äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">    model = Student</span><br><span class="line">    list_serializer_class = StudentListSerializer</span><br><span class="line">    fields = <span class="string">'__all__'</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> kwargs.pop(<span class="string">'many'</span>, <span class="literal">False</span>):</span><br><span class="line">        <span class="keyword">return</span> cls.many_init(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> super(BaseSerializer, cls).__new__(cls, *args, **kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">many_init</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">    allow_empty = kwargs.pop(<span class="string">'allow_empty'</span>, <span class="literal">None</span>)</span><br><span class="line">    child_serializer = cls(*args, **kwargs)</span><br><span class="line">    list_kwargs = &#123;</span><br><span class="line">        <span class="string">'child'</span>: child_serializer,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> allow_empty <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        list_kwargs[<span class="string">'allow_empty'</span>] = allow_empty</span><br><span class="line">    list_kwargs.update(&#123;</span><br><span class="line">        key: value <span class="keyword">for</span> key, value <span class="keyword">in</span> kwargs.items()</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> LIST_SERIALIZER_KWARGS</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment"># å¦‚æœåºåˆ—åŒ–å¯¹è±¡ä¸­æ²¡æœ‰è®¾ç½®list_serializer_classå±æ€§ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨é»˜è®¤çš„ListSerializeråºåˆ—åŒ–å™¨</span></span><br><span class="line">    meta = getattr(cls, <span class="string">'Meta'</span>, <span class="literal">None</span>)</span><br><span class="line">    list_serializer_class = getattr(meta, <span class="string">'list_serializer_class'</span>, ListSerializer)</span><br><span class="line">    <span class="keyword">return</span> list_serializer_class(*args, **list_kwargs)</span><br></pre></td></tr></table></figure>



<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://www.django-rest-framework.org/api-guide/serializers/#listserializer" target="_blank" rel="noopener">ListSerializer</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
        <tag>django-rest-framework</tag>
      </tags>
  </entry>
  <entry>
    <title>Django --- å¤šæ•°æ®åº“åŠåˆ†åº“å®ç°</title>
    <url>/2020/05/23/django-%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%8A%E5%88%86%E5%BA%93%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<p>åœ¨djangoé¡¹ç›®ä¸­, ä¸€ä¸ªå·¥ç¨‹ä¸­å­˜åœ¨å¤šä¸ªAPPåº”ç”¨å¾ˆå¸¸è§. æœ‰æ—¶å€™å¸Œæœ›ä¸åŒçš„APPè¿æ¥ä¸åŒçš„æ•°æ®åº“ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦å»ºç«‹å¤šä¸ªæ•°æ®åº“è¿æ¥ã€‚</p>
<h3 id="ä¿®æ”¹é¡¹ç›®çš„-settings-é…ç½®"><a href="#ä¿®æ”¹é¡¹ç›®çš„-settings-é…ç½®" class="headerlink" title="ä¿®æ”¹é¡¹ç›®çš„ settings é…ç½®"></a>ä¿®æ”¹é¡¹ç›®çš„ settings é…ç½®</h3><p>åœ¨settings.pyä¸­é…ç½®å¤šä¸ªæ•°æ®åº“ï¼Œç»™ä¸ªæ•°æ®åº“æœ‰è‡ªå·±çš„åŠŸèƒ½</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'customs'</span>,</span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'xx'</span>,</span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'xx'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'xx.xx.0.10'</span>,</span><br><span class="line">        <span class="string">'PORT'</span>: <span class="string">'3306'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'xxx'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'xxx'</span>,</span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,</span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'xxx'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'xx.xx.0.10'</span>,</span><br><span class="line">        <span class="string">'PORT'</span>: <span class="string">'3306'</span>,</span><br><span class="line">        <span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">            <span class="string">'init_command'</span>: <span class="string">'SET storage_engine=MyISAM'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="è®¾ç½®æ•°æ®åº“çš„è·¯ç”±è§„åˆ™æ–¹æ³•"><a href="#è®¾ç½®æ•°æ®åº“çš„è·¯ç”±è§„åˆ™æ–¹æ³•" class="headerlink" title="è®¾ç½®æ•°æ®åº“çš„è·¯ç”±è§„åˆ™æ–¹æ³•"></a>è®¾ç½®æ•°æ®åº“çš„è·¯ç”±è§„åˆ™æ–¹æ³•</h3><p>åœ¨ settings.py ä¸­é…ç½® DATABASE_ROUTERS</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ•°æ®åº“åˆ†åº“</span></span><br><span class="line"><span class="comment"># User, Group, HumanRoleä¸‰å¼ è¡¨ä½¿ç”¨xxxçš„æ•°æ®åº“ï¼Œå…¶ä»–çš„ä½¿ç”¨é»˜è®¤çš„</span></span><br><span class="line"><span class="comment"># DatabaseAppsRouteræ˜¯è·¯ç”±ç±»çš„è·¯å¾„</span></span><br><span class="line">DATABASE_ROUTERS = [<span class="string">'proutils.db_router.DatabaseAppsRouter'</span>]</span><br><span class="line"><span class="comment"># æ¯ä¸ªAPPè¦è¿æ¥å“ªä¸ªæ•°æ®åº“ï¼Œéœ€è¦åœ¨åšåŒ¹é…è®¾ç½®</span></span><br><span class="line"><span class="comment"># å¦‚æœæ²¡æœ‰é…ç½®çš„ï¼Œå°†ä½¿ç”¨defaultæ•°æ®åº“</span></span><br><span class="line">DATABASE_APPS_MAPPING = &#123;</span><br><span class="line">    <span class="string">'auth'</span>: <span class="string">'xxx'</span>,</span><br><span class="line">    <span class="string">'xxx_human'</span>: <span class="string">'xxx'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºæ•°æ®åº“è·¯ç”±è§„åˆ™"><a href="#åˆ›å»ºæ•°æ®åº“è·¯ç”±è§„åˆ™" class="headerlink" title="åˆ›å»ºæ•°æ®åº“è·¯ç”±è§„åˆ™"></a>åˆ›å»ºæ•°æ®åº“è·¯ç”±è§„åˆ™</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># __author__ = 'ChenTao'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line">DATABASE_MAPPING = settings.DATABASE_APPS_MAPPING</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DatabaseAppsRouter</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    æ•°æ®åº“åˆ†åº“è®¾ç½®</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    A router to control all database operations on models for different</span></span><br><span class="line"><span class="string">    databases.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    In case an app is not set in settings.DATABASE_APPS_MAPPING, the router</span></span><br><span class="line"><span class="string">    will fallback to the `default` database.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Settings example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    DATABASE_APPS_MAPPING = &#123;'app1': 'db1', 'app2': 'db2'&#125;</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">db_for_read</span><span class="params">(self, model, **hints)</span>:</span></span><br><span class="line">        <span class="string">""""Point all read operations to the specific database."""</span></span><br><span class="line">        <span class="keyword">if</span> model._meta.app_label <span class="keyword">in</span> DATABASE_MAPPING:</span><br><span class="line">            <span class="keyword">return</span> DATABASE_MAPPING[model._meta.app_label]</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">db_for_write</span><span class="params">(self, model, **hints)</span>:</span></span><br><span class="line">        <span class="string">"""Point all write operations to the specific database."""</span></span><br><span class="line">        <span class="keyword">if</span> model._meta.app_label <span class="keyword">in</span> DATABASE_MAPPING:</span><br><span class="line">            <span class="keyword">return</span> DATABASE_MAPPING[model._meta.app_label]</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">allow_relation</span><span class="params">(self, obj1, obj2, **hints)</span>:</span></span><br><span class="line">        <span class="string">"""Allow any relation between apps that use the same database."""</span></span><br><span class="line">        db_obj1 = DATABASE_MAPPING.get(obj1._meta.app_label)</span><br><span class="line">        db_obj2 = DATABASE_MAPPING.get(obj2._meta.app_label)</span><br><span class="line">        <span class="keyword">if</span> db_obj1 <span class="keyword">and</span> db_obj2:</span><br><span class="line">            <span class="keyword">if</span> db_obj1 == db_obj2:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">allow_syncdb</span><span class="params">(self, db, model)</span>:</span></span><br><span class="line">        <span class="string">"""Make sure that apps only appear in the related database."""</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> db <span class="keyword">in</span> DATABASE_MAPPING.values():</span><br><span class="line">            <span class="keyword">return</span> DATABASE_MAPPING.get(model._meta.app_label) == db</span><br><span class="line">        <span class="keyword">elif</span> model._meta.app_label <span class="keyword">in</span> DATABASE_MAPPING:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">allow_migrate</span><span class="params">(self, db, app_label, model=None, **hints)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Make sure the auth app only appears in the 'auth_db'</span></span><br><span class="line"><span class="string">        database.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> db <span class="keyword">in</span> DATABASE_MAPPING.values():</span><br><span class="line">            <span class="keyword">return</span> DATABASE_MAPPING.get(app_label) == db</span><br><span class="line">        <span class="keyword">elif</span> app_label <span class="keyword">in</span> DATABASE_MAPPING:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<h3 id="Modelsåˆ›å»ºæ ·ä¾‹"><a href="#Modelsåˆ›å»ºæ ·ä¾‹" class="headerlink" title="Modelsåˆ›å»ºæ ·ä¾‹"></a>Modelsåˆ›å»ºæ ·ä¾‹</h3><p>ä¾‹å¦‚:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HumanRole</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        app_label = <span class="string">'xxx_human'</span></span><br></pre></td></tr></table></figure>
<p>ä¹‹ååœ¨è·¯ç”±åˆ†å‘çš„æ—¶å€™ï¼Œä¼šæ ¹æ®app_labelçš„å€¼ä»<code>DATABASE_APPS_MAPPING</code>å¾—åˆ°ä¸åŒçš„æ•°æ®åº“åï¼Œç„¶åä½¿ç”¨ã€‚</p>
<h3 id="ç”Ÿæˆæ•°æ®è¡¨"><a href="#ç”Ÿæˆæ•°æ®è¡¨" class="headerlink" title="ç”Ÿæˆæ•°æ®è¡¨"></a>ç”Ÿæˆæ•°æ®è¡¨</h3><p>åœ¨ä½¿ç”¨djangoçš„ migrate åˆ›å»ºç”Ÿæˆè¡¨çš„æ—¶å€™ï¼Œéœ€è¦åŠ ä¸Š â€“database å‚æ•°ï¼Œå¦‚æœä¸åŠ åˆ™å°† æœª æŒ‡å®š app_label çš„ APPçš„modelsä¸­çš„è¡¨åˆ›å»ºåˆ°defaultæŒ‡å®šçš„æ•°æ®åº“ä¸­,å¦‚:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python manage.py  migrate account --database=db01</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šåˆ›å»ºå®Œæˆå,å…¶å®ƒæ‰€æœ‰çš„åˆ›å»ºã€æŸ¥è¯¢ã€åˆ é™¤ç­‰æ“ä½œå°±å’Œæ™®é€šä¸€æ ·æ“ä½œå°±å¯ä»¥äº†,æ— éœ€å†ä½¿ç”¨ç±»ä¼¼<br><code>models.User.objects.using(dbname).all(ï¼‰</code><br>è¿™æ ·çš„æ–¹å¼æ¥æ“ä½œ</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
      </tags>
  </entry>
  <entry>
    <title>Django --- æ—¥å¿—é…ç½®</title>
    <url>/2020/05/23/django-%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h3 id="å¸¸ç”¨é…ç½®"><a href="#å¸¸ç”¨é…ç½®" class="headerlink" title="å¸¸ç”¨é…ç½®"></a>å¸¸ç”¨é…ç½®</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import datetime</span><br><span class="line"></span><br><span class="line">LOGGING &#x3D; &#123;</span><br><span class="line">    # æŒ‡æ˜dictConnfigçš„ç‰ˆæœ¬</span><br><span class="line">    &#39;version&#39;: 1,</span><br><span class="line">    # æ˜¯å¦ç¦ç”¨æ‰€æœ‰çš„å·²ç»å­˜åœ¨çš„æ—¥å¿—é…ç½®</span><br><span class="line">    &#39;disable_existing_loggers&#39;: True,</span><br><span class="line">    &#39;formatters&#39;: &#123;</span><br><span class="line">        &#39;standard&#39;: &#123;</span><br><span class="line">            # é…ç½®æ‰“å°logæ ¼å¼</span><br><span class="line">            &#39;format&#39;: &#39;%(asctime)s [%(name)s:%(lineno)d] [%(module)s:%(funcName)s] [%(levelname)s] %(message)s&#39;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    # è¿‡æ»¤å™¨</span><br><span class="line">    &#39;filters&#39;: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    # ç”¨æ¥å®šä¹‰å…·ä½“å¤„ç†æ—¥å¿—çš„æ–¹å¼ï¼Œå¯ä»¥å®šä¹‰å¤šç§</span><br><span class="line">    &#39;handlers&#39;: &#123;</span><br><span class="line">        &#39;mail_admins&#39;: &#123;</span><br><span class="line">            &#39;level&#39;: &#39;ERROR&#39;,</span><br><span class="line">            &#39;class&#39;: &#39;django.utils.log.AdminEmailHandler&#39;,</span><br><span class="line">            &#39;include_html&#39;: True,</span><br><span class="line">        &#125;,</span><br><span class="line">        # é»˜è®¤ç±»å‹</span><br><span class="line">        &#39;default&#39;: &#123;</span><br><span class="line">            &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">            &#39;class&#39;: &#39;logging.handlers.RotatingFileHandler&#39;,</span><br><span class="line">            # ä¿å­˜çš„æ–‡ä»¶</span><br><span class="line">            &#39;filename&#39;: &#39;&#123;&#125;&#x2F;Log&#x2F;QWebFX_&#123;&#125;.log&#39;.format(BASE_DIR, datetime.datetime.now().date()),  # æ—¥å¿—è¾“å‡ºæ–‡ä»¶</span><br><span class="line">            # æ–‡ä»¶å¤§å°</span><br><span class="line">            &#39;maxBytes&#39;: 1024 * 1024 * 5,</span><br><span class="line">            # å¤‡ä»½ä»½æ•°</span><br><span class="line">            &#39;backupCount&#39;: 5,</span><br><span class="line">            # ä½¿ç”¨å“ªç§formattersæ—¥å¿—æ ¼å¼</span><br><span class="line">            &#39;formatter&#39;: &#39;standard&#39;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#39;django_backends&#39;: &#123;</span><br><span class="line">            &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">            &#39;class&#39;: &#39;logging.handlers.RotatingFileHandler&#39;,</span><br><span class="line">            # ä¿å­˜çš„æ–‡ä»¶</span><br><span class="line">            &#39;filename&#39;: &#39;&#123;&#125;&#x2F;Log&#x2F;backends_&#123;&#125;.log&#39;.format(BASE_DIR, datetime.datetime.now().date()),  # æ—¥å¿—è¾“å‡ºæ–‡ä»¶</span><br><span class="line">            # æ–‡ä»¶å¤§å°</span><br><span class="line">            &#39;maxBytes&#39;: 1024 * 1024 * 5,</span><br><span class="line">            # å¤‡ä»½ä»½æ•°</span><br><span class="line">            &#39;backupCount&#39;: 5,</span><br><span class="line">            # ä½¿ç”¨å“ªç§formattersæ—¥å¿—æ ¼å¼</span><br><span class="line">            &#39;formatter&#39;: &#39;standard&#39;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#39;error&#39;: &#123;</span><br><span class="line">            &#39;level&#39;: &#39;ERROR&#39;,</span><br><span class="line">            &#39;class&#39;: &#39;logging.handlers.RotatingFileHandler&#39;,</span><br><span class="line">            &#39;filename&#39;: &#39;&#123;&#125;&#x2F;Log&#x2F;Error&#x2F;QWebFX_Error_&#123;&#125;.log&#39;.format(BASE_DIR, datetime.datetime.now().date()),</span><br><span class="line">            &#39;maxBytes&#39;: 1024 * 1024 * 5,</span><br><span class="line">            &#39;backupCount&#39;: 5,</span><br><span class="line">            &#39;formatter&#39;: &#39;standard&#39;,</span><br><span class="line">        &#125;,</span><br><span class="line">        # æ‰“å°logåˆ°æ§åˆ¶å°</span><br><span class="line">        &#39;console&#39;: &#123;</span><br><span class="line">            &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">            &#39;class&#39;: &#39;logging.StreamHandler&#39;,</span><br><span class="line">            &#39;formatter&#39;: &#39;standard&#39;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#39;request_handler&#39;: &#123;</span><br><span class="line">            &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">            &#39;class&#39;: &#39;logging.handlers.RotatingFileHandler&#39;,</span><br><span class="line">            &#39;filename&#39;: &#39;&#123;&#125;&#x2F;Log&#x2F;Request&#x2F;QWebFX_Request_&#123;&#125;.log&#39;.format(BASE_DIR, datetime.datetime.now().date()),</span><br><span class="line">            &#39;maxBytes&#39;: 1024 * 1024 * 5,</span><br><span class="line">            &#39;backupCount&#39;: 5,</span><br><span class="line">            &#39;formatter&#39;: &#39;standard&#39;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#39;scripts_handler&#39;: &#123;</span><br><span class="line">            # åªæœ‰INFOåŠä»¥ä¸Šçº§åˆ«çš„logæ‰ä¼šå†™å…¥æ–‡ä»¶ä¸­</span><br><span class="line">            &#39;level&#39;: &#39;INFO&#39;,</span><br><span class="line">            &#39;class&#39;: &#39;logging.handlers.RotatingFileHandler&#39;,</span><br><span class="line">            &#39;filename&#39;: &#39;&#123;&#125;&#x2F;Log&#x2F;Script&#x2F;QWebFX_Script_&#123;&#125;.log&#39;.format(BASE_DIR, datetime.datetime.now().date()),</span><br><span class="line">            &#39;maxBytes&#39;: 1024 * 1024 * 5,</span><br><span class="line">            &#39;backupCount&#39;: 5,</span><br><span class="line">            &#39;formatter&#39;: &#39;standard&#39;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#39;loggers&#39;: &#123;</span><br><span class="line">        # django è¡¨ç¤ºå°±æ˜¯djangoæœ¬èº«é»˜è®¤çš„æ§åˆ¶å°è¾“å‡ºï¼Œå°±æ˜¯åŸæœ¬åœ¨æ§åˆ¶å°é‡Œé¢è¾“å‡ºçš„å†…å®¹</span><br><span class="line">        &#39;django&#39;: &#123;</span><br><span class="line">            # ä½¿ç”¨defaultç±»å‹çš„å¤„ç†å™¨è¿›è¡Œå¤„ç†</span><br><span class="line">            &#39;handlers&#39;: [&#39;default&#39;],</span><br><span class="line">            &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">            &#39;propagate&#39;: False</span><br><span class="line">        &#125;,</span><br><span class="line">        &#39;django.request&#39;: &#123;</span><br><span class="line">            &#39;handlers&#39;: [&#39;request_handler&#39;],</span><br><span class="line">            &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">            &#39;propagate&#39;: False,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#39;scripts&#39;: &#123;</span><br><span class="line">            &#39;handlers&#39;: [&#39;scripts_handler&#39;],</span><br><span class="line">            # åªæœ‰INFOåŠä»¥ä¸Šçº§åˆ«çš„æ¶ˆæ¯æ‰ä¼šè°ƒç”¨æ­¤handler</span><br><span class="line">            &#39;level&#39;: &#39;INFO&#39;,</span><br><span class="line">            &#39;propagate&#39;: False</span><br><span class="line">        &#125;,</span><br><span class="line">        &#39;console&#39;: &#123;</span><br><span class="line">            &#39;handlers&#39;: [&#39;console&#39;],</span><br><span class="line">            &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">            &#39;propagate&#39;: True</span><br><span class="line">        &#125;,</span><br><span class="line">        # API&#x2F;Views æ¨¡å—çš„æ—¥å¿—å¤„ç†</span><br><span class="line">        &#39;views&#39;: &#123;</span><br><span class="line">            &#39;handlers&#39;: [&#39;default&#39;, &#39;error&#39;],</span><br><span class="line">            &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">            &#39;propagate&#39;: True</span><br><span class="line">        &#125;,</span><br><span class="line">        &#39;util&#39;: &#123;</span><br><span class="line">            &#39;handlers&#39;: [&#39;error&#39;],</span><br><span class="line">            &#39;level&#39;: &#39;ERROR&#39;,</span><br><span class="line">            &#39;propagate&#39;: True</span><br><span class="line">        &#125;,</span><br><span class="line">        # ä¿å­˜æ‰€æœ‰çš„æ•°æ®åº“æ“ä½œ</span><br><span class="line">        &#39;django.db.backends&#39;: &#123;</span><br><span class="line">            &#39;handlers&#39;: [&#39;django_backends&#39;],  # æŒ‡å®šfile handlerå¤„ç†å™¨ï¼Œè¡¨ç¤ºåªå†™å…¥åˆ°æ–‡ä»¶</span><br><span class="line">            &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">            &#39;propagate&#39;: True,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>ä½¿ç”¨æ–¹å¼:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">log = logging.getLogger(<span class="string">'views'</span>)</span><br><span class="line">log.debug(<span class="string">'hello'</span>)</span><br></pre></td></tr></table></figure>
<p><code>getLogger</code>ä¸­ä¼ å…¥çš„å€¼ä¼šè·å–<code>loggers</code>ä¸­çš„æ•°æ®ï¼Œç„¶åæ ¹æ®<code>handler</code>çš„å€¼æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚</p>
<h3 id="level-çº§åˆ«"><a href="#level-çº§åˆ«" class="headerlink" title="level:çº§åˆ«"></a>level:çº§åˆ«</h3><br/>
ä¸€ä¸ªè®°å½•å™¨æ˜¯æ—¥å¿—ç³»ç»Ÿçš„ä¸€ä¸ªå®ä½“ï¼Œæ¯ä¸€ä¸ªè®°å½•å™¨æ˜¯ä¸€ä¸ªå·²ç»å‘½åå¥½çš„å¯ä»¥å°†æ¶ˆæ¯ä¸ºè¿›ç¨‹å†™å…¥çš„â€œæ¡¶â€ã€‚
æ¯ä¸€ä¸ªè®°å½•å™¨éƒ½ä¼šæœ‰ä¸€ä¸ªæ—¥å¿—ç­‰çº§ï¼Œæ¯ä¸ªç­‰çº§æè¿°äº†è®°å½•å™¨å³å°†å¤„ç†çš„ä¿¡æ¯çš„ä¸¥é‡æ€§ï¼Œpythonå®šä¹‰äº†ä»¥ä¸‹å…­ä¸ªç­‰çº§ï¼š
çº§åˆ«å€¼æè¿°
**CRITICAL 50** å…³é”®é”™è¯¯/æ¶ˆæ¯,æè¿°å·²ç»å‘ç”Ÿçš„ä¸¥é‡é—®é¢˜ <br/>
**ERROR 40** é”™è¯¯,æè¿°å·²ç»å‘ç”Ÿçš„ä¸»è¦é—®é¢˜ <br/>
**WARNING 30** è­¦å‘Šæ¶ˆæ¯,æè¿°å·²ç»å‘ç”Ÿçš„å°é—®é¢˜ <br/>
**INFO 20** é€šçŸ¥æ¶ˆæ¯,æ™®é€šçš„ç³»ç»Ÿä¿¡æ¯åˆ—è¡¨å†…å®¹ <br/>
**DEBUG 10** è°ƒè¯•,å‡ºäºè°ƒè¯•ç›®çš„çš„ä½å±‚æ¬¡ç³»ç»Ÿä¿¡æ¯ <br/>
**NOTSET 0** æ— çº§åˆ«<br/>

<h3 id="å¤„ç†å™¨-è®°å½•å™¨-å…³é”®å­—å‚æ•°"><a href="#å¤„ç†å™¨-è®°å½•å™¨-å…³é”®å­—å‚æ•°" class="headerlink" title="å¤„ç†å™¨/è®°å½•å™¨ å…³é”®å­—å‚æ•°"></a>å¤„ç†å™¨/è®°å½•å™¨ å…³é”®å­—å‚æ•°</h3><br/>
**filename** å°†æ—¥å¿—æ¶ˆæ¯é™„åŠ åˆ°æŒ‡å®šæ–‡ä»¶åçš„æ–‡ä»¶ <br/>
**filemode** æŒ‡å®šç”¨äºæ‰“å¼€æ–‡ä»¶æ¨¡å¼, æ–‡ä»¶æ‰“å¼€æ–¹å¼ï¼Œåœ¨æŒ‡å®šäº†filenameæ—¶ä½¿ç”¨è¿™ä¸ªå‚æ•°ï¼Œé»˜è®¤å€¼ä¸ºâ€œaâ€è¿˜å¯æŒ‡å®šä¸ºâ€œwâ€ã€‚ <br/>
**format** ç”¨äºç”Ÿæˆæ—¥å¿—æ¶ˆæ¯çš„æ ¼å¼å­—ç¬¦ä¸² <br/>
**datefmt** ç”¨äºè¾“å‡ºæ—¥æœŸå’Œæ—¶é—´çš„æ ¼å¼å­—ç¬¦ä¸² <br/>
**level** è®¾ç½®è®°å½•å™¨çš„çº§åˆ« <br/>
**propagate** å¯ä»¥åŸºäºæ¯ä¸ªè®°å½•å™¨æ§åˆ¶è¯¥ä¼ æ’­ã€‚ å¦‚æœæ‚¨ä¸å¸Œæœ›ç‰¹å®šè®°å½•å™¨ä¼ æ’­åˆ°å…¶çˆ¶é¡¹ï¼Œåˆ™å¯ä»¥å…³é—­æ­¤è¡Œä¸ºã€‚ <br/>
**stream** æä¾›æ‰“å¼€çš„æ–‡ä»¶ï¼Œç”¨äºæŠŠæ—¥å¿—æ¶ˆæ¯å‘é€åˆ°æ–‡ä»¶ã€‚å¯ä»¥æŒ‡å®šè¾“å‡ºåˆ°sys.stderr,sys.stdoutæˆ–è€…æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºsys.stderrã€‚ <br/>
è‹¥åŒæ—¶åˆ—å‡ºäº†filenameå’Œstreamä¸¤ä¸ªå‚æ•°ï¼Œåˆ™streamå‚æ•°ä¼šè¢«å¿½ç•¥ã€‚

<h3 id="format-æ—¥å¿—æ¶ˆæ¯æ ¼å¼"><a href="#format-æ—¥å¿—æ¶ˆæ¯æ ¼å¼" class="headerlink" title="format: æ—¥å¿—æ¶ˆæ¯æ ¼å¼"></a>format: æ—¥å¿—æ¶ˆæ¯æ ¼å¼</h3><br/>
**%(name)s** è®°å½•å™¨çš„åç§° <br/>
**%(levelno)s** æ•°å­—å½¢å¼çš„æ—¥å¿—è®°å½•çº§åˆ« <br/>
**%(levelname)s** æ—¥å¿—è®°å½•çº§åˆ«çš„æ–‡æœ¬åç§° <br/>
**%(filename)s** æ‰§è¡Œæ—¥å¿—è®°å½•è°ƒç”¨çš„æºæ–‡ä»¶çš„æ–‡ä»¶åç§° <br/>
**%(pathname)s** æ‰§è¡Œæ—¥å¿—è®°å½•è°ƒç”¨çš„æºæ–‡ä»¶çš„è·¯å¾„åç§° <br/>
**%(funcName)s** æ‰§è¡Œæ—¥å¿—è®°å½•è°ƒç”¨çš„å‡½æ•°åç§° <br/>
**%(module)s** æ‰§è¡Œæ—¥å¿—è®°å½•è°ƒç”¨çš„æ¨¡å—åç§° <br/>
**%(lineno)s** æ‰§è¡Œæ—¥å¿—è®°å½•è°ƒç”¨çš„è¡Œå· <br/>
**%(created)s** æ‰§è¡Œæ—¥å¿—è®°å½•çš„æ—¶é—´ <br/>
**%(asctime)s** æ—¥æœŸå’Œæ—¶é—´ <br/>
**%(msecs)s** æ¯«ç§’éƒ¨åˆ† <br/>
**%(thread)d** çº¿ç¨‹ID <br/>
**%(threadName)s** çº¿ç¨‹åç§° <br/>
**%(process)d** è¿›ç¨‹ID <br/>
**%(message)s** è®°å½•çš„æ¶ˆæ¯<br/>


<h3 id="å†…ç½®å¤„ç†å™¨"><a href="#å†…ç½®å¤„ç†å™¨" class="headerlink" title="å†…ç½®å¤„ç†å™¨"></a>å†…ç½®å¤„ç†å™¨</h3><br/>
loggingæ¨¡å—æä¾›äº†ä¸€äº›å¤„ç†å™¨ï¼Œå¯ä»¥é€šè¿‡å„ç§æ–¹å¼å¤„ç†æ—¥å¿—æ¶ˆæ¯ã€‚ä½¿ç”¨addHandler()æ–¹æ³•å°†è¿™äº›å¤„ç†å™¨æ·»åŠ ç»™Loggerå¯¹è±¡ã€‚å¦å¤–è¿˜å¯ä»¥ä¸ºæ¯ä¸ªå¤„ç†å™¨é…ç½®å®ƒè‡ªå·±çš„ç­›é€‰å’Œçº§åˆ«ã€‚ <br/>
**logging.StreamHandler** å¯ä»¥å‘ç±»ä¼¼ä¸sys.stdoutæˆ–è€…sys.stderrçš„ä»»ä½•æ–‡ä»¶å¯¹è±¡(file object)è¾“å‡ºä¿¡æ¯ <br/>
**logging.FileHandler** å°†æ—¥å¿—æ¶ˆæ¯å†™å…¥æ–‡ä»¶filenameã€‚ <br/>
**logging.handlers.DatagramHandler(hostï¼Œport)** å‘é€æ—¥å¿—æ¶ˆæ¯ç»™ä½äºåˆ¶å®šhostå’Œportä¸Šçš„UDPæœåŠ¡å™¨ã€‚ä½¿ç”¨UDPåè®®ï¼Œå°†æ—¥å¿—ä¿¡æ¯å‘é€åˆ°ç½‘ç»œ <br/>
**logging.handlers.HTTPHandler(host, url)** ä½¿ç”¨HTTPçš„GETæˆ–POSTæ–¹æ³•å°†æ—¥å¿—æ¶ˆæ¯ä¸Šä¼ åˆ°ä¸€å°HTTP æœåŠ¡å™¨ã€‚ <br/>
**logging.handlers.RotatingFileHandler(filename)** å°†æ—¥å¿—æ¶ˆæ¯å†™å…¥æ–‡ä»¶filenameã€‚å¦‚æœæ–‡ä»¶çš„å¤§å°è¶…å‡ºmaxBytesåˆ¶å®šçš„å€¼ï¼Œé‚£ä¹ˆå®ƒå°†è¢«å¤‡ä»½ä¸ºfilenamelã€‚ <br/>
**logging.handlers.SocketHandler** ä½¿ç”¨TCPåè®®ï¼Œå°†æ—¥å¿—ä¿¡æ¯å‘é€åˆ°ç½‘ç»œã€‚ <br/>
**logging.handlers.SysLogHandler** æ—¥å¿—è¾“å‡ºåˆ°syslog <br/>
**logging.handlers.NTEventLogHandler** è¿œç¨‹è¾“å‡ºæ—¥å¿—åˆ°Windows NT/2000/XPçš„äº‹ä»¶æ—¥å¿— 
**logging.handlers.SMTPHandler** è¿œç¨‹è¾“å‡ºæ—¥å¿—åˆ°é‚®ä»¶åœ°å€ <br/>
**logging.handlers.MemoryHandler** æ—¥å¿—è¾“å‡ºåˆ°å†…å­˜ä¸­çš„åˆ¶å®šbuffer <br/>
æ³¨æ„ï¼šç”±äºå†…ç½®å¤„ç†å™¨è¿˜æœ‰å¾ˆå¤šï¼Œå¦‚æœæƒ³æ›´æ·±å…¥äº†è§£ã€‚å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ‰‹å†Œã€‚


<h3 id="djangoæä¾›çš„å†…ç½®è®°å½•å™¨"><a href="#djangoæä¾›çš„å†…ç½®è®°å½•å™¨" class="headerlink" title="djangoæä¾›çš„å†…ç½®è®°å½•å™¨"></a>djangoæä¾›çš„å†…ç½®è®°å½•å™¨</h3><br/>
**django** åœ¨Djangoå±‚æ¬¡ç»“æ„ä¸­çš„æ‰€æœ‰æ¶ˆæ¯è®°å½•å™¨ã€‚æ²¡æœ‰ä½¿ç”¨æ­¤åç§°å‘å¸ƒæ¶ˆæ¯ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸‹é¢çš„è®°å½•å™¨ä¹‹ä¸€ã€‚ <br/>
**django.request** ä¸è¯·æ±‚å¤„ç†ç›¸å…³çš„æ—¥å¿—æ¶ˆæ¯ã€‚5xxå“åº”è¢«æå‡ä¸ºé”™è¯¯æ¶ˆæ¯ï¼›4xxå“åº”è¢«æå‡ä¸ºè­¦å‘Šæ¶ˆæ¯ã€‚ <br/>
**django.server** ä¸ç”±RunServerå‘½ä»¤è°ƒç”¨çš„æœåŠ¡å™¨æ‰€æ¥æ”¶çš„è¯·æ±‚çš„å¤„ç†ç›¸å…³çš„æ—¥å¿—æ¶ˆæ¯ã€‚HTTP 5XXå“åº”è¢«è®°å½•ä¸ºé”™è¯¯æ¶ˆæ¯ï¼Œ4XXå“åº”è¢«è®°å½•ä¸ºè­¦å‘Šæ¶ˆæ¯ï¼Œå…¶ä»–ä¸€åˆ‡éƒ½è¢«è®°å½•ä¸ºINFOã€‚ <br/>
**django.template** ä¸æ¨¡æ¿å‘ˆç°ç›¸å…³çš„æ—¥å¿—æ¶ˆæ¯ <br/>
**django.db.backends** æœ‰å…³ä»£ç ä¸æ•°æ®åº“äº¤äº’çš„æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œè¯·æ±‚æ‰§è¡Œçš„æ¯ä¸ªåº”ç”¨ç¨‹åºçº§SQLè¯­å¥éƒ½åœ¨è°ƒè¯•çº§åˆ«è®°å½•åˆ°æ­¤è®°å½•å™¨ã€‚<br/>


<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;docs.djangoproject.com&#x2F;en&#x2F;dev&#x2F;topics&#x2F;logging&#x2F;#topic-logging-parts-formatters</span><br><span class="line">https:&#x2F;&#x2F;www.jb51.net&#x2F;article&#x2F;161439.htm</span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_34416649&#x2F;article&#x2F;details&#x2F;87073006</span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;haeasringnar&#x2F;article&#x2F;details&#x2F;82053714</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
      </tags>
  </entry>
  <entry>
    <title>Django-rest-framework --- è§†å›¾é›†ä¸­é™„åŠ actionçš„å£°æ˜</title>
    <url>/2020/05/23/django-rest-framework-%E8%A7%86%E5%9B%BE%E9%9B%86%E4%B8%AD%E9%99%84%E5%8A%A0action%E7%9A%84%E5%A3%B0%E6%98%8E/</url>
    <content><![CDATA[<p>åœ¨è§†å›¾é›†(<code>ViewSet</code>)ä¸­ï¼Œå¦‚æœæƒ³è¦è®©Routerè‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬ä¸ºè‡ªå®šä¹‰çš„åŠ¨ä½œç”Ÿæˆè·¯ç”±ä¿¡æ¯ï¼Œéœ€è¦ä½¿ç”¨rest_framework.decorators.actionè£…é¥°å™¨ã€‚<br>ä»¥actionè£…é¥°å™¨è£…é¥°çš„æ–¹æ³•åä¼šä½œä¸ºactionåŠ¨ä½œåï¼Œä¸listã€retrieveç­‰åŒã€‚</p>
<p><code>@action</code>å¯ä»¥æ¥æ”¶å››ä¸ªå‚æ•°: </p>
<ul>
<li>methods: å£°æ˜è¯¥actionå¯¹åº”çš„è¯·æ±‚æ–¹å¼ï¼Œåˆ—è¡¨ä¼ é€’</li>
<li>detail: å£°æ˜è¯¥actionçš„è·¯å¾„æ˜¯å¦ä¸å•ä¸€èµ„æºå¯¹åº”ï¼ŒåŠæ˜¯å¦æ˜¯xxx/<pk>/actionæ–¹æ³•å/<ul>
<li>True è¡¨ç¤ºè·¯å¾„æ ¼å¼æ˜¯xxx/<pk>/actionæ–¹æ³•å/</li>
<li>False è¡¨ç¤ºè·¯å¾„æ ¼å¼æ˜¯xxx/actionæ–¹æ³•å/</li>
</ul>
</li>
<li>url_path: é‡è®¾è®¿é—®è¯¥å‡½æ•°çš„è·¯å¾„,é»˜è®¤æ˜¯é€šè¿‡å‡½æ•°å<code>func.__name__</code>æ¥è®¿é—®</li>
<li>url_name: æ”¹å‡½æ•°å¯¹åº”çš„name,å¯ç”¨æ¥è®¾ç½®è·³è½¬é“¾æ¥,ä¾‹å¦‚revese(â€˜â€™)ç­‰.</li>
</ul>
<a id="more"></a>

<p>ç¤ºä¾‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BBSIndex</span><span class="params">(HandleExceptionMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">               mixins.ListModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">               mixins.RetrieveModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">               viewsets.GenericViewSet)</span>:</span></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="meta">    @action(methods=['GET'], detail=True, url_path='test')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_data</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">'message'</span>: <span class="string">'test action'</span>&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> routers</span><br><span class="line"></span><br><span class="line">router = routers.DefaultRouter()</span><br><span class="line">router.register(<span class="string">r'all'</span>, views.BBSIndex, base_name=<span class="string">'articles'</span>)</span><br><span class="line"></span><br><span class="line">url(<span class="string">r''</span>, include(router.urls)),</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ²¡æœ‰è®¾ç½®url_pathçš„è¯,é‚£ä¹ˆè®¿é—®è¯¥å‡½æ•°çš„æ–¹å¼ä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.0.60:10000&#x2F;bbs&#x2F;all&#x2F;13&#x2F;test_data&#x2F;</span><br></pre></td></tr></table></figure>
<p>è€Œè®¾ç½®äº†url_path,åˆ™å˜æˆäº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.0.60:10000&#x2F;bbs&#x2F;all&#x2F;13&#x2F;test&#x2F;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
        <tag>django-rest-framework</tag>
      </tags>
  </entry>
  <entry>
    <title>Django --- ä¸­é—´ä»¶ä»‹ç»</title>
    <url>/2020/05/23/django-%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>åœ¨httpè¯·æ±‚åˆ°è¾¾å‡½æ•°ä¹‹å‰å’Œå‡½æ•°returnä¹‹å,djangoä¼šæ ¹æ®è‡ªå·±çš„è§„åˆ™åœ¨åˆé€‚çš„æ—¶æœºæ‰§è¡Œä¸­é—´ä»¶ä¸­ç›¸åº”çš„æ–¹æ³•.å› ä¸ºæ”¹å˜çš„æ˜¯å…¨å±€,æ‰€ä»¥è°¨æ…ä½¿ç”¨.</p>
<p>ä¸­é—´ä»¶æ˜¯ä¸€ä¸ªä¸djangoçš„è¯·æ±‚/å“åº”å¤„ç†ç›¸å…³çš„æ¡†æ¶,æ˜¯ä¸€ç§è½»çš„,ä½å±‚æ¬¡çš„â€æ’ä»¶â€ç³»ç»Ÿ,ç”¨äºdjangoçš„å…¨å±€çš„è¾“å…¥/è¾“å‡º.</p>
<p>å¦‚æœä½ æƒ³ä¿®æ”¹è¯·æ±‚ï¼Œä¾‹å¦‚è¢«ä¼ é€åˆ°viewä¸­çš„HttpRequestå¯¹è±¡ã€‚<br>æˆ–è€…ä½ æƒ³ä¿®æ”¹viewè¿”å›çš„HttpResponseå¯¹è±¡ï¼Œè¿™äº›éƒ½å¯ä»¥é€šè¿‡ä¸­é—´ä»¶æ¥å®ç°ã€‚<br>å¯èƒ½ä½ è¿˜æƒ³åœ¨viewæ‰§è¡Œä¹‹å‰åšä¸€äº›æ“ä½œï¼Œè¿™ç§æƒ…å†µå°±å¯ä»¥ç”¨ middlewareæ¥å®ç°ã€‚</p>
<a id="more"></a>

<h3 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><p>æµç¨‹å›¾:<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/pic/55-1.jpg" alt="æµç¨‹"></p>
<p>åœ¨django==1.8.2çš„django.core.handlers.base.BaseHandlerç±»ä¸­,æœ‰è¿™ä¹ˆä¸ªå‡½æ•°load_middleware,å…¶ä¸­æœ‰æ®µä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> hasattr(mw_instance, <span class="string">'process_request'</span>):</span><br><span class="line">    request_middleware.append(mw_instance.process_request)</span><br><span class="line"><span class="keyword">if</span> hasattr(mw_instance, <span class="string">'process_view'</span>):</span><br><span class="line">    self._view_middleware.append(mw_instance.process_view)</span><br><span class="line"><span class="keyword">if</span> hasattr(mw_instance, <span class="string">'process_template_response'</span>):</span><br><span class="line">    self._template_response_middleware.insert(<span class="number">0</span>,</span><br><span class="line">mw_instance.process_template_response)</span><br><span class="line"><span class="keyword">if</span> hasattr(mw_instance, <span class="string">'process_response'</span>):</span><br><span class="line">    self._response_middleware.insert(<span class="number">0</span>, mw_instance.process_response)</span><br><span class="line"><span class="keyword">if</span> hasattr(mw_instance, <span class="string">'process_exception'</span>):</span><br><span class="line">    self._exception_middleware.insert(<span class="number">0</span>, mw_instance.process_exception)</span><br></pre></td></tr></table></figure>

<p>ä½†åœ¨django==2.0ä¸­,è¿™éƒ¨åˆ†ä»£ç è¢«æ‹†åˆ†åˆ°äº†ä¸¤ä¸ªç±»ä¸­</p>
<p>django.util.deprecation:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MiddlewareMixin</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, get_response=None)</span>:</span></span><br><span class="line">        self.get_response = get_response</span><br><span class="line">        super().__init__()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        response = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> hasattr(self, <span class="string">'process_request'</span>):</span><br><span class="line">            response = self.process_request(request)</span><br><span class="line">        response = response <span class="keyword">or</span> self.get_response(request)</span><br><span class="line">        <span class="keyword">if</span> hasattr(self, <span class="string">'process_response'</span>):</span><br><span class="line">            response = self.process_response(request, response)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>ä»¥åŠ, django.core.handlers.base.BaseHandler.load_middlewareå‡½æ•°ä¸­:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> hasattr(mw_instance, <span class="string">'process_view'</span>):</span><br><span class="line">    self._view_middleware.insert(<span class="number">0</span>, mw_instance.process_view)</span><br><span class="line"><span class="keyword">if</span> hasattr(mw_instance, <span class="string">'process_template_response'</span>):</span><br><span class="line">self._template_response_middleware.append(mw_instance.process_template_response)</span><br><span class="line"><span class="keyword">if</span> hasattr(mw_instance, <span class="string">'process_exception'</span>):</span><br><span class="line">self._exception_middleware.append(mw_instance.process_exception)</span><br></pre></td></tr></table></figure>

<p>å¤§è‡´æµç¨‹æ˜¯,åœ¨å‡½æ•°æ²¡æœ‰è¿”å›å€¼çš„æƒ…å†µä¸‹,ä¼šæŒ‰ç…§settings.pyä¸­çš„ä¸­é—´ä»¶çš„é¡ºåºå…ˆåæ‰§è¡Œprocess_requestå’Œprocess_viewå‡½æ•°,ä½†æ‰§è¡Œå®Œè§†å›¾å‡½æ•°å,ä¼šæŒ‰ç…§é€†å‘é¡ºåºæ‰§è¡Œprocess_exception,<br>process_template_response å’Œ process_response.<br>åˆ›å»ºå®Œdjangoé¡¹ç›®å,ä¼šåœ¨settings.pyä¸­è‡ªåŠ¨æ·»åŠ ä»¥ä¸‹ä¸­é—´ä»¶(django1.8.0ä¸­æ˜¯MIDDLEWARE_CLASSES)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'django.middleware.security.SecurityMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.csrf.CsrfViewMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆåœ¨æ²¡æœ‰ä»»ä½•è¿”å›å€¼ä»¥åŠå¼‚å¸¸çš„æƒ…å†µä¸‹,<br>process_requestçš„æ‰§è¡Œé¡ºåºæ˜¯<br>SecurityMiddlewareâ€“&gt;SessionMiddlewareâ€“&gt;CommonMiddlewareâ€“&gt;â€¦<br>process_viewåŒä¸Š,<br>ä½†åä¸‰è€…çš„æ‰§è¡Œé¡ºåºä¼šæ˜¯<br>XFrameOptionMiddlewareâ€“&gt;MessageMiddlewareâ€“&gt;AuthenticationMiddlewareâ€“&gt;â€¦<br>å…¶å®ä»ä»£ç å°±å¯ä»¥å¤§è‡´çœ‹å‡ºæ¥,å‰ä¸¤è€…ç”¨çš„æ˜¯<code>append</code>,åä¸‰è€…ç”¨çš„æ˜¯<code>insert</code>.</p>
<h3 id="è‡ªå®šä¹‰ä¸­é—´ä»¶"><a href="#è‡ªå®šä¹‰ä¸­é—´ä»¶" class="headerlink" title="è‡ªå®šä¹‰ä¸­é—´ä»¶"></a>è‡ªå®šä¹‰ä¸­é—´ä»¶</h3><p>æŒ‰éœ€è¦å®ç°5ä¸ªå‡½æ•°:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">process_request(self,request)</span><br><span class="line">process_view(self, request, view_func, view_args, view_kwargs)</span><br><span class="line">process_template_response(self,request,response)</span><br><span class="line">process_exception(self, request, exception)</span><br><span class="line">process_response(self, request, response)</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šæ–¹æ³•çš„è¿”å›å€¼å¯ä»¥æ˜¯Noneæˆ–ä¸€ä¸ªHttpResponseå¯¹è±¡ï¼Œå¦‚æœæ˜¯Noneï¼Œåˆ™ç»§ç»­æŒ‰djangoå®šä¹‰çš„è§„åˆ™å‘åç»§ç»­æ‰§è¡Œï¼Œå¦‚æœæ˜¯HttpResponseå¯¹è±¡ï¼Œåˆ™ç›´æ¥å°†è¯¥å¯¹è±¡è¿”å›ç»™ç”¨æˆ·ã€‚</p>
<h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><p>md1.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    MiddlewareMixin = object</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MiddlewareTest1</span><span class="params">(MiddlewareMixin)</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        print(<span class="string">'md1.process_request'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_view</span><span class="params">(self, request, view_func, view_args, view_kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'md1.process_view'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_template_response</span><span class="params">(self, request, response)</span>:</span></span><br><span class="line">        print(<span class="string">'md1.process_template_response'</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_exception</span><span class="params">(self, request, exception)</span>:</span></span><br><span class="line">        print(<span class="string">'md1.process_exception'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self, request, response)</span>:</span></span><br><span class="line">        print(<span class="string">'md1.process_response'</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>md2.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    MiddlewareMixin = object</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MiddlewareTest2</span><span class="params">(MiddlewareMixin)</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        print(<span class="string">'md2.process_request'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_view</span><span class="params">(self, request, view_func, view_args, view_kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'md2.process_view'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_template_response</span><span class="params">(self, request, response)</span>:</span></span><br><span class="line">        print(<span class="string">'md2.process_template_response'</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_exception</span><span class="params">(self, request, exception)</span>:</span></span><br><span class="line">        print(<span class="string">'md2.process_exception'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self, request, response)</span>:</span></span><br><span class="line">        print(<span class="string">'md2.process_response'</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>views.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexApiView</span><span class="params">(APIView)</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'IndexApiView.get'</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'demo/index.html'</span>)</span><br><span class="line">        <span class="comment"># return Response(&#123;'result': True&#125;)</span></span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„å‡ ç‚¹:<br>1.<br>MiddlewareMixinåœ¨django==1.8.0ä¸­æ˜¯æ²¡æœ‰çš„,æ‰€ä»¥éœ€è¦æ•è·å¼‚å¸¸,é‡å†™5ä¸ªå‡½æ•°è·Ÿæ˜¯å¦ç»§æ‰¿MiddlrewareMixinæ— å…³<br>2. process_template_response å’Œ process_responseå¿…é¡»è¦è¿”å›ä¸€ä¸ªresponseå€¼</p>
<h4 id="è¿”å›HTMLæ¨¡æ¿"><a href="#è¿”å›HTMLæ¨¡æ¿" class="headerlink" title="è¿”å›HTMLæ¨¡æ¿"></a>è¿”å›HTMLæ¨¡æ¿</h4><p>å¦‚æœåœ¨è§†å›¾ä¸­è¿”å›ä¸€ä¸ªhtmlæ¨¡æ¿,æµç¨‹ä¼šæ˜¯:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">md1.process_request</span><br><span class="line">md2.process_request</span><br><span class="line">md1.process_view</span><br><span class="line">md2.process_view</span><br><span class="line">IndexApiView.get</span><br><span class="line">md2.process_response</span><br><span class="line">md1.process_response</span><br></pre></td></tr></table></figure>
<p>æ²¡æœ‰æ‰§è¡Œprocess_exception å’Œ process_template_responseå‡½æ•°.</p>
<h4 id="è¿”å›HttpResponseå¯¹è±¡"><a href="#è¿”å›HttpResponseå¯¹è±¡" class="headerlink" title="è¿”å›HttpResponseå¯¹è±¡"></a>è¿”å›HttpResponseå¯¹è±¡</h4><p>å½“è¿”å›HttpResponseå¯¹è±¡æ—¶æ‰“å°çš„LOG:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">md1.process_request</span><br><span class="line">md2.process_request</span><br><span class="line">md1.process_view</span><br><span class="line">md2.process_view</span><br><span class="line">IndexApiView.get</span><br><span class="line">md2.process_template_response</span><br><span class="line">md1.process_template_response</span><br><span class="line">md2.process_response</span><br><span class="line">md1.process_response</span><br></pre></td></tr></table></figure>
<p>ç›¸æ¯”ä¸Šä¸€æ¡,å¤šæ‰§è¡Œäº†process_template_responseå‡½æ•°</p>
<h4 id="æŠ›å‡ºå¼‚å¸¸"><a href="#æŠ›å‡ºå¼‚å¸¸" class="headerlink" title="æŠ›å‡ºå¼‚å¸¸"></a>æŠ›å‡ºå¼‚å¸¸</h4><p>å¦‚æœåœ¨è§†å›¾ä¸­æŠ›å‡ºå¼‚å¸¸:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">md1.process_request</span><br><span class="line">md2.process_request</span><br><span class="line">md1.process_view</span><br><span class="line">md2.process_view</span><br><span class="line">IndexApiView.get</span><br><span class="line">md2.process_exception</span><br><span class="line">md1.process_exception</span><br><span class="line">Exception: æŠ›å‡ºå¼‚å¸¸</span><br><span class="line">md2.process_response</span><br><span class="line">md1.process_response</span><br></pre></td></tr></table></figure>

<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><h5 id="process-request"><a href="#process-request" class="headerlink" title="process_request"></a>process_request</h5><p>1.<br>process_requestæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯requestï¼Œè¿™ä¸ªrequestå’Œè§†å›¾å‡½æ•°ä¸­çš„requestæ˜¯ä¸€æ ·çš„ã€‚<br>2.<br>å®ƒçš„è¿”å›å€¼å¯ä»¥æ˜¯Noneä¹Ÿå¯ä»¥æ˜¯HttpResponseå¯¹è±¡ã€‚è¿”å›å€¼æ˜¯Noneçš„è¯ï¼ŒæŒ‰æ­£å¸¸æµç¨‹ç»§ç»­èµ°ï¼Œäº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å¤„ç†ï¼Œå¦‚æœæ˜¯HttpResponseå¯¹è±¡ï¼ŒDjangoå°†ä¸æ‰§è¡Œè§†å›¾å‡½æ•°ï¼Œè€Œå°†ç›¸åº”å¯¹è±¡è¿”å›ç»™æµè§ˆå™¨.<br>3. ä¸­é—´ä»¶çš„process_requestæ–¹æ³•æ˜¯åœ¨æ‰§è¡Œè§†å›¾å‡½æ•°ä¹‹å‰æ‰§è¡Œçš„ã€‚<br>4.<br>å½“é…ç½®å¤šä¸ªä¸­é—´ä»¶æ—¶ï¼Œä¼šæŒ‰ç…§MIDDLEWAREä¸­çš„æ³¨å†Œé¡ºåºï¼Œä¹Ÿå°±æ˜¯åˆ—è¡¨çš„ç´¢å¼•å€¼ï¼Œä»å‰åˆ°åä¾æ¬¡æ‰§è¡Œçš„ã€‚<br>ä¸åŒä¸­é—´ä»¶ä¹‹é—´ä¼ é€’çš„requestéƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡<br>5. è¿”å›None,ä¸é”™ä»»ä½•å¤„ç†ç›´æ¥è¿›è¡Œä¸‹ä¸€æ­¥<br>6. è¿”å›å€¼<br>2.è¿”å›å“åº”å¯¹è±¡ï¼Œç›´æ¥è·³å‡ºï¼ˆåç»­ä¸­é—´ä»¶çš„process_requestã€ä¸æ‰§è¡Œurls.pyå’Œviews.pyï¼‰è¿”å›å“åº”</p>
<h5 id="process-view"><a href="#process-view" class="headerlink" title="process_view"></a>process_view</h5><p>è¯¥æ–¹æ³•æœ‰å››ä¸ªå‚æ•°<br>requestæ˜¯HttpRequestå¯¹è±¡ã€‚<br>view_funcæ˜¯Djangoå³å°†ä½¿ç”¨çš„è§†å›¾å‡½æ•°ã€‚<br>ï¼ˆå®ƒæ˜¯å®é™…çš„å‡½æ•°å¯¹è±¡ï¼Œè€Œä¸æ˜¯å‡½æ•°çš„åç§°ä½œä¸ºå­—ç¬¦ä¸²ã€‚ï¼‰<br>view_argsæ˜¯å°†ä¼ é€’ç»™è§†å›¾çš„ä½ç½®å‚æ•°çš„åˆ—è¡¨.<br>view_kwargsæ˜¯å°†ä¼ é€’ç»™è§†å›¾çš„å…³é”®å­—å‚æ•°çš„å­—å…¸ã€‚<br>view_argså’Œview_kwargséƒ½ä¸åŒ…å«ç¬¬ä¸€ä¸ªè§†å›¾å‚æ•°ï¼ˆrequestï¼‰ã€‚<br>Djangoä¼šåœ¨è°ƒç”¨è§†å›¾å‡½æ•°ä¹‹å‰è°ƒç”¨process_viewæ–¹æ³•ã€‚<br>å®ƒåº”è¯¥è¿”å›Noneæˆ–ä¸€ä¸ªHttpResponseå¯¹è±¡ã€‚<br>å¦‚æœè¿”å›Noneï¼ŒDjangoå°†ç»§ç»­å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œæ‰§è¡Œä»»ä½•å…¶ä»–ä¸­é—´ä»¶çš„process_viewæ–¹æ³•ï¼Œç„¶ååœ¨æ‰§è¡Œç›¸åº”çš„è§†å›¾ã€‚<br>å¦‚æœå®ƒè¿”å›ä¸€ä¸ªHttpResponseå¯¹è±¡ï¼ŒDjangoä¸ä¼šè°ƒç”¨é€‚å½“çš„è§†å›¾å‡½æ•°ã€‚<br>å®ƒå°†æ‰§è¡Œä¸­é—´ä»¶çš„process_responseæ–¹æ³•å¹¶å°†åº”ç”¨åˆ°è¯¥HttpResponseå¹¶è¿”å›ç»“æœ<br>process_viewæ–¹æ³•æ˜¯åœ¨process_requestä¹‹åï¼Œè§†å›¾å‡½æ•°ä¹‹å‰æ‰§è¡Œçš„ï¼Œæ‰§è¡Œé¡ºåºæŒ‰ç…§MIDDLEWAREä¸­çš„æ³¨å†Œé¡ºåºä»å‰åˆ°åé¡ºåºæ‰§è¡Œçš„</p>
<ol>
<li>åœ¨urls.pyä¹‹ååœ¨æ‰§è¡ŒçœŸæ­£çš„è§†å›¾å‡½æ•°ä¹‹å‰</li>
<li>æŒ‰ç…§åœ¨åˆ—è¡¨ä¸­æ³¨å†Œçš„é¡ºåºä¾æ¬¡æ‰§è¡Œ</li>
<li>è¿”å›None,æ”¾è¡Œ</li>
<li>è¿”å›å“åº”å¯¹è±¡ï¼Œå°±ç›´æ¥è·³å‡ºï¼Œå€’åºä¾æ¬¡æ‰§è¡Œæ‰€æœ‰ä¸­é—´ä»¶çš„process_responseæ–¹æ³•</li>
</ol>
<h5 id="process-response"><a href="#process-response" class="headerlink" title="process_response"></a>process_response</h5><p>å®ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯requestï¼Œä¸€ä¸ªæ˜¯responseï¼Œrequestå°±æ˜¯ä¸Šè¿°ä¾‹å­ä¸­ä¸€æ ·çš„å¯¹è±¡ï¼Œresponseæ˜¯è§†å›¾å‡½æ•°è¿”å›çš„HttpResponseå¯¹è±¡ã€‚<br>è¯¥æ–¹æ³•çš„è¿”å›å€¼ä¹Ÿå¿…é¡»æ˜¯HttpResponseå¯¹è±¡ã€‚<br>process_responseæ–¹æ³•æ˜¯åœ¨è§†å›¾å‡½æ•°ä¹‹åæ‰§è¡Œçš„ï¼Œå¹¶ä¸”é¡ºåºæ˜¯é€†å‘çš„.<br>å¤šä¸ªä¸­é—´ä»¶ä¸­çš„process_responseæ–¹æ³•æ˜¯æŒ‰ç…§MIDDLEWAREä¸­çš„æ³¨å†Œé¡ºåºå€’åºæ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬ä¸€ä¸ªä¸­é—´ä»¶çš„process_requestæ–¹æ³•é¦–å…ˆæ‰§è¡Œï¼Œ<br>è€Œå®ƒçš„process_responseæ–¹æ³•æœ€åæ‰§è¡Œï¼Œæœ€åä¸€ä¸ªä¸­é—´ä»¶çš„process_requestæ–¹æ³•æœ€åä¸€ä¸ªæ‰§è¡Œï¼Œå®ƒçš„process_responseæ–¹æ³•æ˜¯æœ€å…ˆæ‰§è¡Œã€‚</p>
<ol>
<li>åœ¨views.pyè¿”å›å“åº”å¯¹è±¡ä¹‹åæ‰§è¡Œ</li>
<li>æ‰§è¡Œçš„é¡ºåºæŒ‰ç…§åœ¨åˆ—è¡¨ä¸­æ³¨å†Œçš„å€’åºä¾æ¬¡æ‰§è¡Œ</li>
<li>è¿”å›å€¼å¿…é¡»è¦æœ‰è¿”å›å€¼ï¼Œè¿”å›è¦æ˜¯å“åº”å¯¹è±¡</li>
</ol>
<h5 id="process-exception"><a href="#process-exception" class="headerlink" title="process_exception"></a>process_exception</h5><p>è¯¥æ–¹æ³•ä¸¤ä¸ªå‚æ•°:ä¸€ä¸ªHttpRequestå¯¹è±¡ï¼Œå¦ä¸€ä¸ªexceptionæ˜¯è§†å›¾å‡½æ•°å¼‚å¸¸äº§ç”Ÿçš„Exceptionå¯¹è±¡ã€‚<br>è¿™ä¸ªæ–¹æ³•åªæœ‰åœ¨è§†å›¾å‡½æ•°ä¸­å‡ºç°å¼‚å¸¸äº†æ‰æ‰§è¡Œï¼Œå®ƒè¿”å›çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªNoneä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªHttpResponseå¯¹è±¡ã€‚å¦‚æœæ˜¯HttpResponseå¯¹è±¡ï¼ŒDjangoå°†è°ƒç”¨æ¨¡æ¿å’Œä¸­é—´ä»¶ä¸­çš„process_responseæ–¹æ³•ï¼Œå¹¶è¿”å›ç»™æµè§ˆå™¨ï¼Œå¦åˆ™å°†é»˜è®¤å¤„ç†å¼‚å¸¸ã€‚å¦‚æœè¿”å›ä¸€ä¸ªNoneï¼Œåˆ™äº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶çš„process_exceptionæ–¹æ³•æ¥å¤„ç†å¼‚å¸¸ã€‚å®ƒçš„æ‰§è¡Œé¡ºåºä¹Ÿæ˜¯æŒ‰ç…§ä¸­é—´ä»¶æ³¨å†Œé¡ºåºçš„å€’åºæ‰§è¡Œã€‚</p>
<h5 id="process-template-response"><a href="#process-template-response" class="headerlink" title="process_template_response"></a>process_template_response</h5><p>å®ƒçš„å‚æ•°ï¼Œä¸€ä¸ªHttpRequestå¯¹è±¡ï¼Œresponseæ˜¯TemplateResponseå¯¹è±¡ï¼ˆç”±è§†å›¾å‡½æ•°æˆ–è€…ä¸­é—´ä»¶äº§ç”Ÿï¼‰ã€‚<br>process_template_responseæ˜¯åœ¨è§†å›¾å‡½æ•°æ‰§è¡Œå®Œæˆåç«‹å³æ‰§è¡Œï¼Œä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªå‰ææ¡ä»¶ï¼Œé‚£å°±æ˜¯è§†å›¾å‡½æ•°è¿”å›çš„å¯¹è±¡æœ‰ä¸€ä¸ªrender()æ–¹æ³•<br>è§†å›¾å‡½æ•°æ‰§è¡Œå®Œä¹‹åï¼Œç«‹å³æ‰§è¡Œäº†ä¸­é—´ä»¶çš„process_template_responseæ–¹æ³•ï¼Œé¡ºåºæ˜¯å€’åºï¼Œå…ˆæ‰§è¡ŒMD1çš„ï¼Œåœ¨æ‰§è¡ŒMD2çš„ï¼Œæ¥ç€æ‰§è¡Œäº†è§†å›¾å‡½æ•°è¿”å›çš„HttpResponseå¯¹è±¡çš„renderæ–¹æ³•ï¼Œè¿”å›äº†ä¸€ä¸ªæ–°çš„HttpResponseå¯¹è±¡ï¼Œæ¥ç€æ‰§è¡Œä¸­é—´ä»¶çš„process_responseæ–¹æ³•ã€‚</p>
<h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol>
<li>requestè¯·æ±‚ç»è¿‡WSGIåï¼Œå…ˆè¿›å…¥ä¸­é—´ä»¶ï¼Œä¾ç„¶å¼€å§‹å…ˆèµ°process_requestå‡½æ•°ï¼Œç„¶åèµ°è·¯ç”±å…³ç³»æ˜ å°„åï¼Œè¿™é‡Œæ³¨æ„å¹¶æ²¡æœ‰ç›´æ¥è¿›å…¥è§†å›¾å‡½æ•°ï¼Œè€Œæ˜¯ä»å¤´å¼€å§‹æ‰§è¡Œprocess_view()å‡½æ•°ï¼›ç„¶åå†å»æ‰§è¡Œä¸urls.pyåŒ¹é…çš„è§†å›¾å‡½æ•°ï¼›</li>
<li>å¦‚æœè§†å›¾å‡½æ•°æ²¡æœ‰æŠ¥é”™ï¼Œé‚£å°±ç›´æ¥æŒ¨ä¸ªåè¿‡æ¥ä»æœ€åä¸€ä¸ªä¸­é—´ä»¶å¼€å§‹ï¼Œä¾æ¬¡å°†è¿”å›çš„å®ä¾‹å¯¹è±¡(ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨è§†å›¾å‡½æ•°ä¸­å†™çš„<br>return HttpResponse()ç­‰ç­‰)ä¼ é€’ç»™æ¯ä¸ªä¸­é—´ä»¶çš„process_responseå‡½æ•°ï¼›æœ€åå†äº¤ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ï¼›</li>
<li>å¦‚æœæ‰§è¡Œè§†å›¾å‡½æ•°å‡ºé”™ï¼Œé‚£å°±åè¿‡æ¥ä»æœ€åä¸€ä¸ªä¸­é—´ä»¶å¼€å§‹ï¼Œå°†é”™è¯¯ä¿¡æ¯ä¼ é€’ç»™æ¯ä¸ªä¸­é—´ä»¶çš„process_exception()å‡½æ•°ï¼Œèµ°å®Œæ‰€æœ‰åï¼Œç„¶åæœ€ç»ˆå†èµ°procss_responseåï¼Œæœ€ç»ˆå†äº¤ç»™å®¢æˆ·ç«¯æµè§ˆå™¨æ³¨æ„ï¼šè§†å›¾å‡½æ•°çš„é”™è¯¯æ˜¯ç”±process_exception()å‡½æ•°å¤„ç†çš„ï¼Œä»æœ€åä¸€ä¸ªä¸­é—´ä»¶å¼€å§‹ï¼Œä¾æ¬¡é€çº§æäº¤æ•æ‰åˆ°çš„å¼‚å¸¸ç„¶åæœ€ç»ˆäº¤ç»™procss_response()å‡½æ•°ï¼Œå°†æœ€ç»ˆçš„é”™è¯¯ä¿¡æ¯äº¤ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚</li>
<li>è¿‡ç¨‹<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/pic/55-2.jpg" alt="è¿‡ç¨‹"></li>
</ol>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">https://zhuanlan.zhihu.com/p/39275116</span><br><span class="line">https://blog.csdn.net/mbl114/article/details/78220606</span><br><span class="line">https://blog.csdn.net/lm_is_dc/article/details/80527298</span><br><span class="line">https://code.ziqiangxuetang.com/django/django-middleware.html</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
      </tags>
  </entry>
  <entry>
    <title>Python --- äºŒå‰æŸ¥æ‰¾æ ‘è½¬å˜ä¸ºæœ‰åºåŒå‘é“¾è¡¨</title>
    <url>/2020/05/23/%E4%BA%8C%E5%8F%89%E6%9F%A5%E6%89%BE%E6%A0%91%E8%BD%AC%E5%8F%98%E4%B8%BA%E6%9C%89%E5%BA%8F%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8/</url>
    <content><![CDATA[<p>ä¸€é“å¾®è½¯çš„é¢è¯•é¢˜: è¾“å…¥ä¸€æ£µäºŒå…ƒæŸ¥æ‰¾æ ‘ï¼Œå°†è¯¥äºŒå…ƒæŸ¥æ‰¾æ ‘è½¬æ¢æˆä¸€ä¸ªæ’åºçš„åŒå‘é“¾è¡¨ã€‚</p>
<a id="more"></a>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-5-24 22:40</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, value, left=None, right=None)</span>:</span></span><br><span class="line">        self.value = value</span><br><span class="line">        self.left = left</span><br><span class="line">        self.right = right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tree2DoubleLink</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.root = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.root:</span><br><span class="line">            self.root = Node(value)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.__insert(value, self.root)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__insert</span><span class="params">(self, value, node)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> node:</span><br><span class="line">            node = Node(value)</span><br><span class="line">        <span class="keyword">elif</span> value &lt;= node.value:</span><br><span class="line">            node.left = self.__insert(value, node.left)</span><br><span class="line">        <span class="keyword">elif</span> value &gt; node.value:</span><br><span class="line">            node.right = self.__insert(value, node.right)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mid_order</span><span class="params">(self, node)</span>:</span></span><br><span class="line">        <span class="comment"># ä¸­åºéå†</span></span><br><span class="line">        <span class="keyword">if</span> node:</span><br><span class="line">            self.mid_order(node.left)</span><br><span class="line">            print(node.value, end=<span class="string">' '</span>)</span><br><span class="line">            self.mid_order(node.right)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tree_to_link</span><span class="params">(self, node)</span>:</span></span><br><span class="line">        <span class="comment"># å°†äºŒå‰æ’åºæ ‘è½¬æˆåŒå‘é“¾è¡¨</span></span><br><span class="line">        <span class="comment"># æ·»åŠ </span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'head'</span>):</span><br><span class="line">            <span class="comment"># å¤´ç»“ç‚¹</span></span><br><span class="line">            self.head = <span class="literal">None</span></span><br><span class="line">            <span class="comment"># ç§»åŠ¨çš„èŠ‚ç‚¹</span></span><br><span class="line">            self.cur = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä¸­åºéå†</span></span><br><span class="line">        <span class="keyword">if</span> node:</span><br><span class="line">            self.tree_to_link(node.left)</span><br><span class="line">            <span class="comment"># åˆ›å»ºå¤´ç»“ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.head:</span><br><span class="line">                self.head = node</span><br><span class="line">            <span class="comment"># ç§»åŠ¨çš„èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="keyword">not</span> self.cur:</span><br><span class="line">                self.cur = node</span><br><span class="line">                <span class="comment"># å¤´ç»“ç‚¹æŒ‡å‘ç¬¬äºŒä¸ªèŠ‚ç‚¹</span></span><br><span class="line">                self.head.right = self.cur</span><br><span class="line">                <span class="comment"># ç¬¬äºŒä¸ªèŠ‚ç‚¹çš„å·¦æŒ‡é’ˆæŒ‡å‘å¤´èŠ‚ç‚¹</span></span><br><span class="line">                self.cur.left = self.head</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># å‰ä¸€ä¸ªèŠ‚ç‚¹çš„å³æŒ‡é’ˆæŒ‡å‘å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">                self.cur.right = node</span><br><span class="line">                <span class="comment"># å½“å‰èŠ‚ç‚¹çš„å·¦æŒ‡é’ˆæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">                node.left = self.cur</span><br><span class="line">                <span class="comment"># æ›¿æ¢</span></span><br><span class="line">                self.cur = node</span><br><span class="line">            self.tree_to_link(node.right)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.head</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    tree = Tree2DoubleLink()</span><br><span class="line">    <span class="comment"># éšæœºè¾“å…¥</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> [random.randint(<span class="number">0</span>, <span class="number">100</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">10</span>)]:</span><br><span class="line">        tree.insert(i)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¸­åºéå†</span></span><br><span class="line">    tree.mid_order(tree.root)</span><br><span class="line">    print(<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è½¬æˆåŒå‘é“¾è¡¨</span></span><br><span class="line">    head = tree.tree_to_link(tree.root)</span><br><span class="line">    <span class="comment"># ä»å¤´èŠ‚ç‚¹å¼€å§‹è¾“å‡º</span></span><br><span class="line">    <span class="keyword">while</span> head <span class="keyword">and</span> head.right:</span><br><span class="line">        print(head.value, end=<span class="string">' '</span>)</span><br><span class="line">        head = head.right</span><br><span class="line">    print(head.value)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä»å°¾èŠ‚ç‚¹å¼€å§‹è¾“å‡º</span></span><br><span class="line">    tail = head</span><br><span class="line">    <span class="keyword">while</span> tail:</span><br><span class="line">        print(tail.value, end=<span class="string">' '</span>)</span><br><span class="line">        tail = tail.left</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>æ•°æ®ç»“æ„ -- åˆ¤æ–­å•é“¾è¡¨æ˜¯å¦æœ‰ç¯çš„ä¸¤ç§æ–¹æ³•</title>
    <url>/2020/05/23/%E5%88%A4%E6%96%AD%E5%8D%95%E9%93%BE%E8%A1%A8%E6%98%AF%E5%90%A6%E6%9C%89%E7%8E%AF%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æœ‰ç¯å•é“¾è¡¨</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">(object)</span>:</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data, next=None)</span>:</span></span><br><span class="line">      self.data = data</span><br><span class="line">      self.next = next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CircleLinklist</span><span class="params">(object)</span>:</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">      self.head = <span class="literal">None</span></span><br><span class="line">      self.length = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, node)</span>:</span></span><br><span class="line">      <span class="keyword">if</span> self.length == <span class="number">0</span>:</span><br><span class="line">         self.head = node</span><br><span class="line">         self.length += <span class="number">1</span></span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      cur = self.head</span><br><span class="line">      <span class="keyword">while</span> cur.next:</span><br><span class="line">         cur = cur.next</span><br><span class="line"></span><br><span class="line">      cur.next = node</span><br><span class="line">      self.length += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">traverse</span><span class="params">(self)</span>:</span></span><br><span class="line">      cur = self.head</span><br><span class="line">      <span class="keyword">while</span> cur <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">         print(cur.data)</span><br><span class="line">         cur = cur.next</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">judge_circle_quick_slow_pointer</span><span class="params">(self)</span>:</span></span><br><span class="line">      <span class="string">"""</span></span><br><span class="line"><span class="string">      åˆ¤æ–­å•é“¾è¡¨æ˜¯å¦æœ‰ç¯</span></span><br><span class="line"><span class="string">      å¦‚æœåœ¨æŸä¸ªæ—¶å€™,å¿«æŒ‡é’ˆè¿½ä¸Šäº†æ…¢æŒ‡é’ˆ,é‚£ä¹ˆä¾¿è¯´æ˜æœ‰ç¯</span></span><br><span class="line"><span class="string">      """</span></span><br><span class="line">      <span class="comment"># å¿«æŒ‡é’ˆ,æ¯æ¬¡èµ°ä¸¤ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">      quick = self.head</span><br><span class="line">      <span class="comment"># æ…¢æŒ‡é’ˆ,æ¯æ¬¡èµ°ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">      slow = self.head</span><br><span class="line"></span><br><span class="line">      <span class="comment"># æ ‡å¿—,åˆ¤æ–­æ˜¯å¦æœ‰ç¯</span></span><br><span class="line">      flag = <span class="literal">False</span></span><br><span class="line">      <span class="comment"># æ¯ä¸ªæŒ‡é’ˆçš„æ­¥æ•°</span></span><br><span class="line">      count = <span class="number">0</span></span><br><span class="line">      <span class="comment"># åŠ ä¸Štry-exceptï¼Œå› ä¸ºåœ¨æ²¡ç¯çš„æƒ…å†µä¸‹ï¼Œå¿«æŒ‡é’ˆä¼šå‡ºé”™</span></span><br><span class="line">      <span class="keyword">try</span>:</span><br><span class="line">         <span class="comment"># å¾ªç¯ç»ˆæ­¢æ¡ä»¶,å¦‚æœæŸä¸ªèŠ‚ç‚¹çš„nextä¸ºç©º,å°±è¯´æ˜æ²¡æœ‰ç¯äº†</span></span><br><span class="line">         <span class="keyword">while</span> quick.next.next <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> slow.next <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            <span class="comment"># æ’é™¤ç¬¬ä¸€æ¬¡ç›¸ç­‰çš„æƒ…å†µ</span></span><br><span class="line">            <span class="comment"># ç”¨åé¢é‚£ä¸ªæ¡ä»¶åšåˆ¤æ–­ä¸æ˜¯ä¸ªå¥½æƒ³æ³•ï¼Œä¸‡ä¸€ç¯çš„èµ·ç‚¹å°±æ˜¯headï¼Œç„¶åèŠ‚ç‚¹ä¸ªæ•°åˆæ˜¯å¶æ•°çš„è¯ï¼Œä¸ä¼šåœæ­¢äº†å§</span></span><br><span class="line">            <span class="keyword">if</span> quick.data == slow.data <span class="keyword">and</span> count != <span class="number">1</span>:  <span class="comment"># quick != self.head</span></span><br><span class="line">               print(<span class="string">'å¿«æŒ‡é’ˆè¿½ä¸Šæ…¢æŒ‡é’ˆæ—¶çš„èŠ‚ç‚¹çš„å€¼: '</span>,quick.data)</span><br><span class="line">               flag = <span class="literal">True</span></span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># ä¸€æ¬¡è·¨ä¸¤ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            quick = quick.next.next</span><br><span class="line">            <span class="comment"># ä¸€æ¬¡è·¨ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            slow = slow.next</span><br><span class="line">      <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">         print(e.args)</span><br><span class="line">         print(<span class="string">'quickæ¡ä»¶æŠ¥é”™ï¼Œè¯´æ˜æ²¡æœ‰ç¯'</span>)</span><br><span class="line">      <span class="keyword">finally</span>:</span><br><span class="line">         print(<span class="string">'æ­¥æ•°: '</span>, count)</span><br><span class="line">         print(<span class="string">'æ˜¯å¦æœ‰ç¯: '</span>, flag)</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">judge_circle_by_traversing</span><span class="params">(self)</span>:</span></span><br><span class="line">      <span class="string">"""</span></span><br><span class="line"><span class="string">      å°†æ¯ä¸ªéå†è¿‡çš„èŠ‚ç‚¹ä¿å­˜åˆ°é›†åˆä¸­ï¼Œå¦‚æœä¸‹ä¸€æ¬¡éå†çš„èŠ‚ç‚¹åœ¨é›†åˆä¸­äº†ï¼Œå°±è¯´æ˜æœ‰ç¯</span></span><br><span class="line"><span class="string">      è¿™ä¸ªæ–¹æ³•å¾ˆå‚»ï¼Œä½†å´å¯ä»¥å¾—åˆ°ç¯çš„ç‚¹æ˜¯å“ªä¸ª</span></span><br><span class="line"><span class="string">      å¿«æ…¢æŒ‡é’ˆåªèƒ½åˆ¤æ–­æ˜¯å¦æœ‰ç¯ï¼Œä¸èƒ½å¾—åˆ°ç¯çš„èµ·ç‚¹</span></span><br><span class="line"><span class="string">      """</span></span><br><span class="line">      nodes = []</span><br><span class="line">      cur = self.head</span><br><span class="line">      <span class="keyword">while</span> cur <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">         <span class="keyword">if</span> cur <span class="keyword">not</span> <span class="keyword">in</span> nodes:</span><br><span class="line">            nodes.append(cur)</span><br><span class="line">         <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'æœ‰ç¯ï¼Œç¯çš„å€¼æ˜¯: '</span>, cur.data)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">         cur = cur.next</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">         print(<span class="string">'æ²¡æœ‰ç¯'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">   cl = CircleLinklist()</span><br><span class="line">   nodes = []</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">'ABCDEFGHIJKLMN'</span>:</span><br><span class="line">      nodes.append(Node(i))</span><br><span class="line">   nodes[len(nodes) - <span class="number">1</span>].next = nodes[<span class="number">5</span>]  <span class="comment"># å°†æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„nextæŒ‡å‘F</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> node <span class="keyword">in</span> nodes:</span><br><span class="line">      cl.insert(node)</span><br><span class="line"></span><br><span class="line">   <span class="comment"># cl.traverse()</span></span><br><span class="line"></span><br><span class="line">   cl.judge_circle_quick_slow_pointer()</span><br><span class="line">   print(<span class="string">'-'</span> * <span class="number">80</span>)</span><br><span class="line">   cl.judge_circle_by_traversing()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
  </entry>
  <entry>
    <title>Django-rest-framework --- é™æµ</title>
    <url>/2020/05/23/django-rest-framework-%E9%99%90%E6%B5%81/</url>
    <content><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>é™æµå°±æ˜¯é™åˆ¶è®¿é—®,å°±æ˜¯é€šå¸¸ä¸€ä¸ªç”¨æˆ·åœ¨å¤šæ¬¡è¯·æ±‚ä¸€ä¸ªé¡µé¢ï¼Œæˆ–è€…ç‚¹å‡»ä¸€ä¸ªé“¾æ¥çš„æ—¶å€™ï¼Œå‰å‡ æ¬¡ç‚¹å‡»æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯ä¸€æ—¦è¿ç»­å‡ æ¬¡ä¹‹åï¼Œå°±ä¼šå‡ºç°è®¿é—®å—é™ï¼Œç¦»ä¸‹ä¸€æ¬¡è®¿é—®è¿˜æœ‰50ç§’ç­‰çš„å­—æ ·ï¼Œåœ¨django<br>rest framework ä¸­æœ‰ä¸€ä¸ªä¸“é—¨çš„ç»„ä»¶æ¥åšé™åˆ¶è®¿é—®.</p>
<a id="more"></a>

<h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><h4 id="è‡ªå®šä¹‰Throttleç±»"><a href="#è‡ªå®šä¹‰Throttleç±»" class="headerlink" title="è‡ªå®šä¹‰Throttleç±»"></a>è‡ªå®šä¹‰Throttleç±»</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AllUserThrottle</span><span class="params">(throttling.SimpleRateThrottle)</span>:</span></span><br><span class="line">    <span class="comment"># ä½¿ç”¨çš„ç¼“å­˜æ–¹å¼</span></span><br><span class="line">    cache = cache</span><br><span class="line">    <span class="comment"># å¿…å¡«</span></span><br><span class="line">    scope = <span class="string">'all_user'</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cache_key</span><span class="params">(self, request, view)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> request.user.is_authenticated:</span><br><span class="line">            <span class="comment"># å¦‚æœæ˜¯ç™»å½•ç”¨æˆ·,åˆ™ä½¿ç”¨scope=user</span></span><br><span class="line">            AllUserThrottle.scope = <span class="string">'user'</span></span><br><span class="line">            ident = request.user.username</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># å¦‚æœæ˜¯æœªç™»å½•ç”¨æˆ·,åˆ™ä½¿ç”¨scope='anonymous'</span></span><br><span class="line">            AllUserThrottle.scope = <span class="string">'anonymous'</span></span><br><span class="line">            ident = self.get_ident(request)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> self.cache_format % &#123;</span><br><span class="line">            <span class="string">'scope'</span>: self.scope,</span><br><span class="line">            <span class="string">'ident'</span>: ident</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">'DEFAULT_THROTTLE_RATES'</span>: &#123;</span><br><span class="line">        <span class="string">'anonymous'</span>: <span class="string">'5/m'</span>,</span><br><span class="line">        <span class="string">'user'</span>: <span class="string">'10/m'</span>,</span><br><span class="line">        <span class="string">'all_user'</span>: <span class="string">'15/m'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThrottleApiView</span><span class="params">(generics.ListAPIView)</span>:</span></span><br><span class="line">    queryset = UserInfo.objects.all()</span><br><span class="line">    <span class="comment"># ä½¿ç”¨é™æµçš„æ–¹å¼</span></span><br><span class="line">    throttle_classes = [AllUserThrottle]</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        userinfo = [qs.user.username <span class="keyword">for</span> qs <span class="keyword">in</span> self.get_queryset()]</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> JsonResponse(json.dumps(userinfo), safe=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>å½“ç”¨æˆ·ç™»å½•çŠ¶æ€è®¿é—®ThrottleApiViewæ—¶,åªèƒ½æ¯åˆ†é’Ÿè®¿é—®10æ¬¡,å¦‚æœæ˜¯æœªç™»å½•çŠ¶æ€è®¿é—®,åªèƒ½æ¯åˆ†é’Ÿè®¿é—®5æ¬¡.<br>ä¸Šé¢çš„ä»£ç å†™æ³•æ²¡å¤ªå¤§å¿…è¦,å¯ä»¥ä»¿ç…§drfçš„AnonRateThrottleå’ŒUserRateThrottle,æ ¹æ®ä¸åŒçš„çŠ¶æ€æ¥è°ƒç”¨ä¸åŒçš„é™æµç±»,è€Œä¸æ˜¯ç”¨ä¸€ä¸ªé™æµç±»æ ¹æ®ä¸åŒçš„çŠ¶æ€æ¥ä½¿ç”¨ä¸åŒçš„scope,å¤ªä½çº§äº†.</p>
<h3 id="AnonRateThrottle-å’Œ-UserRateThrottle"><a href="#AnonRateThrottle-å’Œ-UserRateThrottle" class="headerlink" title="AnonRateThrottle å’Œ UserRateThrottle"></a>AnonRateThrottle å’Œ UserRateThrottle</h3><p>å¯¹äºæ ¹æ®ç”¨æˆ·æ˜¯å¦ç™»å½•æ¥é™åˆ¶è®¿é—®æ¬¡æ•°,drfæä¾›äº†AnonRateThrottle å’Œ<br>UserRateThrottleä¸¤ä¸ªç±»,åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸‹å³å¯é™åˆ¶ç™»å½•ç”¨æˆ·è®¿é—®10æ¬¡/åˆ†é’Ÿ,æœªç™»å½•ç”¨æˆ·é™åˆ¶5æ¬¡/åˆ†é’Ÿäº†.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK &#x3D; &#123;</span><br><span class="line">    &#39;DEFAULT_THROTTLE_CLASSES&#39;:[</span><br><span class="line">      &#39;rest_framework.throttling.AnonRateThrottle&#39;,</span><br><span class="line">      &#39;rest_framework.throttling.UserRateThrottle&#39;,</span><br><span class="line">    ],</span><br><span class="line">    &#39;DEFAULT_THROTTLE_RATES&#39;: &#123;</span><br><span class="line">        &#39;anon&#39;: &#39;5&#x2F;m&#39;,</span><br><span class="line">        &#39;user&#39;: &#39;10&#x2F;m&#39;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶,ä¸æ¨èä¸Šè¿°å†™æ³•,æœ€å¥½æŠŠé™æµç±»å†™å…¥è§†å›¾ç±»ä¸­,ä¸è¦å…¨å±€å®šä¹‰.</p>
<h3 id="æºä»£ç "><a href="#æºä»£ç " class="headerlink" title="æºä»£ç "></a>æºä»£ç </h3><h4 id="initial"><a href="#initial" class="headerlink" title="initial"></a>initial</h4><p>rest_framework.views.APIView:<br>ä¼šåœ¨åˆå§‹åŒ–æ—¶,æ£€æŸ¥é™æµ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initial</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">    self.check_throttles(request)</span><br></pre></td></tr></table></figure>
<h4 id="check-throttles"><a href="#check-throttles" class="headerlink" title="check_throttles"></a>check_throttles</h4><p>rest_framework.views.APIView:<br>ä¼šè·å–è‡ªå®šä¹‰çš„throttle_classesåˆ—è¡¨(å¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤çš„),è°ƒç”¨allow_requestå‡½æ•°åˆ¤æ–­æ˜¯å¦è¢«é™æµ,å¦‚æœé™æµäº†å°±<br>æŠ›å‡ºå¼‚å¸¸,å¹¶æç¤ºè¿˜éœ€è¦å¤šä¹…æ‰èƒ½å†æ¬¡è®¿é—®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_throttles</span><span class="params">(self, request)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Check if request should be throttled.</span></span><br><span class="line"><span class="string">    Raises an appropriate exception if the request is throttled.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> throttle <span class="keyword">in</span> self.get_throttles():</span><br><span class="line">        <span class="comment"># å½“è¿”å›Noneæˆ–è€…Falseä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="comment"># è¿”å›ä¸ºTrue,è¡¨ç¤ºå¯ä»¥æ­£å¸¸è®¿é—®</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> throttle.allow_request(request, self):</span><br><span class="line">            self.throttled(request, throttle.wait())</span><br><span class="line"> </span><br><span class="line"><span class="comment"># è·å–throttle_classåˆ—è¡¨æ•°æ®</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_throttles</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Instantiates and returns the list of throttles that this view uses.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> [throttle() <span class="keyword">for</span> throttle <span class="keyword">in</span> self.throttle_classes]</span><br><span class="line"><span class="comment"># é»˜è®¤å€¼</span></span><br><span class="line">throttle_classes = api_settings.DEFAULT_THROTTLE_CLASSES</span><br></pre></td></tr></table></figure>

<h4 id="SimpleRateThrottle"><a href="#SimpleRateThrottle" class="headerlink" title="SimpleRateThrottle"></a>SimpleRateThrottle</h4><p>rest_framework.throttling:<br>ä¸€èˆ¬æˆ‘ä»¬è‡ªå®šä¹‰é™æµç±»éƒ½ä¼šç»§æ‰¿è¯¥ç±»,å¹¶ä¸”é‡å†™scopeå±æ€§,ä»¥åŠget_cache_key()å‡½æ•°.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleRateThrottle</span><span class="params">(BaseThrottle)</span>:</span></span><br><span class="line">    <span class="comment"># ä½¿ç”¨å“ªç§ç¼“å­˜</span></span><br><span class="line">    cache = default_cache</span><br><span class="line">    <span class="comment"># æ—¶é—´æˆ³</span></span><br><span class="line">    timer = time.time</span><br><span class="line">    <span class="comment"># å­˜å…¥ç¼“å­˜æ—¶çš„keyå€¼</span></span><br><span class="line">    cache_format = <span class="string">'throttle_%(scope)s_%(ident)s'</span></span><br><span class="line">    <span class="comment"># è‡ªå®šä¹‰æ—¶å¿…é¡»é‡å†™</span></span><br><span class="line">    scope = <span class="literal">None</span></span><br><span class="line">    <span class="comment"># é¢‘ç‡è®¾ç½® &#123; â€˜userâ€™: â€˜10/mâ€™ &#125;</span></span><br><span class="line">    THROTTLE_RATES = api_settings.DEFAULT_THROTTLE_RATES</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> getattr(self, <span class="string">'rate'</span>, <span class="literal">None</span>):</span><br><span class="line">            self.rate = self.get_rate()</span><br><span class="line">        <span class="comment"># é…ç½®æ–‡ä»¶ä¸­ä¸€å®šè®¿é—®æ—¶é—´å†…çš„è®¿é—®æ¬¡æ•°</span></span><br><span class="line">        self.num_requests, self.duration = self.parse_rate(self.rate)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># è‡ªå®šä¹‰æ—¶å¿…é¡»é‡å†™,æ”¾å›æŸé™æµä¸‹çš„å”¯ä¸€å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cache_key</span><span class="params">(self, request, view)</span>:</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">'.get_cache_key() must be overridden'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_rate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># æ²¡æœ‰scopeæ—¶æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> getattr(self, <span class="string">'scope'</span>, <span class="literal">None</span>):</span><br><span class="line">            msg = (<span class="string">"You must set either `.scope` or `.rate` for '%s'</span></span><br><span class="line"><span class="string">throttle"</span> %</span><br><span class="line">                   self.__class__.__name__)</span><br><span class="line">            <span class="keyword">raise</span> ImproperlyConfigured(msg)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># è¿”å›é¢‘ç‡,ç±»ä¼¼ â€˜10/mâ€™ä¹‹ç±»</span></span><br><span class="line">            <span class="keyword">return</span> self.THROTTLE_RATES[self.scope]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            msg = <span class="string">"No default throttle rate set for '%s' scope"</span> %</span><br><span class="line">self.scope</span><br><span class="line">            <span class="keyword">raise</span> ImproperlyConfigured(msg)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># è¿”å›é¢‘ç‡å…ƒç¥–</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_rate</span><span class="params">(self, rate)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> rate <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">        num, period = rate.split(<span class="string">'/'</span>)</span><br><span class="line">        num_requests = int(num)</span><br><span class="line">        duration = &#123;<span class="string">'s'</span>: <span class="number">1</span>, <span class="string">'m'</span>: <span class="number">60</span>, <span class="string">'h'</span>: <span class="number">3600</span>, <span class="string">'d'</span>: <span class="number">86400</span>&#125;[period[<span class="number">0</span>]]</span><br><span class="line">        <span class="keyword">return</span> (num_requests, duration)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">allow_request</span><span class="params">(self, request, view)</span>:</span></span><br><span class="line">        <span class="comment"># æ˜¯å¦é™åˆ¶è®¿é—®é¢‘ç‡</span></span><br><span class="line">        <span class="comment"># å½“é™åˆ¶çš„é¢‘ç‡ä¸ºç©ºæ—¶,ä¸ä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">if</span> self.rate <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment"># è·å–ç”¨æˆ·çš„å”¯ä¸€æ ‡å¿—</span></span><br><span class="line">        self.key = self.get_cache_key(request, view)</span><br><span class="line">        <span class="keyword">if</span> self.key <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment"># è·å–ç”¨æˆ·çš„å†å²è®¿é—®æ¬¡æ•°</span></span><br><span class="line">        self.history = self.cache.get(self.key, [])</span><br><span class="line">        <span class="comment"># å½“å‰æ—¶é—´</span></span><br><span class="line">        self.now = self.timer()</span><br><span class="line"> </span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">å¦‚æœä¹‹å‰å·²ç»è®¿é—®è¿‡è¯¥é“¾æ¥,ä½†è·ç¦»å½“å‰æ—¶é—´æœ€é•¿çš„ä¸€æ¬¡è®¿é—®è¶…è¿‡äº†duration,</span><br><span class="line">        <span class="comment"># å°±å°†å…¶åˆ é™¤</span></span><br><span class="line">        <span class="comment"># å¾ªç¯åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">while</span> self.history <span class="keyword">and</span> self.history[<span class="number">-1</span>] &lt;= self.now -</span><br><span class="line">self.duration:</span><br><span class="line">            self.history.pop()</span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">åˆ é™¤<span class="string">"è¿‡æœŸ"</span>æ—¶é—´å,å‰©ä¸‹çš„è®¿é—®æ¬¡æ•°ä»ç„¶å¤§äºç­‰äºé™åˆ¶æ¬¡æ•°,é‚£ä¹ˆå°±é™åˆ¶è®¿é—®</span><br><span class="line">        <span class="keyword">if</span> len(self.history) &gt;= self.num_requests:</span><br><span class="line">            <span class="keyword">return</span> self.throttle_failure()</span><br><span class="line">        <span class="comment"># æ­£å¸¸è®¿é—®</span></span><br><span class="line">        <span class="keyword">return</span> self.throttle_success()</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># å¯ä»¥æ­£å¸¸è®¿é—®</span></span><br><span class="line">    <span class="comment"># å°†è®¿é—®æ—¶é—´æ’å…¥åˆ—è¡¨é¦–ä½</span></span><br><span class="line">    <span class="comment"># æ›´æ–°ç¼“å­˜ä¿¡æ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">throttle_success</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.history.insert(<span class="number">0</span>, self.now)</span><br><span class="line">        self.cache.set(self.key, self.history, self.duration)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># é™åˆ¶è®¿é—®</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">throttle_failure</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># ä¸å¯è®¿é—®æ—¶çš„ç­‰å¾…æ—¶é—´</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wait</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># å¦‚æœæœ‰è®¿é—®è®°å½•,å°±è¿”å›é™åˆ¶æ—¶é—´-æœ€æ–°ä¸€æ¬¡è®¿é—®æ—¶é—´</span></span><br><span class="line">        <span class="comment"># å¦åˆ™è¿”å›æ€»çš„é™åˆ¶æ—¶é—´</span></span><br><span class="line">        <span class="keyword">if</span> self.history:</span><br><span class="line">            remaining_duration = self.duration - (self.now -</span><br><span class="line">self.history[<span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            remaining_duration = self.duration</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># TODO æ²¡çœ‹æ‡‚</span></span><br><span class="line">        available_requests = self.num_requests - len(self.history) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> available_requests &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> remaining_duration / float(available_requests)</span><br></pre></td></tr></table></figure>

<h4 id="get-ident"><a href="#get-ident" class="headerlink" title="get_ident"></a>get_ident</h4><p>rest_framework.BaseThrottle:<br>å¦‚æœç”¨æˆ·æ²¡æœ‰è¿”å›å”¯ä¸€çš„å€¼,é‚£ä¹ˆå¯ä»¥è°ƒç”¨è¯¥å‡½æ•°,ç”¨ipåœ°å€åšå”¯ä¸€å€¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_ident</span><span class="params">(self, request)</span>:</span></span><br><span class="line">    xff = request.META.get(<span class="string">'HTTP_X_FORWARDED_FOR'</span>)</span><br><span class="line">    remote_addr = request.META.get(<span class="string">'REMOTE_ADDR'</span>)</span><br><span class="line">    num_proxies = api_settings.NUM_PROXIES</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> num_proxies <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">if</span> num_proxies == <span class="number">0</span> <span class="keyword">or</span> xff <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> remote_addr</span><br><span class="line">        addrs = xff.split(<span class="string">','</span>)</span><br><span class="line">        client_addr = addrs[-min(num_proxies, len(addrs))]</span><br><span class="line">        <span class="keyword">return</span> client_addr.strip()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(xff.split()) <span class="keyword">if</span> xff <span class="keyword">else</span> remote_addr</span><br></pre></td></tr></table></figure>

<h4 id="drfå®šä¹‰é™æµç±»ä»‹ç»"><a href="#drfå®šä¹‰é™æµç±»ä»‹ç»" class="headerlink" title="drfå®šä¹‰é™æµç±»ä»‹ç»"></a>drfå®šä¹‰é™æµç±»ä»‹ç»</h4><p>rest_framework.throttling:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserRateThrottle</span><span class="params">(SimpleRateThrottle)</span>:</span></span><br><span class="line">    scope = <span class="string">'user'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cache_key</span><span class="params">(self, request, view)</span>:</span></span><br><span class="line">        <span class="comment"># å¦‚æœç™»å½•äº†,åˆ™è¿”å›pk</span></span><br><span class="line">        <span class="comment"># å¦åˆ™è¿”å›ip</span></span><br><span class="line">        <span class="keyword">if</span> request.user.is_authenticated:</span><br><span class="line">            ident = request.user.pk</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ident = self.get_ident(request)</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># éœ€è¦æ‹¼æ¥å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">return</span> self.cache_format % &#123;</span><br><span class="line">            <span class="string">'scope'</span>: self.scope,</span><br><span class="line">            <span class="string">'ident'</span>: ident</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnonRateThrottle</span><span class="params">(SimpleRateThrottle)</span>:</span></span><br><span class="line">    scope = <span class="string">'anon'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cache_key</span><span class="params">(self, request, view)</span>:</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">ä¸ºäº†é¿å…ä¸userçš„å†²çª,å¦‚æœåœ¨è®¾ç½®anonæ—¶,å¦‚æœå·²ç»ç™»å½•äº†,é‚£ä¹ˆå°±è¿”å›<span class="literal">None</span>,ä¸è®°å½•æ¬¡æ•°</span><br><span class="line">        <span class="keyword">if</span> request.user.is_authenticated:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>  <span class="comment"># Only throttle unauthenticated requests.</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment"># æ‹¼æ¥å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">return</span> self.cache_format % &#123;</span><br><span class="line">            <span class="string">'scope'</span>: self.scope,</span><br><span class="line">            <span class="string">'ident'</span>: self.get_ident(request)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h4 id="è‡ªå®šä¹‰throttleå¼‚å¸¸"><a href="#è‡ªå®šä¹‰throttleå¼‚å¸¸" class="headerlink" title="è‡ªå®šä¹‰throttleå¼‚å¸¸"></a>è‡ªå®šä¹‰throttleå¼‚å¸¸</h4><p>åœ¨APIViewç±»ä¸‹æœ‰ä¸ªthrottled()å‡½æ•°,é‡å†™è¯¥å‡½æ•°å°±å¯å®ç°è‡ªå®šä¹‰å¼‚å¸¸<br>rest_framework.views.APIView:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">throttled</span><span class="params">(self, request, wait)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    If request is throttled, determine what kind of exception to raise.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">raise</span> exceptions.Throttled(wait)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># rest_framework.exceptions:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Throttled</span><span class="params">(APIException)</span>:</span></span><br><span class="line">    status_code = status.HTTP_429_TOO_MANY_REQUESTS</span><br><span class="line">    default_detail = _(<span class="string">'Request was throttled.'</span>)</span><br><span class="line">    extra_detail_singular = <span class="string">'Expected available in &#123;wait&#125; second.'</span></span><br><span class="line">    extra_detail_plural = <span class="string">'Expected available in &#123;wait&#125; seconds.'</span></span><br><span class="line">    default_code = <span class="string">'throttled'</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, wait=None, detail=None, code=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> detail <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            detail = force_text(self.default_detail)</span><br><span class="line">        <span class="keyword">if</span> wait <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            wait = math.ceil(wait)</span><br><span class="line">            detail = <span class="string">' '</span>.join((</span><br><span class="line">                detail,</span><br><span class="line">force_text(ungettext(self.extra_detail_singular.format(wait=wait),</span><br><span class="line">self.extra_detail_plural.format(wait=wait),</span><br><span class="line">                                     wait))))</span><br><span class="line">        self.wait = wait</span><br><span class="line">        super(Throttled, self).__init__(detail, code)</span><br></pre></td></tr></table></figure>
<p>ä¾‹å¦‚:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> exceptions</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">throttled</span><span class="params">(self, request, wait)</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyThrottled</span><span class="params">(exceptions.Throttled)</span>:</span></span><br><span class="line">        default_detail = <span class="string">'è¯·æ±‚è¢«é™åˆ¶.'</span></span><br><span class="line">        extra_detail_singular = <span class="string">'Expected available in &#123;wait&#125; second.'</span></span><br><span class="line">        extra_detail_plural = <span class="string">'è¿˜éœ€è¦å†ç­‰å¾…&#123;wait&#125;'</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">raise</span> MyThrottled(wait)</span><br></pre></td></tr></table></figure>

<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;cjaaron&#x2F;p&#x2F;10443725.html</span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;eric_yi&#x2F;p&#x2F;8424424.html</span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_42487752&#x2F;article&#x2F;details&#x2F;85328307</span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;supery007&#x2F;p&#x2F;8423769.html</span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;welan&#x2F;p&#x2F;10138615.html</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
        <tag>django-rest-framework</tag>
      </tags>
  </entry>
  <entry>
    <title>Django --- è¯·æ±‚åˆ°å“åº”æºç åˆ†æ</title>
    <url>/2020/05/23/django-%E8%AF%B7%E6%B1%82%E5%88%B0%E5%93%8D%E5%BA%94%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<p>webåº”ç”¨æˆ–è€…ç½‘ç«™æœ¬è´¨ä¸Šéƒ½æ˜¯å›´ç»•ç€è¯·æ±‚-å“åº”çš„æ–¹å¼æ¥è¿ä½œçš„ã€‚å½“ä½ é€šè¿‡æµè§ˆå™¨è®¿é—®ç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨ä¼šå‘webæœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚å½“webæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼ŒæœåŠ¡å™¨ä¼šå¯¹è¯·æ±‚è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œç„¶åè¿”å›ç›¸åº”çš„å“åº”ç»™æµè§ˆå™¨ï¼Œæœ€åæµè§ˆå™¨å‘ˆç°ç»™ä½ ã€‚</p>
<h3 id="å…¥å£"><a href="#å…¥å£" class="headerlink" title="å…¥å£"></a>å…¥å£</h3><p>è¿™æ˜¯webæœåŠ¡å™¨è½¬å‘è¯·æ±‚åˆ°djangoåº”ç”¨çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯è¿”å›å“åº”çš„åœ°æ–¹ã€‚</p>
<p>è·¯å¾„: <code>xxx.wsgi.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.core.wsgi <span class="keyword">import</span> get_wsgi_application</span><br><span class="line"><span class="comment"># è®¾ç½®djangoè¦ä½¿ç”¨çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">os.environ.setdefault(<span class="string">'DJANGO_SETTINGS_MODULE'</span>, <span class="string">'JwtDemo.settings'</span>)</span><br><span class="line"></span><br><span class="line">application = get_wsgi_application()</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="WSGIHandler"><a href="#WSGIHandler" class="headerlink" title="WSGIHandler"></a>WSGIHandler</h3><p>åˆå§‹åŒ–è¯·æ±‚ï¼Œå¹¶è¿”å›å“åº”æ•°æ®ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WSGIHandler</span><span class="params">(base.BaseHandler)</span>:</span></span><br><span class="line">    request_class = WSGIRequest</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># åŠ è½½djangoåº”ç”¨ä¸­é…ç½®çš„ä¸­é—´ä»¶ï¼Œè¯¥æ–¹æ³•æ˜¯çˆ¶ç±»BaseHandlerä¸­çš„</span></span><br><span class="line">        self.load_middleware()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, environ, start_response)</span>:</span></span><br><span class="line">        set_script_prefix(get_script_name(environ))</span><br><span class="line">        signals.request_started.send(sender=self.__class__, environ=environ)</span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–requestè¯·æ±‚</span></span><br><span class="line">        request = self.request_class(environ)</span><br><span class="line">        <span class="comment"># å¼€å§‹å¤„ç†è¯·æ±‚ï¼Œå¹¶ç”Ÿæˆå“åº”</span></span><br><span class="line">        response = self.get_response(request)</span><br><span class="line"></span><br><span class="line">        response._handler_class = self.__class__</span><br><span class="line"></span><br><span class="line">        <span class="comment"># çŠ¶æ€ç ï¼ŒçŠ¶æ€æè¿°</span></span><br><span class="line">        status = <span class="string">'%d %s'</span> % (response.status_code, response.reason_phrase)</span><br><span class="line">        <span class="comment"># å“åº”å¤´ä¿¡æ¯</span></span><br><span class="line">        response_headers = list(response.items())</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> response.cookies.values():</span><br><span class="line">            response_headers.append((<span class="string">'Set-Cookie'</span>, c.output(header=<span class="string">''</span>)))</span><br><span class="line">        start_response(status, response_headers)</span><br><span class="line">        <span class="keyword">if</span> getattr(response, <span class="string">'file_to_stream'</span>, <span class="literal">None</span>) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> environ.get(<span class="string">'wsgi.file_wrapper'</span>):</span><br><span class="line">            response = environ[<span class="string">'wsgi.file_wrapper'</span>](response.file_to_stream)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<h3 id="åŠ è½½ä¸­é—´ä»¶"><a href="#åŠ è½½ä¸­é—´ä»¶" class="headerlink" title="åŠ è½½ä¸­é—´ä»¶"></a>åŠ è½½ä¸­é—´ä»¶</h3><h4 id="load-middleware"><a href="#load-middleware" class="headerlink" title="load_middleware"></a>load_middleware</h4><p>è·¯å¾„:<code>django.core.handlers.base.BaseHandler.load_middleware</code><br>WSGIHandlerä¸­è°ƒç”¨çš„load_middlewareå‡½æ•°æ˜¯çˆ¶ç±»BaseHandlerä¸­çš„ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œä¼šæŒ‰é¡ºåºåŠ è½½æ‰€æœ‰é…ç½®çš„ä¸­é—´ä»¶ã€‚<br>ä¸»å¾ªç¯ä¼šå¯¹æ‰€æœ‰çš„ä¸­é—´ä»¶é€†åºéå†ï¼Œè€Œå°†ä¸­é—´ä»¶å‡½æ•°åŠ å…¥åˆ—è¡¨çš„é¡ºåºä¹Ÿè·Ÿå®é™…çš„æ‰§è¡Œé¡ºåºä¸€è‡´ã€‚<br><code>process_view</code>ä¼šæŒ‰ç…§ä¸­é—´ä»¶çš„å…ˆåé¡ºåºæ‰§è¡Œï¼Œæ‰€ä»¥é‡‡ç”¨äº†insert(0,xx),è€Œ<code>process_template_response</code>å’Œ<code>process_exception</code>åˆ™é‡‡ç”¨äº†appendæ“ä½œã€‚<br>è¿™ä¸ªçœ‹ç€æœ‰ç‚¹ç»•..<br>ä»¥ä¸‹é¢çš„ä¸­é—´ä»¶é…ç½®ä¸ºä¾‹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'django.middleware.security.SecurityMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.csrf.CsrfViewMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºé‡‡ç”¨äº†é€†åºéå†ï¼Œé‚£ä¹ˆæ‰§è¡Œé¡ºåºå°±æ˜¯<code>XFrameOptionsMiddleware -&gt; MessageMiddleware -&gt; ... -&gt;SecurityMiddleware</code>ï¼Œè€Œ<code>process_view</code>é‡‡ç”¨äº†insert(0,xx)çš„æ–¹æ³•ï¼Œæ‰€ä»¥<code>_view_middleware</code>ä¸­<code>process_view</code>å‡½æ•°çš„é¡ºåºå°±æ˜¯<code>SecurityMiddleware.process_view -&gt; ... -&gt; SecurityMiddleware.process_view</code>äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_middleware</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="comment"># åŠ è½½ä¸­é—´ä»¶</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¸­é—´ä»¶ä¸­çš„process_viewå‡½æ•°åˆ—è¡¨</span></span><br><span class="line">    self._view_middleware = []</span><br><span class="line">    <span class="comment"># ä¸­é—´ä»¶ä¸­çš„process_template_responseå‡½æ•°åˆ—è¡¨</span></span><br><span class="line">    self._template_response_middleware = []</span><br><span class="line">    <span class="comment"># ä¸­é—´ä»¶ä¸­çš„process_exceptionå‡½æ•°åˆ—è¡¨</span></span><br><span class="line">    self._exception_middleware = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿™æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œè£…é¥°å™¨å†…è¿”å›äº†responseï¼Œåªä¸è¿‡åŒ…è£¹äº†exceptionæ•°æ®</span></span><br><span class="line">    handler = convert_exception_to_response(self._get_response)</span><br><span class="line">    <span class="comment"># middleware_pathæ˜¯å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">for</span> middleware_path <span class="keyword">in</span> reversed(settings.MIDDLEWARE):</span><br><span class="line">        <span class="comment"># è½¬æ¢æˆå…·ä½“çš„ç±»</span></span><br><span class="line">        middleware = import_string(middleware_path)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            mw_instance = middleware(handler)</span><br><span class="line">        <span class="keyword">except</span> MiddlewareNotUsed <span class="keyword">as</span> exc:</span><br><span class="line">            <span class="keyword">if</span> settings.DEBUG:</span><br><span class="line">                <span class="keyword">if</span> str(exc):</span><br><span class="line">                    logger.debug(<span class="string">'MiddlewareNotUsed(%r): %s'</span>, middleware_path, exc)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    logger.debug(<span class="string">'MiddlewareNotUsed: %r'</span>, middleware_path)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> mw_instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> ImproperlyConfigured(</span><br><span class="line">                <span class="string">'Middleware factory %s returned None.'</span> % middleware_path</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¯¹ä¸åŒçš„ä¸­é—´ä»¶å‡½æ•°ï¼Œä½¿ç”¨ä¸åŒçš„æ’å…¥é¡ºåºï¼Œéšä»–ä»¬çš„å¤„ç†é¡ºåº</span></span><br><span class="line">        <span class="comment"># process_viewæ­£åºæ’å…¥</span></span><br><span class="line">        <span class="keyword">if</span> hasattr(mw_instance, <span class="string">'process_view'</span>):</span><br><span class="line">            self._view_middleware.insert(<span class="number">0</span>, mw_instance.process_view)</span><br><span class="line">        <span class="comment"># process_template_responseé€†åºæ’å…¥</span></span><br><span class="line">        <span class="keyword">if</span> hasattr(mw_instance, <span class="string">'process_template_response'</span>):</span><br><span class="line">            self._template_response_middleware.append(mw_instance.process_template_response)</span><br><span class="line">        <span class="comment"># process_exceptioné€†åºæ’å…¥</span></span><br><span class="line">        <span class="keyword">if</span> hasattr(mw_instance, <span class="string">'process_exception'</span>):</span><br><span class="line">            self._exception_middleware.append(mw_instance.process_exception)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># é‡æ–°å¤„ç†</span></span><br><span class="line">        handler = convert_exception_to_response(mw_instance)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ˜¯ä¸€ä¸ªä¿®é¥°å™¨å‡½æ•°ï¼Œæœ€å†…å±‚æ˜¯_get_responseï¼Œå¤–å±‚æ˜¯ä¸­é—´ä»¶</span></span><br><span class="line">    self._middleware_chain = handler</span><br></pre></td></tr></table></figure>

<h4 id="MiddlewareMixin"><a href="#MiddlewareMixin" class="headerlink" title="MiddlewareMixin"></a>MiddlewareMixin</h4><p>ä½¿ç”¨äº†mixinæ¨¡å¼ï¼Œå½“è‡ªå®šä¹‰ä¸­é—´ä»¶æ—¶ï¼Œéœ€è¦è‡ªå·±å®ç°<code>process_request</code>å’Œ<code>process_response</code>ä¸¤ä¸ªå‡½æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MiddlewareMixin</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, get_response=None)</span>:</span></span><br><span class="line">        self.get_response = get_response</span><br><span class="line">        super().__init__()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        response = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># å¤„ç†proecess_requestå‡½æ•°</span></span><br><span class="line">        <span class="keyword">if</span> hasattr(self, <span class="string">'process_request'</span>):</span><br><span class="line">            response = self.process_request(request)</span><br><span class="line">        response = response <span class="keyword">or</span> self.get_response(request)</span><br><span class="line">        <span class="comment"># å¤„ç†process_responseå‡½æ•°</span></span><br><span class="line">        <span class="keyword">if</span> hasattr(self, <span class="string">'process_response'</span>):</span><br><span class="line">            response = self.process_response(request, response)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<h4 id="get-response"><a href="#get-response" class="headerlink" title="get_response"></a>get_response</h4><p>è·¯å¾„:<code>django.core.handlers.base.get_response</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_response</span><span class="params">(self, request)</span>:</span></span><br><span class="line">    <span class="string">"""Return an HttpResponse object for the given HttpRequest."""</span></span><br><span class="line">    <span class="comment"># è®¾ç½®å¼€å§‹ä½ç½®çš„url</span></span><br><span class="line">    set_urlconf(settings.ROOT_URLCONF)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŒ…è£…äº†self._get_responseçš„è£…é¥°å™¨</span></span><br><span class="line">    response = self._middleware_chain(request)</span><br><span class="line"></span><br><span class="line">    response._closable_objects.append(request)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If the exception handler returns a TemplateResponse that has not</span></span><br><span class="line">    <span class="comment"># been rendered, force it to be rendered.</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> getattr(response, <span class="string">'is_rendered'</span>, <span class="literal">True</span>) <span class="keyword">and</span> callable(getattr(response, <span class="string">'render'</span>, <span class="literal">None</span>)):</span><br><span class="line">        response = response.render()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> response.status_code &gt;= <span class="number">400</span>:</span><br><span class="line">        log_response(</span><br><span class="line">            <span class="string">'%s: %s'</span>, response.reason_phrase, request.path,</span><br><span class="line">            response=response,</span><br><span class="line">            request=request,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<h4 id="get-response-1"><a href="#get-response-1" class="headerlink" title="_get_response"></a>_get_response</h4><p>è·¯å¾„: <code>django.core.handlers.base._get_response</code><br>è¿™ä¸ªå‡½æ•°æ˜¯çœŸæ­£çš„è°ƒç”¨è§†å›¾å‡½æ•°æˆ–è€…è§†å›¾ç±»çš„åœ°æ–¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_response</span><span class="params">(self, request)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Resolve and call the view, then apply view, exception, and</span></span><br><span class="line"><span class="string">    template_response middleware. This method is everything that happens</span></span><br><span class="line"><span class="string">    inside the request/response middleware.</span></span><br><span class="line"><span class="string">    å®é™…ä¸Šè°ƒç”¨è§†å›¾å‡½æ•°çš„åœ°æ–¹</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    response = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> hasattr(request, <span class="string">'urlconf'</span>):</span><br><span class="line">        urlconf = request.urlconf</span><br><span class="line">        set_urlconf(urlconf)</span><br><span class="line">        resolver = get_resolver(urlconf)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        resolver = get_resolver()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># é€šè¿‡urlæ“ä½œï¼Œè·å–å®é™…çš„æ‰§è¡Œå‡½æ•°</span></span><br><span class="line">    resolver_match = resolver.resolve(request.path_info)</span><br><span class="line">    callback, callback_args, callback_kwargs = resolver_match</span><br><span class="line">    request.resolver_match = resolver_match</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰§è¡Œproecess_viewä¸­é—´ä»¶å‡½æ•°</span></span><br><span class="line">    <span class="keyword">for</span> middleware_method <span class="keyword">in</span> self._view_middleware:</span><br><span class="line">        <span class="comment"># è°ƒç”¨process_viewå‡½æ•°</span></span><br><span class="line">        response = middleware_method(request, callback, callback_args, callback_kwargs)</span><br><span class="line">        <span class="comment"># å¦‚æœæŸä¸ªä¸­é—´ä»¶çš„process_viewè¿”å›äº†å€¼ï¼Œé‚£ä¹ˆå°±åœæ­¢ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> response:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> response <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># callbackæ˜¯å®é™…ä¸Šè¦æ‰§è¡Œçš„è§†å›¾å‡½æ•°æˆ–è€…è§†å›¾ç±»</span></span><br><span class="line">        wrapped_callback = self.make_view_atomic(callback)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># æ‰§è¡Œå®é™…å‡½æ•°ï¼Œè·å–è¿”å›çš„response</span></span><br><span class="line">            response = wrapped_callback(request, *callback_args, **callback_kwargs)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            response = self.process_exception_by_middleware(e, request)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Complain if the view returned None (a common error).</span></span><br><span class="line">    <span class="keyword">if</span> response <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">if</span> isinstance(callback, types.FunctionType):    <span class="comment"># FBV</span></span><br><span class="line">            view_name = callback.__name__</span><br><span class="line">        <span class="keyword">else</span>:                                           <span class="comment"># CBV</span></span><br><span class="line">            view_name = callback.__class__.__name__ + <span class="string">'.__call__'</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">raise</span> ValueError(</span><br><span class="line">            <span class="string">"The view %s.%s didn't return an HttpResponse object. It "</span></span><br><span class="line">            <span class="string">"returned None instead."</span> % (callback.__module__, view_name)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If the response supports deferred rendering, apply template</span></span><br><span class="line">    <span class="comment"># response middleware and then render the response</span></span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰§è¡Œä¸­é—´ä»¶ä¸­çš„process_template_responseå‡½æ•°</span></span><br><span class="line">    <span class="keyword">elif</span> hasattr(response, <span class="string">'render'</span>) <span class="keyword">and</span> callable(response.render):</span><br><span class="line">        <span class="comment"># éå†æ‰§è¡Œprocess_template_responseå‡½æ•°</span></span><br><span class="line">        <span class="keyword">for</span> middleware_method <span class="keyword">in</span> self._template_response_middleware:</span><br><span class="line">            response = middleware_method(request, response)</span><br><span class="line">            <span class="comment"># å¦‚æœæŸä¸ªprocess_template_responseå‡½æ•°è¿”å›äº†Noneï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            <span class="comment"># è‡ªå®šä¹‰process_template_responseå‡½æ•°æ—¶ï¼Œéœ€è¦è¿”å›response</span></span><br><span class="line">            <span class="keyword">if</span> response <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(</span><br><span class="line">                    <span class="string">"%s.process_template_response didn't return an "</span></span><br><span class="line">                    <span class="string">"HttpResponse object. It returned None instead."</span></span><br><span class="line">                    % (middleware_method.__self__.__class__.__name__)</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># è°ƒç”¨HttpResponseçš„render()å‡½æ•°ï¼Œè·å–çœŸæ­£çš„è¿”å›å€¼</span></span><br><span class="line">            response = response.render()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            response = self.process_exception_by_middleware(e, request)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>


<h4 id="HttpResponse-render"><a href="#HttpResponse-render" class="headerlink" title="HttpResponse.render"></a>HttpResponse.render</h4><p>è·¯å¾„:<code>django.template.response.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">render</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""Render (thereby finalizing) the content of the response.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If the content has already been rendered, this is a no-op.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Return the baked response instance.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    retval = self</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self._is_rendered:</span><br><span class="line">        self.content = self.rendered_content</span><br><span class="line">        <span class="keyword">for</span> post_callback <span class="keyword">in</span> self._post_render_callbacks:</span><br><span class="line">            newretval = post_callback(retval)</span><br><span class="line">            <span class="keyword">if</span> newretval <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                retval = newretval</span><br><span class="line">    <span class="keyword">return</span> retval</span><br></pre></td></tr></table></figure>

<h3 id="æ‰§è¡Œæµç¨‹æ€»ç»“"><a href="#æ‰§è¡Œæµç¨‹æ€»ç»“" class="headerlink" title="æ‰§è¡Œæµç¨‹æ€»ç»“"></a>æ‰§è¡Œæµç¨‹æ€»ç»“</h3><p>â†’ wsgi.pyæ˜¯ä¸€æ¬¡è¯·æ±‚çš„å…¥å£<br>â†’ get_wsgi_application()ï¼Œè¿”å›WSGIè°ƒç”¨å¯¹è±¡<br>â†’ WSGIHandler()ï¼Œæ¥æ”¶è¯·æ±‚\è¿”å›å“åº”å¯¹è±¡çš„ç±»<br>â†’ load_middleware()ï¼Œåœ¨åˆ›å»ºWSGIHandler()å¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨æ­¤å‡½æ•°ï¼ŒåŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„ä¸­é—´ä»¶ï¼Œåœ¨ä¸€æ¬¡æœåŠ¡å™¨å¯åŠ¨æœŸé—´ï¼Œåªæ‰§è¡Œä¸€æ¬¡<br>â†’ å°†_get_responseå‡½æ•°åšå‚æ•°ä¼ å…¥convert_exception_to_responseå‡½æ•°ï¼Œæ‰§è¡Œå‡½æ•°ä¼šè¿”å›handlerï¼Œè¯¥handlerå®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒ…è£¹äº†exceptionå’Œ_get_responseå‡½æ•°çš„è£…é¥°å™¨<br>â†’ å°†handlerèµ‹å€¼ç»™_middleware_chain<br>â†’ ä¸­é—´ä»¶åŠ è½½å®Œæ¯•<br>â†’ ä¸€æ¬¡è¯·æ±‚åˆ°è¾¾djangoæ—¶ï¼Œä¼šè°ƒç”¨djangoçš„<strong>call</strong>å‡½æ•°ï¼Œåœ¨è¯¥å‡½æ•°ä¸­ï¼Œä¼šè°ƒç”¨get_responseï¼ˆå®šä¹‰åœ¨çˆ¶ç±»BaseHandlerä¸­ï¼‰å‡½æ•°<br>â†’ åœ¨get_responseå‡½æ•°ä¸­ï¼Œä¼šæ‰§è¡Œresponse = self._middleware_chain(request)è¿™ä¸€è¡Œä»£ç ï¼Œä»ä¸Šé¢çš„æ­¥éª¤çœ‹ï¼Œä¹Ÿå°±ç›¸å½“äºæ‰§è¡Œäº†_get_responseå‡½æ•°<br>â†’ åœ¨_get_responseå‡½æ•°ä¸­ï¼Œä¼šæ‰§è¡ŒçœŸæ­£çš„è§†å›¾å‡½æ•°(callbackå’Œwrapped_callback)ï¼Œè¿”å›çš„ç»“æœresponseå¯¹è±¡<br>â†’ _get_responseæ‰§è¡Œå®Œæ¯•åï¼Œè¿”å›responseï¼Œå›åˆ°get_responseå‡½æ•°ä¸­<br>â†’ get_responseå‡½æ•°æ‹¿åˆ°_get_responseè¿”å›çš„responseå¯¹è±¡ç»§ç»­æ‰§è¡Œä¹‹åçš„ä»£ç ï¼Œæœ€åå°†responseå¯¹è±¡è¿”å›<br>â†’ get_responseå‡½æ•°ç»“æŸåï¼Œå›åˆ°WSGIHandlerçš„<strong>call</strong>å‡½æ•°ä¸­ï¼Œæ‰§è¡Œåç»­ä»£ç ï¼Œè¿”å›responseåˆ°å‰ç«¯</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>é€šè¿‡ä¸Šé¢ä»£ç åˆ†æï¼Œæˆ‘ä»¬å·²ç»å¤§è‡´äº†è§£äº†Djangoè¯·æ±‚å“åº”çš„æµç¨‹ã€‚å¤§è‡´å¦‚ä¸‹<br>ç”¨æˆ·è¯·æ±‚é¦–å…ˆä¼šåˆ°webæœåŠ¡å™¨ï¼›<br>webæœåŠ¡å™¨ä¼šæŠŠè¯·æ±‚å‘åˆ°django.core.handlers.wsgiçš„BaseHandlerï¼›<br>ç”Ÿæˆrequestï¼Œresponseï¼Œviewï¼Œ exceptionï¼Œtemplate_responseä¸­é—´ä»¶é“¾è¡¨ï¼›<br>æŒ‰ä¸­é—´ä»¶é…ç½®é¡ºåºåº”ç”¨requestä¸­é—´ä»¶æ¥å¤„ç†requestï¼Œå¦‚æœè¿™ä¸­é—´ç”Ÿæˆresponseï¼Œåˆ™ç›´æ¥è¿”å›ï¼›<br>é€šè¿‡urlresolvers.resolveåŒ¹é…è¯·æ±‚çš„urlæ¥æ‰¾åˆ°å¯¹åº”çš„viewï¼›<br>åº”ç”¨viewä¸­é—´ä»¶ï¼Œå¦‚æœæœ‰responseï¼Œåˆ™ç›´æ¥è¿”å›ï¼›<br>è°ƒç”¨å¯¹åº”çš„viewï¼Œè¿™ä¸ªè¿‡ç¨‹å’Œå’Œmodelsè¿›è¡Œäº¤äº’ï¼Œæ¯”å¦‚ä»æ•°æ®åº“è·å–æ•°æ®ç­‰ï¼Œå¹¶æ¸²æŸ“æ¨¡æ¿ï¼›<br>æ¥ç€responseä¸­é—´ä»¶ä¼šè¢«åº”ç”¨æ¥å¤„ç†repsonseï¼›<br>è¿™å…¶ä¸­å¿½ç•¥äº†ä¸€äº›å…¶ä»–é‡è¦çš„æ­¥éª¤ï¼Œæ¯”å¦‚å¼‚å¸¸ä¸­é—´ä»¶çš„è°ƒç”¨ã€‚</p>
<p>ç”¨ç½‘ä¸Šçš„ä¸€å¼ å›¾æ€»ç»“ä»¥ä¸Šï¼š<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/pic/django-%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94.png" alt=""></p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;1ff05dfb3d0d</span><br><span class="line">http:&#x2F;&#x2F;hongweipeng.com&#x2F;index.php&#x2F;archives&#x2F;1369&#x2F;#menu_index_1</span><br><span class="line">http:&#x2F;&#x2F;www.php.cn&#x2F;python-tutorials-416971.html</span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;time-read&#x2F;p&#x2F;10650988.html</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title>Python -- å››ç§å•ä¾‹æ¨¡å¼å†™æ³•</title>
    <url>/2020/05/23/python-%E5%9B%9B%E7%A7%8D%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%86%99%E6%B3%95/</url>
    <content><![CDATA[<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">é€šè¿‡å•ä¾‹æ¨¡å¼ï¼Œå¯ä»¥ä¿è¯ç³»ç»Ÿä¸­çš„è¿™ä¸ªç±»åªäº§ç”Ÿä¸€ä¸ªå¯¹è±¡ä¸”å®¹æ˜“è¢«å¤–ç•Œè®¿é—®ï¼Œæ–¹ä¾¿æ§åˆ¶ä¸ªä¾‹ä¸ªæ•°ä»¥åŠèŠ‚çœèµ„æº</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls,*args,**kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        ç¡®ä¿æ¯æ¬¡é€šè¿‡__new__å‡½æ•°ï¼Œè¿”å›çš„å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªå³å¯</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(cls,<span class="string">'_instance'</span>):</span><br><span class="line">            <span class="comment">#orig = super(Singleton,cls)</span></span><br><span class="line">            <span class="comment">#cls._instance = orig.__new__(cls,*args,**kwargs)</span></span><br><span class="line">            <span class="comment"># or</span></span><br><span class="line">            cls._instance = super().__new__(cls,*args,**kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(Singleton)</span>:</span></span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">a1 = A()</span><br><span class="line">a2 = A()</span><br><span class="line">a3 = A()</span><br><span class="line"></span><br><span class="line">print(id(a1),id(a2),id(a3))</span><br><span class="line">a1.num = <span class="number">100</span></span><br><span class="line">print(a2.num,a3.num,A.num)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'-'</span> * <span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton2</span><span class="params">(object)</span>:</span></span><br><span class="line">    _state = &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls,*args,**kwargs)</span>:</span></span><br><span class="line">        single = super().__new__(cls,*args,**kwargs)</span><br><span class="line">        single.__dict__ = cls._state</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> single</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(Singleton2)</span>:</span></span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">b1 = B()</span><br><span class="line">b2 = B()</span><br><span class="line">b3 = B()</span><br><span class="line"><span class="comment"># æ¯æ¬¡è¿”å›çš„å¯¹è±¡éƒ½ä¸ä¸€æ ·</span></span><br><span class="line">print(id(b1),id(b2),id(b3))</span><br><span class="line"></span><br><span class="line">b1.num = <span class="number">100</span></span><br><span class="line">print(b2.num,b3.num,B.num)</span><br><span class="line"><span class="comment"># ä½†è´¡çŒ®äº†__dict__çš„é­”æ³•æ–¹æ³•ï¼Œå³å…·æœ‰çš„å±æ€§ï¼Œæ•°æ®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸€ä¸ªå¯¹è±¡ä¿®æ”¹ï¼Œå…¶ä»–å¯¹è±¡è·Ÿç€ä¿®æ”¹</span></span><br><span class="line">print(b1.__dict__,b2.__dict__,b3.__dict__)</span><br><span class="line">print(b1._state)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'-'</span> * <span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">è·Ÿç¬¬ä¸€ç§æ–¹æ³•æ•ˆæœä¸€æ ·ï¼Œéƒ½æ˜¯åªç”Ÿæˆä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="string">ä½¿ç”¨ä¸€ä¸ªdictå­˜å‚¨ç±»å¯¹è±¡ï¼Œåœ¨ä½¿ç”¨è£…é¥°å™¨æ—¶å…ˆåˆ¤æ–­clsæ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™å–å‡ºï¼Œå¦åˆ™åˆ›å»ºå­˜å…¥å†å–å‡º</span></span><br><span class="line"><span class="string">å°±èƒ½ç¡®ä¿æ¯æ¬¡éƒ½æ˜¯åªä½¿ç”¨åŒä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">singleton</span><span class="params">(cls)</span>:</span></span><br><span class="line">    instances = &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getinstance</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> instances:</span><br><span class="line">            instances[cls] = cls(*args,**kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> instances[cls]</span><br><span class="line">    <span class="keyword">return</span> getinstance</span><br><span class="line"></span><br><span class="line"><span class="meta">@singleton</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(object)</span>:</span></span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">c1 = C()</span><br><span class="line">c2 = C()</span><br><span class="line">c3 = C()</span><br><span class="line">print(id(c1),id(c2),id(c3))</span><br><span class="line"></span><br><span class="line">print(<span class="string">'-'</span> * <span class="number">80</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">æ¨¡å—å¯¼å…¥ï¼Œåœ¨pythonä¸­ï¼Œæ¨¡å—æ˜¯å¤©ç„¶çš„å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"># åœ¨ single.py ä¸­çš„ç±»</span></span><br><span class="line"><span class="string">class Singleton4(object):</span></span><br><span class="line"><span class="string">    num = 0</span></span><br><span class="line"><span class="string">    def foo(self):</span></span><br><span class="line"><span class="string">        print(self.num)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">single = Singleton4()</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> single <span class="keyword">import</span> single,Singleton4</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½†ä»…é™äºæŠŠå·²ç»åˆ›å»ºå¥½çš„å®ä¾‹å¯¹è±¡å¯¼å…¥è¿›æ¥</span></span><br><span class="line">single.num = <span class="number">100</span></span><br><span class="line">single.foo()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ˜¯å¯¼å…¥äº†ç±»ï¼Œç„¶ååˆ›å»ºäº†å®ä¾‹å¯¹è±¡ï¼Œé‚£ä¹ˆè·Ÿæ™®é€šç±»æ²¡æœ‰åŒºåˆ«</span></span><br><span class="line">s1 = Singleton4()</span><br><span class="line">s2 = Singleton4()</span><br><span class="line">s3 = Singleton4()</span><br><span class="line">print(id(s1),id(s2),id(s3))</span><br><span class="line"></span><br><span class="line">s1.num = <span class="number">500</span></span><br><span class="line">print(s2.num,s3.num,Singleton4.num)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Python --- è£…é¥°å™¨çš„å‡ ç§ç”¨æ³•</title>
    <url>/2020/05/23/%E8%A3%85%E9%A5%B0%E5%99%A8%E7%9A%84%E5%87%A0%E7%A7%8D%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<p>è£…é¥°å™¨æ˜¯pythonçš„ä¸€ç§ç‰¹æ®Šå·¥å…·ï¼Œæä¾›äº†ä¸€ç§åœ¨å‡½æ•°å¤–éƒ¨ä¿®æ”¹å‡½æ•°çš„çµæ´»èƒ½åŠ›ï¼Œå¯ä»¥æ”¹å˜å‡½æ•°æœ¬èº«çš„è¡Œä¸ºï¼Œç®€å•è¯´ï¼Œå°±æ˜¯åœ¨ä¸ä¿®æ”¹å‡½æ•°ä»£ç çš„æƒ…å†µä¸‹ï¼Œç»™å‡½æ•°å¢åŠ æ–°çš„åŠŸèƒ½ã€‚ä¾‹å¦‚å¸¸ç”¨çš„<code>staticmethod</code>å’Œ<code>classmethod</code>ç­‰ã€‚</p>
<h3 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fprint</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@fprint</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="å¸¦å‚æ•°ç”¨æ³•"><a href="#å¸¦å‚æ•°ç”¨æ³•" class="headerlink" title="å¸¦å‚æ•°ç”¨æ³•"></a>å¸¦å‚æ•°ç”¨æ³•</h3><p>å¦‚æœè¦ä½¿ç”¨å¸¦å‚æ•°çš„è£…é¥°å™¨ï¼Œåˆ™éœ€è¦åœ¨åŸºæœ¬ä½¿ç”¨ä¸Šå†æ·»åŠ ä¸€å±‚å‡½æ•°ï¼Œè¯¥å±‚å‡½æ•°å¯ä»¥ç”¨æ¥æ¥æ”¶ä¼ é€’çš„å‚æ•°ã€‚<br>åœ¨æ¯ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œéƒ½éœ€è¦è¿”å›å†…å±‚å‡½æ•°å¯¹è±¡ï¼Œæœ€å†…å±‚çš„æ‰§è¡Œfuncçš„å‡½æ•°é™¤å¤–ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fprint</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorate</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            print(<span class="string">'&gt;&gt;&gt;name = '</span> + str(name))</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@fprint('hello')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'foo...'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨ç±»æ¥å®ç°è£…é¥°å™¨"><a href="#ä½¿ç”¨ç±»æ¥å®ç°è£…é¥°å™¨" class="headerlink" title="ä½¿ç”¨ç±»æ¥å®ç°è£…é¥°å™¨"></a>ä½¿ç”¨ç±»æ¥å®ç°è£…é¥°å™¨</h3><p>ç»å¤§å¤šæ•°è£…é¥°å™¨éƒ½æ˜¯åŸºäºå‡½æ•°å’Œé—­åŒ…å®ç°çš„ï¼Œä½†è¿™å¹¶éåˆ¶é€ è£…é¥°å™¨çš„å”¯ä¸€æ–¹å¼ã€‚äº‹å®ä¸Šï¼Œpythonå¯¹æŸä¸ªå¯¹è±¡æ˜¯å¦èƒ½é€šè¿‡è£…é¥°å™¨å½¢å¼ä½¿ç”¨åªæœ‰ä¸€ä¸ªè¦æ±‚:</p>
<blockquote>
<p>decoratorå¿…é¡»æ˜¯ä¸€ä¸ªâ€œå¯è¢«è°ƒç”¨(callable)çš„å¯¹è±¡â€<br>å‡½æ•°è‡ªç„¶æ˜¯â€œå¯è¢«è°ƒç”¨â€çš„å¯¹è±¡ã€‚ä½†é™¤äº†å‡½æ•°å¤–ï¼Œç±»ä¹Ÿæ˜¯å¯è°ƒç”¨çš„ï¼Œåªè¦å®ç°<code>__call__</code>é­”æ³•æ–¹æ³•å³å¯ã€‚åŸºäºè¿™ä¸ª ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä½¿ç”¨ç±»æ¥å®ç°è£…é¥°å™¨ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-6-2 15:44</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DelayFunc</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, duration, func)</span>:</span></span><br><span class="line">        self.duration = duration</span><br><span class="line">        self.func = func</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">f'Wait for <span class="subst">&#123;self.duration&#125;</span> seconds...'</span>)</span><br><span class="line">        time.sleep(self.duration)</span><br><span class="line">        <span class="keyword">return</span> self.func(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">eager_call</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'No Wait...'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.func(*args, **kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delay</span><span class="params">(duration)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> functools.partial(DelayFunc, duration)</span><br><span class="line"></span><br><span class="line"><span class="meta">@delay(1)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    print(<span class="string">'add..'</span>)</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># addå®é™…ä¸Šæ—¶DelayFuncçš„å®ä¾‹å¯¹è±¡ï¼Œå½“åƒå‡½æ•°ä¸€æ ·è°ƒç”¨æ—¶ï¼Œä¼šè°ƒç”¨__call__æ–¹æ³•</span></span><br><span class="line">print(add(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line"><span class="comment"># ä¸å»¶æ—¶æ‰§è¡Œå‡½æ•°</span></span><br><span class="line">print(add.eager_call(<span class="number">3</span>, <span class="number">4</span>))</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç å®ç°äº†ä¸€ä¸ªç®€å•çš„addåŠŸèƒ½ï¼Œå¹¶ä¸”ä½¿ç”¨äº†è£…é¥°å™¨+åå‡½æ•°ï¼Œå®é™…ä¸Šçš„è°ƒç”¨è·Ÿä»¥ä¸‹ä»£ç åŠŸèƒ½ä¸€è‡´ã€‚æŠŠå‡½æ•°å½“å‚æ•°ä¼ å…¥ç±»å±æ€§ä¸­ï¼Œç„¶åè°ƒç”¨<code>__call__</code>é­”æ³•æ–¹æ³•æ—¶ï¼Œæ‰§è¡Œè¯¥å‡½æ•°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DelayFunc</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, duration, func)</span>:</span></span><br><span class="line">        self.duration = duration</span><br><span class="line">        self.func = func</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">f'Wait for <span class="subst">&#123;self.duration&#125;</span> seconds...'</span>)</span><br><span class="line">        time.sleep(self.duration)</span><br><span class="line">        <span class="keyword">return</span> self.func(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">eager_call</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'No Wait...'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.func(*args, **kwargs)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delay</span><span class="params">(duration)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorate</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            df = DelayFunc(duration, func)</span><br><span class="line">            <span class="keyword">return</span> df(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorate</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    print(<span class="string">'add..'</span>)</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">    </span><br><span class="line">add_func = delay(<span class="number">1</span>)(add)</span><br><span class="line"><span class="comment"># print(add_func)</span></span><br><span class="line">print(add_func(<span class="number">1</span>, <span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨wraptæ¨¡å—ç¼–å†™æ›´æ‰å¹³çš„è£…é¥°å™¨"><a href="#ä½¿ç”¨wraptæ¨¡å—ç¼–å†™æ›´æ‰å¹³çš„è£…é¥°å™¨" class="headerlink" title="ä½¿ç”¨wraptæ¨¡å—ç¼–å†™æ›´æ‰å¹³çš„è£…é¥°å™¨"></a>ä½¿ç”¨wraptæ¨¡å—ç¼–å†™æ›´æ‰å¹³çš„è£…é¥°å™¨</h3><p>åœ¨ç¼–å†™è£…é¥°å™¨æ—¶ï¼Œæœ‰ä¸¤ä»¶äº‹ä¼šæ˜¾å¾—ç‰¹åˆ«éº»çƒ¦ï¼Œ1.å®ç°å¸¦å‚æ•°çš„è£…é¥°å™¨æ—¶ï¼Œå±‚å±‚åµŒå¥—çš„å‡½æ•°ä»£ç ç‰¹åˆ«éš¾å†™ï¼Œéš¾è¯» 2.å› ä¸ºå‡½æ•°å’Œç±»æ–¹æ³•çš„ä¸åŒï¼Œä¸ºæŸè€…ç¼–å†™çš„è£…é¥°å™¨å¾€å¾€ä¸èƒ½ç›´æ¥ç”¨åœ¨å¦ä¸€ä¸ªä¸Šã€‚<br>wraptæ¨¡å—æ—¶ä¸€ä¸ªä¸“é—¨å¸®åŠ©ç¼–å†™è£…é¥°å™¨çš„å·¥å…·åº“ï¼Œåˆ©ç”¨å®ƒï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿çš„æ”¹é€ è£…é¥°å™¨å‡½æ•°ï¼Œå®Œç¾è§£å†³ä»¥ä¸Šä¸¤ä¸ªé—®é¢˜ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> wrapt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_num</span><span class="params">(min_num, max_num)</span>:</span></span><br><span class="line"><span class="meta">	@wrapt.decorator</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(wrapped, instance, args, kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">		:param wrapped: è¢«è£…é¥°çš„å‡½æ•°æˆ–è€…ç±»æ–¹æ³•</span></span><br><span class="line"><span class="string">		:param instance: 1.å¦‚æœè¢«è£…é¥°è€…æ—¶æ™®é€šç±»æ–¹æ³•ï¼Œè¯¥å€¼ä¸ºç±»å®ä¾‹</span></span><br><span class="line"><span class="string">					2.å¦‚æœè¢«è£…é¥°è€…æ—¶classmethodæ–¹æ³•ï¼Œè¯¥å€¼ä¸ºç±»</span></span><br><span class="line"><span class="string">					3.å¦‚æœè¢«è£…é¥°è€…æ—¶ç±»/å‡½æ•°/é™æ€æ–¹æ³•ï¼Œè¯¥å€¼ä¸ºNone</span></span><br><span class="line"><span class="string">		:param args: è°ƒç”¨æ—¶çš„ä½ç½®å‚æ•°ï¼ˆæ²¡æœ‰*ç¬¦å·ï¼‰</span></span><br><span class="line"><span class="string">		:param kwargs: è°ƒç”¨æ—¶çš„å…³é”®å­—å‚æ•°ï¼ˆæ²¡æœ‰**ç¬¦å·ï¼‰</span></span><br><span class="line"><span class="string">		"""</span></span><br><span class="line">        num = random.randint(min_num, max_num)</span><br><span class="line"></span><br><span class="line">        args = (num,) + args</span><br><span class="line">        <span class="keyword">return</span> wrapped(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@random_num(10, 100)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(num)</span>:</span></span><br><span class="line">    print(<span class="string">f'random num is <span class="subst">&#123;num&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	@random_num(100, 1000)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self, num)</span>:</span></span><br><span class="line">        print(<span class="string">f'random num in class is <span class="subst">&#123;num&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func()</span><br><span class="line"></span><br><span class="line">t = Test()</span><br><span class="line">t.test()</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨wraptç¼–å†™çš„è£…é¥°å™¨ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿:</p>
<ul>
<li>åµŒå¥—å±‚çº§å°‘ï¼šä½¿ç”¨<code>wrapt.decorator</code>å¯ä»¥å°†ä¸¤å±‚åµŒå¥—å‡å°‘ä¸ºä¸€å±‚</li>
<li>æ›´ç®€å•: å¤„ç†ä½ç½®ä¸å…³é”®å­—å‚æ•°æ—¶ï¼Œå¯ä»¥å¿½ç•¥ç±»å®ä¾‹ç­‰ç‰¹åˆ«æƒ…å†µ</li>
<li>æ›´çµæ´»: é’ˆå¯¹<code>instance</code>å€¼è¿›è¡Œåˆ¤æ–­åï¼Œæ›´å®¹æ˜“è®©è£…é¥°å™¨å˜å¾—é€šç”¨ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Django-rest-framework -- å¸¸ç”¨è§†å›¾å‡½æ•°</title>
    <url>/2020/05/23/django-rest-framework-%E5%B8%B8%E7%94%A8%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<h3 id="settings-py"><a href="#settings-py" class="headerlink" title="settings.py"></a>settings.py</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="comment"># è®¾ç½®åˆ†é¡µ</span></span><br><span class="line">    <span class="string">'DEFAULT_PAGINATION_CLASS'</span>: <span class="string">'rest_framework.pagination.PageNumberPagination'</span>,</span><br><span class="line">    <span class="string">'DEFAULT_VERSIONING_CLASS'</span>: <span class="string">'rest_framework.versioning.NamespaceVersioning'</span>,</span><br><span class="line">    <span class="string">'DEFAULT_PERMISSOIN_CLASSES'</span>:[</span><br><span class="line">        <span class="string">'rest_framework.permissions.IsAdminUser'</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># æ¯ä¸€é¡µæ•°é‡</span></span><br><span class="line">    <span class="string">'PAGE_SIZE'</span>: <span class="number">10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="models-py"><a href="#models-py" class="headerlink" title="models.py"></a>models.py</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line">SEX_CHOICES = (</span><br><span class="line">    (<span class="number">1</span>, <span class="string">'ç”·'</span>),</span><br><span class="line">    (<span class="number">2</span>, <span class="string">'å¥³'</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Classes</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">16</span>, null=<span class="literal">False</span>, verbose_name=<span class="string">'å­¦ç”Ÿå§“å'</span>)</span><br><span class="line">    sex = models.CharField(max_length=<span class="number">16</span>, choices=SEX_CHOICES, default=<span class="number">1</span>)</span><br><span class="line">    classes = models.ForeignKey(Classes, on_delete=models.CASCADE)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Course</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Score</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    score = models.DecimalField(max_digits=<span class="number">5</span>, decimal_places=<span class="number">2</span>)</span><br><span class="line">    student = models.ForeignKey(Student, on_delete=models.CASCADE)</span><br><span class="line">    course = models.OneToOneField(Course, on_delete=models.CASCADE)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.score</span><br></pre></td></tr></table></figure>


<h3 id="serializers-py"><a href="#serializers-py" class="headerlink" title="serializers.py"></a>serializers.py</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-3-26 23:31</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> demo.models <span class="keyword">import</span> Classes, Student, Course, Score</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassesSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Classes</span><br><span class="line">        fields = (<span class="string">'id'</span>, <span class="string">'name'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Student</span><br><span class="line">        fields = (<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'sex'</span>, <span class="string">'classes'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Course</span><br><span class="line">        fields = (<span class="string">'id'</span>, <span class="string">'name'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScoreSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    student = StudentSerializer(many=<span class="literal">False</span>, read_only=<span class="literal">True</span>)</span><br><span class="line">    course = CourseSerializer(many=<span class="literal">False</span>, read_only=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Score</span><br><span class="line">        fields = (<span class="string">'id'</span>, <span class="string">'score'</span>, <span class="string">'student'</span>, <span class="string">'course'</span>)</span><br></pre></td></tr></table></figure>


<h3 id="views-py"><a href="#views-py" class="headerlink" title="views.py"></a>views.py</h3><h4 id="views-classes-py"><a href="#views-classes-py" class="headerlink" title="views_classes.py"></a>views_classes.py</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-3-26 23:57</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> mixins</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> generics</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> demo.models <span class="keyword">import</span> Classes</span><br><span class="line"><span class="keyword">from</span> demo.serializers <span class="keyword">import</span> ClassesSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassesList</span><span class="params">(mixins.ListModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">				  mixins.CreateModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">				  generics.GenericAPIView)</span>:</span></span><br><span class="line">    queryset = Classes.objects.all()</span><br><span class="line">    serializer_class = ClassesSerializer</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.list(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.create(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassesDetail</span><span class="params">(mixins.RetrieveModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">					mixins.UpdateModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">					mixins.DestroyModelMixin,</span></span></span><br><span class="line"><span class="class"><span class="params">					generics.GenericAPIView)</span>:</span></span><br><span class="line">    queryset = Classes.objects.all()</span><br><span class="line">    serializer_class = ClassesSerializer</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.retrieve(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.update(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.destroy(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>


<h4 id="views-course-py"><a href="#views-course-py" class="headerlink" title="views_course.py"></a>views_course.py</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"><span class="keyword">from</span> rest_framework.decorators <span class="keyword">import</span> api_view</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.request <span class="keyword">import</span> Request</span><br><span class="line"><span class="keyword">from</span> demo.models <span class="keyword">import</span> Course</span><br><span class="line"><span class="keyword">from</span> demo.serializers <span class="keyword">import</span> CourseSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@api_view(['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">course_list</span><span class="params">(request: Request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        course = Course.objects.all()</span><br><span class="line">        serializer = CourseSerializer(course, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        serializer = CourseSerializer(data=request.data)</span><br><span class="line">        <span class="keyword">if</span> serializer.is_valid():</span><br><span class="line">            serializer.save()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data, status=status.HTTP_201_CREATED)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@api_view(['GET', 'PUT', 'DELETE'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">course_detail</span><span class="params">(request: Request, pk)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        course = Course.objects.get(pk=pk)</span><br><span class="line">    <span class="keyword">except</span> Course.DoesNotExist:</span><br><span class="line">        <span class="keyword">return</span> Response(status=status.HTTP_404_NOT_FOUND)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        serializer = CourseSerializer(course)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">'PUT'</span>:</span><br><span class="line">        serializer = CourseSerializer(course, data=request.data)</span><br><span class="line">        <span class="keyword">if</span> serializer.is_valid():</span><br><span class="line">            serializer.save()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">'DELETE'</span>:</span><br><span class="line">        course.delete()</span><br><span class="line">        <span class="keyword">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br></pre></td></tr></table></figure>


<h4 id="views-score-py"><a href="#views-score-py" class="headerlink" title="views_score.py"></a>views_score.py</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-3-27 00:02</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> generics</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> demo.models <span class="keyword">import</span> Score</span><br><span class="line"><span class="keyword">from</span> demo.serializers <span class="keyword">import</span> ScoreSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScoreList</span><span class="params">(generics.ListCreateAPIView)</span>:</span></span><br><span class="line">    queryset = Score.objects.all()</span><br><span class="line">    serializer_class = ScoreSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScoreDetail</span><span class="params">(generics.RetrieveUpdateDestroyAPIView)</span>:</span></span><br><span class="line">    queryset = Score.objects.all()</span><br><span class="line">    serializer_class = ScoreSerializer</span><br></pre></td></tr></table></figure>


<h4 id="views-student-py"><a href="#views-student-py" class="headerlink" title="views_student.py"></a>views_student.py</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-3-26 23:46</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> Http404</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> demo.models <span class="keyword">import</span> Student</span><br><span class="line"><span class="keyword">from</span> demo.serializers <span class="keyword">import</span> StudentSerializer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentList</span><span class="params">(APIView)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, format=None)</span>:</span></span><br><span class="line">        stu = Student.objects.all()</span><br><span class="line">        serializer = StudentSerializer(stu, many=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, format=None)</span>:</span></span><br><span class="line">        serializer = StudentSerializer(data=request.data)</span><br><span class="line">        <span class="keyword">if</span> serializer.is_valid():</span><br><span class="line">            serializer.save()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data, status=status.HTTP_201_CREATED)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentDetail</span><span class="params">(APIView)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_object</span><span class="params">(self, pk)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> Student.objects.get(pk)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Student.DoesNotExist:</span><br><span class="line">            <span class="keyword">raise</span> Http404</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, pk, format=None)</span>:</span></span><br><span class="line">        stu = self.get_object(pk)</span><br><span class="line">        serializer = StudentSerializer(stu)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, request, pk, format=None)</span>:</span></span><br><span class="line">        stu = self.get_object(pk)</span><br><span class="line">        serializer = StudentSerializer(stu, data=request.data)</span><br><span class="line">        <span class="keyword">if</span> serializer.is_valid():</span><br><span class="line">            serializer.save()</span><br><span class="line">            <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, request, pk, format=None)</span>:</span></span><br><span class="line"></span><br><span class="line">        stu = self.get_object(pk)</span><br><span class="line">        stu.delete()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br></pre></td></tr></table></figure>


<h3 id="urls-py"><a href="#urls-py" class="headerlink" title="urls.py"></a>urls.py</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-3-27 00:03</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> demo <span class="keyword">import</span> views_classes, views_course, views_score, views_student</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'cls/'</span>, views_classes.ClassesList.as_view()),</span><br><span class="line">    re_path(<span class="string">'cls/(?P&lt;pk&gt;[0-9]+)/'</span>, views_classes.ClassesDetail.as_view()),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">urlpatterns += [</span><br><span class="line">    path(<span class="string">'stu/'</span>, views_student.StudentList.as_view()),</span><br><span class="line">    re_path(<span class="string">'stu/(?P&lt;pk&gt;[0-9]+)/'</span>, views_student.StudentDetail.as_view())</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">urlpatterns += [</span><br><span class="line">    path(<span class="string">'cou/'</span>, views_course.course_list),</span><br><span class="line">    re_path(<span class="string">'cou/(?P&lt;pk&gt;[0-9]+)/'</span>, views_course.course_detail),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">urlpatterns += [</span><br><span class="line">    path(<span class="string">'sco/'</span>, views_score.ScoreList.as_view()),</span><br><span class="line">    re_path(<span class="string">'sco/(?P&lt;pk&gt;[0-9]+)'</span>, views_score.ScoreDetail.as_view())</span><br><span class="line">]</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
        <tag>django-rest-framework</tag>
      </tags>
  </entry>
  <entry>
    <title>Django-rest-framework --- mixinæ¨¡å¼</title>
    <url>/2020/05/23/django-rest-framework-mixin%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<p>å‡è®¾å­˜åœ¨è¿™ä¸ªä¸‰ä¸ªç±»ï¼ŒBird, Fish, Animalï¼Œåˆ†åˆ«å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œåƒfly, swim, runç­‰ã€‚ç°æœ‰æŸç§è™šæ‹ŸAnimalå…·æœ‰ä»¥ä¸Šä¸‰ç§åŠŸèƒ½ï¼Œé‚£ä¹ˆä¾¿ä½¿ç”¨ç»§æ‰¿å°±å¯å®ç° ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bird</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fly</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'can fly'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fish</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">swim</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'can swim'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'can run'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VirtualAnimal</span><span class="params">(Bird, Fish, Animal)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">can</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.fly()</span><br><span class="line">        self.swim()</span><br><span class="line">        self.run()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">va = VirtualAnimal()</span><br><span class="line">va.can()</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>å¯è¿™ä¹ˆåšå°±ä¼šå‡ºç°ä¸€ä¸ª é—®é¢˜ï¼Œå½“ä½ çœ‹åˆ°VirtualAnimalè¿™ä¸ªç±»æ—¶ï¼Œå¦‚æœä½ äº‹å…ˆä¸æ¸…æ¥šå®ƒæ˜¯Animalçš„è¯ï¼Œå•çœ‹è¿™ä¸ªç±»ï¼Œä½ ä¸ä¼šçŸ¥é“å®ƒåˆ°åº•æ˜¯Bird, Fish è¿˜æ˜¯Animalã€‚</p>
<p>å¦‚æœä½¿ç”¨mixinæ¨¡å¼ï¼Œå³æŠŠç±»åæ”¹æˆMixinBird, MixinFishï¼Œé‚£ä¹ˆç±»çš„ç»§æ‰¿å°±å†™æˆäº†</p>
<p><code>class VirtualAnimal(MixinBird, MixinFish, Animal):</code></p>
<p>è™½ç„¶åªæ˜¯æ›´æ”¹äº†ç±»åï¼Œä»£ç æ²¡æœ‰å‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œä½†è¿™æ˜¯ä¸€ç§é»˜è®¤ç”³æ˜ï¼Œè¯¥ç”Ÿç‰©æ˜¯Animalä½†å…·æœ‰fly(), swim()åŠŸèƒ½ã€‚</p>
<p>drfæ¡†æ¶ä¸­ï¼Œå¤§é‡ä½¿ç”¨è¿™ç§å†™æ³•ã€‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>django</tag>
        <tag>django-rest-framework</tag>
      </tags>
  </entry>
  <entry>
    <title>Python -- ä½¿ç”¨å•åˆ†æ´¾æ³›å‡½æ•°å®ç°å‡½æ•°`é‡è½½`åŠŸèƒ½</title>
    <url>/2020/05/23/python%E4%BD%BF%E7%94%A8%E5%8D%95%E5%88%86%E6%B4%BE%E6%B3%9B%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0%E5%87%BD%E6%95%B0-%E9%87%8D%E8%BD%BD-%E5%8A%9F%E8%83%BD/</url>
    <content><![CDATA[<p>ä¼—æ‰€å‘¨çŸ¥,pythonä¸­æ²¡æœ‰ç±»ä¼¼Javaä¸­çš„å‡½æ•°é‡è½½åŠŸèƒ½,å½“å®šä¹‰å¤šä¸ªå‡½æ•°åä¸€æ ·ä½†å‚æ•°ä¸ä¸€æ ·çš„å‡½æ•°æ—¶,æœ€åä¸€ä¸ªä¼šå‰é¢å‰çš„åŒåå‡½æ•°è¦†ç›–.</p>
<a id="more"></a>

<h3 id="æ¨¡å—ä¸­ä½¿ç”¨"><a href="#æ¨¡å—ä¸­ä½¿ç”¨" class="headerlink" title="æ¨¡å—ä¸­ä½¿ç”¨"></a>æ¨¡å—ä¸­ä½¿ç”¨</h3><ul>
<li><p>æˆ‘ä»¬ä½¿ç”¨singledispatchè£…é¥°å™¨æ¥å®ç°â€é‡è½½â€åŠŸèƒ½</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> singledispatch, partial</span><br><span class="line">    </span><br><span class="line"><span class="meta">@singledispatch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pprint</span><span class="params">(obj)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨<code>@&lt;ä¸»å‡½æ•°&gt;.register(type)</code>æ¥è£…é¥°åŒåå‡½æ•°.åˆ†æ´¾å‡½æ•°å¯ä»¥æœ‰ä»»æ„å¤šä¸ªå‚æ•°,ä½†æ˜¯å…·ä½“è°ƒç”¨å“ªä¸€éƒ¨åˆ†åªç”±ç¬¬ä¸€ä¸ªå‚æ•°ç±»å‹å†³å®š,ä¹Ÿå°±æ˜¯<code>register(type)</code>ä¸­çš„typeå†³å®š. </p>
</li>
<li><p>å¯¹äºå•åˆ†æ´¾è€Œè¨€,å‡½æ•°åæ— å…³ç´§è¦,ä½†ä¸èƒ½åŒåå°±æ˜¯äº†.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pprint.register(str)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_pprint</span><span class="params">(obj)</span>:</span></span><br><span class="line">    print(<span class="string">f'---&gt;strç±»å‹: <span class="subst">&#123;obj&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@pprint.register(Integral)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span><span class="params">(obj)</span>:</span></span><br><span class="line">    print(<span class="string">f'--&gt;intç±»å‹: <span class="subst">&#123;obj&#125;</span>'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>å‡½æ•°å‚æ•°å¯ä»¥æœ‰å¤šä¸ª,ä½†å¦‚æœæœ‰å¤šä¸ªåŒç±»å‹çš„å•åˆ†æ´¾å‡½æ•°,æœ€åä¸€ä¸ªä¼šè¦†ç›–å‰é¢çš„,åœ¨è°ƒç”¨ä¸‹é¢çš„å‡½æ•°æ—¶,å¿…é¡»ä¼ å…¥ä¸¤ä¸ªå‚æ•°,ç¬¬ä¸€ä¸ªæ˜¯ç±»å‹,ç¬¬äºŒä¸ªéšæ„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pprint.register(str)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_pprint</span><span class="params">(obj)</span>:</span></span><br><span class="line">    print(<span class="string">f'---&gt;strç±»å‹: <span class="subst">&#123;obj&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@pprint.register(str)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_pprint</span><span class="params">(obj1, obj2)</span>:</span></span><br><span class="line">    print(<span class="string">f'---&gt;strç±»å‹,ä¸¤ä¸ªå‚æ•°: <span class="subst">&#123;obj1&#125;</span>, <span class="subst">&#123;obj2&#125;</span>'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¯ä»¥è¯†åˆ«çš„ç±»å‹éšæ„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> numbers <span class="keyword">import</span> Integral</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(A.__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@pprint.register(Integral)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span><span class="params">(obj)</span>:</span></span><br><span class="line">    print(<span class="string">f'--&gt;Integralç±»å‹: <span class="subst">&#123;obj&#125;</span>'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">@pprint.register(A)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span><span class="params">(obj)</span>:</span></span><br><span class="line">    print(<span class="string">f'è‡ªå®šä¹‰ç±»å‹: <span class="subst">&#123;obj&#125;</span>'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¹Ÿå¯ä»¥åŒæ—¶æ³¨å†Œå¤šç§ç±»å‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pprint.register(float)</span></span><br><span class="line"><span class="meta">@pprint.register(dict)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span><span class="params">(obj)</span>:</span></span><br><span class="line">    print(<span class="string">f'<span class="subst">&#123;obj&#125;</span>.type = '</span> + str(type(obj)))</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¹Ÿå¯ç»“åˆåå‡½æ•°ä½¿ç”¨,å½“ç„¶,å…¶å®è·Ÿæ™®é€šå‡½æ•°ç”¨æ³•æ²¡ä»€ä¹ˆåŒºåˆ«</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">printstr = partial(pprint, <span class="string">'å›ºå®šç¬¬ä¸€ä¸ªå‚æ•°'</span>)</span><br><span class="line">printstr(<span class="string">'hello'</span>)</span><br></pre></td></tr></table></figure>


</li>
</ul>
<p>å®Œæ•´ä»£ç :</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-5-15 21:48</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> singledispatch, partial</span><br><span class="line"><span class="keyword">from</span> numbers <span class="keyword">import</span> Integral</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(A.__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@singledispatch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pprint</span><span class="params">(obj)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">NotImplemented</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># @pprint.register(str)</span></span><br><span class="line"><span class="comment"># def _pprint(obj):</span></span><br><span class="line"><span class="comment"># 	print(f'---&gt;strç±»å‹: &#123;obj&#125;')</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pprint.register(str)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_pprint</span><span class="params">(obj1, obj2)</span>:</span></span><br><span class="line">    print(<span class="string">f'---&gt;strç±»å‹,ä¸¤ä¸ªå‚æ•°: <span class="subst">&#123;obj1&#125;</span>, <span class="subst">&#123;obj2&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pprint.register(Integral)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span><span class="params">(obj)</span>:</span></span><br><span class="line">    print(<span class="string">f'---&gt;intç±»å‹: <span class="subst">&#123;obj&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pprint.register(float)</span></span><br><span class="line"><span class="meta">@pprint.register(dict)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span><span class="params">(obj)</span>:</span></span><br><span class="line">    print(<span class="string">f'---&gt;<span class="subst">&#123;obj&#125;</span>.type = '</span> + str(type(obj)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@pprint.register(A)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span><span class="params">(obj)</span>:</span></span><br><span class="line">    print(<span class="string">f'---&gt;è‡ªå®šä¹‰ç±»å‹: <span class="subst">&#123;obj&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">printstr = partial(pprint, <span class="string">'å›ºå®šç¬¬ä¸€ä¸ªå‚æ•°'</span>)</span><br><span class="line"></span><br><span class="line">pprint(<span class="string">'hello'</span>, <span class="string">'world'</span>)</span><br><span class="line">pprint(<span class="number">100</span>)</span><br><span class="line">pprint(<span class="number">1.34</span>)</span><br><span class="line">pprint(&#123;<span class="string">'name'</span>: <span class="string">'chen'</span>&#125;)</span><br><span class="line">pprint(A())</span><br><span class="line">printstr(<span class="string">'hello'</span>)</span><br></pre></td></tr></table></figure>

<p>è¾“å‡º:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">---&gt;strç±»å‹,ä¸¤ä¸ªå‚æ•°: hello, world</span><br><span class="line">---&gt;intç±»å‹: 100</span><br><span class="line">---&gt;1.34.type = &lt;class 'float'&gt;</span><br><span class="line">---&gt;&#123;'name': 'chen'&#125;.type = &lt;class 'dict'&gt;</span><br><span class="line">---&gt;è‡ªå®šä¹‰ç±»å‹: A</span><br><span class="line">---&gt;strç±»å‹,ä¸¤ä¸ªå‚æ•°: å›ºå®šç¬¬ä¸€ä¸ªå‚æ•°, hello</span><br></pre></td></tr></table></figure>

<h3 id="ç±»ä¸­ä½¿ç”¨"><a href="#ç±»ä¸­ä½¿ç”¨" class="headerlink" title="ç±»ä¸­ä½¿ç”¨"></a>ç±»ä¸­ä½¿ç”¨</h3><p>åªæµ‹è¯•å‡ºè¿™ä¸€ç§å†™æ³•,æ— æ³•ä½¿ç”¨self,ä¸èƒ½æ·»åŠ staticmethodå’Œclassmethod,æ„Ÿè§‰å®ç”¨æ„ä¹‰ä¸å¤§.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> singledispatch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomerPrint</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">	@singledispatch</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cprint</span><span class="params">(self, obj)</span>:</span></span><br><span class="line">        print(<span class="string">'default--&gt;'</span>, obj)</span><br><span class="line"></span><br><span class="line"><span class="meta">	@cprint.register(str)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span><span class="params">(obj)</span>:</span></span><br><span class="line">        print(<span class="string">'str--&gt;'</span>, obj)</span><br><span class="line"></span><br><span class="line"><span class="meta">	@cprint.register(int)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span><span class="params">(obj)</span>:</span></span><br><span class="line">        print(<span class="string">'int--&gt;'</span>, obj)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CustomerPrint.cprint(<span class="string">'h'</span>)</span><br><span class="line">CustomerPrint.cprint(<span class="number">100</span>)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode ---  åˆ†éš”é“¾è¡¨</title>
    <url>/2020/05/23/leetcode-%E5%88%86%E9%9A%94%E9%93%BE%E8%A1%A8/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/partition-list/submissions/" target="_blank" rel="noopener">åˆ†éš”é“¾è¡¨</a><br><br/></p>
<p>ç»™å®šä¸€ä¸ªé“¾è¡¨å’Œä¸€ä¸ªç‰¹å®šå€¼ xï¼Œå¯¹é“¾è¡¨è¿›è¡Œåˆ†éš”ï¼Œä½¿å¾—æ‰€æœ‰å°äº x çš„èŠ‚ç‚¹éƒ½åœ¨å¤§äºæˆ–ç­‰äº x çš„èŠ‚ç‚¹ä¹‹å‰ã€‚<br>ä½ åº”å½“ä¿ç•™ä¸¤ä¸ªåˆ†åŒºä¸­æ¯ä¸ªèŠ‚ç‚¹çš„åˆå§‹ç›¸å¯¹ä½ç½®ã€‚</p>
<p>ç¤ºä¾‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: head &#x3D; 1-&gt;4-&gt;3-&gt;2-&gt;5-&gt;2, x &#x3D; 3</span><br><span class="line">è¾“å‡º: 1-&gt;2-&gt;2-&gt;4-&gt;3-&gt;5</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„é—®é¢˜ï¼Œç†Ÿæ‚‰ä¸€ä¸‹golangçš„è¯­æ³•ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> code</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ListNode <span class="keyword">struct</span> &#123;</span><br><span class="line">    Val  <span class="keyword">int</span></span><br><span class="line">    Next *ListNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">partition</span><span class="params">(head *ListNode, x <span class="keyword">int</span>)</span> *<span class="title">ListNode</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> smallNode *ListNode</span><br><span class="line">    <span class="keyword">var</span> smallFirst *ListNode</span><br><span class="line">    <span class="keyword">var</span> bigNode *ListNode</span><br><span class="line">    <span class="keyword">var</span> bigFirst *ListNode</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> head == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> head.Val &lt; x &#123;</span><br><span class="line">            <span class="keyword">if</span> smallNode == <span class="literal">nil</span> &#123;</span><br><span class="line">                smallNode = head</span><br><span class="line">                smallFirst = head</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                smallNode.Next = head</span><br><span class="line">                smallNode = smallNode.Next</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> head.Val &gt;= x &#123;</span><br><span class="line">            <span class="keyword">if</span> bigNode == <span class="literal">nil</span> &#123;</span><br><span class="line">                bigNode = head</span><br><span class="line">                bigFirst = head</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                bigNode.Next = head</span><br><span class="line">                bigNode = bigNode.Next</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        head = head.Next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ€å®¹æ˜“å‡ºé”™çš„åœ°æ–¹</span></span><br><span class="line">    <span class="keyword">if</span> bigNode != <span class="literal">nil</span> &#123;</span><br><span class="line">        bigNode.Next = <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> smallNode != <span class="literal">nil</span> &#123;</span><br><span class="line">        smallNode.Next = bigFirst</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> node *ListNode</span><br><span class="line">    <span class="keyword">if</span> smallFirst != <span class="literal">nil</span> &#123;</span><br><span class="line">        node = smallFirst</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        node = bigFirst</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> node</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test86</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//	1-&gt;4-&gt;3-&gt;2-&gt;5-&gt;2, x = 3</span></span><br><span class="line">    x := <span class="number">0</span></span><br><span class="line">    n1 := ListNode&#123;Val: <span class="number">1</span>&#125;</span><br><span class="line">    n2 := ListNode&#123;Val: <span class="number">4</span>&#125;</span><br><span class="line">    n3 := ListNode&#123;Val: <span class="number">3</span>&#125;</span><br><span class="line">    n4 := ListNode&#123;Val: <span class="number">2</span>&#125;</span><br><span class="line">    n5 := ListNode&#123;Val: <span class="number">5</span>&#125;</span><br><span class="line">    n6 := ListNode&#123;Val: <span class="number">2</span>&#125;</span><br><span class="line"></span><br><span class="line">    n1.Next = &amp;n2</span><br><span class="line">    n2.Next = &amp;n3</span><br><span class="line">    n3.Next = &amp;n4</span><br><span class="line">    n4.Next = &amp;n5</span><br><span class="line">    n5.Next = &amp;n6</span><br><span class="line"></span><br><span class="line">    node := partition(&amp;n1, x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> node == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        fmt.Println(node.Val)</span><br><span class="line">        node = node.Next</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode ---  é¢œè‰²åˆ†ç±»</title>
    <url>/2020/05/23/leetcode-%E9%A2%9C%E8%89%B2%E5%88%86%E7%B1%BB/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/sort-colors/" target="_blank" rel="noopener">é¢œè‰²åˆ†ç±»</a><br><br/><br>ç»™å®šä¸€ä¸ªåŒ…å«çº¢è‰²ã€ç™½è‰²å’Œè“è‰²ï¼Œä¸€å…± n ä¸ªå…ƒç´ çš„æ•°ç»„ï¼ŒåŸåœ°å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œä½¿å¾—ç›¸åŒé¢œè‰²çš„å…ƒç´ ç›¸é‚»ï¼Œå¹¶æŒ‰ç…§çº¢è‰²ã€ç™½è‰²ã€è“è‰²é¡ºåºæ’åˆ—ã€‚</p>
<p>æ­¤é¢˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° 0ã€ 1 å’Œ 2 åˆ†åˆ«è¡¨ç¤ºçº¢è‰²ã€ç™½è‰²å’Œè“è‰²ã€‚</p>
<p>æ³¨æ„:<br>ä¸èƒ½ä½¿ç”¨ä»£ç åº“ä¸­çš„æ’åºå‡½æ•°æ¥è§£å†³è¿™é“é¢˜ã€‚</p>
<p>ç¤ºä¾‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [2,0,2,1,1,0]</span><br><span class="line">è¾“å‡º: [0,0,1,1,2,2]</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>é¢˜ç›®è™½ç„¶æ˜¯ä¸­ç­‰éš¾åº¦ï¼Œä½†è¿˜æ˜¯å¾ˆç®€å•å§ï¼Œå°±æ˜¯æ¡¶æ’åºçš„æ„æ€ã€‚</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sortColors</span><span class="params">(nums []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> colors = [<span class="number">3</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">        colors[nums[i]] += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    index := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(colors); i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j := <span class="number">0</span>; j &lt; colors[i]; j++ &#123;</span><br><span class="line">            nums[index] = i</span><br><span class="line">            index++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- æœ€å¤§å­åºå’Œ</title>
    <url>/2020/05/23/leetcode-%E6%9C%80%E5%A4%A7%E5%AD%90%E5%BA%8F%E5%92%8C/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/maximum-subarray/" target="_blank" rel="noopener">æœ€å¤§å­åºå’Œ</a></p>
<p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚</p>
<p>ç¤ºä¾‹:</p>
<blockquote>
</blockquote>
<p>è¾“å…¥: [-2,1,-3,4,-1,2,1,-5,4],<br/><br>è¾“å‡º: 6 <br/><br>è§£é‡Š: è¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6ã€‚<br/></p>
<a id="more"></a>

<h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>è¿™é“é¢˜å¾ˆç†Ÿæ‚‰äº†ï¼Œé‚£æ—¶å€™å¤§å­¦æ—¶å€™åœ¨moocä¸Šå­¦ä¹ æ•°æ®ç»“æ„æ—¶å°±è®²åˆ°äº†è¿™é“é¢˜ï¼Œç„¶åè¿‡äº†è¿™ä¹ˆå¤šå¹´ ï¼Œæ¯æ¬¡åˆ·é¢˜éƒ½èƒ½é‡åˆ°ï¼Œä½¿ç”¨ä¸€ä¸ªforå¾ªç¯å°±æå®šã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> code</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxSubArray</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> result = nums[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">var</span> tmp = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        tmp += v</span><br><span class="line">        <span class="keyword">if</span> tmp &gt; result &#123;</span><br><span class="line">            result = tmp</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> tmp &lt; <span class="number">0</span> &#123;</span><br><span class="line">            tmp = <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test53</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> nums = []<span class="keyword">int</span>&#123;<span class="number">-2</span>, <span class="number">1</span>, <span class="number">-3</span>, <span class="number">4</span>, <span class="number">-1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">-5</span>, <span class="number">4</span>&#125;</span><br><span class="line">    fmt.Println(maxSubArray(nums))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- çˆ¬æ¥¼æ¢¯</title>
    <url>/2020/05/23/leetcode-%E7%88%AC%E6%A5%BC%E6%A2%AF/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/climbing-stairs/" target="_blank" rel="noopener">çˆ¬æ¥¼æ¢¯</a><br><br/><br>å‡è®¾ä½ æ­£åœ¨çˆ¬æ¥¼æ¢¯ã€‚éœ€è¦ n é˜¶ä½ æ‰èƒ½åˆ°è¾¾æ¥¼é¡¶ã€‚<br>æ¯æ¬¡ä½ å¯ä»¥çˆ¬ 1 æˆ– 2 ä¸ªå°é˜¶ã€‚ä½ æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶å‘¢ï¼Ÿ<br>æ³¨æ„ï¼šç»™å®š n æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ã€‚</p>
<p>ç¤ºä¾‹ 1ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š 2 </span><br><span class="line">è¾“å‡ºï¼š 2</span><br><span class="line">è§£é‡Šï¼š æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚</span><br><span class="line">1.  1 é˜¶ + 1 é˜¶</span><br><span class="line">2.  2 é˜¶</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ 2ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼š 3</span><br><span class="line">è¾“å‡ºï¼š 3</span><br><span class="line">è§£é‡Šï¼š æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚</span><br><span class="line">1.  1 é˜¶ + 1 é˜¶ + 1 é˜¶</span><br><span class="line">2.  1 é˜¶ + 2 é˜¶</span><br><span class="line">3.  2 é˜¶ + 1 é˜¶</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>å¾ˆå¸¸è§çš„ä¸€é“é¢˜ç›®äº†ï¼Œç”¨å¸¸è§„çš„é€’å½’è§£å†³å°±å¯ä»¥äº†ã€‚<br>æ²¡æƒ³åˆ°çš„æ˜¯ï¼ŒåŠ ä¸Šmapåšç¼“å­˜åï¼Œè€—æ—¶ç«Ÿç„¶æ˜¯0msï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ‰§è¡Œç”¨æ—¶ :0 ms, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†100.00% çš„ç”¨æˆ·</span><br><span class="line">å†…å­˜æ¶ˆè€— :1.9 MB, åœ¨æ‰€æœ‰ Go æäº¤ä¸­å‡»è´¥äº†76.09%çš„ç”¨æˆ·</span><br></pre></td></tr></table></figure>

<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> code</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼“å­˜æ¯ä¸€ä¸ªnçš„å€¼</span></span><br><span class="line"><span class="keyword">var</span> cache = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">climbStairs</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="comment">// é€’å½’çš„ç»“æŸæ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">if</span> _, ok := cache[n]; ok &#123;</span><br><span class="line">        <span class="keyword">return</span> cache[n]</span><br><span class="line">    &#125;</span><br><span class="line">    m := climbStairs(n<span class="number">-1</span>) + climbStairs(n<span class="number">-2</span>)</span><br><span class="line">    cache[n] = m</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Test70</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(climbStairs(<span class="number">2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- å­—ç¬¦ä¸²ç›¸ä¹˜</title>
    <url>/2020/05/23/leetcode-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E4%B9%98/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/multiply-strings/" target="_blank" rel="noopener">å­—ç¬¦ä¸²ç›¸ä¹˜</a><br/><br>ç»™å®šä¸¤ä¸ªä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºçš„éè´Ÿæ•´æ•° num1 å’Œ num2ï¼Œè¿”å› num1 å’Œ num2 çš„ä¹˜ç§¯ï¼Œå®ƒä»¬çš„ä¹˜ç§¯ä¹Ÿè¡¨ç¤ºä¸ºå­—ç¬¦ä¸²å½¢å¼ã€‚<br>ç¤ºä¾‹1:</p>
<blockquote>
</blockquote>
<p>è¾“å…¥: num1 = â€œ2â€, num2 = â€œ3â€<br>è¾“å‡º: â€œ6â€</p>
<p>ç¤ºä¾‹2:</p>
<blockquote>
</blockquote>
<p>è¾“å…¥: num1 = â€œ123â€, num2 = â€œ456â€<br>è¾“å‡º: â€œ56088â€</p>
<p>è¯´æ˜:</p>
<blockquote>
</blockquote>
<p>num1 å’Œ num2 çš„é•¿åº¦å°äº110ã€‚<br/><br>num1 å’Œ num2 åªåŒ…å«æ•°å­— 0-9ã€‚<br/><br>num1 å’Œ num2 å‡ä¸ä»¥é›¶å¼€å¤´ï¼Œé™¤éæ˜¯æ•°å­— 0 æœ¬èº«ã€‚<br/><br>ä¸èƒ½ä½¿ç”¨ä»»ä½•æ ‡å‡†åº“çš„å¤§æ•°ç±»å‹ï¼ˆæ¯”å¦‚ BigIntegerï¼‰æˆ–ç›´æ¥å°†è¾“å…¥è½¬æ¢ä¸ºæ•´æ•°æ¥å¤„ç†ã€‚<br/></p>
<a id="more"></a>

<h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>æ„Ÿè§‰åšèµ·æ¥é¥¶äº†ä¸€å¤§åœˆçš„æ ·å­ï¼Œè¿˜æ˜¯pythonçš„æ•´æ•°èˆ’æœï¼Œéƒ½ä¸éœ€è¦åœ¨æ„æº¢å‡ºçš„é—®é¢˜ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># __author__ = 'ChenTao'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">multiply</span><span class="params">(self, num1: str, num2: str)</span> -&gt; str:</span></span><br><span class="line">        alist = list(num1)</span><br><span class="line">        blist = list(num2)</span><br><span class="line">        result = list()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¾—åˆ°ä¹˜æ³•çš„ä¸­é—´è¿‡ç¨‹</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">                1 2 3</span></span><br><span class="line"><span class="string">            *   4 5 6</span></span><br><span class="line"><span class="string">            --------------    ä¸­é—´è¿‡ç¨‹</span></span><br><span class="line"><span class="string">                7 3 8</span></span><br><span class="line"><span class="string">              6 1 5 0</span></span><br><span class="line"><span class="string">            4 9 2 0 0</span></span><br><span class="line"><span class="string">            ---------------   ç»“æœ</span></span><br><span class="line"><span class="string">            5 6 0 8 8</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># é€†åºç›¸ä¹˜ï¼Œä»ä¸ªä½å¼€å§‹è®¡ç®—</span></span><br><span class="line">        <span class="comment"># iæ˜¯ä»å³æ•°ç¬¬å‡ ä¸ªä½ç½®ï¼Œæ–¹ä¾¿æ·»åŠ 0</span></span><br><span class="line">        <span class="comment"># æ­¤æ­¥åšä¹˜æ³•</span></span><br><span class="line">        <span class="keyword">for</span> i, m <span class="keyword">in</span> enumerate(alist[::<span class="number">-1</span>]):</span><br><span class="line">            <span class="comment"># ä½ä½è¡¥å……0</span></span><br><span class="line">            temp = [<span class="string">'0'</span>] * i</span><br><span class="line">            <span class="comment"># è¿›ä½æ•°ï¼Œä¾‹å¦‚ 9 * 9 = 81ï¼Œé‚£ä¹ˆp=8</span></span><br><span class="line">            p = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> n <span class="keyword">in</span> blist[::<span class="number">-1</span>]:</span><br><span class="line">                <span class="comment"># è®¡ç®—å½“å‰ä½ç½®ï¼Œå¹¶åŠ ä¸Šè¿›ä½æ•°</span></span><br><span class="line">                x = int(m) * int(n) + p</span><br><span class="line">                <span class="comment"># å°†ä¸ªä½æ•°å­—ä¿å­˜</span></span><br><span class="line">                temp.insert(<span class="number">0</span>, str(x % <span class="number">10</span>))</span><br><span class="line">                <span class="comment"># åä½æ•°è¿›ä½</span></span><br><span class="line">                p = x // <span class="number">10</span></span><br><span class="line">            <span class="comment"># ä¸è¦å¿˜è®°æœ€åçš„è¿›ä½æ•°è¦åŠ ä¸Š</span></span><br><span class="line">            <span class="keyword">if</span> p &gt; <span class="number">0</span>:</span><br><span class="line">                temp.insert(<span class="number">0</span>, str(p))</span><br><span class="line">            <span class="comment"># ä¿å­˜ä¸­é—´è¿‡ç¨‹</span></span><br><span class="line">            <span class="comment"># é€†åºä¿å­˜ï¼Œæ–¹ä¾¿ä¹‹åçš„åŠ æ³•è¿ç®—</span></span><br><span class="line">            result.append(temp[::<span class="number">-1</span>])</span><br><span class="line">        print(result)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä¸ä¸Šé¢ä¸€æ ·ï¼Œä¸è¿‡æ­¤æ­¥æ˜¯åšåŠ æ³•ï¼Œå°†ä¸­é—´è¿‡ç¨‹çš„æ‰€æœ‰æ•°ç›¸åŠ </span></span><br><span class="line">        end = list()</span><br><span class="line">        p = <span class="number">0</span></span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment"># indexå¤„æ‰€æœ‰æ•°ç›¸åŠ çš„ä¸´æ—¶ç»“æœ</span></span><br><span class="line">            tmp_result = <span class="number">0</span></span><br><span class="line">            <span class="comment"># ç”¨æ¥åˆ¤æ–­æ˜¯å¦æ‰€æœ‰çš„æ•°éƒ½åŠ ä¸Šè¿‡äº†</span></span><br><span class="line">            flag = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">for</span> r <span class="keyword">in</span> result:</span><br><span class="line">                <span class="comment"># å¦‚æœä¸­é—´è¿‡ç¨‹çš„æ•°ä¸­ï¼Œæ­¤ä½ç½®ä¸Šè¿˜æœ‰æ•°</span></span><br><span class="line">                <span class="keyword">if</span> len(r) &gt; index:</span><br><span class="line">                    flag = <span class="literal">True</span></span><br><span class="line">                    tmp_result += int(r[index])</span><br><span class="line"></span><br><span class="line">            tmp_result += p</span><br><span class="line">            end.insert(<span class="number">0</span>, str(tmp_result % <span class="number">10</span>))</span><br><span class="line">            p = tmp_result // <span class="number">10</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># è¯´æ˜æ‰€æœ‰çš„æ•°éƒ½å·²ç»è®¡ç®—å®Œæ¯•</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># ä½ç½®å¾€å‰æŒª</span></span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> str(int(<span class="string">''</span>.join(end)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">n1 = <span class="string">"123"</span></span><br><span class="line">n2 = <span class="string">"456"</span></span><br><span class="line">print(s.multiply(n1, n2))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- æœ€æ¥è¿‘çš„ä¸‰æ•°ä¹‹å’Œ</title>
    <url>/2020/05/23/leetcode-%E6%9C%80%E6%8E%A5%E8%BF%91%E7%9A%84%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/3sum-closest/" target="_blank" rel="noopener">æœ€æ¥è¿‘çš„ä¸‰æ•°ä¹‹å’Œ</a><br/><br>ç»™å®šä¸€ä¸ªåŒ…æ‹¬ n ä¸ªæ•´æ•°çš„æ•°ç»„ nums å’Œ ä¸€ä¸ªç›®æ ‡å€¼ targetã€‚æ‰¾å‡º nums ä¸­çš„ä¸‰ä¸ªæ•´æ•°ï¼Œä½¿å¾—å®ƒä»¬çš„å’Œä¸ target æœ€æ¥è¿‘ã€‚è¿”å›è¿™ä¸‰ä¸ªæ•°çš„å’Œã€‚å‡å®šæ¯ç»„è¾“å…¥åªå­˜åœ¨å”¯ä¸€ç­”æ¡ˆã€‚</p>
<blockquote>
</blockquote>
<p>ä¾‹å¦‚ï¼Œç»™å®šæ•°ç»„ nums = [-1ï¼Œ2ï¼Œ1ï¼Œ-4], å’Œ target = 1. ä¸ target æœ€æ¥è¿‘çš„ä¸‰ä¸ªæ•°çš„å’Œä¸º 2. (-1 + 2 + 1 = 2).</p>
<a id="more"></a>

<h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># __author__ = 'ChenTao'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">threeSumClosest</span><span class="params">(self, nums: list, target: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="comment"># æ’åº</span></span><br><span class="line">        nums.sort()</span><br><span class="line">        <span class="comment"># æœ€å¤§åå·®</span></span><br><span class="line">        tmp = [sys.maxsize, sys.maxsize, sys.maxsize]</span><br><span class="line">        <span class="keyword">for</span> first <span class="keyword">in</span> range(len(nums) - <span class="number">2</span>):</span><br><span class="line">            second = first + <span class="number">1</span></span><br><span class="line">            <span class="comment"># ç¬¬ä¸‰ä¸ªæ•°ä»æœ€å³è¾¹å¼€å§‹</span></span><br><span class="line">            third = len(nums) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># ä¿è¯æœ‰æ•ˆèŒƒå›´</span></span><br><span class="line">            <span class="keyword">while</span> second &lt; third &lt; len(nums):</span><br><span class="line">                x = nums[first] + nums[second] + nums[third]</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> x == target:</span><br><span class="line">                    tmp = [nums[first], nums[second], nums[third]]</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="comment"># è®¡ç®—å·®å€¼çš„ç»å¯¹å€¼</span></span><br><span class="line">                <span class="keyword">elif</span> abs(x - target) &lt; abs(sum(tmp) - target):</span><br><span class="line">                    tmp = [nums[first], nums[second], nums[third]]</span><br><span class="line"></span><br><span class="line">                <span class="comment"># æŒªåŠ¨</span></span><br><span class="line">                <span class="keyword">if</span> x &lt; target:</span><br><span class="line">                    second += <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    third -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sum(tmp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line"><span class="comment"># nums = [0, 2, 1, -3]</span></span><br><span class="line"><span class="comment"># nums = [1, 1, -1, -1, 3]</span></span><br><span class="line">nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">32</span>, <span class="number">64</span>, <span class="number">128</span>]</span><br><span class="line">target = <span class="number">82</span></span><br><span class="line">print(s.threeSumClosest(nums, target))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- æ‰“å°é›¶ä¸å¥‡å¶æ•°</title>
    <url>/2020/05/23/leetcode-%E6%89%93%E5%8D%B0%E9%9B%B6%E4%B8%8E%E5%A5%87%E5%81%B6%E6%95%B0/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/print-zero-even-odd/" target="_blank" rel="noopener">æ‰“å°é›¶ä¸å¥‡å¶æ•°</a></p>
<p>å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ZeroEvenOdd</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ZeroEvenOdd</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123; ... &#125;      <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">zero</span><span class="params">(printNumber)</span> </span>&#123; ... &#125;  <span class="comment">// ä»…æ‰“å°å‡º 0</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">even</span><span class="params">(printNumber)</span> </span>&#123; ... &#125;  <span class="comment">// ä»…æ‰“å°å‡º å¶æ•°</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">odd</span><span class="params">(printNumber)</span> </span>&#123; ... &#125;   <span class="comment">// ä»…æ‰“å°å‡º å¥‡æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç›¸åŒçš„ä¸€ä¸ª ZeroEvenOdd ç±»å®ä¾‹å°†ä¼šä¼ é€’ç»™ä¸‰ä¸ªä¸åŒçš„çº¿ç¨‹ï¼š</p>
<pre><code>çº¿ç¨‹ A å°†è°ƒç”¨ zero()ï¼Œå®ƒåªè¾“å‡º 0 ã€‚
çº¿ç¨‹ B å°†è°ƒç”¨ even()ï¼Œå®ƒåªè¾“å‡ºå¶æ•°ã€‚
çº¿ç¨‹ C å°†è°ƒç”¨ odd()ï¼Œå®ƒåªè¾“å‡ºå¥‡æ•°ã€‚</code></pre><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ª printNumber æ–¹æ³•æ¥è¾“å‡ºä¸€ä¸ªæ•´æ•°ã€‚è¯·ä¿®æ”¹ç»™å‡ºçš„ä»£ç ä»¥è¾“å‡ºæ•´æ•°åºåˆ— 010203040506â€¦ ï¼Œå…¶ä¸­åºåˆ—çš„é•¿åº¦å¿…é¡»ä¸º 2nã€‚<br>ç¤ºä¾‹1:<br>è¾“å…¥ï¼šn = 2<br/><br>è¾“å‡ºï¼šâ€0102â€<br/><br>è¯´æ˜ï¼šä¸‰æ¡çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œï¼Œå…¶ä¸­ä¸€ä¸ªè°ƒç”¨ zero()ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ even()ï¼Œæœ€åä¸€ä¸ªçº¿ç¨‹è°ƒç”¨odd()ã€‚æ­£ç¡®çš„è¾“å‡ºä¸º â€œ0102â€ã€‚<br>ç¤ºä¾‹2:<br>è¾“å…¥ï¼šn = 5<br/><br>è¾“å‡ºï¼šâ€0102030405â€</p>
<a id="more"></a>

<h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># __author__ = 'ChenTao'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ZeroEvenOdd</span>:</span></span><br><span class="line">    BREAKPOINT = <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        self.n = n</span><br><span class="line">        self.cur = <span class="number">0</span></span><br><span class="line">        self.index = <span class="number">1</span></span><br><span class="line">        self.condition = threading.Condition()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">zero</span><span class="params">(self, printNumber)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">with</span> self.condition:</span><br><span class="line">                <span class="comment"># åˆ¤æ–­æ˜¯å¦ç­‰å¾…å”¤é†’</span></span><br><span class="line">                <span class="keyword">while</span> <span class="keyword">not</span> self.__is_zero():</span><br><span class="line">                    self.condition.wait()</span><br><span class="line">                <span class="comment"># é€€å‡ºå¾ªç¯</span></span><br><span class="line">                <span class="keyword">if</span> self.cur == self.BREAKPOINT:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="comment"># æ‰“å°</span></span><br><span class="line">                printNumber(self.cur)</span><br><span class="line">                <span class="comment"># è®¡ç®—ä¸‹ä¸€æ¬¡æ‰“å°çš„æ•°å­—</span></span><br><span class="line">                self.__continue()</span><br><span class="line">                <span class="comment"># å”¤é†’</span></span><br><span class="line">                self.condition.notify_all()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">even</span><span class="params">(self, printNumber)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">with</span> self.condition:</span><br><span class="line">                <span class="keyword">while</span> <span class="keyword">not</span> self.__is_even():</span><br><span class="line">                    self.condition.wait()</span><br><span class="line">                <span class="keyword">if</span> self.cur == self.BREAKPOINT:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                printNumber(self.cur)</span><br><span class="line">                self.__continue()</span><br><span class="line">                self.condition.notify_all()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">odd</span><span class="params">(self, printNumber)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">with</span> self.condition:</span><br><span class="line">                <span class="keyword">while</span> <span class="keyword">not</span> self.__is_odd():</span><br><span class="line">                    self.condition.wait()</span><br><span class="line">                <span class="keyword">if</span> self.cur == self.BREAKPOINT:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                printNumber(self.cur)</span><br><span class="line">                self.__continue()</span><br><span class="line">                self.condition.notify_all()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__is_zero</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ‰“å°æ•°å­—0</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.cur == <span class="number">0</span> <span class="keyword">or</span> self.cur == self.BREAKPOINT</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__is_even</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ‰“å°å¥‡æ•°</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> (self.cur != <span class="number">0</span> <span class="keyword">and</span> self.cur % <span class="number">2</span> == <span class="number">0</span>) <span class="keyword">or</span> self.cur == self.BREAKPOINT</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__is_odd</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ‰“å°å¶æ•°</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> (self.cur != <span class="number">0</span> <span class="keyword">and</span> self.cur % <span class="number">2</span> == <span class="number">1</span>) <span class="keyword">or</span> self.cur == self.BREAKPOINT</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__continue</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.index &lt;= self.n:</span><br><span class="line">            <span class="keyword">if</span> self.cur == <span class="number">0</span>:</span><br><span class="line">                self.cur = self.index</span><br><span class="line">                self.index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.cur = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.cur = self.BREAKPOINT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•ä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_number</span><span class="params">(num)</span>:</span></span><br><span class="line">    print(num, end=<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(ze: ZeroEvenOdd, fname: str)</span>:</span></span><br><span class="line">    _fc = getattr(ze, fname)</span><br><span class="line">    _fc(print_number)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    n = <span class="number">8</span></span><br><span class="line">    ze = ZeroEvenOdd(n)</span><br><span class="line">    thrs = list()</span><br><span class="line">    thrs.append(threading.Thread(target=func, args=(ze, <span class="string">'zero'</span>)))</span><br><span class="line">    thrs.append(threading.Thread(target=func, args=(ze, <span class="string">'odd'</span>)))</span><br><span class="line">    thrs.append(threading.Thread(target=func, args=(ze, <span class="string">'even'</span>)))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> th <span class="keyword">in</span> thrs:</span><br><span class="line">        th.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> th <span class="keyword">in</span> thrs:</span><br><span class="line">        th.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- æœ€å°æ ˆ</title>
    <url>/2020/05/23/leetcode-%E6%9C%80%E5%B0%8F%E6%A0%88/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/min-stack/" target="_blank" rel="noopener">æœ€å°æ ˆ</a></p>
<a id="more"></a>

<p>è®¾è®¡ä¸€ä¸ªæ”¯æŒ pushï¼Œpopï¼Œtop æ“ä½œï¼Œå¹¶èƒ½åœ¨å¸¸æ•°æ—¶é—´å†…æ£€ç´¢åˆ°æœ€å°å…ƒç´ çš„æ ˆã€‚</p>
<pre><code>push(x) -- å°†å…ƒç´  x æ¨å…¥æ ˆä¸­ã€‚
pop() -- åˆ é™¤æ ˆé¡¶çš„å…ƒç´ ã€‚
top() -- è·å–æ ˆé¡¶å…ƒç´ ã€‚
getMin() -- æ£€ç´¢æ ˆä¸­çš„æœ€å°å…ƒç´ ã€‚</code></pre><figure class="highlight"><table><tr><td class="code"><pre><span class="line">MinStack minStack = new MinStack();</span><br><span class="line">minStack.push(<span class="number">-2</span>);</span><br><span class="line">minStack.push(<span class="number">0</span>);</span><br><span class="line">minStack.push(<span class="number">-3</span>);</span><br><span class="line">minStack.getMin();   --&gt; è¿”å› -3.</span><br><span class="line">minStack.pop();</span><br><span class="line">minStack.top();      --&gt; è¿”å› 0.</span><br><span class="line">minStack.getMin();   --&gt; è¿”å› -2.</span><br></pre></td></tr></table></figure>



<h3 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h3><h4 id="1-ç¬¬ä¸€ç§è§£æ³•-list-min"><a href="#1-ç¬¬ä¸€ç§è§£æ³•-list-min" class="headerlink" title="1. ç¬¬ä¸€ç§è§£æ³•: list + min"></a>1. ç¬¬ä¸€ç§è§£æ³•: list + min</h4><p>ç¬¬ä¸€ç§è§£æ³•å°±æ˜¯åˆ©ç”¨<code>list</code>å­˜æ”¾æ•°æ®ï¼Œç„¶ååœ¨è·å–æœ€å°å€¼çš„æ—¶ï¼Œä½¿ç”¨å†…ç½®å‡½æ•°<code>min</code>ã€‚</p>
<p>PS:æ²¡è€ƒè™‘å¼‚å¸¸çš„æƒ…å†µäº†ï¼Œä¾‹å¦‚ç©ºåˆ—è¡¨çš„å¤„ç†ä¹‹ç±»çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        initialize your data structure here.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.__stack = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, x: int)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self.__stack.append(x)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self.__stack.pop()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">top</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.__stack[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getMin</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> min(self.__stack)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">stack = MinStack()</span><br><span class="line">nums = [random.randint(<span class="number">0</span>, <span class="number">100</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">print(<span class="string">'nums: '</span> + str(nums))</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">    stack.push(num)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'min: '</span> + str(stack.getMin()))</span><br><span class="line">stack.pop()</span><br><span class="line">stack.pop()</span><br><span class="line">stack.pop()</span><br><span class="line">stack.pop()</span><br><span class="line">print(<span class="string">'min: '</span> + str(stack.getMin()))</span><br><span class="line">print(<span class="string">'top: '</span> + str(stack.top()))</span><br></pre></td></tr></table></figure>

<p>leetcodeçš„ç®—æ³•å¤æ‚åº¦ï¼Œç”¨æ—¶<code>988ms</code></p>
<h4 id="ç¬¬äºŒç§è§£æ³•-åŒdeque"><a href="#ç¬¬äºŒç§è§£æ³•-åŒdeque" class="headerlink" title="ç¬¬äºŒç§è§£æ³•: åŒdeque"></a>ç¬¬äºŒç§è§£æ³•: åŒdeque</h4><p>è¿™ç§è§£æ³•åˆ©ç”¨äº†pythonè‡ªå¸¦çš„ dequeæ•°æ®ç»“æ„ï¼Œç”¨ç©ºé—´æ¢æ—¶é—´æ¥è§£çš„ ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        initialize your data structure here.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.__stack = deque()</span><br><span class="line">        self.__min_stack = deque()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, x: int)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self.__stack.append(x)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.__min_stack <span class="keyword">or</span> self.__min_stack[<span class="number">-1</span>] &gt;= x:</span><br><span class="line">            self.__min_stack.append(x)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        x = self.__stack.pop()</span><br><span class="line">        <span class="keyword">if</span> self.__min_stack <span class="keyword">and</span> self.__min_stack[<span class="number">-1</span>] == x:</span><br><span class="line">            self.__min_stack.pop()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">top</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.__stack[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getMin</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">return</span> self.__min_stack[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">stack = MinStack()</span><br><span class="line">nums = [random.randint(<span class="number">0</span>, <span class="number">100</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">print(<span class="string">'nums: '</span> + str(nums))</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">    stack.push(num)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'min: '</span> + str(stack.getMin()))</span><br><span class="line">stack.pop()</span><br><span class="line">stack.pop()</span><br><span class="line">stack.pop()</span><br><span class="line">stack.pop()</span><br><span class="line">print(<span class="string">'min: '</span> + str(stack.getMin()))</span><br><span class="line">print(<span class="string">'top: '</span> + str(stack.top()))</span><br></pre></td></tr></table></figure>

<p>leetcodeä¸Šé€šè¿‡æ—¶é—´æ˜¯<code>148ms</code></p>
]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- è¿”å›åˆ é™¤èŠ‚ç‚¹åçš„æ£®æ—ä¸­çš„æ¯æ£µæ ‘</title>
    <url>/2020/05/23/leetcode-%E8%BF%94%E5%9B%9E%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9%E5%90%8E%E7%9A%84%E6%A3%AE%E6%9E%97%E4%B8%AD%E7%9A%84%E6%AF%8F%E6%A3%B5%E6%A0%91/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>è¿™ä¸ªé¢˜ç›®æ˜¯leetcodeä¸Šéšæœºäº§ç”Ÿçš„ä¸€ä¸ªé¢è¯•é¢˜ï¼Œæ‰€ä»¥æ²¡æœ‰é“¾æ¥äº†ã€‚</p>
<p>ç»™å‡ºäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ <code>root</code>ï¼Œæ ‘ä¸Šæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªä¸åŒçš„å€¼ã€‚</p>
<p>å¦‚æœèŠ‚ç‚¹å€¼åœ¨ <code>to_delete</code> ä¸­å‡ºç°ï¼Œæˆ‘ä»¬å°±æŠŠè¯¥èŠ‚ç‚¹ä»æ ‘ä¸Šåˆ å»ï¼Œæœ€åå¾—åˆ°ä¸€ä¸ªæ£®æ—ï¼ˆä¸€äº›ä¸ç›¸äº¤çš„æ ‘æ„æˆçš„é›†åˆï¼‰ã€‚</p>
<p>è¿”å›æ£®æ—ä¸­çš„æ¯æ£µæ ‘ã€‚ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºç»„ç»‡ç­”æ¡ˆã€‚</p>
<p>ç¤ºä¾‹:</p>
<p><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/blog/20190803/screen-shot-2019-07-01-at-53836-pm.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šroot &#x3D; [1,2,3,4,5,6,7], to_delete &#x3D; [3,5]</span><br><span class="line">è¾“å‡ºï¼š[[1,2,null,4],[6],[7]]</span><br></pre></td></tr></table></figure>

<p>æç¤º:</p>
<ul>
<li>æ ‘ä¸­çš„èŠ‚ç‚¹æ•°æœ€å¤§ä¸º <code>1000</code>ã€‚</li>
<li>æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªä»‹äº <code>1</code> åˆ° <code>1000</code> ä¹‹é—´çš„å€¼ï¼Œä¸”å„ä¸ç›¸åŒã€‚</li>
<li><code>to_delete.length &lt;= 1000</code></li>
<li><code>to_delete</code> åŒ…å«ä¸€äº›ä» <code>1</code> åˆ° <code>1000</code>ã€å„ä¸ç›¸åŒçš„å€¼ã€‚</li>
</ul>
<a id="more"></a>

<h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>ä¸»è¦éœ€è¦å¤„ç†åˆ é™¤çš„èŠ‚ç‚¹ä»¥åŠå­èŠ‚ç‚¹çš„é—®é¢˜ã€‚</p>
<p>è¦æƒ³é€šè¿‡æµ‹è¯•ç”¨ä¾‹ï¼Œåˆ™éœ€è¦æŠŠè¦åˆ é™¤çš„èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„left \ rightèµ‹å€¼ä¸ºNoneæ‰è¡Œã€‚</p>
<p>ä¸»è¦åˆ†æè§ä»£ç æ³¨é‡Šå³å¯ã€‚</p>
<p>ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»“æœè¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­å­˜æ”¾ç€æ£®æ—ä¸­æ¯æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œä¸æ˜¯ç›´æ¥è¿”å›æœ€ç»ˆç»“æœâ€¦.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.left = <span class="literal">None</span></span><br><span class="line">        self.right = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(self.val)</span><br><span class="line"></span><br><span class="line">    __repr__ = __str__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delNodes</span><span class="params">(self, root: TreeNode, to_delete: list)</span> -&gt; list:</span></span><br><span class="line">        <span class="comment"># è¿‡ç¨‹ï¼Œå‡¡æ˜¯æ ‘çš„æ ¹èŠ‚ç‚¹çš„éƒ½æ”¾åœ¨æ­¤åˆ—è¡¨ä¸­</span></span><br><span class="line">        <span class="comment"># å°±æ˜¯æ ¹èŠ‚ç‚¹å’Œè¦åˆ é™¤çš„èŠ‚ç‚¹</span></span><br><span class="line">        process = list()</span><br><span class="line">        <span class="comment"># ç»“æœ</span></span><br><span class="line">        result = list()</span><br><span class="line"></span><br><span class="line">        process.append(root)</span><br><span class="line">        <span class="keyword">while</span> len(process) &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># æŠ›å‡ºä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            node = process.pop(<span class="number">0</span>)</span><br><span class="line">            <span class="comment"># éå†åˆ é™¤</span></span><br><span class="line">            <span class="comment"># å¦‚æœè¿™ä¸ªèŠ‚ç‚¹ä¸æ˜¯åˆ é™¤çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”å­˜åœ¨ï¼Œå°±æ·»åŠ è¿›ç»“æœä¸­</span></span><br><span class="line">            <span class="comment"># è¿™ä¸ªåˆ¤æ–­æ¡ä»¶ä¸èƒ½ä¸æ·»åŠ ï¼Œå¦åˆ™ä¼šé€šä¸è¿‡è¿™ç»„æ•°æ®</span></span><br><span class="line">            <span class="comment"># root = [1, 2, None, 4, 3]</span></span><br><span class="line">            <span class="comment"># to_delete = [2, 3]</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.traverse(node, process, to_delete) <span class="keyword">and</span> node:</span><br><span class="line">                result.append(node)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">traverse</span><span class="params">(self, node, process, to_delete)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> node:</span><br><span class="line">            <span class="comment"># å¦‚æœå½“å‰èŠ‚ç‚¹çš„å€¼ä¸æ˜¯è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±ç»§ç»­å¾€å·¦\å³éå†</span></span><br><span class="line">            <span class="keyword">if</span> node.val <span class="keyword">not</span> <span class="keyword">in</span> to_delete:</span><br><span class="line">                <span class="comment"># ä¸ºäº†èƒ½é€šè¿‡æµ‹è¯•æäº¤ï¼Œå¦‚æœè¿”å›çš„æ˜¯Trueï¼Œå°±è¡¨ç¤ºå·¦\å³å­èŠ‚ç‚¹åˆ é™¤äº†</span></span><br><span class="line">                <span class="comment"># é‚£ä¹ˆå°±éœ€è¦æŠŠçˆ¶èŠ‚ç‚¹çš„å·¦\å³æŒ‡é’ˆç½®ç©º</span></span><br><span class="line">                <span class="keyword">if</span> self.traverse(node.left, process, to_delete):</span><br><span class="line">                    node.left = <span class="literal">None</span></span><br><span class="line">                <span class="keyword">if</span> self.traverse(node.right, process, to_delete):</span><br><span class="line">                    node.right = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># éœ€è¦åˆ é™¤æœ¬èº«</span></span><br><span class="line">                <span class="comment"># æŠŠå·¦å³ä¸¤ä¸ªå­èŠ‚ç‚¹åŠ å…¥åˆ—è¡¨ä¸­ï¼Œéœ€è¦å¾€ä¸‹éå†</span></span><br><span class="line">                process.append(node.left)</span><br><span class="line">                process.append(node.right)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•ä»£ç </span></span><br><span class="line">root = [<span class="number">1</span>, <span class="number">2</span>, <span class="literal">None</span>, <span class="number">4</span>, <span class="number">3</span>]</span><br><span class="line">to_delete = [<span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># å±‚åºæ„é€ äºŒå‰æ ‘</span></span><br><span class="line">    <span class="comment"># æ„é€ çš„æ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œæ‰€ä»¥æ­¤å¤„ä¸ä¼šå­˜åœ¨bug</span></span><br><span class="line">    <span class="comment"># å¦‚æœæ˜¯æ™®é€šäºŒå‰æ ‘ï¼Œä¸èƒ½è¿™ä¹ˆå†™äº†</span></span><br><span class="line">    nodes = list()</span><br><span class="line">    <span class="keyword">for</span> index, num <span class="keyword">in</span> enumerate(root):</span><br><span class="line">        node = TreeNode(num)</span><br><span class="line">        <span class="comment"># æ ¹èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> index == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="comment"># å·¦å­©å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">elif</span> index % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">            parent = int((index - <span class="number">1</span>) / <span class="number">2</span>)</span><br><span class="line">            parent_node = nodes[parent]</span><br><span class="line">            parent_node.left = node</span><br><span class="line">        <span class="comment"># å³å­©å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">elif</span> index % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            parent = int((index - <span class="number">2</span>) / <span class="number">2</span>)</span><br><span class="line">            parent_node = nodes[parent]</span><br><span class="line">            parent_node.right = node</span><br><span class="line"></span><br><span class="line">        nodes.append(node)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> nodes</span><br><span class="line"></span><br><span class="line">print(create())</span><br><span class="line">head = create()[<span class="number">0</span>]</span><br><span class="line">s = Solution()</span><br><span class="line">print(s.delNodes(head, to_delete))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- äº¤æ›¿æ‰“å°FooBar</title>
    <url>/2020/05/23/leetcode-%E4%BA%A4%E6%9B%BF%E6%89%93%E5%8D%B0FooBar/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/print-foobar-alternately/" target="_blank" rel="noopener">äº¤æ›¿æ‰“å°FooBar</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooBar</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      print(<span class="string">"foo"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      print(<span class="string">"bar"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹å°†ä¼šå…±ç”¨ä¸€ä¸ª FooBar å®ä¾‹ã€‚å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹å°†ä¼šè°ƒç”¨ foo() æ–¹æ³•ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°†ä¼šè°ƒç”¨ bar() æ–¹æ³•ã€‚</p>
<p>è¯·è®¾è®¡ä¿®æ”¹ç¨‹åºï¼Œä»¥ç¡®ä¿ â€œfoobarâ€ è¢«è¾“å‡º n æ¬¡ã€‚</p>
<p>ç¤ºä¾‹1:</p>
<blockquote>
<p>è¾“å…¥: n = 1<br>è¾“å‡º: â€œfoobarâ€<br>è§£é‡Š: è¿™é‡Œæœ‰ä¸¤ä¸ªçº¿ç¨‹è¢«å¼‚æ­¥å¯åŠ¨ã€‚å…¶ä¸­ä¸€ä¸ªè°ƒç”¨ foo() æ–¹æ³•, å¦ä¸€ä¸ªè°ƒç”¨ bar() æ–¹æ³•ï¼Œâ€foobarâ€ å°†è¢«è¾“å‡ºä¸€æ¬¡ã€‚</p>
</blockquote>
<p>ç¤ºä¾‹2:</p>
<blockquote>
<p>è¾“å…¥: n = 2<br>è¾“å‡º: â€œfoobarfoobarâ€<br>è§£é‡Š: â€œfoobarâ€ å°†è¢«è¾“å‡ºä¸¤æ¬¡ã€‚</p>
</blockquote>
<a id="more"></a>

<h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>å¤šçº¿ç¨‹ä¸­çš„ä¸€ä¸ªé¢˜ç›®ï¼Œç”¨Conditionç±»å®Œæˆã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, Condition</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooBar</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        self.n = n</span><br><span class="line">        self.con = Condition()</span><br><span class="line">        self.val = <span class="string">'foo'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self, printFoo: <span class="string">'Callable[[], None]'</span>)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.n):</span><br><span class="line">            <span class="comment"># printFoo() outputs "foo". Do not change or remove this line.</span></span><br><span class="line">            <span class="keyword">with</span> self.con:</span><br><span class="line">                <span class="keyword">if</span> self.val != <span class="string">'foo'</span>:</span><br><span class="line">                    self.con.wait()</span><br><span class="line">                printFoo()</span><br><span class="line">                self.val = <span class="string">'bar'</span></span><br><span class="line">                self.con.notify_all()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(self, printBar: <span class="string">'Callable[[], None]'</span>)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.n):</span><br><span class="line">            <span class="comment"># printBar() outputs "bar". Do not change or remove this line.</span></span><br><span class="line">            <span class="keyword">with</span> self.con:</span><br><span class="line">                <span class="keyword">if</span> self.val != <span class="string">'bar'</span>:</span><br><span class="line">                    self.con.wait()</span><br><span class="line"></span><br><span class="line">                printBar()</span><br><span class="line">                self.val = <span class="string">'foo'</span></span><br><span class="line">                self.con.notify_all()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_printFoo</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'foo'</span>, end=<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_printBar</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'bar'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">foo = FooBar(<span class="number">10</span>)</span><br><span class="line">thrs = list()</span><br><span class="line">thrs.append(Thread(target=foo.foo, args=(_printFoo,)))</span><br><span class="line">thrs.append(Thread(target=foo.bar, args=(_printBar,)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> th <span class="keyword">in</span> thrs:</span><br><span class="line">    th.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> th <span class="keyword">in</span> thrs:</span><br><span class="line">    th.join()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®</title>
    <url>/2020/05/23/leetcode-%E5%9C%A8%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E6%9F%A5%E6%89%BE%E5%85%83%E7%B4%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%92%8C%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E4%BD%8D%E7%BD%AE/</url>
    <content><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p><a href="https://leetcode-cn.com/problems/find-first-and-last-position-of-element-in-sorted-array/" target="_blank" rel="noopener">åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®</a></p>
<p>ç»™å®šä¸€ä¸ªæŒ‰ç…§å‡åºæ’åˆ—çš„æ•´æ•°æ•°ç»„ numsï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ targetã€‚æ‰¾å‡ºç»™å®šç›®æ ‡å€¼åœ¨æ•°ç»„ä¸­çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚<br>ä½ çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦å¿…é¡»æ˜¯ O(log n) çº§åˆ«ã€‚<br>å¦‚æœæ•°ç»„ä¸­ä¸å­˜åœ¨ç›®æ ‡å€¼ï¼Œè¿”å› [-1, -1]ã€‚</p>
<p>ç¤ºä¾‹1:</p>
<blockquote>
<p>è¾“å…¥: nums = [5,7,7,8,8,10], target = 8<br>è¾“å‡º: [3,4]</p>
</blockquote>
<p>ç¤ºä¾‹2:</p>
<blockquote>
<p>è¾“å…¥: nums = [5,7,7,8,8,10], target = 6<br>è¾“å‡º: [-1,-1]</p>
</blockquote>
<a id="more"></a>

<h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>é¢˜ç›®å¾ˆç®€å•ï¼ŒäºŒåˆ†æ³•è§£å†³ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># __author__ = 'ChenTao'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">searchRange</span><span class="params">(self, nums: list, target: int)</span> -&gt; list:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> nums:</span><br><span class="line">            <span class="keyword">return</span> [<span class="number">-1</span>, <span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = len(nums) - <span class="number">1</span></span><br><span class="line">        min_index = <span class="number">-1</span></span><br><span class="line">        max_index = <span class="number">-1</span></span><br><span class="line">        <span class="comment"># æ‰¾åˆ°æŸä¸ªä½ç½®çš„å€¼ï¼Œä¸ç®¡æ˜¯ç¬¬å‡ ä¸ª</span></span><br><span class="line">        cur_index = <span class="number">-1</span></span><br><span class="line">        <span class="comment"># äºŒåˆ†æŸ¥æ‰¾</span></span><br><span class="line">        <span class="keyword">while</span> left &lt;= right:</span><br><span class="line">            mid = int((left + right) / <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">if</span> nums[mid] == target:</span><br><span class="line">                cur_index = mid</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> nums[mid] &lt; target:</span><br><span class="line">                left = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right = mid - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># é‡‡ç”¨çš„æ˜¯é¡ºåºéå†ï¼Œä¼šæ›´åŠ è€—æ—¶</span></span><br><span class="line">        <span class="comment"># try:</span></span><br><span class="line">        <span class="comment">#     cur_index = nums.index(target)</span></span><br><span class="line">        <span class="comment"># except:</span></span><br><span class="line">        <span class="comment">#     cur_index = -1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä»æ‰¾åˆ°çš„å€¼çš„ä½ç½®å¾€å‰éå†ï¼Œæ‰¾åˆ°æœ€å°å€¼</span></span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> range(cur_index, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> nums[index] == target:</span><br><span class="line">                min_index = index</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¾€åéå†æ‰¾åˆ°æœ€å¤§å€¼</span></span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> range(cur_index, len(nums), <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> nums[index] == target:</span><br><span class="line">                max_index = index</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœå­˜åœ¨å€¼ï¼Œä¸èƒ½è¿”å›[-1, -1]</span></span><br><span class="line">        <span class="keyword">if</span> min_index == <span class="number">-1</span> <span class="keyword">or</span> max_index == <span class="number">-1</span>:</span><br><span class="line">            min_index = max_index = max_index <span class="keyword">if</span> max_index &gt; min_index <span class="keyword">else</span> min_index</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [min_index, max_index]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">so = Solution()</span><br><span class="line"></span><br><span class="line">nums = [<span class="number">5</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">10</span>]</span><br><span class="line"><span class="comment"># nums = [1, 4]</span></span><br><span class="line">target = <span class="number">8</span></span><br><span class="line">print(so.searchRange(nums, target))</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨é¢˜è§£åŒºçœ‹åˆ°äº†å¦ä¸€ç§è§£æ³•ï¼Œæˆ‘ä¸€ç›´è®¤ä¸º in å…³é”®å­—å’Œ listçš„indexéƒ½æ˜¯é¡ºåºéå†ï¼Œä¸ºä»€ä¹ˆå¤æ‚åº¦åè€Œä¸ä¼šå¢åŠ å¾ˆå¤šå‘¢ï¼Ÿç›¸æ¯”äºæˆ‘ç”¨äºŒåˆ†æ³•è§£ï¼Œæ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦å‡ ä¹æ²¡ä»€ä¹ˆå¢åŠ çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">searchRange</span><span class="params">(self, nums, target)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type nums: List[int]</span></span><br><span class="line"><span class="string">        :type target: int</span></span><br><span class="line"><span class="string">        :rtype: List[int]</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> target <span class="keyword">in</span> nums:</span><br><span class="line">            start = nums.index(target)</span><br><span class="line">            end = len(nums) - nums[::<span class="number">-1</span>].index(target) - <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> [start,end]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> [<span class="number">-1</span>,<span class="number">-1</span>]</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- å®ç° Trie (å‰ç¼€æ ‘)</title>
    <url>/2020/05/23/leetcode-%E5%AE%9E%E7%8E%B0-Trie-%E5%89%8D%E7%BC%80%E6%A0%91/</url>
    <content><![CDATA[<p><a href="https://leetcode-cn.com/problems/implement-trie-prefix-tree" target="_blank" rel="noopener">å‰ç¼€æ ‘</a></p>
<p>å®ç°ä¸€ä¸ª Trie (å‰ç¼€æ ‘)ï¼ŒåŒ…å« insert, search, å’Œ startsWith è¿™ä¸‰ä¸ªæ“ä½œã€‚</p>
<p>ç¤ºä¾‹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Trie trie = new Trie();</span><br><span class="line">trie.insert(<span class="string">"apple"</span>);</span><br><span class="line">trie.search(<span class="string">"apple"</span>);   // è¿”å› true</span><br><span class="line">trie.search(<span class="string">"app"</span>);     // è¿”å› false</span><br><span class="line">trie.startsWith(<span class="string">"app"</span>); // è¿”å› true</span><br><span class="line">trie.insert(<span class="string">"app"</span>);   </span><br><span class="line">trie.search(<span class="string">"app"</span>);     // è¿”å› true</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜:</p>
<p>ä½ å¯ä»¥å‡è®¾æ‰€æœ‰çš„è¾“å…¥éƒ½æ˜¯ç”±å°å†™å­—æ¯ a-z æ„æˆçš„ã€‚<br>ä¿è¯æ‰€æœ‰è¾“å…¥å‡ä¸ºéç©ºå­—ç¬¦ä¸²ã€‚</p>
<p>leetcodeä¸Šè¯¥ä»£ç å·²ç»é€šè¿‡äº†ï¼Œè‡ªå·±åœ¨åŸåŸºç¡€ä¸ŠåŠ äº†æ³¨é‡Šå’Œéå†çš„åŠŸèƒ½ã€‚<br>è¿™ä¸ªå°±æ˜¯å­—å…¸æ ‘:</p>
<ul>
<li>æ’å…¥ä¸€ä¸ªå•è¯æ—¶ï¼Œéå†æ­¤å•è¯å„ä¸ªå­—ç¬¦</li>
<li>å¦‚æœå•ä¸ªå­—ç¬¦å­˜åœ¨ï¼Œåˆ™å–å‡ºè¯¥å­—ç¬¦å¯¹åº”çš„èŠ‚ç‚¹</li>
<li>å¦‚æœå­—ç¬¦ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå­—ç¬¦èŠ‚ç‚¹ï¼Œå¹¶åŠ å…¥åˆ°ä¸Šä¸€ä¸ªå­—ç¬¦çš„å­èŠ‚ç‚¹(next)ä¸­</li>
<li>å¾ªç¯</li>
</ul>
<a id="more"></a>

<p>ä¸€å¼ å›¾å¯ä»¥è§£é‡Šè¿™ä¸ªåŠŸèƒ½:<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/pic/20180717203719720.png" alt="å­—å…¸æ ‘"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="comment"># èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        self.value = value</span><br><span class="line">        <span class="comment"># è¯¥èŠ‚ç‚¹æ˜¯å¦æˆä¸ºä¸€ä¸ªå•è¯çš„ç»“å°¾å­—ç¬¦</span></span><br><span class="line">        self.end = <span class="literal">False</span></span><br><span class="line">        <span class="comment"># è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</span></span><br><span class="line">        self.next = dict()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.value</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trie</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Initialize your data structure here.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.root = Node(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, word: str)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Inserts a word into the trie.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        cur = self.root</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> word:</span><br><span class="line">            node = cur.next.get(w)</span><br><span class="line">            <span class="comment"># åˆ¤æ–­å­èŠ‚ç‚¹ä¸­æ˜¯å¦å­˜åœ¨wè¿™ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»º</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node:</span><br><span class="line">                node = Node(w)</span><br><span class="line">                <span class="comment"># å°†æ–°åˆ›å»ºçš„èŠ‚ç‚¹æ›´æ–°åˆ°nextä¸­</span></span><br><span class="line">                cur.next[w] = node</span><br><span class="line">            <span class="comment"># ç§»åŠ¨æŒ‡é’ˆä½ç½®</span></span><br><span class="line">            cur = node</span><br><span class="line">        <span class="comment"># wordçš„æ‰€æœ‰å€¼éå†å®Œæˆï¼Œå°†æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„endå€¼è®¾ç½®ä¸ºTrue</span></span><br><span class="line">        cur.end = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self, word: str)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Returns if the word is in the trie.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        node = self.root</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> word:</span><br><span class="line">            node = node.next.get(w)</span><br><span class="line">            <span class="comment"># éå†ï¼Œå¦‚æœnodeä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜è¯¥å•è¯ä¸å­˜åœ¨</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="comment"># æœ‰å¯èƒ½wordæ˜¯å‰ç¼€ï¼Œç›´æ¥è¿”å›endå€¼å³å¯</span></span><br><span class="line">        <span class="keyword">return</span> node.end</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">startsWith</span><span class="params">(self, prefix: str)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Returns if there is any word in the trie that starts with the given prefix.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        node = self.root</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> prefix:</span><br><span class="line">            node = node.next.get(p)</span><br><span class="line">            <span class="comment"># nodeä¸å­˜åœ¨ï¼Œè¯´æ˜å‰ç¼€é”™è¯¯ï¼Œç›´æ¥è¿”å›False</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> node:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># prefiexéå†å®Œæˆï¼Œå‰ç¼€å­˜åœ¨ï¼Œè¿”å›True</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">traverse</span><span class="params">(self, node, word=<span class="string">''</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        éå†æ‰€æœ‰å•è¯</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> node.end:</span><br><span class="line">            print(word)</span><br><span class="line">        <span class="keyword">elif</span> node:</span><br><span class="line">            <span class="keyword">for</span> node <span class="keyword">in</span> node.next.values():</span><br><span class="line">                self.traverse(node, word+node.value)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_words</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">import</span> random</span><br><span class="line">    <span class="keyword">import</span> string</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10000</span>):</span><br><span class="line">        <span class="keyword">yield</span> <span class="string">''</span>.join(random.choice(string.ascii_lowercase) <span class="keyword">for</span> y <span class="keyword">in</span> range(random.randint(<span class="number">5</span>, <span class="number">15</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    words = random_words()</span><br><span class="line">    t = Trie()</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">        t.insert(word)</span><br><span class="line">    t.insert(<span class="string">'hello'</span>)</span><br><span class="line">    t.insert(<span class="string">'world'</span>)</span><br><span class="line">    t.insert(<span class="string">'python'</span>)</span><br><span class="line">    <span class="comment"># t.traverse(t.root)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    start = time.time()</span><br><span class="line">    print(<span class="string">'search python: '</span> + str(t.search(<span class="string">'python'</span>)))</span><br><span class="line">    print(<span class="string">'search time: '</span> + str(time.time() - start))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    test()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- ä¸¤æ•°ç›¸åŠ </title>
    <url>/2020/05/23/leetcode-%E4%B8%A4%E6%95%B0%E7%9B%B8%E5%8A%A0/</url>
    <content><![CDATA[<p><a href="https://leetcode-cn.com/problems/add-two-numbers/" target="_blank" rel="noopener">ä¸¤æ•°ç›¸åŠ </a></p>
<p>ç»™å‡ºä¸¤ä¸ª éç©º çš„é“¾è¡¨ç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªéè´Ÿçš„æ•´æ•°ã€‚å…¶ä¸­ï¼Œå®ƒä»¬å„è‡ªçš„ä½æ•°æ˜¯æŒ‰ç…§ é€†åº çš„æ–¹å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”å®ƒä»¬çš„æ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ ä¸€ä½ æ•°å­—ã€‚<br>å¦‚æœï¼Œæˆ‘ä»¬å°†è¿™ä¸¤ä¸ªæ•°ç›¸åŠ èµ·æ¥ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªæ–°çš„é“¾è¡¨æ¥è¡¨ç¤ºå®ƒä»¬çš„å’Œã€‚<br>æ‚¨å¯ä»¥å‡è®¾é™¤äº†æ•°å­— 0 ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªæ•°éƒ½ä¸ä¼šä»¥ 0 å¼€å¤´ã€‚</p>
<p>ç¤ºä¾‹ï¼š<br>è¾“å…¥ï¼š(2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)<br>è¾“å‡ºï¼š7 -&gt; 0 -&gt; 8<br>åŸå› ï¼š342 + 465 = 807</p>
<a id="more"></a>


<p>ä¸€è„¸æ‡µé€¼ï¼Œç”¨æœ€æ­£å¸¸çš„è§£æ³•åšå‡ºæ¥çš„ï¼Œè™½ç„¶æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦éƒ½æœ‰ç‚¹é«˜ï¼Œä½†è¿˜æ˜¯è¿‡äº†ã€‚<br>çœ‹è¯„è®ºè¯´ï¼ŒO(2n)çš„æ—¶é—´å¤æ‚åº¦éƒ½è¿‡ä¸å»ï¼Œé‚£æˆ‘è¿™å†™æ³•æ€ä¹ˆè¿‡çš„ï¼Ÿ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># __author__ = '_Tao'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addTwoNumbers</span><span class="params">(self, l1: ListNode, l2: ListNode)</span> -&gt; ListNode:</span></span><br><span class="line">        num1 = self.get_num(l1)</span><br><span class="line">        num2 = self.get_num(l2)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.split_num(num1 + num2)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_num</span><span class="params">(self, node)</span>:</span></span><br><span class="line">        num = <span class="number">0</span></span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> node:</span><br><span class="line">            num += node.val * pow(<span class="number">10</span>, index)</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">            node = node.next</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">split_num</span><span class="params">(self, num)</span>:</span></span><br><span class="line">        s = str(num)</span><br><span class="line">        cur = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> len(s) &gt;= <span class="number">1</span>:</span><br><span class="line">            last = s[<span class="number">0</span>]</span><br><span class="line">            s = s[<span class="number">1</span>:]</span><br><span class="line">            x = ListNode(int(last))</span><br><span class="line">            x.next = cur</span><br><span class="line">            cur = x</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cur</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    s = Solution()</span><br><span class="line">    n1 = ListNode(<span class="number">2</span>)</span><br><span class="line">    n2 = ListNode(<span class="number">4</span>)</span><br><span class="line">    n3 = ListNode(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    n1.next = n2</span><br><span class="line">    n2.next = n3</span><br><span class="line"></span><br><span class="line">    n4 = ListNode(<span class="number">5</span>)</span><br><span class="line">    n5 = ListNode(<span class="number">6</span>)</span><br><span class="line">    n6 = ListNode(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    n4.next = n5</span><br><span class="line">    n5.next = n6</span><br><span class="line"></span><br><span class="line">    x = s.addTwoNumbers(n1, n4)</span><br><span class="line">    print(s.get_num(x))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</title>
    <url>/2020/05/23/leetcode-%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E9%93%BE%E8%A1%A8/</url>
    <content><![CDATA[<p><a href="https://leetcode-cn.com/problems/merge-two-sorted-lists/" target="_blank" rel="noopener">åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</a></p>
<p>å°†ä¸¤ä¸ªæœ‰åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„æœ‰åºé“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚ </p>
<p>ç¤ºä¾‹ï¼š</p>
<p>è¾“å…¥ï¼š1-&gt;2-&gt;4, 1-&gt;3-&gt;4<br>è¾“å‡ºï¼š1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4<br><br/></p>
<a id="more"></a>

<p>é¢˜ç›®å¾ˆç®€å•ï¼Œå°±æ˜¯æ™®é€šé“¾è¡¨åšæ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-3-30 15:50</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mergeTwoLists</span><span class="params">(self, l1: ListNode, l2: ListNode)</span> -&gt; ListNode:</span></span><br><span class="line">        cur_node = <span class="literal">None</span></span><br><span class="line">        head = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®ä¸ºç©ºçš„æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> l1:</span><br><span class="line">            <span class="keyword">return</span> l2</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> l2:</span><br><span class="line">            <span class="keyword">return</span> l1</span><br><span class="line"></span><br><span class="line">        <span class="comment"># éå†åˆ¤æ–­å¤§å°</span></span><br><span class="line">        <span class="keyword">while</span> l1 <span class="keyword">and</span> l2:</span><br><span class="line">            <span class="keyword">if</span> l1.val &lt; l2.val:</span><br><span class="line">                val = l1.val</span><br><span class="line">                <span class="comment"># ç§»åŠ¨èŠ‚ç‚¹</span></span><br><span class="line">                l1 = l1.next</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                val = l2.val</span><br><span class="line">                l2 = l2.next</span><br><span class="line">            <span class="comment"># åˆ›å»ºæ–°èŠ‚ç‚¹</span></span><br><span class="line">            node = ListNode(val)</span><br><span class="line">            <span class="comment"># è®¾ç½®å¤´èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> head:</span><br><span class="line">                cur_node = node</span><br><span class="line">                head = cur_node</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                cur_node.next = node</span><br><span class="line">                cur_node = node</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†æ²¡æœ‰éå†å®Œçš„æ•°æ®ï¼Œè¿½åŠ åˆ°èŠ‚ç‚¹ä¹‹å</span></span><br><span class="line">        <span class="keyword">while</span> l1:</span><br><span class="line">            node = ListNode(l1.val)</span><br><span class="line">            l1 = l1.next</span><br><span class="line">            cur_node.next = node</span><br><span class="line">            cur_node = node</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> l2:</span><br><span class="line">            node = ListNode(l2.val)</span><br><span class="line">            l2 = l2.next</span><br><span class="line">            cur_node.next = node</span><br><span class="line">            cur_node = node</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> head</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m1 = ListNode(<span class="number">1</span>)</span><br><span class="line">m2 = ListNode(<span class="number">2</span>)</span><br><span class="line">m3 = ListNode(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">m1.next = m2</span><br><span class="line">m2.next = m3</span><br><span class="line"></span><br><span class="line">n1 = ListNode(<span class="number">1</span>)</span><br><span class="line">n2 = ListNode(<span class="number">3</span>)</span><br><span class="line">n3 = ListNode(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">n1.next = n2</span><br><span class="line">n2.next = n3</span><br><span class="line"></span><br><span class="line">so = Solution()</span><br><span class="line">print(so.mergeTwoLists(m1, n1).val)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- æœ€é•¿å…¬å…±å‰ç¼€</title>
    <url>/2020/05/23/leetcode-%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%89%8D%E7%BC%80/</url>
    <content><![CDATA[<p>ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æŸ¥æ‰¾å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æœ€é•¿å…¬å…±å‰ç¼€ã€‚</p>
<p>å¦‚æœä¸å­˜åœ¨å…¬å…±å‰ç¼€ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸² <code>&quot;&quot;</code>ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [&quot;flower&quot;,&quot;flow&quot;,&quot;flight&quot;]</span><br><span class="line">è¾“å‡º: &quot;fl&quot;</span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹ 2:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥: [&quot;dog&quot;,&quot;racecar&quot;,&quot;car&quot;]</span><br><span class="line">è¾“å‡º: &quot;&quot;</span><br><span class="line">è§£é‡Š: è¾“å…¥ä¸å­˜åœ¨å…¬å…±å‰ç¼€ã€‚</span><br></pre></td></tr></table></figure>



<a id="more"></a>

<p>å¸¸è§„åšæ³•:</p>
<p>ä»ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹ï¼Œåˆ¤æ–­åˆ°æœ€åä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœæŸæ¬¡ä¸ç›¸ç­‰ï¼Œæˆ–è€…å…¨éƒ¨åŒ¹é…å®Œæˆï¼Œå°±è¿”å›ä¿å­˜å…¬å…±å‰ç¼€çš„ä¸´æ—¶å˜é‡ï¼Œæ—¶é—´å¤æ‚åº¦æ—¶O(n*m)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestCommonPrefix</span><span class="params">(self, strs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">		:type strs: List[str]</span></span><br><span class="line"><span class="string">		:rtype: str</span></span><br><span class="line"><span class="string">		"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> strs:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">        <span class="keyword">if</span> len(strs) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> strs[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        cur = <span class="string">''</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                istr = strs[<span class="number">0</span>][index]</span><br><span class="line">                <span class="keyword">for</span> s <span class="keyword">in</span> strs[<span class="number">1</span>:]:</span><br><span class="line">                    <span class="keyword">if</span> s[index] != istr:</span><br><span class="line">                        <span class="keyword">return</span> cur</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    index += <span class="number">1</span></span><br><span class="line">                    cur = <span class="string">''</span>.join([cur, istr])</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">return</span> cur</span><br></pre></td></tr></table></figure>



<p>çœ‹äº†ä¸‹è¯„è®ºåŒºçš„è§£æ³•ï¼Œç»™è·ªäº†â€¦</p>
<p>ç»™å­—ç¬¦ä¸²æ’åºï¼Œåªéœ€è¦åˆ¤æ–­â€œæœ€å¤§å­—ç¬¦ä¸²â€å’Œâ€œæœ€å°å­—ç¬¦ä¸²â€çš„å…¬å…±å‰ç¼€å³å¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">longestCommonPrefix</span><span class="params">(self, strs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">		:type strs: List[str]</span></span><br><span class="line"><span class="string">		:rtype: str</span></span><br><span class="line"><span class="string">		"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> strs: <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">        maxstr = max(strs)</span><br><span class="line">        minstr = min(strs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> index, value <span class="keyword">in</span> enumerate(minstr):</span><br><span class="line">            <span class="keyword">if</span> value != maxstr[index]:</span><br><span class="line">                <span class="keyword">return</span> maxstr[:index]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> minstr</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- æ‹¬å·ç”Ÿæˆ</title>
    <url>/2020/05/23/leetcode-%E2%80%94-%E6%8B%AC%E5%8F%B7%E7%94%9F%E6%88%90/</url>
    <content><![CDATA[<p><a href="https://leetcode-cn.com/problems/generate-parentheses/" target="_blank" rel="noopener">æ‹¬å·ç”Ÿæˆ</a></p>
<p>ç»™å‡º n ä»£è¡¨ç”Ÿæˆæ‹¬å·çš„å¯¹æ•°ï¼Œè¯·ä½ å†™å‡ºä¸€ä¸ªå‡½æ•°ï¼Œä½¿å…¶èƒ½å¤Ÿç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¹¶ä¸”æœ‰æ•ˆçš„æ‹¬å·ç»„åˆã€‚</p>
<p>ä¾‹å¦‚ï¼Œç»™å‡º n = 3ï¼Œç”Ÿæˆç»“æœä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  &quot;((()))&quot;,</span><br><span class="line">  &quot;(()())&quot;,</span><br><span class="line">  &quot;(())()&quot;,</span><br><span class="line">  &quot;()(())&quot;,</span><br><span class="line">  &quot;()()()&quot;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>ä½¿ç”¨å›æº¯+å‰ªæåš,å…ˆå¾€ç»“æœä¸­æ·»åŠ å·¦æ‹¬å·,å†æ·»åŠ å³æ‹¬å·.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generateParenthesis</span><span class="params">(self, n: int)</span> -&gt; list:</span></span><br><span class="line">        self.__result = []</span><br><span class="line">        self.__add_all(<span class="number">0</span>, <span class="number">0</span>, n, <span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.__result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__add_all</span><span class="params">(self, used_left, used_right, n, cur)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">		é€’å½’è®¡ç®—</span></span><br><span class="line"><span class="string">		:param used_left: å·¦æ‹¬å·å·²ä½¿ç”¨æ•°é‡</span></span><br><span class="line"><span class="string">		:param used_right: å³æ‹¬å·å·²ä½¿ç”¨æ•°é‡</span></span><br><span class="line"><span class="string">		:param n: æ€»æ•°</span></span><br><span class="line"><span class="string">		:param cur: å½“å‰ç»“æœ</span></span><br><span class="line"><span class="string">		"""</span></span><br><span class="line">        <span class="comment"># å¦‚æœå·¦æ‹¬å·å’Œå³æ‹¬å·éƒ½å·²ç»ä½¿ç”¨å®Œäº†,åˆ™ç»“æŸæ­¤è½®é€’å½’</span></span><br><span class="line">        <span class="keyword">if</span> used_left == n <span class="keyword">and</span> used_right == n:</span><br><span class="line">            self.__result.append(cur)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœå·¦æ‹¬å·è¿˜èƒ½å¢åŠ </span></span><br><span class="line">        <span class="keyword">if</span> used_left &lt; n:</span><br><span class="line">            self.__add_all(used_left + <span class="number">1</span>, used_right, n, cur + <span class="string">'('</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœå³æ‹¬å·è¿˜èƒ½å¢åŠ ,å¹¶ä¸”å³æ‹¬å·çš„æ•°é‡è¦å°äºå·¦æ‹¬å·çš„æ•°é‡</span></span><br><span class="line">        <span class="keyword">if</span> used_right &lt; n <span class="keyword">and</span> used_right &lt; used_left:</span><br><span class="line">            self.__add_all(used_left, used_right + <span class="number">1</span>, n, cur + <span class="string">')'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">print(s.generateParenthesis(<span class="number">10</span>))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- ç››æœ€å¤šæ°´çš„å®¹å™¨</title>
    <url>/2020/05/23/leetcode-%E7%9B%9B%E6%9C%80%E5%A4%9A%E6%B0%B4%E7%9A%84%E5%AE%B9%E5%99%A8/</url>
    <content><![CDATA[<p><a href="https://leetcode-cn.com/problems/container-with-most-water/" target="_blank" rel="noopener">ç››æœ€å¤šæ°´çš„å®¹å™¨</a></p>
<p>ç»™å®š n ä¸ªéè´Ÿæ•´æ•° a1ï¼Œa2ï¼Œâ€¦ï¼Œanï¼Œæ¯ä¸ªæ•°ä»£è¡¨åæ ‡ä¸­çš„ä¸€ä¸ªç‚¹ (i, ai) ã€‚åœ¨åæ ‡å†…ç”» n æ¡å‚ç›´çº¿ï¼Œå‚ç›´çº¿ i çš„ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«ä¸º (i, ai) å’Œ (i, 0)ã€‚æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸ x è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚</p>
<p>è¯´æ˜ï¼šä½ ä¸èƒ½å€¾æ–œå®¹å™¨ï¼Œä¸” n çš„å€¼è‡³å°‘ä¸º 2ã€‚<br><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/pic/question_11.jpg" alt=""><br>å›¾ä¸­å‚ç›´çº¿ä»£è¡¨è¾“å…¥æ•°ç»„ (1,8,6,2,5,4,8,3,7)ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå®¹å™¨èƒ½å¤Ÿå®¹çº³æ°´ï¼ˆè¡¨ç¤ºä¸ºè“è‰²éƒ¨åˆ†ï¼‰çš„æœ€å¤§å€¼ä¸º 49ã€‚</p>
<p>ç¤ºä¾‹:</p>
<p>è¾“å…¥: (1,8,6,2,5,4,8,3,7)<br>è¾“å‡º: 49</p>
<a id="more"></a>

<p>å…¶å®å°±æ˜¯æ±‚æœ€å¤§é¢ç§¯.<br>ä¸€ä¸ªç´¢å¼•æŒ‡å‘æœ€å·¦è¾¹,ä¸€ç›´æŒ‡å‘æœ€å³è¾¹,ç„¶ååˆ¤æ–­ä¸¤ä¸ªç´¢å¼•å¤„çš„å€¼çš„å¤§å°,å“ªä¸ªå°,å°±å°†å¯¹åº”çš„ç´¢å¼•å¾€ä¸­å¿ƒé ,ç›´åˆ°å·¦è¾¹çš„å¤§äºç­‰äºå³è¾¹å³å¯,å–å¾—æœ€å¤§å€¼.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-5-8 23:58</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maxArea</span><span class="params">(self, height)</span> -&gt; int:</span></span><br><span class="line">        start = <span class="number">0</span></span><br><span class="line">        end = len(height) - <span class="number">1</span></span><br><span class="line">        maxnum = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> end &gt; start:</span><br><span class="line">            startnum = height[start]</span><br><span class="line">            endnum = height[end]</span><br><span class="line">            <span class="keyword">if</span> min(startnum, endnum) * (end - start) &gt; maxnum:</span><br><span class="line">                maxnum = min(startnum, endnum) * (end - start)</span><br><span class="line">            <span class="keyword">if</span> startnum &lt; endnum:</span><br><span class="line">                start += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                end -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> maxnum</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- æ•´æ•°åè½¬</title>
    <url>/2020/05/23/leetcode-%E6%95%B4%E6%95%B0%E5%8F%8D%E8%BD%AC/</url>
    <content><![CDATA[<p><a href="https://leetcode-cn.com/problems/reverse-integer/" target="_blank" rel="noopener">æ•´æ•°åè½¬</a></p>
<p>ç»™å‡ºä¸€ä¸ª 32 ä½çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œä½ éœ€è¦å°†è¿™ä¸ªæ•´æ•°ä¸­æ¯ä½ä¸Šçš„æ•°å­—è¿›è¡Œåè½¬ã€‚</p>
<p>ç¤ºä¾‹ 1:<br>è¾“å…¥: 123<br>è¾“å‡º: 321</p>
<p> ç¤ºä¾‹ 2:<br>è¾“å…¥: -123<br>è¾“å‡º: -321</p>
<p>ç¤ºä¾‹ 3:<br>è¾“å…¥: 120<br>è¾“å‡º: 21</p>
<p>æ³¨æ„:<br>å‡è®¾æˆ‘ä»¬çš„ç¯å¢ƒåªèƒ½å­˜å‚¨å¾—ä¸‹ 32 ä½çš„æœ‰ç¬¦å·æ•´æ•°ï¼Œåˆ™å…¶æ•°å€¼èŒƒå›´ä¸º [âˆ’2<sup>31</sup>,  2<sup>31</sup> âˆ’ 1]ã€‚è¯·æ ¹æ®è¿™ä¸ªå‡è®¾ï¼Œå¦‚æœåè½¬åæ•´æ•°æº¢å‡ºé‚£ä¹ˆå°±è¿”å› 0ã€‚</p>
<a id="more"></a>

<p>æ²¡ä»€ä¹ˆéš¾åº¦,ç¡¬åˆšå°±æˆ.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-5-8 23:43</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverse</span><span class="params">(self, x: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="keyword">if</span> x == <span class="number">0</span>:</span><br><span class="line">            y = <span class="number">0</span></span><br><span class="line">        <span class="keyword">elif</span> x &gt; <span class="number">0</span>:</span><br><span class="line">            y = int(<span class="string">''</span>.join(list(reversed(str(x)))))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            y = int(str(<span class="string">'-'</span>) + <span class="string">''</span>.join(list(reversed(str(-x)))))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="number">-2</span> ** <span class="number">31</span> &lt; y &lt; <span class="number">2</span> ** <span class="number">31</span> - <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> y</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- LRUç¼“å­˜æœºåˆ¶</title>
    <url>/2020/05/23/leetcode-LRU%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<p><a href="https://leetcode-cn.com/problems/lru-cache/" target="_blank" rel="noopener">LRUç¼“å­˜æœºåˆ¶</a></p>
<p>è¿ç”¨ä½ æ‰€æŒæ¡çš„æ•°æ®ç»“æ„ï¼Œè®¾è®¡å’Œå®ç°ä¸€ä¸ª  LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜æœºåˆ¶ã€‚å®ƒåº”è¯¥æ”¯æŒä»¥ä¸‹æ“ä½œï¼š è·å–æ•°æ® get å’Œ å†™å…¥æ•°æ® put ã€‚</p>
<p>è·å–æ•°æ® get(key) - å¦‚æœå¯†é’¥ (key) å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è·å–å¯†é’¥çš„å€¼ï¼ˆæ€»æ˜¯æ­£æ•°ï¼‰ï¼Œå¦åˆ™è¿”å› -1ã€‚<br>å†™å…¥æ•°æ® put(key, value) - å¦‚æœå¯†é’¥ä¸å­˜åœ¨ï¼Œåˆ™å†™å…¥å…¶æ•°æ®å€¼ã€‚å½“ç¼“å­˜å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå®ƒåº”è¯¥åœ¨å†™å…¥æ–°æ•°æ®ä¹‹å‰åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®å€¼ï¼Œä»è€Œä¸ºæ–°çš„æ•°æ®å€¼ç•™å‡ºç©ºé—´ã€‚</p>
<p>è¿›é˜¶:</p>
<p>ä½ æ˜¯å¦å¯ä»¥åœ¨ O(1) æ—¶é—´å¤æ‚åº¦å†…å®Œæˆè¿™ä¸¤ç§æ“ä½œï¼Ÿ</p>
<p>ç¤ºä¾‹:</p>
<p>LRUCache cache = new LRUCache( 2 /* ç¼“å­˜å®¹é‡ */ );</p>
<p>cache.put(1, 1);<br/><br>cache.put(2, 2);<br/><br>cache.get(1);       // è¿”å›  1<br/><br>cache.put(3, 3);    // è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 2 ä½œåºŸ<br/><br>cache.get(2);       // è¿”å› -1 (æœªæ‰¾åˆ°)<br/><br>cache.put(4, 4);    // è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 1 ä½œåºŸ<br/><br>cache.get(1);       // è¿”å› -1 (æœªæ‰¾åˆ°)<br/><br>cache.get(3);       // è¿”å›  3<br/><br>cache.get(4);       // è¿”å›  4<br/></p>
<a id="more"></a>

<p>ä½¿ç”¨python collectionsçš„OrderDictåšçš„ï¼Œå°±ä¸éœ€è¦å†è‡ªå·±é€ è½®å­äº†â€¦<br/><br>ä¸€çœ‹è·Ÿå…¶ä»–è¯­è¨€çš„æ¯”è¾ƒï¼Œæ€§èƒ½çœŸçš„æ˜¯å·®çš„ä¸æ­¢ä¸€ç‚¹å•Šâ€¦<br/><br>æ‰§è¡Œç”¨æ—¶ : 144 ms, åœ¨LRU Cacheçš„Python3æäº¤ä¸­å‡»è´¥äº†84.29% çš„ç”¨æˆ·<br/><br>å†…å­˜æ¶ˆè€— : 21.8 MB, åœ¨LRU Cacheçš„Python3æäº¤ä¸­å‡»è´¥äº†0.00% çš„ç”¨æˆ·</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-3-31 15:33</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRUCache</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, capacity: int)</span>:</span></span><br><span class="line">        self.__capacity = capacity</span><br><span class="line">        self.__now_count = <span class="number">0</span></span><br><span class="line">        self.__cache = OrderedDict()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key: int)</span> -&gt; int:</span></span><br><span class="line">        <span class="comment"># å¦‚æœkeyå€¼ä¸å­˜åœ¨ï¼Œåœ¨è¿”å›-1</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> self.__cache:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å› ä¸ºæ—¶æœ‰é¡ºåºçš„å­—å…¸ï¼Œé‚£ä¹ˆè¦å®ç°LRUç¼“å­˜åŠŸèƒ½ï¼Œå°±éœ€è¦å…ˆåˆ é™¤ï¼Œå†æ’å…¥</span></span><br><span class="line">        <span class="comment"># é‚£ä¹ˆæœ€åä¸€ä¸ªå…ƒç´ å°±æ˜¯æœ€è¿‘ä½¿ç”¨çš„ï¼Œæœ€å‰é¢çš„å…ƒç´ å°±æ˜¯æœ€å¼€å§‹ä½¿ç”¨çš„</span></span><br><span class="line">        <span class="comment"># å½“è¾¾åˆ°å®¹é‡ä¸Šé™æ—¶ï¼Œå°±åˆ é™¤æœ€å‰é¢çš„å…ƒç´ </span></span><br><span class="line">        value = self.__cache.pop(key)</span><br><span class="line">        self.__cache[key] = value</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, key: int, value: int)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="comment"># å¦‚æœè¦æ’å…¥çš„å…ƒç´ ä¸å­˜åœ¨ï¼Œå¹¶ä¸”å®¹é‡å·²åˆ°ä¸Šé™æ—¶ï¼Œå°±åˆ é™¤æœ€å¼€å§‹ä½¿ç”¨çš„å…ƒç´ </span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> self.__cache <span class="keyword">and</span> self.__now_count &gt;= self.__capacity:</span><br><span class="line">            <span class="comment"># å®¹é‡-1</span></span><br><span class="line">            self.__now_count -= <span class="number">1</span></span><br><span class="line">            <span class="comment"># åˆ é™¤æœ€å‰é¢çš„å…ƒç´ </span></span><br><span class="line">            self.__cache.popitem(last=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœè¦åŠ å…¥çš„å…ƒç´ å·²ç»å­˜åœ¨äº†ï¼Œé‚£ä¹ˆå°±éœ€è¦å…ˆåˆ é™¤</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> self.__cache:</span><br><span class="line">            self.__now_count -= <span class="number">1</span></span><br><span class="line">            self.__cache.pop(key)</span><br><span class="line"></span><br><span class="line">        self.__cache[key] = value</span><br><span class="line">        self.__now_count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">print_length</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'now_count = &#123;0&#125;, cache.length = &#123;1&#125;'</span>.format(self.__now_count, len(self.__cache)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cache = LRUCache(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">cache.put(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">cache.put(<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">cache.print_length()</span><br><span class="line"></span><br><span class="line">print(cache.get(<span class="number">1</span>))</span><br><span class="line">cache.put(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">print(cache.get(<span class="number">2</span>))</span><br><span class="line">cache.put(<span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line">print(cache.get(<span class="number">1</span>))</span><br><span class="line">print(cache.get(<span class="number">3</span>))</span><br><span class="line">print(cache.get(<span class="number">4</span>))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- åˆå¹¶Kä¸ªæœ‰åºé“¾è¡¨</title>
    <url>/2020/05/23/leetcode-%E5%90%88%E5%B9%B6K%E4%B8%AA%E6%9C%89%E5%BA%8F%E9%93%BE%E8%A1%A8/</url>
    <content><![CDATA[<p><a href="https://leetcode-cn.com/problems/merge-k-sorted-lists/" target="_blank" rel="noopener">åˆå¹¶Kä¸ªæœ‰åºé“¾è¡¨</a></p>
<p>åˆå¹¶ k ä¸ªæ’åºé“¾è¡¨ï¼Œè¿”å›åˆå¹¶åçš„æ’åºé“¾è¡¨ã€‚è¯·åˆ†æå’Œæè¿°ç®—æ³•çš„å¤æ‚åº¦ã€‚</p>
<p>ç¤ºä¾‹:</p>
<p>è¾“å…¥:<br>[<br>  1-&gt;4-&gt;5,<br>  1-&gt;3-&gt;4,<br>  2-&gt;6<br>]<br>è¾“å‡º: 1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4-&gt;5-&gt;6</p>
<a id="more"></a>

<br/>
<br/>
æ–¹æ³•è·Ÿåˆå¹¶ä¸¤ä¸ªé“¾è¡¨å·®ä¸å¤šï¼Œä¸è¿‡è¦é‡‡ç”¨åˆ†è€Œæ²»ä¹‹çš„æ–¹æ³•.....
ä¹‹å‰é‡‡ç”¨reduceå†™è¶…æ—¶äº†ï¼Œä¹Ÿè‚¯å®šå¾—è¶…æ—¶ï¼Œæ˜¯å¾—å¤šè ¢...

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-3-30 17:10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.next = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mergeKLists</span><span class="params">(self, lists)</span> -&gt; ListNode:</span></span><br><span class="line">        <span class="comment"># å‡ ç§ç‰¹æ®Šæƒ…å†µ</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> lists:</span><br><span class="line">            <span class="keyword">return</span> lists</span><br><span class="line">        <span class="keyword">elif</span> len(lists) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> lists[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">elif</span> len(lists) == <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> self.mergeTwoLists(lists[<span class="number">0</span>], lists[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ±‚å¾—ä¸­é—´çš„å€¼</span></span><br><span class="line">        <span class="keyword">if</span> len(lists) % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            mid = len(lists) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            mid = (len(lists) + <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">        mid -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># é‡‡ç”¨åˆ†è€Œæ²»ä¹‹çš„æ–¹æ³•æ±‚</span></span><br><span class="line">        <span class="comment"># ä¸€ç›´äºŒåˆ†ä¸‹å»ï¼Œæœ€ååˆå¹¶</span></span><br><span class="line">        <span class="keyword">return</span> self.mergeTwoLists(self.mergeKLists(lists[:mid]), self.mergeKLists(lists[mid:]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mergeTwoLists</span><span class="params">(self, l1: ListNode, l2: ListNode)</span> -&gt; ListNode:</span></span><br><span class="line">        cur_node = <span class="literal">None</span></span><br><span class="line">        head = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®ä¸ºç©ºçš„æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> l1:</span><br><span class="line">            <span class="keyword">return</span> l2</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> l2:</span><br><span class="line">            <span class="keyword">return</span> l1</span><br><span class="line"></span><br><span class="line">        <span class="comment"># éå†åˆ¤æ–­å¤§å°</span></span><br><span class="line">        <span class="keyword">while</span> l1 <span class="keyword">and</span> l2:</span><br><span class="line">            <span class="keyword">if</span> l1.val &lt; l2.val:</span><br><span class="line">                val = l1.val</span><br><span class="line">                <span class="comment"># ç§»åŠ¨èŠ‚ç‚¹</span></span><br><span class="line">                l1 = l1.next</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                val = l2.val</span><br><span class="line">                l2 = l2.next</span><br><span class="line">            <span class="comment"># åˆ›å»ºæ–°èŠ‚ç‚¹</span></span><br><span class="line">            node = ListNode(val)</span><br><span class="line">            <span class="comment"># è®¾ç½®å¤´èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> head:</span><br><span class="line">                cur_node = node</span><br><span class="line">                head = cur_node</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                cur_node.next = node</span><br><span class="line">                cur_node = node</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†æ²¡æœ‰éå†å®Œçš„æ•°æ®ï¼Œè¿½åŠ åˆ°èŠ‚ç‚¹ä¹‹å</span></span><br><span class="line">        <span class="keyword">while</span> l1:</span><br><span class="line">            node = ListNode(l1.val)</span><br><span class="line">            l1 = l1.next</span><br><span class="line">            cur_node.next = node</span><br><span class="line">            cur_node = node</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> l2:</span><br><span class="line">            node = ListNode(l2.val)</span><br><span class="line">            l2 = l2.next</span><br><span class="line">            cur_node.next = node</span><br><span class="line">            cur_node = node</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> head</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m1 = ListNode(<span class="number">1</span>)</span><br><span class="line">m2 = ListNode(<span class="number">2</span>)</span><br><span class="line">m3 = ListNode(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">m1.next = m2</span><br><span class="line">m2.next = m3</span><br><span class="line"></span><br><span class="line">n1 = ListNode(<span class="number">1</span>)</span><br><span class="line">n2 = ListNode(<span class="number">3</span>)</span><br><span class="line">n3 = ListNode(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">n1.next = n2</span><br><span class="line">n2.next = n3</span><br><span class="line"></span><br><span class="line">x1 = ListNode(<span class="number">1</span>)</span><br><span class="line">x2 = ListNode(<span class="number">10</span>)</span><br><span class="line">x1.next = x2</span><br><span class="line"></span><br><span class="line">so = Solution()</span><br><span class="line">node = so.mergeKLists([m1, n1, x1])</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> node:</span><br><span class="line">    print(node.val)</span><br><span class="line">    node = node.next</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</title>
    <url>/2020/05/23/leetcode-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88/</url>
    <content><![CDATA[<p><a href="https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree/" target="_blank" rel="noopener">äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</a></p>
<p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p>
<p>ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€</p>
<p>ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æ ‘:  root = [3,5,1,6,2,0,8,null,null,7,4]</p>
<p><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/pic/32.png" alt="ç¤ºä¾‹"></p>
<p>ç¤ºä¾‹ 1:</p>
<p>è¾“å…¥: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 1</p>
<p>è¾“å‡º: 3</p>
<p>è§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 1 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 3ã€‚<br/></p>
<p>ç¤ºä¾‹ 2:</p>
<p>è¾“å…¥: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 4</p>
<p>è¾“å‡º: 5</p>
<p>è§£é‡Š: èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 5ã€‚å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚</p>
<p>è¯´æ˜:</p>
<p>æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚<br>pã€q ä¸ºä¸åŒèŠ‚ç‚¹ä¸”å‡å­˜åœ¨äºç»™å®šçš„äºŒå‰æ ‘ä¸­ã€‚</p>
<a id="more"></a>


<p>è§£é‡Š:</p>
<p>1.å¦‚æœäºŒå‰æ ‘ä¸­å­˜åœ¨ç€è¯¥çˆ¶èŠ‚ç‚¹ï¼Œé‚£ä¹ˆpä¸€å®šåœ¨å·¦å­æ ‘ä¸Šï¼Œqä¸€å®šåœ¨å³å­æ ‘ä¸Š</p>
<p>2.å¦‚æœåœ¨æŸèŠ‚ç‚¹ä¸­çš„å·¦å­æ ‘ä¸­æ‰¾åˆ°äº†pï¼Œå³å­æ ‘ä¸­æ‰¾åˆ°äº†qï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹å°±æ˜¯æœ€è¿‘çš„å…¬å…±çˆ¶èŠ‚ç‚¹</p>
<p>3.å¦‚æœpï¼Œqéƒ½å¤„äºæŸèŠ‚ç‚¹çš„åŒä¸€åˆ†æ”¯ä¸Šï¼Œé‚£ä¹ˆå°±éœ€è¦æ²¿ç€è¯¥åˆ†æ”¯ç»§ç»­éå†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-3-31 17:46</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.left = <span class="literal">None</span></span><br><span class="line">        self.right = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'val = '</span> + str(self.val)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lowestCommonAncestor</span><span class="params">(self, root: TreeNode, p: TreeNode, q: TreeNode)</span> -&gt; TreeNode:</span></span><br><span class="line">        <span class="comment"># å¦‚æœèŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±æ˜¯å·²ç»éå†åˆ°äº†æœ€å</span></span><br><span class="line">        <span class="comment"># å¦‚æœæ˜¯pï¼Œqï¼Œä¹Ÿå°±ä¸å†éœ€è¦ç»§ç»­éå†</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> root <span class="keyword">or</span> root == p <span class="keyword">or</span> root == q:</span><br><span class="line">            <span class="keyword">return</span> root</span><br><span class="line"></span><br><span class="line">        <span class="comment"># éå†èŠ‚ç‚¹çš„å·¦å­æ ‘</span></span><br><span class="line">        left_tree = self.lowestCommonAncestor(root.left, p, q)</span><br><span class="line">        <span class="comment"># éå†èŠ‚ç‚¹çš„å³å­æ ‘</span></span><br><span class="line">        right_tree = self.lowestCommonAncestor(root.right, p, q)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å¦‚æœå·¦å­æ ‘æœ‰æ•°æ®ï¼Œå³å­æ ‘ä¹Ÿæœ‰æ•°æ®ï¼Œé‚£ä¹ˆå°±è¯´æ˜æ˜¯æœ€ç»ˆç»“æœäº†</span></span><br><span class="line">        <span class="keyword">if</span> left_tree <span class="keyword">and</span> right_tree:</span><br><span class="line">            <span class="keyword">return</span> root</span><br><span class="line">        <span class="comment"># å¦‚æœpï¼Œqéƒ½åœ¨å³å­æ ‘ä¸Š</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> left_tree <span class="keyword">and</span> right_tree:</span><br><span class="line">            <span class="keyword">return</span> right_tree</span><br><span class="line">        <span class="comment"># å¦‚æœpï¼Œqéƒ½åœ¨å·¦å­æ ‘ä¸Š</span></span><br><span class="line">        <span class="keyword">elif</span> left_tree <span class="keyword">and</span> <span class="keyword">not</span> right_tree:</span><br><span class="line">            <span class="keyword">return</span> left_tree</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">so = Solution()</span><br><span class="line"></span><br><span class="line">t3 = TreeNode(<span class="number">3</span>)</span><br><span class="line">t5 = TreeNode(<span class="number">5</span>)</span><br><span class="line">t1 = TreeNode(<span class="number">1</span>)</span><br><span class="line">t6 = TreeNode(<span class="number">6</span>)</span><br><span class="line">t2 = TreeNode(<span class="number">2</span>)</span><br><span class="line">t0 = TreeNode(<span class="number">0</span>)</span><br><span class="line">t8 = TreeNode(<span class="number">8</span>)</span><br><span class="line">t7 = TreeNode(<span class="number">7</span>)</span><br><span class="line">t4 = TreeNode(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">t3.left = t5</span><br><span class="line">t3.right = t1</span><br><span class="line"></span><br><span class="line">t5.left = t6</span><br><span class="line">t5.right = t2</span><br><span class="line"></span><br><span class="line">t1.left = t0</span><br><span class="line">t1.right = t8</span><br><span class="line"></span><br><span class="line">t2.left = t7</span><br><span class="line">t2.right = t4</span><br><span class="line"></span><br><span class="line">print(so.lowestCommonAncestor(t3, t4, t8))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- å¯»æ‰¾ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°</title>
    <url>/2020/05/23/leetcode-%E5%AF%BB%E6%89%BE%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E7%9A%84%E4%B8%AD%E4%BD%8D%E6%95%B0/</url>
    <content><![CDATA[<p>ç»™å®šä¸¤ä¸ªå¤§å°ä¸º m å’Œ n çš„æœ‰åºæ•°ç»„ nums1 å’Œ nums2ã€‚<br>è¯·ä½ æ‰¾å‡ºè¿™ä¸¤ä¸ªæœ‰åºæ•°ç»„çš„ä¸­ä½æ•°ï¼Œå¹¶ä¸”è¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(log(m + n))ã€‚<br>ä½ å¯ä»¥å‡è®¾ nums1 å’Œ nums2 ä¸ä¼šåŒæ—¶ä¸ºç©ºã€‚</p>
<p>nums1 = [1, 3]<br>nums2 = [2]</p>
<p>åˆ™ä¸­ä½æ•°æ˜¯ 2.0</p>
<a id="more"></a>

<p>æ¯”è¾ƒç®€å•æŠŠï¼Œä¸¤ä¸ªæ’åºå¥½çš„æ•°ç»„ï¼Œç”¨ä¸€ä¸ªå¾ªç¯å°±èƒ½æå®šäº†.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># __author__ = 'ChenTao'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findMedianSortedArrays</span><span class="params">(self, nums1: list, nums2: list)</span> -&gt; float:</span></span><br><span class="line">        result = []</span><br><span class="line">        m, n = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> m != len(nums1) <span class="keyword">and</span> n != len(nums2):</span><br><span class="line">            <span class="keyword">if</span> nums1[m] &lt; nums2[n]:</span><br><span class="line">                result.append(nums1[m])</span><br><span class="line">                m += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result.append(nums2[n])</span><br><span class="line">                n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        result.extend(nums1[m:])</span><br><span class="line">        result.extend(nums2[n:])</span><br><span class="line">        print(result)</span><br><span class="line">        <span class="keyword">if</span> len(result) % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            mid = int(len(result) / <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> (result[mid - <span class="number">1</span>] + result[mid]) / <span class="number">2.0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            mid = int((len(result) - <span class="number">1</span>) / <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> result[mid] * <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Solution()</span><br><span class="line">nums1 = []</span><br><span class="line">nums2 = [<span class="number">1</span>]</span><br><span class="line">print(s.findMedianSortedArrays(nums1, nums2))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</title>
    <url>/2020/05/23/leetcode-%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E7%9A%84%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88/</url>
    <content><![CDATA[<p><a href="https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-search-tree/" target="_blank" rel="noopener">äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</a></p>
<p>ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p>
<p>ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€</p>
<p>ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æœç´¢æ ‘:  root = [6,2,8,0,4,7,9,null,null,3,5]</p>
<p><img src="https://qxinhai.oss-cn-shenzhen.aliyuncs.com/pic/33.png" alt="1.png"></p>
<p>ç¤ºä¾‹ 1:</p>
<p>è¾“å…¥: root = [6,2,8,0,4,7,9,null,null,3,5], p = 2, q = 8</p>
<p>è¾“å‡º: 6</p>
<p>è§£é‡Š: èŠ‚ç‚¹ 2 å’ŒèŠ‚ç‚¹ 8 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯ 6ã€‚</p>
<p>ç¤ºä¾‹ 2:</p>
<p>è¾“å…¥: root = [6,2,8,0,4,7,9,null,null,3,5], p = 2, q = 4<br>è¾“å‡º: 2</p>
<p>è§£é‡Š: èŠ‚ç‚¹ 2 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯ 2, å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚</p>
<p>è¯´æ˜:</p>
<p>æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚<br>pã€q ä¸ºä¸åŒèŠ‚ç‚¹ä¸”å‡å­˜åœ¨äºç»™å®šçš„äºŒå‰æœç´¢æ ‘ä¸­ã€‚</p>
<a id="more"></a>

<br/>
è¿™é¢˜ç›¸å¯¹äºç›´æ¥æŸ¥æ‰¾æœ€è¿‘çš„çˆ¶èŠ‚ç‚¹ï¼Œè¿˜æ˜¯å®¹æ˜“å¾ˆå¤šçš„ã€‚æœç´¢äºŒå‰æ ‘æœ¬èº«å°±å·²ç»æ’åºå¥½äº†çš„ï¼Œåªéœ€è¦åˆ¤æ–­æ ¹èŠ‚ç‚¹æ¯”æŸ¥æ‰¾çš„èŠ‚ç‚¹å¤§å°å³å¯ã€‚

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: _Tao</span></span><br><span class="line"><span class="comment"># @Time: 19-3-31 18:18</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.left = <span class="literal">None</span></span><br><span class="line">        self.right = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'val = '</span> + str(self.val)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lowestCommonAncestor</span><span class="params">(self, root: TreeNode, p: TreeNode, q: TreeNode)</span> -&gt; TreeNode:</span></span><br><span class="line">        <span class="comment"># è°ƒæ•´é¡ºåºï¼Œå› ä¸ºè¾“å…¥çš„èŠ‚ç‚¹ä¸­ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°pçš„å€¼å¤§äºqçš„å€¼çš„æƒ…å†µ</span></span><br><span class="line">        <span class="comment"># è°ƒæ•´ä¸ºï¼Œpå€¼è‚¯å®šå°äºqå€¼</span></span><br><span class="line">        <span class="keyword">if</span> p.val &gt; q.val:</span><br><span class="line">            p, q = q, p</span><br><span class="line">        <span class="comment"># æŒ‰ç…§æœç´¢äºŒå‰æ ‘çš„æ¦‚å¿µï¼Œå½“èŠ‚ç‚¹çš„å€¼å¤§äºpå€¼åˆ‡å°äºqå€¼æ—¶ï¼Œé‚£ä¹ˆå°±æ˜¯æœ€è¿‘çš„çˆ¶èŠ‚ç‚¹äº†</span></span><br><span class="line">        <span class="comment"># æ³¨æ„ç­‰å·çš„æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">if</span> p.val &lt;= root.val &lt;= q.val:</span><br><span class="line">            <span class="keyword">return</span> root</span><br><span class="line">        <span class="comment"># å¦‚æœrootå€¼å¤§äºpï¼Œqå€¼ï¼Œé‚£ä¹ˆå°±éå†å®ƒçš„å·¦å­æ ‘</span></span><br><span class="line">        <span class="keyword">elif</span> root.val &gt;= p.val <span class="keyword">and</span> root.val &gt;= q.val:</span><br><span class="line">            <span class="keyword">return</span> self.lowestCommonAncestor(root.left, p, q)</span><br><span class="line">        <span class="comment"># å¦‚æœrootå€¼å°äºp,qå€¼ï¼Œé‚£ä¹ˆå°±éå†å³å­æ ‘</span></span><br><span class="line">        <span class="keyword">elif</span> root.val &lt;= p.val <span class="keyword">and</span> root.val &lt;= q.val:</span><br><span class="line">            <span class="keyword">return</span> self.lowestCommonAncestor(root.right, p, q)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">so = Solution()</span><br><span class="line"></span><br><span class="line">t3 = TreeNode(<span class="number">3</span>)</span><br><span class="line">t5 = TreeNode(<span class="number">5</span>)</span><br><span class="line">t1 = TreeNode(<span class="number">1</span>)</span><br><span class="line">t6 = TreeNode(<span class="number">6</span>)</span><br><span class="line">t2 = TreeNode(<span class="number">2</span>)</span><br><span class="line">t0 = TreeNode(<span class="number">0</span>)</span><br><span class="line">t8 = TreeNode(<span class="number">8</span>)</span><br><span class="line">t7 = TreeNode(<span class="number">7</span>)</span><br><span class="line">t4 = TreeNode(<span class="number">4</span>)</span><br><span class="line">t9 = TreeNode(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">t6.left = t2</span><br><span class="line">t6.right = t8</span><br><span class="line"></span><br><span class="line">t2.left = t0</span><br><span class="line">t2.right = t4</span><br><span class="line"></span><br><span class="line">t8.left = t7</span><br><span class="line">t8.right = t9</span><br><span class="line"></span><br><span class="line">t4.left = t3</span><br><span class="line">t4.right = t5</span><br><span class="line"></span><br><span class="line">print(so.lowestCommonAncestor(t6, t4, t3))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>leetcode --- æœ‰æ•ˆçš„æ‹¬å·</title>
    <url>/2020/05/23/leetcode-%E6%9C%89%E6%95%88%E7%9A%84%E6%8B%AC%E5%8F%B7-1/</url>
    <content><![CDATA[<p><a href="https://leetcode-cn.com/problems/valid-parentheses/" target="_blank" rel="noopener">æœ‰æ•ˆçš„æ‹¬å·</a><br><br/><br>ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ â€˜(â€˜ï¼Œâ€™)â€™ï¼Œâ€™{â€˜ï¼Œâ€™}â€™ï¼Œâ€™[â€˜ï¼Œâ€™]â€™ çš„å­—ç¬¦ä¸²ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚</p>
<p>æœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š</p>
<p>å·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚<br>å·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚<br>æ³¨æ„ç©ºå­—ç¬¦ä¸²å¯è¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆå­—ç¬¦ä¸²ã€‚</p>
<a id="more"></a>

<br/>
<br/>

<p>â€¦.æ²¡çœ‹æ¸…é¢˜ç›®ï¼Œä»¥ä¸ºæ˜¯è¾“å…¥ä»»æ„çš„å­—ç¬¦ä¸²ï¼Œç„¶åå†™äº†ä»¥ä¸‹åšæ³•.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isValid</span><span class="params">(self, s: str)</span> -&gt; bool:</span></span><br><span class="line">    alist = []</span><br><span class="line">    left = <span class="string">'&#123;[('</span></span><br><span class="line">    right = <span class="string">')]&#125;'</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> ch <span class="keyword">in</span> left:</span><br><span class="line">            alist.append(ch)</span><br><span class="line">        <span class="keyword">elif</span> alist:</span><br><span class="line">            ch2 = alist[<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">if</span> (ch2 == <span class="string">'('</span> <span class="keyword">and</span> ch == <span class="string">')'</span>) <span class="keyword">or</span> (ch2 == <span class="string">'['</span> <span class="keyword">and</span> ch == <span class="string">']'</span>) <span class="keyword">or</span> (ch2 == <span class="string">'&#123;'</span> <span class="keyword">and</span> ch == <span class="string">'&#125;'</span>):</span><br><span class="line">                alist.pop()</span><br><span class="line">            <span class="keyword">elif</span> ch <span class="keyword">in</span> right:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> ch <span class="keyword">in</span> right:</span><br><span class="line">            alist.append(ch)</span><br><span class="line">    <span class="keyword">return</span> len(alist) == <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>å†™çš„å¾ˆä¹±ï¼Œä½†ä¹Ÿé€šè¿‡äº†ã€‚<br>çœ‹æ¸…æ¥šé¢˜ç›®åï¼Œåªä¼šè¾“å…¥æ‹¬å·ï¼Œé‚£ä¹ˆé¢˜ç›®å°±å˜å¾—å¾ˆç®€å•äº†.<br>åªéœ€ä¸€ç›´å¾ªç¯ï¼Œç„¶ååˆ é™¤æ‰æˆå¯¹çš„æ‹¬å·å°±è¡Œäº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isValid2</span><span class="params">(self, s: str)</span> -&gt; bool:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="string">'()'</span> <span class="keyword">in</span> s <span class="keyword">or</span> <span class="string">'&#123;&#125;'</span> <span class="keyword">in</span> s <span class="keyword">or</span> <span class="string">'[]'</span> <span class="keyword">in</span> s:</span><br><span class="line">        s = s.replace(<span class="string">'()'</span>, <span class="string">''</span>).replace(<span class="string">'[]'</span>, <span class="string">''</span>).replace(<span class="string">'&#123;&#125;'</span>, <span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> s == <span class="string">''</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„å†™æ³•å¾ˆç®€å•ï¼Œä½†è€—æ—¶å¤ªé•¿ï¼Œå¯ä»¥æ”¹æˆä»¥ä¸‹å†™æ³•ï¼Œè™½ç„¶ç›¸å¯¹äºå…¶ä»–è¯­è¨€çš„è€—æ—¶ï¼Œä»æ—§æ˜¯ä¸ªddã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isValid</span><span class="params">(self, s: str)</span> -&gt; bool:</span></span><br><span class="line">    left = <span class="string">'&#123;[('</span></span><br><span class="line">    right = <span class="string">')]&#125;'</span></span><br><span class="line">    alist = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> s:</span><br><span class="line">       <span class="keyword">if</span> ch <span class="keyword">in</span> left <span class="keyword">or</span> <span class="keyword">not</span> alist:</span><br><span class="line">           <span class="keyword">if</span> <span class="keyword">not</span> alist <span class="keyword">and</span> ch <span class="keyword">in</span> right:</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">           alist.append(ch)</span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           ch2 = alist[<span class="number">-1</span>]</span><br><span class="line">           <span class="keyword">if</span> (ch2 == <span class="string">'('</span> <span class="keyword">and</span> ch == <span class="string">')'</span>) <span class="keyword">or</span> \</span><br><span class="line">                   (ch2 == <span class="string">'['</span> <span class="keyword">and</span> ch == <span class="string">']'</span>) <span class="keyword">or</span> \</span><br><span class="line">                   (ch2 == <span class="string">'&#123;'</span> <span class="keyword">and</span> ch == <span class="string">'&#125;'</span>):</span><br><span class="line">               alist.pop()</span><br><span class="line">           <span class="keyword">else</span>:</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> len(alist) == <span class="number">0</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode --- ç¯å½¢é“¾è¡¨</title>
    <url>/2020/05/23/leetcode%20---%20%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8/</url>
    <content><![CDATA[<p><a href="https://leetcode-cn.com/problems/linked-list-cycle/" target="_blank" rel="noopener">ç¯å½¢é“¾è¡¨</a></p>
<p>ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚</p>
<p>ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•´æ•° <code>pos</code> æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ å¦‚æœ <code>pos</code> æ˜¯ <code>-1</code>ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [3,2,0,-4], pos = 1</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line">è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">è¾“å…¥ï¼šhead = [1,2], pos = 0</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line">è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>è¯•äº†ä¸¤ç§æ–¹æ³•:</p>
<p>ç¬¬ä¸€ç§ç”¨çš„æ˜¯å¿«æ…¢æŒ‡é’ˆï¼Œå¤æ‚åº¦æ˜¯60 ms\18.2 MB</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># class ListNode(object):</span></span><br><span class="line"><span class="comment">#     def __init__(self, x):</span></span><br><span class="line"><span class="comment">#         self.val = x</span></span><br><span class="line"><span class="comment">#         self.next = None</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hasCycle</span><span class="params">(self, head)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> head <span class="keyword">or</span> <span class="keyword">not</span> head.next:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        fast = head</span><br><span class="line">        slow = fast.next</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> fast != slow:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                fast = fast.next</span><br><span class="line">                slow = slow.next.next</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>



<p>ç¬¬äºŒç§è¯•äº†ä¸‹ç”¨ä¸€ä¸ª åˆ—è¡¨å­˜ä¸‹å·²ç»éå†è¿‡çš„èŠ‚ç‚¹ï¼Œç„¶ååˆ¤æ–­æ–°çš„èŠ‚ç‚¹æ˜¯å¦åœ¨åˆ—è¡¨ä¸­â€¦.ä½†æ—¶é—´å¤æ‚åº¦æœ‰ç‚¹çœ‹ä¸æ‡‚äº†ï¼Œæœ¬æ¥ä»¥ä¸ºç©ºé—´å¤æ‚åº¦ä¼šå¾ˆé«˜ï¼Œæ—¶é—´å¤æ‚åº¦ä¼šä½ä¸€ç‚¹çš„ ï¼š 1764 ms\18.1 MB </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># class ListNode(object):</span></span><br><span class="line"><span class="comment">#     def __init__(self, x):</span></span><br><span class="line"><span class="comment">#         self.val = x</span></span><br><span class="line"><span class="comment">#         self.next = None</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hasCycle</span><span class="params">(self, head)</span>:</span></span><br><span class="line"></span><br><span class="line">        tmp = []</span><br><span class="line">        <span class="keyword">while</span> head:</span><br><span class="line">            <span class="keyword">if</span> head <span class="keyword">in</span> tmp:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            tmp.append(head)</span><br><span class="line">            head = head.next</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Leetcode</category>
      </categories>
  </entry>
</search>
